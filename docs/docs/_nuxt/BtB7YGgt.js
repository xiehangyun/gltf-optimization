import{toKTX2UASTC as Qc}from"./DYAt5juM.js";import"./ChbFcRqi.js";class Ca{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t),this}removeEventListener(e,t){const n=this._listeners[e];if(n!==void 0){const o=n.indexOf(t);o!==-1&&n.splice(o,1)}return this}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){const n=s.slice(0);for(let o=0,i=n.length;o<i;o++)n[o].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class Bt{constructor(e,t,s,n={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=s,this._attributes=n,!t.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class Jc extends Ca{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const t=new Set;for(const s of this.listParentEdges(e))t.add(s.getParent());return Array.from(t)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const t=new Set;for(const s of this.listChildEdges(e))t.add(s.getChild());return Array.from(t)}disconnectParents(e,t){for(const s of this.listParentEdges(e))(!t||t(s.getParent()))&&s.dispose();return this}_createEdge(e,t,s,n){const o=new Bt(e,t,s,n);this._edges.add(o);const i=o.getParent();this._parentEdges.has(i)||this._parentEdges.set(i,new Set),this._parentEdges.get(i).add(o);const a=o.getChild();return this._childEdges.has(a)||this._childEdges.set(a,new Set),this._childEdges.get(a).add(o),o}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function qn(){return qn=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},qn.apply(this,arguments)}class ot{constructor(e){if(this.list=[],e)for(const t of e)this.list.push(t)}add(e){this.list.push(e)}remove(e){const t=this.list.indexOf(e);t>=0&&this.list.splice(t,1)}removeChild(e){const t=[];for(const s of this.list)s.getChild()===e&&t.push(s);for(const s of t)this.remove(s);return t}listRefsByChild(e){const t=[];for(const s of this.list)s.getChild()===e&&t.push(s);return t}values(){return this.list}}class ie{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const t of e)this.add(t)}add(e){const t=e.getChild();this.removeChild(t),this.set.add(e),this.map.set(t,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const t=this.map.get(e)||null;return t&&this.remove(t),t}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class ke{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,t){this.map[e]=t}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const se=Symbol("attributes"),wt=Symbol("immutableKeys");class so extends Ca{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[se]=void 0,this[wt]=void 0,this.graph=e,this[wt]=new Set,this[se]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const s in e){const n=e[s];if(n instanceof so){const o=this.graph._createEdge(s,this,n);this[wt].add(s),t[s]=o}else t[s]=n}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const s in this[se]){const n=this[se][s];if(n instanceof Bt){const o=n;o.getChild()===e&&this.setRef(s,t,o.getAttributes())}else if(n instanceof ot)for(const o of n.listRefsByChild(e)){const i=o.getAttributes();this.removeRef(s,e),this.addRef(s,t,i)}else if(n instanceof ie){const o=n.getRefByChild(e);if(o){const i=o.getAttributes();this.removeRef(s,e),this.addRef(s,t,i)}}else if(n instanceof ke)for(const o of n.keys()){const i=n.get(o);i.getChild()===e&&this.setRefMap(s,o,t,i.getAttributes())}}return this}get(e){return this[se][e]}set(e,t){return this[se][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[se][e];return t?t.getChild():null}setRef(e,t,s){if(this[wt].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const n=this[se][e];if(n&&n.dispose(),!t)return this;const o=this.graph._createEdge(e,this,t,s);return this[se][e]=o,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(s=>s.getChild())}addRef(e,t,s){const n=this.graph._createEdge(e,this,t,s);return this.assertRefList(e).add(n),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){const s=this.assertRefList(e);if(s instanceof ot)for(const n of s.listRefsByChild(t))n.dispose();else{const n=s.getRefByChild(t);n&&n.dispose()}return this}assertRefList(e){const t=this[se][e];if(t instanceof ot||t instanceof ie)return t;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(t=>t.getChild())}getRefMap(e,t){const n=this.assertRefMap(e).get(t);return n?n.getChild():null}setRefMap(e,t,s,n){const o=this.assertRefMap(e),i=o.get(t);if(i&&i.dispose(),!s)return this;n=Object.assign(n||{},{key:t});const a=this.graph._createEdge(e,this,s,qn({},n,{key:t}));return o.set(t,a),this.dispatchEvent({type:"change",attribute:e,key:t})}assertRefMap(e){const t=this[se][e];if(t instanceof ke)return t;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(qn({},e,{target:this})),this.graph.dispatchEvent(qn({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const t=e.getName();if(this[se][t]===e)this[se][t]=null,this[wt].has(t)&&e.getChild().dispose();else if(this[se][t]instanceof ot)this[se][t].remove(e);else if(this[se][t]instanceof ie)this[se][t].remove(e);else if(this[se][t]instanceof ke){const s=this[se][t];for(const n of s.keys())s.get(n)===e&&s.delete(n)}else return;this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:t})}}const Da="v4.2.0",$t="@glb.bin";var C;(function(r){r.ACCESSOR="Accessor",r.ANIMATION="Animation",r.ANIMATION_CHANNEL="AnimationChannel",r.ANIMATION_SAMPLER="AnimationSampler",r.BUFFER="Buffer",r.CAMERA="Camera",r.MATERIAL="Material",r.MESH="Mesh",r.PRIMITIVE="Primitive",r.PRIMITIVE_TARGET="PrimitiveTarget",r.NODE="Node",r.ROOT="Root",r.SCENE="Scene",r.SKIN="Skin",r.TEXTURE="Texture",r.TEXTURE_INFO="TextureInfo"})(C||(C={}));var _s;(function(r){r.INTERLEAVED="interleaved",r.SEPARATE="separate"})(_s||(_s={}));var De;(function(r){r.ARRAY_BUFFER="ARRAY_BUFFER",r.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",r.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",r.OTHER="OTHER",r.SPARSE="SPARSE"})(De||(De={}));var Be;(function(r){r[r.R=4096]="R",r[r.G=256]="G",r[r.B=16]="B",r[r.A=1]="A"})(Be||(Be={}));var it;(function(r){r.GLTF="GLTF",r.GLB="GLB"})(it||(it={}));const ut={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var $s=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function Zc(){var r=new $s(3);return $s!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ss(r){var e=r[0],t=r[1],s=r[2];return Math.hypot(e,t,s)}function eu(r,e,t){var s=e[0],n=e[1],o=e[2],i=t[3]*s+t[7]*n+t[11]*o+t[15];return i=i||1,r[0]=(t[0]*s+t[4]*n+t[8]*o+t[12])/i,r[1]=(t[1]*s+t[5]*n+t[9]*o+t[13])/i,r[2]=(t[2]*s+t[6]*n+t[10]*o+t[14])/i,r}(function(){var r=Zc();return function(e,t,s,n,o,i){var a,c;for(t||(t=3),s||(s=0),n?c=Math.min(n*t+s,e.length):c=e.length,a=s;a<c;a+=t)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],o(r,r,i),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2];return e}})();function tu(r){const e=ja(),t=r.propertyType===C.NODE?[r]:r.listChildren();for(const s of t)s.traverse(n=>{const o=n.getMesh();if(!o)return;const i=ru(o,n.getWorldMatrix());i.min.every(isFinite)&&i.max.every(isFinite)&&(Hs(i.min,e),Hs(i.max,e))});return e}function ru(r,e){const t=ja();for(const s of r.listPrimitives()){const n=s.getAttribute("POSITION"),o=s.getIndices();if(!n)continue;let i=[0,0,0],a=[0,0,0];for(let c=0,f=o?o.getCount():n.getCount();c<f;c++){const u=o?o.getScalar(c):c;i=n.getElement(u,i),a=eu(a,i,e),Hs(a,t)}}return t}function Hs(r,e){for(let t=0;t<3;t++)e.min[t]=Math.min(r[t],e.min[t]),e.max[t]=Math.max(r[t],e.max[t])}function ja(){return{min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]}}class Y{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),s=new Uint8Array(t.length);for(let n=0;n<t.length;n++)s[n]=t.charCodeAt(n);return s}else{const t=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(t,s?"base64":"utf8")}}static encodeText(e){return new TextEncoder().encode(e)}static decodeText(e){return new TextDecoder().decode(e)}static concat(e){let t=0;for(const o of e)t+=o.byteLength;const s=new Uint8Array(t);let n=0;for(const o of e)s.set(o,n),n+=o.byteLength;return s}static pad(e,t=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const n=new Uint8Array(s);if(n.set(e),t!==0)for(let o=e.byteLength;o<s;o++)n[o]=t;return n}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==t[s])return!1;return!0}static toView(e,t=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class ds{static hexToFactor(e,t){e=Math.floor(e);const s=t;return s[0]=(e>>16&255)/255,s[1]=(e>>8&255)/255,s[2]=(e&255)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[s,n,o]=this.convertLinearToSRGB(e,t);return s*255<<16^n*255<<8^o*255<<0}static convertSRGBToLinear(e,t){const s=e,n=t;for(let o=0;o<3;o++)n[o]=s[o]<.04045?s[o]*.0773993808:Math.pow(s[o]*.9478672986+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const s=e,n=t;for(let o=0;o<3;o++)n[o]=s[o]<.0031308?s[o]*12.92:1.055*Math.pow(s[o],.41666)-.055;return t}}class nu{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let t=new DataView(e.buffer,e.byteOffset+4),s,n;for(;t.byteLength;){if(s=t.getUint16(0,!1),su(t,s),n=t.getUint8(s+1),n===192||n===193||n===194)return[t.getUint16(s+7,!1),t.getUint16(s+5,!1)];t=new DataView(e.buffer,t.byteOffset+s+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class As{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return Y.decodeText(e.slice(12,16))===As.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}As.PNG_FRIED_CHUNK_NAME="CgBI";class Ce{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let s=0;const n=4,o=this.getSize(e,t);if(!o)return null;for(;o[0]>1||o[1]>1;)s+=o[0]*o[1]*n,o[0]=Math.max(Math.floor(o[0]/2),1),o[1]=Math.max(Math.floor(o[1]/2),1);return s+=1*1*n,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}Ce.impls={"image/jpeg":new nu,"image/png":new As};function su(r,e){if(e>r.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(r.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return r}class Ct{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return Ce.mimeTypeToExtension(t)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}function Ii(r){return Object.prototype.toString.call(r)==="[object Object]"}function Ot(r){if(Ii(r)===!1)return!1;const e=r.constructor;if(e===void 0)return!0;const t=e.prototype;return!(Ii(t)===!1||Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")===!1)}var qs,Ws;(function(r){r[r.SILENT=4]="SILENT",r[r.ERROR=3]="ERROR",r[r.WARN=2]="WARN",r[r.INFO=1]="INFO",r[r.DEBUG=0]="DEBUG"})(Ws||(Ws={}));class Ue{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Ue.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Ue.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Ue.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Ue.Verbosity.ERROR&&console.error(e)}}qs=Ue;Ue.Verbosity=Ws;Ue.DEFAULT_INSTANCE=new qs(qs.Verbosity.INFO);function ou(r){var e=r[0],t=r[1],s=r[2],n=r[3],o=r[4],i=r[5],a=r[6],c=r[7],f=r[8],u=r[9],l=r[10],_=r[11],g=r[12],b=r[13],I=r[14],A=r[15],T=e*i-t*o,j=e*a-s*o,S=e*c-n*o,D=t*a-s*i,M=t*c-n*i,P=s*c-n*a,x=f*b-u*g,N=f*I-l*g,w=f*A-_*g,F=u*I-l*b,k=u*A-_*b,L=l*A-_*I;return T*L-j*k+S*F+D*w-M*N+P*x}function iu(r,e,t){var s=e[0],n=e[1],o=e[2],i=e[3],a=e[4],c=e[5],f=e[6],u=e[7],l=e[8],_=e[9],g=e[10],b=e[11],I=e[12],A=e[13],T=e[14],j=e[15],S=t[0],D=t[1],M=t[2],P=t[3];return r[0]=S*s+D*a+M*l+P*I,r[1]=S*n+D*c+M*_+P*A,r[2]=S*o+D*f+M*g+P*T,r[3]=S*i+D*u+M*b+P*j,S=t[4],D=t[5],M=t[6],P=t[7],r[4]=S*s+D*a+M*l+P*I,r[5]=S*n+D*c+M*_+P*A,r[6]=S*o+D*f+M*g+P*T,r[7]=S*i+D*u+M*b+P*j,S=t[8],D=t[9],M=t[10],P=t[11],r[8]=S*s+D*a+M*l+P*I,r[9]=S*n+D*c+M*_+P*A,r[10]=S*o+D*f+M*g+P*T,r[11]=S*i+D*u+M*b+P*j,S=t[12],D=t[13],M=t[14],P=t[15],r[12]=S*s+D*a+M*l+P*I,r[13]=S*n+D*c+M*_+P*A,r[14]=S*o+D*f+M*g+P*T,r[15]=S*i+D*u+M*b+P*j,r}function au(r,e){var t=e[0],s=e[1],n=e[2],o=e[4],i=e[5],a=e[6],c=e[8],f=e[9],u=e[10];return r[0]=Math.hypot(t,s,n),r[1]=Math.hypot(o,i,a),r[2]=Math.hypot(c,f,u),r}function cu(r,e){var t=new $s(3);au(t,e);var s=1/t[0],n=1/t[1],o=1/t[2],i=e[0]*s,a=e[1]*n,c=e[2]*o,f=e[4]*s,u=e[5]*n,l=e[6]*o,_=e[8]*s,g=e[9]*n,b=e[10]*o,I=i+u+b,A=0;return I>0?(A=Math.sqrt(I+1)*2,r[3]=.25*A,r[0]=(l-g)/A,r[1]=(_-c)/A,r[2]=(a-f)/A):i>u&&i>b?(A=Math.sqrt(1+i-u-b)*2,r[3]=(l-g)/A,r[0]=.25*A,r[1]=(a+f)/A,r[2]=(_+c)/A):u>b?(A=Math.sqrt(1+u-i-b)*2,r[3]=(_-c)/A,r[0]=(a+f)/A,r[1]=.25*A,r[2]=(l+g)/A):(A=Math.sqrt(1+b-i-u)*2,r[3]=(a-f)/A,r[0]=(_+c)/A,r[1]=(l+g)/A,r[2]=.25*A),r}class Q{static identity(e){return e}static eq(e,t,s=1e-5){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>s)return!1;return!0}static clamp(e,t,s){return e<t?t:e>s?s:e}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(Q.clamp(e,0,1)*65535);case 5121:return Math.round(Q.clamp(e,0,1)*255);case 5122:return Math.round(Q.clamp(e,-1,1)*32767);case 5120:return Math.round(Q.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,t,s,n){let o=Ss([e[0],e[1],e[2]]);const i=Ss([e[4],e[5],e[6]]),a=Ss([e[8],e[9],e[10]]);ou(e)<0&&(o=-o),t[0]=e[12],t[1]=e[13],t[2]=e[14];const f=e.slice(),u=1/o,l=1/i,_=1/a;f[0]*=u,f[1]*=u,f[2]*=u,f[4]*=l,f[5]*=l,f[6]*=l,f[8]*=_,f[9]*=_,f[10]*=_,cu(s,f),n[0]=o,n[1]=i,n[2]=a}static compose(e,t,s,n){const o=n,i=t[0],a=t[1],c=t[2],f=t[3],u=i+i,l=a+a,_=c+c,g=i*u,b=i*l,I=i*_,A=a*l,T=a*_,j=c*_,S=f*u,D=f*l,M=f*_,P=s[0],x=s[1],N=s[2];return o[0]=(1-(A+j))*P,o[1]=(b+M)*P,o[2]=(I-D)*P,o[3]=0,o[4]=(b-M)*x,o[5]=(1-(g+j))*x,o[6]=(T+S)*x,o[7]=0,o[8]=(I+D)*N,o[9]=(T-S)*N,o[10]=(1-(g+A))*N,o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}}function uu(r,e){if(!!r!=!!e)return!1;const t=r.getChild(),s=e.getChild();return t===s||t.equals(s)}function pu(r,e){if(!!r!=!!e)return!1;const t=r.values(),s=e.values();if(t.length!==s.length)return!1;for(let n=0;n<t.length;n++){const o=t[n],i=s[n];if(o.getChild()!==i.getChild()&&!o.getChild().equals(i.getChild()))return!1}return!0}function lu(r,e){if(!!r!=!!e)return!1;const t=r.keys(),s=e.keys();if(t.length!==s.length)return!1;for(const n of t){const o=r.get(n),i=e.get(n);if(!!o!=!!i)return!1;const a=o.getChild(),c=i.getChild();if(a!==c&&!a.equals(c))return!1}return!0}function Pa(r,e){if(r===e)return!0;if(!!r!=!!e||!r||!e||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Fa(r,e){if(r===e)return!0;if(!!r!=!!e)return!1;if(!Ot(r)||!Ot(e))return r===e;const t=r,s=e;let n=0,o=0,i;for(i in t)n++;for(i in s)o++;if(n!==o)return!1;for(i in t){const a=t[i],c=s[i];if(hs(a)&&hs(c)){if(!Pa(a,c))return!1}else if(Ot(a)&&Ot(c)){if(!Fa(a,c))return!1}else if(a!==c)return!1}return!0}function hs(r){return Array.isArray(r)||ArrayBuffer.isView(r)}const xi="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",fu=999,_u=6,Ri=new Set,du=function(){let e="";for(let t=0;t<_u;t++)e+=xi.charAt(Math.floor(Math.random()*xi.length));return e},hu=function(){for(let e=0;e<fu;e++){const t=du();if(!Ri.has(t))return Ri.add(t),t}return""},Si="https://null.example";class Wn{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return Ct.basename(new URL(e,Si).pathname)}static extension(e){return Ct.extension(new URL(e,Si).pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const s=e.split("/"),n=t.split("/");s.pop();for(let o=0;o<n.length;o++)n[o]!=="."&&(n[o]===".."?s.pop():s.push(n[o]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Wn.DEFAULT_INIT={};Wn.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const ct=r=>r,yu=new Set;class oo extends so{constructor(e,t=""){super(e),this[se].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,ct)}copy(e,t=ct){for(const s in this[se]){const n=this[se][s];if(n instanceof Bt)this[wt].has(s)||n.dispose();else if(n instanceof ot||n instanceof ie)for(const o of n.values())o.dispose();else if(n instanceof ke)for(const o of n.values())o.dispose()}for(const s in e[se]){const n=this[se][s],o=e[se][s];if(o instanceof Bt)this[wt].has(s)?n.getChild().copy(t(o.getChild()),t):this.setRef(s,t(o.getChild()),o.getAttributes());else if(o instanceof ie||o instanceof ot)for(const i of o.values())this.addRef(s,t(i.getChild()),i.getAttributes());else if(o instanceof ke)for(const i of o.keys()){const a=o.get(i);this.setRefMap(s,i,t(a.getChild()),a.getAttributes())}else Ot(o)?this[se][s]=JSON.parse(JSON.stringify(o)):Array.isArray(o)||o instanceof ArrayBuffer||ArrayBuffer.isView(o)?this[se][s]=o.slice():this[se][s]=o}return this}equals(e,t=yu){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[se]){if(t.has(s))continue;const n=this[se][s],o=e[se][s];if(n instanceof Bt||o instanceof Bt){if(!uu(n,o))return!1}else if(n instanceof ie||o instanceof ie||n instanceof ot||o instanceof ot){if(!pu(n,o))return!1}else if(n instanceof ke||o instanceof ke){if(!lu(n,o))return!1}else if(Ot(n)||Ot(o)){if(!Fa(n,o))return!1}else if(hs(n)||hs(o)){if(!Pa(n,o))return!1}else if(n!==o)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Re extends oo{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new ke})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t._validateParent(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class W extends Re{init(){this.propertyType=C.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:W.Type.SCALAR,componentType:W.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case W.Type.SCALAR:return 1;case W.Type.VEC2:return 2;case W.Type.VEC3:return 3;case W.Type.VEC4:return 4;case W.Type.MAT2:return 4;case W.Type.MAT3:return 9;case W.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case W.ComponentType.BYTE:return 1;case W.ComponentType.UNSIGNED_BYTE:return 1;case W.ComponentType.SHORT:return 2;case W.ComponentType.UNSIGNED_SHORT:return 2;case W.ComponentType.UNSIGNED_INT:return 4;case W.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getNormalized(),s=this.getElementSize(),n=this.getComponentType();if(this.getMin(e),t)for(let o=0;o<s;o++)e[o]=Q.decodeNormalizedInt(e[o],n);return e}getMin(e){const t=this.getArray(),s=this.getCount(),n=this.getElementSize();for(let o=0;o<n;o++)e[o]=1/0;for(let o=0;o<s*n;o+=n)for(let i=0;i<n;i++){const a=t[o+i];Number.isFinite(a)&&(e[i]=Math.min(e[i],a))}return e}getMaxNormalized(e){const t=this.getNormalized(),s=this.getElementSize(),n=this.getComponentType();if(this.getMax(e),t)for(let o=0;o<s;o++)e[o]=Q.decodeNormalizedInt(e[o],n);return e}getMax(e){const t=this.get("array"),s=this.getCount(),n=this.getElementSize();for(let o=0;o<n;o++)e[o]=-1/0;for(let o=0;o<s*n;o+=n)for(let i=0;i<n;i++){const a=t[o+i];Number.isFinite(a)&&(e[i]=Math.max(e[i],a))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return W.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const t=this.getElementSize(),s=this.getComponentType(),n=this.getArray();return this.getNormalized()?Q.decodeNormalizedInt(n[e*t],s):n[e*t]}setScalar(e,t){const s=this.getElementSize(),n=this.getComponentType(),o=this.getArray();return this.getNormalized()?o[e*s]=Q.encodeNormalizedInt(t,n):o[e*s]=t,this}getElement(e,t){const s=this.getNormalized(),n=this.getElementSize(),o=this.getComponentType(),i=this.getArray();for(let a=0;a<n;a++)s?t[a]=Q.decodeNormalizedInt(i[e*n+a],o):t[a]=i[e*n+a];return t}setElement(e,t){const s=this.getNormalized(),n=this.getElementSize(),o=this.getComponentType(),i=this.getArray();for(let a=0;a<n;a++)s?i[e*n+a]=Q.encodeNormalizedInt(t[a],o):i[e*n+a]=t[a];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?gu(e):W.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}W.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};W.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function gu(r){switch(r.constructor){case Float32Array:return W.ComponentType.FLOAT;case Uint32Array:return W.ComponentType.UNSIGNED_INT;case Uint16Array:return W.ComponentType.UNSIGNED_SHORT;case Uint8Array:return W.ComponentType.UNSIGNED_BYTE;case Int16Array:return W.ComponentType.SHORT;case Int8Array:return W.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class La extends Re{init(){this.propertyType=C.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new ie,samplers:new ie})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class Yt extends Re{init(){this.propertyType=C.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}Yt.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class Qt extends Re{init(){this.propertyType=C.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Qt.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:De.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:De.OTHER})}}Qt.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Ua extends Re{init(){this.propertyType=C.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class jt extends Re{init(){this.propertyType=C.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:jt.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}jt.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class pe extends oo{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}pe.EXTENSION_NAME=void 0;class re extends Re{init(){this.propertyType=C.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:re.WrapMode.REPEAT,wrapT:re.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}re.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};re.MagFilter={NEAREST:9728,LINEAR:9729};re.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:ts,G:rs,B:ns,A:mu}=Be;class Ze extends Re{init(){this.propertyType=C.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Ze.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new re(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new re(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new re(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new re(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new re(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:ts|rs|ns|mu,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:ts|rs|ns,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:ts|rs|ns})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:ts})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:rs|ns})}}Ze.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class Ba extends Re{init(){this.propertyType=C.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new ie})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class Ga extends Re{init(){this.propertyType=C.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new ie})}copy(e,t=ct){if(t===ct)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Q.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),s=this.get("rotation").slice(),n=this.get("scale").slice();return Q.decompose(e,t,s,n),this.set("translation",t).set("rotation",s).set("scale",n)}getWorldTranslation(){const e=[0,0,0];return Q.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Q.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Q.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let n=this;n!=null;n=n.getParentNode())e.push(n);let t;const s=e.pop().getMatrix();for(;t=e.pop();)iu(s,s,t.getMatrix());return s}addChild(e){const t=e.getParentNode();t&&t.removeChild(e);for(const s of e.listParents())s.propertyType===C.SCENE&&s.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===C.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class _e extends Re{init(){this.propertyType=C.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:_e.Mode.TRIANGLES,material:null,indices:null,attributes:new ke,targets:new ie})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:De.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:De.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}_e.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Tu extends oo{init(){this.propertyType=C.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new ke})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:De.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function xe(){return xe=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},xe.apply(null,arguments)}class Is extends Re{init(){this.propertyType=C.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new ie})}copy(e,t=ct){if(t===ct)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){const t=e.getParentNode();return t&&t.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class Va extends Re{init(){this.propertyType=C.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new ie})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:De.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class Kn extends Re{init(){this.propertyType=C.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Ce.extensionToMimeType(Ct.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=Ce.extensionToMimeType(Ct.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Y.assertView(e))}getSize(){const e=this.get("image");return e?Ce.getSize(e,this.getMimeType()):null}}class Pt extends Re{init(){this.propertyType=C.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${Da}`,version:"2.0"},defaultScene:null,accessors:new ie,animations:new ie,buffers:new ie,cameras:new ie,materials:new ie,meshes:new ie,nodes:new ie,scenes:new ie,skins:new ie,textures:new ie})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",t=>{this._addChildOfRoot(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=ct){if(t===ct)throw new Error("Root cannot be copied.");this.set("asset",xe({},e.get("asset"))),this.setName(e.getName()),this.setExtras(xe({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const n=e.getExtension(s);this.setExtension(s,t(n))}return this}_addChildOfRoot(e){return e instanceof Is?this.addRef("scenes",e):e instanceof Ga?this.addRef("nodes",e):e instanceof jt?this.addRef("cameras",e):e instanceof Va?this.addRef("skins",e):e instanceof Ba?this.addRef("meshes",e):e instanceof Ze?this.addRef("materials",e):e instanceof Kn?this.addRef("textures",e):e instanceof La?this.addRef("animations",e):e instanceof W?this.addRef("accessors",e):e instanceof Ua&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Ge{static fromGraph(e){return Ge._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new Jc,this._root=new Pt(this._graph),this._logger=Ue.DEFAULT_INSTANCE,Ge._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const t=e.map(s=>s.name);for(const s of e)await s(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===t)||new e(this)}createScene(e=""){return new Is(this._graph,e)}createNode(e=""){return new Ga(this._graph,e)}createCamera(e=""){return new jt(this._graph,e)}createSkin(e=""){return new Va(this._graph,e)}createMesh(e=""){return new Ba(this._graph,e)}createPrimitive(){return new _e(this._graph)}createPrimitiveTarget(e=""){return new Tu(this._graph,e)}createMaterial(e=""){return new Ze(this._graph,e)}createTexture(e=""){return new Kn(this._graph,e)}createAnimation(e=""){return new La(this._graph,e)}createAnimationChannel(e=""){return new Yt(this._graph,e)}createAnimationSampler(e=""){return new Qt(this._graph,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new W(this._graph,e).setBuffer(t)}createBuffer(e=""){return new Ua(this._graph,e)}}Ge._GRAPH_DOCUMENTS=new WeakMap;class ce{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this._listener=void 0,this.document=e,e.getRoot()._enableExtension(this),this._listener=s=>{const n=s,o=n.target;o instanceof pe&&o.extensionName===this.extensionName&&(n.type==="node:create"&&this._addExtensionProperty(o),n.type==="node:dispose"&&this._removeExtensionProperty(o))};const t=e.getGraph();t.addEventListener("node:create",this._listener),t.addEventListener("node:dispose",this._listener)}dispose(){this.document.getRoot()._disableExtension(this);const e=this.document.getGraph();e.removeEventListener("node:create",this._listener),e.removeEventListener("node:dispose",this._listener);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}_addExtensionProperty(e){return this.properties.add(e),this}_removeExtensionProperty(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}ce.EXTENSION_NAME=void 0;class bu{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const s=this.jsonDoc.json.textures[t.index];if(s.sampler===void 0)return;const n=this.jsonDoc.json.samplers[s.sampler];n.magFilter!==void 0&&e.setMagFilter(n.magFilter),n.minFilter!==void 0&&e.setMinFilter(n.minFilter),n.wrapS!==void 0&&e.setWrapS(n.wrapS),n.wrapT!==void 0&&e.setWrapT(n.wrapT)}}const Mi={logger:Ue.DEFAULT_INSTANCE,extensions:[],dependencies:{}},Eu=new Set([C.BUFFER,C.TEXTURE,C.MATERIAL,C.MESH,C.PRIMITIVE,C.NODE,C.SCENE]);class Au{static read(e,t=Mi){const s=xe({},Mi,t),{json:n}=e,o=new Ge().setLogger(s.logger);this.validate(e,s);const i=new bu(e),a=n.asset,c=o.getRoot().getAsset();a.copyright&&(c.copyright=a.copyright),a.extras&&(c.extras=a.extras),n.extras!==void 0&&o.getRoot().setExtras(xe({},n.extras));const f=n.extensionsUsed||[],u=n.extensionsRequired||[];s.extensions.sort((x,N)=>x.EXTENSION_NAME>N.EXTENSION_NAME?1:-1);for(const x of s.extensions)if(f.includes(x.EXTENSION_NAME)){const N=o.createExtension(x).setRequired(u.includes(x.EXTENSION_NAME)),w=N.prereadTypes.filter(F=>!Eu.has(F));w.length&&s.logger.warn(`Preread hooks for some types (${w.join()}), requested by extension ${N.extensionName}, are unsupported. Please file an issue or a PR.`);for(const F of N.readDependencies)N.install(F,s.dependencies[F])}const l=n.buffers||[];o.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(C.BUFFER)).forEach(x=>x.preread(i,C.BUFFER)),i.buffers=l.map(x=>{const N=o.createBuffer(x.name);return x.extras&&N.setExtras(x.extras),x.uri&&x.uri.indexOf("__")!==0&&N.setURI(x.uri),N});const _=n.bufferViews||[];i.bufferViewBuffers=_.map((x,N)=>{if(!i.bufferViews[N]){const w=e.json.buffers[x.buffer],F=w.uri?e.resources[w.uri]:e.resources[$t],k=x.byteOffset||0;i.bufferViews[N]=Y.toView(F,k,x.byteLength)}return i.buffers[x.buffer]});const g=n.accessors||[];i.accessors=g.map(x=>{const N=i.bufferViewBuffers[x.bufferView],w=o.createAccessor(x.name,N).setType(x.type);return x.extras&&w.setExtras(x.extras),x.normalized!==void 0&&w.setNormalized(x.normalized),x.bufferView===void 0||w.setArray(ps(x,i)),w});const b=n.images||[],I=n.textures||[];o.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(C.TEXTURE)).forEach(x=>x.preread(i,C.TEXTURE)),i.textures=b.map(x=>{const N=o.createTexture(x.name);if(x.extras&&N.setExtras(x.extras),x.bufferView!==void 0){const w=n.bufferViews[x.bufferView],F=e.json.buffers[w.buffer],k=F.uri?e.resources[F.uri]:e.resources[$t],L=w.byteOffset||0,B=w.byteLength,U=k.slice(L,L+B);N.setImage(U)}else x.uri!==void 0&&(N.setImage(e.resources[x.uri]),x.uri.indexOf("__")!==0&&N.setURI(x.uri));if(x.mimeType!==void 0)N.setMimeType(x.mimeType);else if(x.uri){const w=Ct.extension(x.uri);N.setMimeType(Ce.extensionToMimeType(w))}return N}),o.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(C.MATERIAL)).forEach(x=>x.preread(i,C.MATERIAL));const A=n.materials||[];i.materials=A.map(x=>{const N=o.createMaterial(x.name);x.extras&&N.setExtras(x.extras),x.alphaMode!==void 0&&N.setAlphaMode(x.alphaMode),x.alphaCutoff!==void 0&&N.setAlphaCutoff(x.alphaCutoff),x.doubleSided!==void 0&&N.setDoubleSided(x.doubleSided);const w=x.pbrMetallicRoughness||{};if(w.baseColorFactor!==void 0&&N.setBaseColorFactor(w.baseColorFactor),x.emissiveFactor!==void 0&&N.setEmissiveFactor(x.emissiveFactor),w.metallicFactor!==void 0&&N.setMetallicFactor(w.metallicFactor),w.roughnessFactor!==void 0&&N.setRoughnessFactor(w.roughnessFactor),w.baseColorTexture!==void 0){const F=w.baseColorTexture,k=i.textures[I[F.index].source];N.setBaseColorTexture(k),i.setTextureInfo(N.getBaseColorTextureInfo(),F)}if(x.emissiveTexture!==void 0){const F=x.emissiveTexture,k=i.textures[I[F.index].source];N.setEmissiveTexture(k),i.setTextureInfo(N.getEmissiveTextureInfo(),F)}if(x.normalTexture!==void 0){const F=x.normalTexture,k=i.textures[I[F.index].source];N.setNormalTexture(k),i.setTextureInfo(N.getNormalTextureInfo(),F),x.normalTexture.scale!==void 0&&N.setNormalScale(x.normalTexture.scale)}if(x.occlusionTexture!==void 0){const F=x.occlusionTexture,k=i.textures[I[F.index].source];N.setOcclusionTexture(k),i.setTextureInfo(N.getOcclusionTextureInfo(),F),x.occlusionTexture.strength!==void 0&&N.setOcclusionStrength(x.occlusionTexture.strength)}if(w.metallicRoughnessTexture!==void 0){const F=w.metallicRoughnessTexture,k=i.textures[I[F.index].source];N.setMetallicRoughnessTexture(k),i.setTextureInfo(N.getMetallicRoughnessTextureInfo(),F)}return N}),o.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(C.MESH)).forEach(x=>x.preread(i,C.MESH));const T=n.meshes||[];o.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(C.PRIMITIVE)).forEach(x=>x.preread(i,C.PRIMITIVE)),i.meshes=T.map(x=>{const N=o.createMesh(x.name);return x.extras&&N.setExtras(x.extras),x.weights!==void 0&&N.setWeights(x.weights),(x.primitives||[]).forEach(F=>{const k=o.createPrimitive();F.extras&&k.setExtras(F.extras),F.material!==void 0&&k.setMaterial(i.materials[F.material]),F.mode!==void 0&&k.setMode(F.mode);for(const[U,V]of Object.entries(F.attributes||{}))k.setAttribute(U,i.accessors[V]);F.indices!==void 0&&k.setIndices(i.accessors[F.indices]);const L=x.extras&&x.extras.targetNames||[];(F.targets||[]).forEach((U,V)=>{const $=L[V]||V.toString(),q=o.createPrimitiveTarget($);for(const[d,te]of Object.entries(U))q.setAttribute(d,i.accessors[te]);k.addTarget(q)}),N.addPrimitive(k)}),N});const j=n.cameras||[];i.cameras=j.map(x=>{const N=o.createCamera(x.name).setType(x.type);if(x.extras&&N.setExtras(x.extras),x.type===jt.Type.PERSPECTIVE){const w=x.perspective;N.setYFov(w.yfov),N.setZNear(w.znear),w.zfar!==void 0&&N.setZFar(w.zfar),w.aspectRatio!==void 0&&N.setAspectRatio(w.aspectRatio)}else{const w=x.orthographic;N.setZNear(w.znear).setZFar(w.zfar).setXMag(w.xmag).setYMag(w.ymag)}return N});const S=n.nodes||[];o.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(C.NODE)).forEach(x=>x.preread(i,C.NODE)),i.nodes=S.map(x=>{const N=o.createNode(x.name);if(x.extras&&N.setExtras(x.extras),x.translation!==void 0&&N.setTranslation(x.translation),x.rotation!==void 0&&N.setRotation(x.rotation),x.scale!==void 0&&N.setScale(x.scale),x.matrix!==void 0){const w=[0,0,0],F=[0,0,0,1],k=[1,1,1];Q.decompose(x.matrix,w,F,k),N.setTranslation(w),N.setRotation(F),N.setScale(k)}return x.weights!==void 0&&N.setWeights(x.weights),N});const D=n.skins||[];i.skins=D.map(x=>{const N=o.createSkin(x.name);x.extras&&N.setExtras(x.extras),x.inverseBindMatrices!==void 0&&N.setInverseBindMatrices(i.accessors[x.inverseBindMatrices]),x.skeleton!==void 0&&N.setSkeleton(i.nodes[x.skeleton]);for(const w of x.joints)N.addJoint(i.nodes[w]);return N}),S.map((x,N)=>{const w=i.nodes[N];(x.children||[]).forEach(k=>w.addChild(i.nodes[k])),x.mesh!==void 0&&w.setMesh(i.meshes[x.mesh]),x.camera!==void 0&&w.setCamera(i.cameras[x.camera]),x.skin!==void 0&&w.setSkin(i.skins[x.skin])});const M=n.animations||[];i.animations=M.map(x=>{const N=o.createAnimation(x.name);x.extras&&N.setExtras(x.extras);const F=(x.samplers||[]).map(L=>{const B=o.createAnimationSampler().setInput(i.accessors[L.input]).setOutput(i.accessors[L.output]).setInterpolation(L.interpolation||Qt.Interpolation.LINEAR);return L.extras&&B.setExtras(L.extras),N.addSampler(B),B});return(x.channels||[]).forEach(L=>{const B=o.createAnimationChannel().setSampler(F[L.sampler]).setTargetPath(L.target.path);L.target.node!==void 0&&B.setTargetNode(i.nodes[L.target.node]),L.extras&&B.setExtras(L.extras),N.addChannel(B)}),N});const P=n.scenes||[];return o.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(C.SCENE)).forEach(x=>x.preread(i,C.SCENE)),i.scenes=P.map(x=>{const N=o.createScene(x.name);return x.extras&&N.setExtras(x.extras),(x.nodes||[]).map(F=>i.nodes[F]).forEach(F=>N.addChild(F)),N}),n.scene!==void 0&&o.getRoot().setDefaultScene(i.scenes[n.scene]),o.getRoot().listExtensionsUsed().forEach(x=>x.read(i)),g.forEach((x,N)=>{const w=i.accessors[N],F=!!x.sparse,k=!x.bufferView&&!w.getArray();(F||k)&&w.setSparse(!0).setArray(xu(x,i))}),o}static validate(e,t){const s=e.json;if(s.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${s.asset.version}".`);if(s.extensionsRequired){for(const n of s.extensionsRequired)if(!t.extensions.find(o=>o.EXTENSION_NAME===n))throw new Error(`Missing required extension, "${n}".`)}if(s.extensionsUsed)for(const n of s.extensionsUsed)t.extensions.find(o=>o.EXTENSION_NAME===n)||t.logger.warn(`Missing optional extension, "${n}".`)}}function Iu(r,e){const t=e.jsonDoc,s=e.bufferViews[r.bufferView],n=t.json.bufferViews[r.bufferView],o=ut[r.componentType],i=W.getElementSize(r.type),a=o.BYTES_PER_ELEMENT,c=r.byteOffset||0,f=new o(r.count*i),u=new DataView(s.buffer,s.byteOffset,s.byteLength),l=n.byteStride;for(let _=0;_<r.count;_++)for(let g=0;g<i;g++){const b=c+_*l+g*a;let I;switch(r.componentType){case W.ComponentType.FLOAT:I=u.getFloat32(b,!0);break;case W.ComponentType.UNSIGNED_INT:I=u.getUint32(b,!0);break;case W.ComponentType.UNSIGNED_SHORT:I=u.getUint16(b,!0);break;case W.ComponentType.UNSIGNED_BYTE:I=u.getUint8(b);break;case W.ComponentType.SHORT:I=u.getInt16(b,!0);break;case W.ComponentType.BYTE:I=u.getInt8(b);break;default:throw new Error(`Unexpected componentType "${r.componentType}".`)}f[_*i+g]=I}return f}function ps(r,e){const t=e.jsonDoc,s=e.bufferViews[r.bufferView],n=t.json.bufferViews[r.bufferView],o=ut[r.componentType],i=W.getElementSize(r.type),a=o.BYTES_PER_ELEMENT,c=i*a;if(n.byteStride!==void 0&&n.byteStride!==c)return Iu(r,e);const f=s.byteOffset+(r.byteOffset||0),u=r.count*i*a;return new o(s.buffer.slice(f,f+u))}function xu(r,e){const t=ut[r.componentType],s=W.getElementSize(r.type);let n;r.bufferView!==void 0?n=ps(r,e):n=new t(r.count*s);const o=r.sparse;if(!o)return n;const i=o.count,a=xe({},r,o.indices,{count:i,type:"SCALAR"}),c=xe({},r,o.values,{count:i}),f=ps(a,e),u=ps(c,e);for(let l=0;l<a.count;l++)for(let _=0;_<s;_++)n[f[l]*s+_]=u[l*s+_];return n}var Xn;(function(r){r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Xn||(Xn={}));class We{constructor(e,t,s){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=t,this.options=s;const n=e.getRoot(),o=n.listBuffers().length,i=n.listTextures().length;this.bufferURIGenerator=new Ni(o>1,()=>s.basename||"buffer"),this.imageURIGenerator=new Ni(i>1,a=>Ru(e,a)||s.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const s={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},n=JSON.stringify(s);this.samplerDefIndexMap.has(n)||(this.samplerDefIndexMap.set(n,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const o={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(n)},i=JSON.stringify(o);this.textureDefIndexMap.has(i)||(this.textureDefIndexMap.set(i,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(o));const a={index:this.textureDefIndexMap.get(i)};return t.getTexCoord()!==0&&(a.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(a.extras=t.getExtras()),this.textureInfoDefMap.set(t,a),a}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,s){if(this.options.format===it.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const n=Ce.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,n),this.assignResourceURI(e.uri,t,!1)}}assignResourceURI(e,t,s){const n=this.jsonDoc.resources;if(!(e in n)){n[e]=t;return}if(t===n[e]){this.logger.warn(`Duplicate resource URI, "${e}".`);return}const o=`Resource URI "${e}" already assigned to different data.`;if(!s){this.logger.warn(o);return}throw new Error(o)}getAccessorUsage(e){const t=this._accessorUsageMap.get(e);if(t)return t;if(e.getSparse())return De.SPARSE;for(const s of this._doc.getGraph().listParentEdges(e)){const{usage:n}=s.getAttributes();if(n)return n;s.getParent().propertyType!==C.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return De.OTHER}addAccessorToUsageGroup(e,t){const s=this._accessorUsageMap.get(e);if(s&&s!==t)throw new Error(`Accessor with usage "${s}" cannot be reused as "${t}".`);return this._accessorUsageMap.set(e,t),this}}We.BufferViewTarget=Xn;We.BufferViewUsage=De;We.USAGE_TO_TARGET={[De.ARRAY_BUFFER]:Xn.ARRAY_BUFFER,[De.ELEMENT_ARRAY_BUFFER]:Xn.ELEMENT_ARRAY_BUFFER};class Ni{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const s=this.basename(e);return this.counter[s]=this.counter[s]||1,`${s}_${this.counter[s]++}.${t}`}else return`${this.basename(e)}.${t}`}}function Ru(r,e){const t=r.getGraph().listParentEdges(e).find(s=>s.getParent()!==r.getRoot());return t?t.getName().replace(/texture$/i,""):""}const{BufferViewUsage:ss}=We,{UNSIGNED_INT:Su,UNSIGNED_SHORT:Mu,UNSIGNED_BYTE:Nu}=W.ComponentType,vu=new Set([C.ACCESSOR,C.BUFFER,C.MATERIAL,C.MESH]);class wu{static write(e,t){const s=e.getGraph(),n=e.getRoot(),o={asset:xe({generator:`glTF-Transform ${Da}`},n.getAsset()),extras:xe({},n.getExtras())},i={json:o,resources:{}},a=new We(e,i,t),c=t.logger||Ue.DEFAULT_INSTANCE,f=new Set(t.extensions.map(T=>T.EXTENSION_NAME)),u=e.getRoot().listExtensionsUsed().filter(T=>f.has(T.extensionName)).sort((T,j)=>T.extensionName>j.extensionName?1:-1),l=e.getRoot().listExtensionsRequired().filter(T=>f.has(T.extensionName)).sort((T,j)=>T.extensionName>j.extensionName?1:-1);u.length<e.getRoot().listExtensionsUsed().length&&c.warn("Some extensions were not registered for I/O, and will not be written.");for(const T of u){const j=T.prewriteTypes.filter(S=>!vu.has(S));j.length&&c.warn(`Prewrite hooks for some types (${j.join()}), requested by extension ${T.extensionName}, are unsupported. Please file an issue or a PR.`);for(const S of T.writeDependencies)T.install(S,t.dependencies[S])}function _(T,j,S,D){const M=[];let P=0;for(const w of T){const F=a.createAccessorDef(w);F.bufferView=o.bufferViews.length;const k=w.getArray(),L=Y.pad(Y.toView(k));F.byteOffset=P,P+=L.byteLength,M.push(L),a.accessorIndexMap.set(w,o.accessors.length),o.accessors.push(F)}const x=Y.concat(M),N={buffer:j,byteOffset:S,byteLength:x.byteLength};return D&&(N.target=D),o.bufferViews.push(N),{buffers:M,byteLength:P}}function g(T,j,S){const D=T[0].getCount();let M=0;for(const F of T){const k=a.createAccessorDef(F);k.bufferView=o.bufferViews.length,k.byteOffset=M;const L=F.getElementSize(),B=F.getComponentSize();M+=Y.padNumber(L*B),a.accessorIndexMap.set(F,o.accessors.length),o.accessors.push(k)}const P=D*M,x=new ArrayBuffer(P),N=new DataView(x);for(let F=0;F<D;F++){let k=0;for(const L of T){const B=L.getElementSize(),U=L.getComponentSize(),V=L.getComponentType(),$=L.getArray();for(let q=0;q<B;q++){const d=F*M+k+q*U,te=$[F*B+q];switch(V){case W.ComponentType.FLOAT:N.setFloat32(d,te,!0);break;case W.ComponentType.BYTE:N.setInt8(d,te);break;case W.ComponentType.SHORT:N.setInt16(d,te,!0);break;case W.ComponentType.UNSIGNED_BYTE:N.setUint8(d,te);break;case W.ComponentType.UNSIGNED_SHORT:N.setUint16(d,te,!0);break;case W.ComponentType.UNSIGNED_INT:N.setUint32(d,te,!0);break;default:throw new Error("Unexpected component type: "+V)}}k+=Y.padNumber(B*U)}}const w={buffer:j,byteOffset:S,byteLength:P,byteStride:M,target:We.BufferViewTarget.ARRAY_BUFFER};return o.bufferViews.push(w),{byteLength:P,buffers:[new Uint8Array(x)]}}function b(T,j,S){const D=[];let M=0;const P=new Map;let x=-1/0,N=!1;for(const V of T){const $=a.createAccessorDef(V);o.accessors.push($),a.accessorIndexMap.set(V,o.accessors.length-1);const q=[],d=[],te=[],oe=new Array(V.getElementSize()).fill(0);for(let p=0,Se=V.getCount();p<Se;p++)if(V.getElement(p,te),!Q.eq(te,oe,0)){x=Math.max(p,x),q.push(p);for(let Me=0;Me<te.length;Me++)d.push(te[Me])}const ae=q.length,Z={accessorDef:$,count:ae};if(P.set(V,Z),ae===0)continue;ae>V.getCount()/2&&(N=!0);const H=ut[V.getComponentType()];Z.indices=q,Z.values=new H(d)}if(!Number.isFinite(x))return{buffers:D,byteLength:M};N&&c.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const w=x<255?Uint8Array:x<65535?Uint16Array:Uint32Array,F=x<255?Nu:x<65535?Mu:Su,k={buffer:j,byteOffset:S+M,byteLength:0};for(const V of T){const $=P.get(V);if($.count===0)continue;$.indicesByteOffset=k.byteLength;const q=Y.pad(Y.toView(new w($.indices)));D.push(q),M+=q.byteLength,k.byteLength+=q.byteLength}o.bufferViews.push(k);const L=o.bufferViews.length-1,B={buffer:j,byteOffset:S+M,byteLength:0};for(const V of T){const $=P.get(V);if($.count===0)continue;$.valuesByteOffset=B.byteLength;const q=Y.pad(Y.toView($.values));D.push(q),M+=q.byteLength,B.byteLength+=q.byteLength}o.bufferViews.push(B);const U=o.bufferViews.length-1;for(const V of T){const $=P.get(V);$.count!==0&&($.accessorDef.sparse={count:$.count,indices:{bufferView:L,byteOffset:$.indicesByteOffset,componentType:F},values:{bufferView:U,byteOffset:$.valuesByteOffset}})}return{buffers:D,byteLength:M}}if(o.accessors=[],o.bufferViews=[],o.samplers=[],o.textures=[],o.images=n.listTextures().map((T,j)=>{const S=a.createPropertyDef(T);T.getMimeType()&&(S.mimeType=T.getMimeType());const D=T.getImage();return D&&a.createImageData(S,D,T),a.imageIndexMap.set(T,j),S}),u.filter(T=>T.prewriteTypes.includes(C.ACCESSOR)).forEach(T=>T.prewrite(a,C.ACCESSOR)),n.listAccessors().forEach(T=>{const j=a.accessorUsageGroupedByParent,S=a.accessorParents;if(a.accessorIndexMap.has(T))return;const D=a.getAccessorUsage(T);if(a.addAccessorToUsageGroup(T,D),j.has(D)){const M=s.listParents(T).find(P=>P.propertyType!==C.ROOT);S.set(T,M)}}),u.filter(T=>T.prewriteTypes.includes(C.BUFFER)).forEach(T=>T.prewrite(a,C.BUFFER)),(n.listAccessors().length>0||a.otherBufferViews.size>0||n.listTextures().length>0&&t.format===it.GLB)&&n.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");o.buffers=[],n.listBuffers().forEach((T,j)=>{const S=a.createPropertyDef(T),D=a.accessorUsageGroupedByParent,M=T.listParents().filter(B=>B instanceof W),P=new Set(M.map(B=>a.accessorParents.get(B))),x=new Map(Array.from(P).map((B,U)=>[B,U])),N={};for(const B of M){var w;if(a.accessorIndexMap.has(B))continue;const U=a.getAccessorUsage(B);let V=U;if(D.has(U)){const $=a.accessorParents.get(B);V+=`:${x.get($)}`}N[w=V]||(N[w]={usage:U,accessors:[]}),N[V].accessors.push(B)}const F=[],k=o.buffers.length;let L=0;for(const{usage:B,accessors:U}of Object.values(N))if(B===ss.ARRAY_BUFFER&&t.vertexLayout===_s.INTERLEAVED){const V=g(U,k,L);L+=V.byteLength;for(const $ of V.buffers)F.push($)}else if(B===ss.ARRAY_BUFFER)for(const V of U){const $=g([V],k,L);L+=$.byteLength;for(const q of $.buffers)F.push(q)}else if(B===ss.SPARSE){const V=b(U,k,L);L+=V.byteLength;for(const $ of V.buffers)F.push($)}else if(B===ss.ELEMENT_ARRAY_BUFFER){const V=We.BufferViewTarget.ELEMENT_ARRAY_BUFFER,$=_(U,k,L,V);L+=$.byteLength;for(const q of $.buffers)F.push(q)}else{const V=_(U,k,L);L+=V.byteLength;for(const $ of V.buffers)F.push($)}if(a.imageBufferViews.length&&j===0){for(let B=0;B<a.imageBufferViews.length;B++)if(o.bufferViews[o.images[B].bufferView].byteOffset=L,L+=a.imageBufferViews[B].byteLength,F.push(a.imageBufferViews[B]),L%8){const U=8-L%8;L+=U,F.push(new Uint8Array(U))}}if(a.otherBufferViews.has(T))for(const B of a.otherBufferViews.get(T))o.bufferViews.push({buffer:k,byteOffset:L,byteLength:B.byteLength}),a.otherBufferViewsIndexMap.set(B,o.bufferViews.length-1),L+=B.byteLength,F.push(B);if(L){let B;t.format===it.GLB?B=$t:(B=a.bufferURIGenerator.createURI(T,"bin"),S.uri=B),S.byteLength=L,a.assignResourceURI(B,Y.concat(F),!0)}o.buffers.push(S),a.bufferIndexMap.set(T,j)}),n.listAccessors().find(T=>!T.getBuffer())&&c.warn("Skipped writing one or more Accessors: no Buffer assigned."),u.filter(T=>T.prewriteTypes.includes(C.MATERIAL)).forEach(T=>T.prewrite(a,C.MATERIAL)),o.materials=n.listMaterials().map((T,j)=>{const S=a.createPropertyDef(T);if(T.getAlphaMode()!==Ze.AlphaMode.OPAQUE&&(S.alphaMode=T.getAlphaMode()),T.getAlphaMode()===Ze.AlphaMode.MASK&&(S.alphaCutoff=T.getAlphaCutoff()),T.getDoubleSided()&&(S.doubleSided=!0),S.pbrMetallicRoughness={},Q.eq(T.getBaseColorFactor(),[1,1,1,1])||(S.pbrMetallicRoughness.baseColorFactor=T.getBaseColorFactor()),Q.eq(T.getEmissiveFactor(),[0,0,0])||(S.emissiveFactor=T.getEmissiveFactor()),T.getRoughnessFactor()!==1&&(S.pbrMetallicRoughness.roughnessFactor=T.getRoughnessFactor()),T.getMetallicFactor()!==1&&(S.pbrMetallicRoughness.metallicFactor=T.getMetallicFactor()),T.getBaseColorTexture()){const D=T.getBaseColorTexture(),M=T.getBaseColorTextureInfo();S.pbrMetallicRoughness.baseColorTexture=a.createTextureInfoDef(D,M)}if(T.getEmissiveTexture()){const D=T.getEmissiveTexture(),M=T.getEmissiveTextureInfo();S.emissiveTexture=a.createTextureInfoDef(D,M)}if(T.getNormalTexture()){const D=T.getNormalTexture(),M=T.getNormalTextureInfo(),P=a.createTextureInfoDef(D,M);T.getNormalScale()!==1&&(P.scale=T.getNormalScale()),S.normalTexture=P}if(T.getOcclusionTexture()){const D=T.getOcclusionTexture(),M=T.getOcclusionTextureInfo(),P=a.createTextureInfoDef(D,M);T.getOcclusionStrength()!==1&&(P.strength=T.getOcclusionStrength()),S.occlusionTexture=P}if(T.getMetallicRoughnessTexture()){const D=T.getMetallicRoughnessTexture(),M=T.getMetallicRoughnessTextureInfo();S.pbrMetallicRoughness.metallicRoughnessTexture=a.createTextureInfoDef(D,M)}return a.materialIndexMap.set(T,j),S}),u.filter(T=>T.prewriteTypes.includes(C.MESH)).forEach(T=>T.prewrite(a,C.MESH)),o.meshes=n.listMeshes().map((T,j)=>{const S=a.createPropertyDef(T);let D=null;return S.primitives=T.listPrimitives().map(M=>{const P={attributes:{}};P.mode=M.getMode();const x=M.getMaterial();x&&(P.material=a.materialIndexMap.get(x)),Object.keys(M.getExtras()).length&&(P.extras=M.getExtras());const N=M.getIndices();N&&(P.indices=a.accessorIndexMap.get(N));for(const w of M.listSemantics())P.attributes[w]=a.accessorIndexMap.get(M.getAttribute(w));for(const w of M.listTargets()){const F={};for(const k of w.listSemantics())F[k]=a.accessorIndexMap.get(w.getAttribute(k));P.targets=P.targets||[],P.targets.push(F)}return M.listTargets().length&&!D&&(D=M.listTargets().map(w=>w.getName())),P}),T.getWeights().length&&(S.weights=T.getWeights()),D&&(S.extras=S.extras||{},S.extras.targetNames=D),a.meshIndexMap.set(T,j),S}),o.cameras=n.listCameras().map((T,j)=>{const S=a.createPropertyDef(T);if(S.type=T.getType(),S.type===jt.Type.PERSPECTIVE){S.perspective={znear:T.getZNear(),zfar:T.getZFar(),yfov:T.getYFov()};const D=T.getAspectRatio();D!==null&&(S.perspective.aspectRatio=D)}else S.orthographic={znear:T.getZNear(),zfar:T.getZFar(),xmag:T.getXMag(),ymag:T.getYMag()};return a.cameraIndexMap.set(T,j),S}),o.nodes=n.listNodes().map((T,j)=>{const S=a.createPropertyDef(T);return Q.eq(T.getTranslation(),[0,0,0])||(S.translation=T.getTranslation()),Q.eq(T.getRotation(),[0,0,0,1])||(S.rotation=T.getRotation()),Q.eq(T.getScale(),[1,1,1])||(S.scale=T.getScale()),T.getWeights().length&&(S.weights=T.getWeights()),a.nodeIndexMap.set(T,j),S}),o.skins=n.listSkins().map((T,j)=>{const S=a.createPropertyDef(T),D=T.getInverseBindMatrices();D&&(S.inverseBindMatrices=a.accessorIndexMap.get(D));const M=T.getSkeleton();return M&&(S.skeleton=a.nodeIndexMap.get(M)),S.joints=T.listJoints().map(P=>a.nodeIndexMap.get(P)),a.skinIndexMap.set(T,j),S}),n.listNodes().forEach((T,j)=>{const S=o.nodes[j],D=T.getMesh();D&&(S.mesh=a.meshIndexMap.get(D));const M=T.getCamera();M&&(S.camera=a.cameraIndexMap.get(M));const P=T.getSkin();P&&(S.skin=a.skinIndexMap.get(P)),T.listChildren().length>0&&(S.children=T.listChildren().map(x=>a.nodeIndexMap.get(x)))}),o.animations=n.listAnimations().map((T,j)=>{const S=a.createPropertyDef(T),D=new Map;return S.samplers=T.listSamplers().map((M,P)=>{const x=a.createPropertyDef(M);return x.input=a.accessorIndexMap.get(M.getInput()),x.output=a.accessorIndexMap.get(M.getOutput()),x.interpolation=M.getInterpolation(),D.set(M,P),x}),S.channels=T.listChannels().map(M=>{const P=a.createPropertyDef(M);return P.sampler=D.get(M.getSampler()),P.target={node:a.nodeIndexMap.get(M.getTargetNode()),path:M.getTargetPath()},P}),a.animationIndexMap.set(T,j),S}),o.scenes=n.listScenes().map((T,j)=>{const S=a.createPropertyDef(T);return S.nodes=T.listChildren().map(D=>a.nodeIndexMap.get(D)),a.sceneIndexMap.set(T,j),S});const A=n.getDefaultScene();return A&&(o.scene=n.listScenes().indexOf(A)),o.extensionsUsed=u.map(T=>T.extensionName),o.extensionsRequired=l.map(T=>T.extensionName),u.forEach(T=>T.write(a)),Ou(o),i}}function Ou(r){const e=[];for(const t in r){const s=r[t];(Array.isArray(s)&&s.length===0||s===null||s===""||s&&typeof s=="object"&&Object.keys(s).length===0)&&e.push(t)}for(const t of e)delete r[t]}var ys;(function(r){r[r.JSON=1313821514]="JSON",r[r.BIN=5130562]="BIN"})(ys||(ys={}));class Cu{constructor(){this._logger=Ue.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=_s.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const t of e)this._extensions.add(t),t.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const s=vi(t)?this._binaryToJSON(t):{json:JSON.parse(Y.decodeText(t)),resources:{}};return await this._readResourcesExternal(s,this.dirname(e)),this._readResourcesInternal(s),s}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),Au.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const t=this._binaryToJSON(Y.assertView(e));this._readResourcesInternal(t);const s=t.json;if(s.buffers&&s.buffers.some(n=>Du(t,n)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(n=>ju(t,n)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(Y.assertView(e)))}async writeJSON(e,t={}){if(t.format===it.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return wu.write(e,{format:t.format||it.GLTF,basename:t.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:xe({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:t,resources:s}=await this.writeJSON(e,{format:it.GLB}),n=new Uint32Array([1179937895,2,12]),o=JSON.stringify(t),i=Y.pad(Y.encodeText(o),32),a=Y.toView(new Uint32Array([i.byteLength,1313821514])),c=Y.concat([a,i]);n[n.length-1]+=c.byteLength;const f=Object.values(s)[0];if(!f||!f.byteLength)return Y.concat([Y.toView(n),c]);const u=Y.pad(f,0),l=Y.toView(new Uint32Array([u.byteLength,5130562])),_=Y.concat([l,u]);return n[n.length-1]+=_.byteLength,Y.concat([Y.toView(n),c,_])}async _readResourcesExternal(e,t){var s=this;const n=e.json.images||[],o=e.json.buffers||[],i=[...n,...o].map(async function(a){const c=a.uri;if(!c||c.match(/data:/))return Promise.resolve();e.resources[c]=await s.readURI(s.resolve(t,c),"view"),s.lastReadBytes+=e.resources[c].byteLength});await Promise.all(i)}_readResourcesInternal(e){function t(o){if(o.uri){if(o.uri in e.resources){Y.assertView(e.resources[o.uri]);return}if(o.uri.match(/data:/)){const i=`__${hu()}.${Ct.extension(o.uri)}`;e.resources[i]=Y.createBufferFromDataURI(o.uri),o.uri=i}}}(e.json.images||[]).forEach(o=>{if(o.bufferView===void 0&&o.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(o)}),(e.json.buffers||[]).forEach(t)}_copyJSON(e){const{images:t,buffers:s}=e.json;return e={json:xe({},e.json),resources:xe({},e.resources)},t&&(e.json.images=t.map(n=>xe({},n))),s&&(e.json.buffers=s.map(n=>xe({},n))),e}_binaryToJSON(e){if(!vi(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==ys.JSON)throw new Error("Missing required GLB JSON chunk.");const s=20,n=t[0],o=Y.decodeText(Y.toView(e,s,n)),i=JSON.parse(o),a=s+n;if(e.byteLength<=a)return{json:i,resources:{}};const c=new Uint32Array(e.buffer,e.byteOffset+a,2);if(c[1]!==ys.BIN)return{json:i,resources:{}};const f=c[0],u=Y.toView(e,a+8,f);return{json:i,resources:{[$t]:u}}}}function Du(r,e){return e.uri!==void 0&&!(e.uri in r.resources)}function ju(r,e){return e.uri!==void 0&&!(e.uri in r.resources)&&e.bufferView===void 0}function vi(r){if(r.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(r.buffer,r.byteOffset,3);return e[0]===1179937895&&e[1]===2}class Pu extends Cu{constructor(e=Wn.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=e}async readURI(e,t){const s=await fetch(e,this._fetchConfig);switch(t){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(e,t){return Wn.resolve(e,t)}dirname(e){return Wn.dirname(e)}}const Fu=0,Lu=0,Uu=0,Bu=2,Gu=0,Vu=163,ku=166,zu=0,$u=2,Hu=1,qu=64,Wu=0;function Ku(){return{vkFormat:Wu,typeSize:1,pixelWidth:0,pixelHeight:0,pixelDepth:0,layerCount:0,faceCount:1,supercompressionScheme:Fu,levels:[],dataFormatDescriptor:[{vendorId:Uu,descriptorType:Lu,versionNumber:Bu,colorModel:Gu,colorPrimaries:Hu,transferFunction:$u,flags:zu,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],keyValue:{},globalData:null}}class Vn{constructor(e,t,s,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,s),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),s=e+2**32*t;return this._offset+=8,s}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t=0){const s=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,n)}}const Ee=[171,75,84,88,32,50,48,187,13,10,26,10];function wi(r){return new TextDecoder().decode(r)}function Ms(r){const e=new Uint8Array(r.buffer,r.byteOffset,Ee.length);if(e[0]!==Ee[0]||e[1]!==Ee[1]||e[2]!==Ee[2]||e[3]!==Ee[3]||e[4]!==Ee[4]||e[5]!==Ee[5]||e[6]!==Ee[6]||e[7]!==Ee[7]||e[8]!==Ee[8]||e[9]!==Ee[9]||e[10]!==Ee[10]||e[11]!==Ee[11])throw new Error("Missing KTX 2.0 identifier.");const t=Ku(),s=17*Uint32Array.BYTES_PER_ELEMENT,n=new Vn(r,Ee.length,s,!0);t.vkFormat=n._nextUint32(),t.typeSize=n._nextUint32(),t.pixelWidth=n._nextUint32(),t.pixelHeight=n._nextUint32(),t.pixelDepth=n._nextUint32(),t.layerCount=n._nextUint32(),t.faceCount=n._nextUint32();const o=n._nextUint32();t.supercompressionScheme=n._nextUint32();const i=n._nextUint32(),a=n._nextUint32(),c=n._nextUint32(),f=n._nextUint32(),u=n._nextUint64(),l=n._nextUint64(),_=o*3*8,g=new Vn(r,Ee.length+s,_,!0);for(let ue=0;ue<o;ue++)t.levels.push({levelData:new Uint8Array(r.buffer,r.byteOffset+g._nextUint64(),g._nextUint64()),uncompressedByteLength:g._nextUint64()});const b=new Vn(r,i,a,!0);b._skip(4);const I=b._nextUint16(),A=b._nextUint16(),T=b._nextUint16(),j=b._nextUint16(),S=b._nextUint8(),D=b._nextUint8(),M=b._nextUint8(),P=b._nextUint8(),x=[b._nextUint8(),b._nextUint8(),b._nextUint8(),b._nextUint8()],N=[b._nextUint8(),b._nextUint8(),b._nextUint8(),b._nextUint8(),b._nextUint8(),b._nextUint8(),b._nextUint8(),b._nextUint8()],F={vendorId:I,descriptorType:A,versionNumber:T,colorModel:S,colorPrimaries:D,transferFunction:M,flags:P,texelBlockDimension:x,bytesPlane:N,samples:[]},B=(j/4-6)/4;for(let ue=0;ue<B;ue++){const me={bitOffset:b._nextUint16(),bitLength:b._nextUint8(),channelType:b._nextUint8(),samplePosition:[b._nextUint8(),b._nextUint8(),b._nextUint8(),b._nextUint8()],sampleLower:Number.NEGATIVE_INFINITY,sampleUpper:Number.POSITIVE_INFINITY};me.channelType&qu?(me.sampleLower=b._nextInt32(),me.sampleUpper=b._nextInt32()):(me.sampleLower=b._nextUint32(),me.sampleUpper=b._nextUint32()),F.samples[ue]=me}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(F);const U=new Vn(r,c,f,!0);for(;U._offset<f;){const ue=U._nextUint32(),me=U._scan(ue),le=wi(me);if(t.keyValue[le]=U._nextUint8Array(ue-me.byteLength-1),le.match(/^ktx/i)){const Ve=wi(t.keyValue[le]);t.keyValue[le]=Ve.substring(0,Ve.lastIndexOf("\0"))}const ze=ue%4?4-ue%4:0;U._skip(ze)}if(l<=0)return t;const V=new Vn(r,u,l,!0),$=V._nextUint16(),q=V._nextUint16(),d=V._nextUint32(),te=V._nextUint32(),oe=V._nextUint32(),ae=V._nextUint32(),Z=[];for(let ue=0;ue<o;ue++)Z.push({imageFlags:V._nextUint32(),rgbSliceByteOffset:V._nextUint32(),rgbSliceByteLength:V._nextUint32(),alphaSliceByteOffset:V._nextUint32(),alphaSliceByteLength:V._nextUint32()});const H=u+V._offset,p=H+d,Se=p+te,Me=Se+oe,ge=new Uint8Array(r.buffer,r.byteOffset+H,d),pt=new Uint8Array(r.buffer,r.byteOffset+p,te),et=new Uint8Array(r.buffer,r.byteOffset+Se,oe),lt=new Uint8Array(r.buffer,r.byteOffset+Me,ae);return t.globalData={endpointCount:$,selectorCount:q,imageDescs:Z,endpointsData:ge,selectorsData:pt,tablesData:et,extendedData:lt},t}const io="EXT_mesh_gpu_instancing",Ks="EXT_meshopt_compression",Xu="EXT_texture_webp",Yu="EXT_texture_avif",ka="KHR_draco_mesh_compression",ao="KHR_lights_punctual",co="KHR_materials_anisotropy",uo="KHR_materials_clearcoat",po="KHR_materials_diffuse_transmission",lo="KHR_materials_dispersion",fo="KHR_materials_emissive_strength",_o="KHR_materials_ior",ho="KHR_materials_iridescence",yo="KHR_materials_pbrSpecularGlossiness",go="KHR_materials_sheen",mo="KHR_materials_specular",To="KHR_materials_transmission",bo="KHR_materials_unlit",Eo="KHR_materials_volume",Ft="KHR_materials_variants",Qu="KHR_mesh_quantization",Ju="KHR_texture_basisu",Ao="KHR_texture_transform",gs="KHR_xmp_json_ld",Xs="INSTANCE_ATTRIBUTE";class za extends pe{init(){this.extensionName=io,this.propertyType="InstancedMesh",this.parentTypes=[C.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new ke})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Xs})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}za.EXTENSION_NAME=io;const yt=io;class $a extends ce{constructor(...e){super(...e),this.extensionName=yt,this.provideTypes=[C.NODE],this.prewriteTypes=[C.ACCESSOR]}createInstancedMesh(){return new za(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((n,o)=>{if(!n.extensions||!n.extensions[yt])return;const i=n.extensions[yt],a=this.createInstancedMesh();for(const c in i.attributes)a.setAttribute(c,e.accessors[i.attributes[c]]);e.nodes[o].setExtension(yt,a)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(Xs);for(const t of this.properties)for(const s of t.listAttributes())e.addAccessorToUsageGroup(s,Xs);return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(s=>{const n=s.getExtension(yt);if(n){const o=e.nodeIndexMap.get(s),i=t.json.nodes[o],a={attributes:{}};n.listSemantics().forEach(c=>{const f=n.getAttribute(c);a.attributes[c]=e.accessorIndexMap.get(f)}),i.extensions=i.extensions||{},i.extensions[yt]=a}}),this}}$a.EXTENSION_NAME=yt;function Je(){return Je=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},Je.apply(null,arguments)}var Yn;(function(r){r.QUANTIZE="quantize",r.FILTER="filter"})(Yn||(Yn={}));var Vt;(function(r){r.ATTRIBUTES="ATTRIBUTES",r.TRIANGLES="TRIANGLES",r.INDICES="INDICES"})(Vt||(Vt={}));var fe;(function(r){r.NONE="NONE",r.OCTAHEDRAL="OCTAHEDRAL",r.QUATERNION="QUATERNION",r.EXPONENTIAL="EXPONENTIAL"})(fe||(fe={}));const{BYTE:Zu,SHORT:Oi,FLOAT:ep}=W.ComponentType,{encodeNormalizedInt:Ci,decodeNormalizedInt:Ys}=Q;function tp(r,e,t,s){const{filter:n,bits:o}=s,i={array:r.getArray(),byteStride:r.getElementSize()*r.getComponentSize(),componentType:r.getComponentType(),normalized:r.getNormalized()};if(t!==Vt.ATTRIBUTES)return i;if(n!==fe.NONE){let a=r.getNormalized()?rp(r):new Float32Array(i.array);switch(n){case fe.EXPONENTIAL:i.byteStride=r.getElementSize()*4,i.componentType=ep,i.normalized=!1,i.array=e.encodeFilterExp(a,r.getCount(),i.byteStride,o);break;case fe.OCTAHEDRAL:i.byteStride=o>8?8:4,i.componentType=o>8?Oi:Zu,i.normalized=!0,a=r.getElementSize()===3?sp(a):a,i.array=e.encodeFilterOct(a,r.getCount(),i.byteStride,o);break;case fe.QUATERNION:i.byteStride=8,i.componentType=Oi,i.normalized=!0,i.array=e.encodeFilterQuat(a,r.getCount(),i.byteStride,o);break;default:throw new Error("Invalid filter.")}i.min=r.getMin([]),i.max=r.getMax([]),r.getNormalized()&&(i.min=i.min.map(c=>Ys(c,r.getComponentType())),i.max=i.max.map(c=>Ys(c,r.getComponentType()))),i.normalized&&(i.min=i.min.map(c=>Ci(c,i.componentType)),i.max=i.max.map(c=>Ci(c,i.componentType)))}else i.byteStride%4&&(i.array=np(i.array,r.getElementSize()),i.byteStride=i.array.byteLength/r.getCount());return i}function rp(r){const e=r.getComponentType(),t=r.getArray(),s=new Float32Array(t.length);for(let n=0;n<t.length;n++)s[n]=Ys(t[n],e);return s}function np(r,e){const s=Y.padNumber(r.BYTES_PER_ELEMENT*e)/r.BYTES_PER_ELEMENT,n=r.length/e,o=new r.constructor(n*s);for(let i=0;i*e<r.length;i++)for(let a=0;a<e;a++)o[i*s+a]=r[i*e+a];return o}function sp(r){const e=new Float32Array(r.length*4/3);for(let t=0,s=r.length/3;t<s;t++)e[t*4]=r[t*3],e[t*4+1]=r[t*3+1],e[t*4+2]=r[t*3+2];return e}function op(r,e){return e===We.BufferViewUsage.ELEMENT_ARRAY_BUFFER?r.listParents().some(s=>s instanceof _e&&s.getMode()===_e.Mode.TRIANGLES)?Vt.TRIANGLES:Vt.INDICES:Vt.ATTRIBUTES}function ip(r,e){const t=e.getGraph().listParentEdges(r).filter(s=>!(s.getParent()instanceof Pt));for(const s of t){const n=s.getName(),o=s.getAttributes().key||"",i=s.getParent().propertyType===C.PRIMITIVE_TARGET;if(n==="indices")return{filter:fe.NONE};if(n==="attributes"){if(o==="POSITION")return{filter:fe.NONE};if(o==="TEXCOORD_0")return{filter:fe.NONE};if(o.startsWith("JOINTS_"))return{filter:fe.NONE};if(o.startsWith("WEIGHTS_"))return{filter:fe.NONE};if(o==="NORMAL"||o==="TANGENT")return i?{filter:fe.NONE}:{filter:fe.OCTAHEDRAL,bits:8}}if(n==="output"){const a=Ha(r);return a==="rotation"?{filter:fe.QUATERNION,bits:16}:a==="translation"?{filter:fe.EXPONENTIAL,bits:12}:a==="scale"?{filter:fe.EXPONENTIAL,bits:12}:{filter:fe.NONE}}if(n==="input")return{filter:fe.NONE};if(n==="inverseBindMatrices")return{filter:fe.NONE}}return{filter:fe.NONE}}function Ha(r){for(const e of r.listParents())if(e instanceof Qt){for(const t of e.listParents())if(t instanceof Yt)return t.getTargetPath()}return null}function ap(r){return!r.extensions||!r.extensions[Ks]?!1:!!r.extensions[Ks].fallback}const Ae=Ks,Di={method:Yn.QUANTIZE};class Io extends ce{constructor(...e){super(...e),this.extensionName=Ae,this.prereadTypes=[C.BUFFER,C.PRIMITIVE],this.prewriteTypes=[C.BUFFER,C.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=Di,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=Je({},Di,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${Ae}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${Ae}]: Missing WASM support.`)}return t===C.BUFFER?this._prereadBuffers(e):t===C.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((n,o)=>{if(!n.extensions||!n.extensions[Ae])return;const i=n.extensions[Ae],a=i.byteOffset||0,c=i.byteLength||0,f=i.count,u=i.byteStride,l=new Uint8Array(f*u),_=t.json.buffers[i.buffer],g=_.uri?t.resources[_.uri]:t.resources[$t],b=Y.toView(g,a,c);this._decoder.decodeGltfBuffer(l,f,u,b,i.mode,i.filter),e.bufferViews[o]=l})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(n=>{if(!n.extensions||!n.extensions[Ae])return;const o=n.extensions[Ae],i=e.buffers[o.buffer],a=e.buffers[n.buffer],c=t.json.buffers[n.buffer];ap(c)&&this._decoderFallbackBufferMap.set(a,i)})}read(e){if(!this.isRequired())return this;for(const[t,s]of this._decoderFallbackBufferMap){for(const n of t.listParents())n instanceof W&&n.swap(t,s);t.dispose()}return this}prewrite(e,t){return t===C.ACCESSOR?this._prewriteAccessors(e):t===C.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,s=this._encoder,n=this._encoderOptions,o=this.document.getGraph(),i=this.document.createBuffer(),a=this.document.getRoot().listBuffers().indexOf(i);let c=1;const f=new Map,u=l=>{for(const _ of o.listParents(l)){if(_.propertyType===C.ROOT)continue;let g=f.get(l);return g===void 0&&f.set(l,g=c++),g}return-1};this._encoderFallbackBuffer=i,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const l of this.document.getRoot().listAccessors()){if(Ha(l)==="weights"||l.getSparse())continue;const _=e.getAccessorUsage(l),g=e.accessorUsageGroupedByParent.has(_)?u(l):null,b=op(l,_),I=n.method===Yn.FILTER?ip(l,this.document):{filter:fe.NONE},A=tp(l,s,b,I),{array:T,byteStride:j}=A,S=l.getBuffer();if(!S)throw new Error(`${Ae}: Missing buffer for accessor.`);const D=this.document.getRoot().listBuffers().indexOf(S),M=[_,g,b,I.filter,j,D].join(":");let P=this._encoderBufferViews[M],x=this._encoderBufferViewData[M],N=this._encoderBufferViewAccessors[M];(!P||!x)&&(N=this._encoderBufferViewAccessors[M]=[],x=this._encoderBufferViewData[M]=[],P=this._encoderBufferViews[M]={buffer:a,target:We.USAGE_TO_TARGET[_],byteOffset:0,byteLength:0,byteStride:_===We.BufferViewUsage.ARRAY_BUFFER?j:void 0,extensions:{[Ae]:{buffer:D,byteOffset:0,byteLength:0,mode:b,filter:I.filter!==fe.NONE?I.filter:void 0,byteStride:j,count:0}}});const w=e.createAccessorDef(l);w.componentType=A.componentType,w.normalized=A.normalized,w.byteOffset=P.byteLength,w.min&&A.min&&(w.min=A.min),w.max&&A.max&&(w.max=A.max),e.accessorIndexMap.set(l,t.accessors.length),t.accessors.push(w),N.push(w),x.push(new Uint8Array(T.buffer,T.byteOffset,T.byteLength)),P.byteLength+=T.byteLength,P.extensions.EXT_meshopt_compression.count+=l.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const s in this._encoderBufferViews){const n=this._encoderBufferViews[s],o=this._encoderBufferViewData[s],i=this.document.getRoot().listBuffers()[n.extensions[Ae].buffer],a=e.otherBufferViews.get(i)||[],{count:c,byteStride:f,mode:u}=n.extensions[Ae],l=Y.concat(o),_=t.encodeGltfBuffer(l,c,f,u),g=Y.pad(_);n.extensions[Ae].byteLength=_.byteLength,o.length=0,o.push(g),a.push(g),e.otherBufferViews.set(i,a)}}write(e){let t=0;for(const i in this._encoderBufferViews){const a=this._encoderBufferViews[i],c=this._encoderBufferViewData[i][0],f=e.otherBufferViewsIndexMap.get(c),u=this._encoderBufferViewAccessors[i];for(const b of u)b.bufferView=f;const l=e.jsonDoc.json.bufferViews[f],_=l.byteOffset||0;Object.assign(l,a),l.byteOffset=t;const g=l.extensions[Ae];g.byteOffset=_,t+=Y.padNumber(a.byteLength)}const s=this._encoderFallbackBuffer,n=e.bufferIndexMap.get(s),o=e.jsonDoc.json.buffers[n];return o.byteLength=t,o.extensions={[Ae]:{fallback:!0}},s.dispose(),this}}Io.EXTENSION_NAME=Ae;Io.EncoderMethod=Yn;const zn=Yu;class cp{match(e){return e.length>=12&&Y.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let s=ji(t,0);if(!s)return null;let n=s.end;for(;s=ji(t,n);)if(s.type==="meta")n=s.start+4;else if(s.type==="iprp"||s.type==="ipco")n=s.start;else{if(s.type==="ispe")return[t.getUint32(s.start+4),t.getUint32(s.start+8)];if(s.type==="mdat")break;n=s.end}return null}getChannels(e){return 4}}class qa extends ce{constructor(...e){super(...e),this.extensionName=zn,this.prereadTypes=[C.TEXTURE]}static register(){Ce.registerFormat("image/avif",new cp)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(s=>{s.extensions&&s.extensions[zn]&&(s.source=s.extensions[zn].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/avif"){const n=e.imageIndexMap.get(s);(t.json.textures||[]).forEach(i=>{i.source===n&&(i.extensions=i.extensions||{},i.extensions[zn]={source:i.source},delete i.source)})}}),this}}qa.EXTENSION_NAME=zn;function ji(r,e){if(r.byteLength<4+e)return null;const t=r.getUint32(e);return r.byteLength<t+e||t<8?null:{type:Y.decodeText(new Uint8Array(r.buffer,r.byteOffset+e+4,4)),start:e+8,end:e+t}}const $n=Xu;class up{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=Y.decodeText(e.slice(0,4)),s=Y.decodeText(e.slice(8,12));if(t!=="RIFF"||s!=="WEBP")return null;const n=new DataView(e.buffer,e.byteOffset);let o=12;for(;o<n.byteLength;){const i=Y.decodeText(new Uint8Array([n.getUint8(o),n.getUint8(o+1),n.getUint8(o+2),n.getUint8(o+3)])),a=n.getUint32(o+4,!0);if(i==="VP8 "){const c=n.getInt16(o+14,!0)&16383,f=n.getInt16(o+16,!0)&16383;return[c,f]}else if(i==="VP8L"){const c=n.getUint8(o+9),f=n.getUint8(o+10),u=n.getUint8(o+11),l=n.getUint8(o+12),_=1+((f&63)<<8|c),g=1+((l&15)<<10|u<<2|(f&192)>>6);return[_,g]}o+=8+a+a%2}return null}getChannels(e){return 4}}class Wa extends ce{constructor(...e){super(...e),this.extensionName=$n,this.prereadTypes=[C.TEXTURE]}static register(){Ce.registerFormat("image/webp",new up)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(s=>{s.extensions&&s.extensions[$n]&&(s.source=s.extensions[$n].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/webp"){const n=e.imageIndexMap.get(s);(t.json.textures||[]).forEach(i=>{i.source===n&&(i.extensions=i.extensions||{},i.extensions[$n]={source:i.source},delete i.source)})}}),this}}Wa.EXTENSION_NAME=$n;const Pi=ka;let he,Ka,Xa;function pp(r,e){const t=new he.DecoderBuffer;try{if(t.Init(e,e.length),r.GetEncodedGeometryType(t)!==he.TRIANGULAR_MESH)throw new Error(`[${Pi}] Unknown geometry type.`);const n=new he.Mesh;if(!r.DecodeBufferToMesh(t,n).ok()||n.ptr===0)throw new Error(`[${Pi}] Decoding failure.`);return n}finally{he.destroy(t)}}function lp(r,e){const s=e.num_faces()*3;let n,o;if(e.num_points()<=65534){const i=s*Uint16Array.BYTES_PER_ELEMENT;n=he._malloc(i),r.GetTrianglesUInt16Array(e,i,n),o=new Uint16Array(he.HEAPU16.buffer,n,s).slice()}else{const i=s*Uint32Array.BYTES_PER_ELEMENT;n=he._malloc(i),r.GetTrianglesUInt32Array(e,i,n),o=new Uint32Array(he.HEAPU32.buffer,n,s).slice()}return he._free(n),o}function fp(r,e,t,s){const n=Xa[s.componentType],o=Ka[s.componentType],i=t.num_components(),c=e.num_points()*i,f=c*o.BYTES_PER_ELEMENT,u=he._malloc(f);r.GetAttributeDataArrayForAllPoints(e,t,n,f,u);const l=new o(he.HEAPF32.buffer,u,c).slice();return he._free(u),l}function _p(r){he=r,Ka={[W.ComponentType.FLOAT]:Float32Array,[W.ComponentType.UNSIGNED_INT]:Uint32Array,[W.ComponentType.UNSIGNED_SHORT]:Uint16Array,[W.ComponentType.UNSIGNED_BYTE]:Uint8Array,[W.ComponentType.SHORT]:Int16Array,[W.ComponentType.BYTE]:Int8Array},Xa={[W.ComponentType.FLOAT]:he.DT_FLOAT32,[W.ComponentType.UNSIGNED_INT]:he.DT_UINT32,[W.ComponentType.UNSIGNED_SHORT]:he.DT_UINT16,[W.ComponentType.UNSIGNED_BYTE]:he.DT_UINT8,[W.ComponentType.SHORT]:he.DT_INT16,[W.ComponentType.BYTE]:he.DT_INT8}}let je;var Qn;(function(r){r[r.EDGEBREAKER=1]="EDGEBREAKER",r[r.SEQUENTIAL=0]="SEQUENTIAL"})(Qn||(Qn={}));var Le;(function(r){r.POSITION="POSITION",r.NORMAL="NORMAL",r.COLOR="COLOR",r.TEX_COORD="TEX_COORD",r.GENERIC="GENERIC"})(Le||(Le={}));const Ya={[Le.POSITION]:14,[Le.NORMAL]:10,[Le.COLOR]:8,[Le.TEX_COORD]:12,[Le.GENERIC]:12},Fi={decodeSpeed:5,encodeSpeed:5,method:Qn.EDGEBREAKER,quantizationBits:Ya,quantizationVolume:"mesh"};function dp(r){je=r}function hp(r,e=Fi){const t=Je({},Fi,e);t.quantizationBits=Je({},Ya,e.quantizationBits);const s=new je.MeshBuilder,n=new je.Mesh,o=new je.ExpertEncoder(n),i={},a=new je.DracoInt8Array,c=r.listTargets().length>0;let f=!1;for(const I of r.listSemantics()){const A=r.getAttribute(I);if(A.getSparse()){f=!0;continue}const T=yp(I),j=gp(s,A.getComponentType(),n,je[T],A.getCount(),A.getElementSize(),A.getArray());if(j===-1)throw new Error(`Error compressing "${I}" attribute.`);if(i[I]=j,t.quantizationVolume==="mesh"||I!=="POSITION")o.SetAttributeQuantization(j,t.quantizationBits[T]);else if(typeof t.quantizationVolume=="object"){const{quantizationVolume:S}=t,D=Math.max(S.max[0]-S.min[0],S.max[1]-S.min[1],S.max[2]-S.min[2]);o.SetAttributeExplicitQuantization(j,t.quantizationBits[T],A.getElementSize(),S.min,D)}else throw new Error("Invalid quantization volume state.")}const u=r.getIndices();if(!u)throw new Qs("Primitive must have indices.");s.AddFacesToMesh(n,u.getCount()/3,u.getArray()),o.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),o.SetTrackEncodedProperties(!0),t.method===Qn.SEQUENTIAL||c||f?o.SetEncodingMethod(je.MESH_SEQUENTIAL_ENCODING):o.SetEncodingMethod(je.MESH_EDGEBREAKER_ENCODING);const l=o.EncodeToDracoBuffer(!(c||f),a);if(l<=0)throw new Qs("Error applying Draco compression.");const _=new Uint8Array(l);for(let I=0;I<l;++I)_[I]=a.GetValue(I);const g=o.GetNumberOfEncodedPoints(),b=o.GetNumberOfEncodedFaces()*3;return je.destroy(a),je.destroy(n),je.destroy(s),je.destroy(o),{numVertices:g,numIndices:b,data:_,attributeIDs:i}}function yp(r){return r==="POSITION"?Le.POSITION:r==="NORMAL"?Le.NORMAL:r.startsWith("COLOR_")?Le.COLOR:r.startsWith("TEXCOORD_")?Le.TEX_COORD:Le.GENERIC}function gp(r,e,t,s,n,o,i){switch(e){case W.ComponentType.UNSIGNED_BYTE:return r.AddUInt8Attribute(t,s,n,o,i);case W.ComponentType.BYTE:return r.AddInt8Attribute(t,s,n,o,i);case W.ComponentType.UNSIGNED_SHORT:return r.AddUInt16Attribute(t,s,n,o,i);case W.ComponentType.SHORT:return r.AddInt16Attribute(t,s,n,o,i);case W.ComponentType.UNSIGNED_INT:return r.AddUInt32Attribute(t,s,n,o,i);case W.ComponentType.FLOAT:return r.AddFloatAttribute(t,s,n,o,i);default:throw new Error(`Unexpected component type, "${e}".`)}}class Qs extends Error{}const de=ka;class kt extends ce{constructor(...e){super(...e),this.extensionName=de,this.prereadTypes=[C.PRIMITIVE],this.prewriteTypes=[C.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,_p(this._decoderModule)),e==="draco3d.encoder"&&(this._encoderModule=t,dp(this._encoderModule)),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${de}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),s=e.jsonDoc,n=new Map;try{const o=s.json.meshes||[];for(const i of o)for(const a of i.primitives){if(!a.extensions||!a.extensions[de])continue;const c=a.extensions[de];let[f,u]=n.get(c.bufferView)||[];if(!u||!f){const l=s.json.bufferViews[c.bufferView],_=s.json.buffers[l.buffer],g=_.uri?s.resources[_.uri]:s.resources[$t],b=l.byteOffset||0,I=l.byteLength,A=Y.toView(g,b,I);f=new this._decoderModule.Decoder,u=pp(f,A),n.set(c.bufferView,[f,u]),t.debug(`[${de}] Decompressed ${A.byteLength} bytes.`)}for(const l in c.attributes){const _=e.jsonDoc.json.accessors[a.attributes[l]],g=f.GetAttributeByUniqueId(u,c.attributes[l]),b=fp(f,u,g,_);e.accessors[a.attributes[l]].setArray(b)}a.indices!==void 0&&e.accessors[a.indices].setArray(lp(f,u))}}finally{for(const[o,i]of Array.from(n.values()))this._decoderModule.destroy(o),this._decoderModule.destroy(i)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${de}] Please install extension dependency, "draco3d.encoder".`);const s=this.document.getLogger();s.debug(`[${de}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const n=mp(this.document),o=new Map;let i="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?s.warn(`[${de}]: quantizationVolume=scene requires exactly 1 scene.`):i=tu(this.document.getRoot().listScenes().pop()));for(const a of Array.from(n.keys())){const c=n.get(a);if(!c)throw new Error("Unexpected primitive.");if(o.has(c)){o.set(c,o.get(c));continue}const f=a.getIndices(),u=e.jsonDoc.json.accessors;let l;try{l=hp(a,Je({},this._encoderOptions,{quantizationVolume:i}))}catch(b){if(b instanceof Qs){s.warn(`[${de}]: ${b.message} Skipping primitive compression.`);continue}throw b}o.set(c,l);const _=e.createAccessorDef(f);_.count=l.numIndices,e.accessorIndexMap.set(f,u.length),u.push(_),l.numVertices>65534&&W.getComponentSize(_.componentType)<=2?_.componentType=W.ComponentType.UNSIGNED_INT:l.numVertices>254&&W.getComponentSize(_.componentType)<=1&&(_.componentType=W.ComponentType.UNSIGNED_SHORT);for(const b of a.listSemantics()){const I=a.getAttribute(b);if(l.attributeIDs[b]===void 0)continue;const A=e.createAccessorDef(I);A.count=l.numVertices,e.accessorIndexMap.set(I,u.length),u.push(A)}const g=a.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(g)||e.otherBufferViews.set(g,[]),e.otherBufferViews.get(g).push(l.data)}return s.debug(`[${de}] Compressed ${n.size} primitives.`),e.extensionData[de]={primitiveHashMap:n,primitiveEncodingMap:o},this}write(e){const t=e.extensionData[de];for(const s of this.document.getRoot().listMeshes()){const n=e.jsonDoc.json.meshes[e.meshIndexMap.get(s)];for(let o=0;o<s.listPrimitives().length;o++){const i=s.listPrimitives()[o],a=n.primitives[o],c=t.primitiveHashMap.get(i);if(!c)continue;const f=t.primitiveEncodingMap.get(c);f&&(a.extensions=a.extensions||{},a.extensions[de]={bufferView:e.otherBufferViewsIndexMap.get(f.data),attributes:f.attributeIDs})}}if(!t.primitiveHashMap.size){const s=e.jsonDoc.json;s.extensionsUsed=(s.extensionsUsed||[]).filter(n=>n!==de),s.extensionsRequired=(s.extensionsRequired||[]).filter(n=>n!==de)}return this}}kt.EXTENSION_NAME=de;kt.EncoderMethod=Qn;function mp(r){const e=r.getLogger(),t=new Set,s=new Set;let n=0,o=0;for(const l of r.getRoot().listMeshes())for(const _ of l.listPrimitives())_.getIndices()?_.getMode()!==_e.Mode.TRIANGLES?(s.add(_),o++):t.add(_):(s.add(_),n++);n>0&&e.warn(`[${de}] Skipping Draco compression of ${n} non-indexed primitives.`),o>0&&e.warn(`[${de}] Skipping Draco compression of ${o} non-TRIANGLES primitives.`);const i=r.getRoot().listAccessors(),a=new Map;for(let l=0;l<i.length;l++)a.set(i[l],l);const c=new Map,f=new Set,u=new Map;for(const l of Array.from(t)){let _=Li(l,a);if(f.has(_)){u.set(l,_);continue}if(c.has(l.getIndices())){const g=l.getIndices(),b=g.clone();a.set(b,r.getRoot().listAccessors().length-1),l.swap(g,b)}for(const g of l.listAttributes())if(c.has(g)){const b=g.clone();a.set(b,r.getRoot().listAccessors().length-1),l.swap(g,b)}_=Li(l,a),f.add(_),u.set(l,_),c.set(l.getIndices(),_);for(const g of l.listAttributes())c.set(g,_)}for(const l of Array.from(c.keys())){const _=new Set(l.listParents().map(g=>g.propertyType));if(_.size!==2||!_.has(C.PRIMITIVE)||!_.has(C.ROOT))throw new Error(`[${de}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const l of Array.from(t)){const _=u.get(l),g=l.getIndices();if(c.get(g)!==_||l.listAttributes().some(b=>c.get(b)!==_))throw new Error(`[${de}] Draco primitives must share all, or no, accessors.`)}for(const l of Array.from(s)){const _=l.getIndices();if(c.has(_)||l.listAttributes().some(g=>c.has(g)))throw new Error(`[${de}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return u}function Li(r,e){const t=[],s=r.getIndices();t.push(e.get(s));for(const n of r.listAttributes())t.push(e.get(n));return t.sort().join("|")}class Ht extends pe{init(){this.extensionName=ao,this.propertyType="Light",this.parentTypes=[C.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:Ht.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}Ht.EXTENSION_NAME=ao;Ht.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const He=ao;class Qa extends ce{constructor(...e){super(...e),this.extensionName=He}createLight(e=""){return new Ht(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[He])return this;const o=(t.json.extensions[He].lights||[]).map(i=>{var a,c;const f=this.createLight().setName(i.name||"").setType(i.type);return i.color!==void 0&&f.setColor(i.color),i.intensity!==void 0&&f.setIntensity(i.intensity),i.range!==void 0&&f.setRange(i.range),((a=i.spot)==null?void 0:a.innerConeAngle)!==void 0&&f.setInnerConeAngle(i.spot.innerConeAngle),((c=i.spot)==null?void 0:c.outerConeAngle)!==void 0&&f.setOuterConeAngle(i.spot.outerConeAngle),f});return t.json.nodes.forEach((i,a)=>{if(!i.extensions||!i.extensions[He])return;const c=i.extensions[He];e.nodes[a].setExtension(He,o[c.light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const s=[],n=new Map;for(const o of this.properties){const i=o,a={type:i.getType()};Q.eq(i.getColor(),[1,1,1])||(a.color=i.getColor()),i.getIntensity()!==1&&(a.intensity=i.getIntensity()),i.getRange()!=null&&(a.range=i.getRange()),i.getName()&&(a.name=i.getName()),i.getType()===Ht.Type.SPOT&&(a.spot={innerConeAngle:i.getInnerConeAngle(),outerConeAngle:i.getOuterConeAngle()}),s.push(a),n.set(i,s.length-1)}return this.document.getRoot().listNodes().forEach(o=>{const i=o.getExtension(He);if(i){const a=e.nodeIndexMap.get(o),c=t.json.nodes[a];c.extensions=c.extensions||{},c.extensions[He]={light:n.get(i)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[He]={lights:s},this}}Qa.EXTENSION_NAME=He;const{R:Tp,G:bp,B:Ep}=Be;class Ja extends pe{init(){this.extensionName=co,this.propertyType="Anisotropy",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new re(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:Tp|bp|Ep})}}Ja.EXTENSION_NAME=co;const gt=co;class Za extends ce{constructor(...e){super(...e),this.extensionName=gt,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createAnisotropy(){return new Ja(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,s=t.json.materials||[],n=t.json.textures||[];return s.forEach((o,i)=>{if(o.extensions&&o.extensions[gt]){const a=this.createAnisotropy();e.materials[i].setExtension(gt,a);const c=o.extensions[gt];if(c.anisotropyStrength!==void 0&&a.setAnisotropyStrength(c.anisotropyStrength),c.anisotropyRotation!==void 0&&a.setAnisotropyRotation(c.anisotropyRotation),c.anisotropyTexture!==void 0){const f=c.anisotropyTexture,u=e.textures[n[f.index].source];a.setAnisotropyTexture(u),e.setTextureInfo(a.getAnisotropyTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const n=s.getExtension(gt);if(n){const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{};const a=i.extensions[gt]={};if(n.getAnisotropyStrength()>0&&(a.anisotropyStrength=n.getAnisotropyStrength()),n.getAnisotropyRotation()!==0&&(a.anisotropyRotation=n.getAnisotropyRotation()),n.getAnisotropyTexture()){const c=n.getAnisotropyTexture(),f=n.getAnisotropyTextureInfo();a.anisotropyTexture=e.createTextureInfoDef(c,f)}}}),this}}Za.EXTENSION_NAME=gt;const{R:Ui,G:Bi,B:Ap}=Be;class ec extends pe{init(){this.extensionName=uo,this.propertyType="Clearcoat",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new re(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new re(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new re(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:Ui})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:Bi})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:Ui|Bi|Ap})}}ec.EXTENSION_NAME=uo;const mt=uo;class tc extends ce{constructor(...e){super(...e),this.extensionName=mt,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createClearcoat(){return new ec(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,s=t.json.materials||[],n=t.json.textures||[];return s.forEach((o,i)=>{if(o.extensions&&o.extensions[mt]){const a=this.createClearcoat();e.materials[i].setExtension(mt,a);const c=o.extensions[mt];if(c.clearcoatFactor!==void 0&&a.setClearcoatFactor(c.clearcoatFactor),c.clearcoatRoughnessFactor!==void 0&&a.setClearcoatRoughnessFactor(c.clearcoatRoughnessFactor),c.clearcoatTexture!==void 0){const f=c.clearcoatTexture,u=e.textures[n[f.index].source];a.setClearcoatTexture(u),e.setTextureInfo(a.getClearcoatTextureInfo(),f)}if(c.clearcoatRoughnessTexture!==void 0){const f=c.clearcoatRoughnessTexture,u=e.textures[n[f.index].source];a.setClearcoatRoughnessTexture(u),e.setTextureInfo(a.getClearcoatRoughnessTextureInfo(),f)}if(c.clearcoatNormalTexture!==void 0){const f=c.clearcoatNormalTexture,u=e.textures[n[f.index].source];a.setClearcoatNormalTexture(u),e.setTextureInfo(a.getClearcoatNormalTextureInfo(),f),f.scale!==void 0&&a.setClearcoatNormalScale(f.scale)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const n=s.getExtension(mt);if(n){const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{};const a=i.extensions[mt]={clearcoatFactor:n.getClearcoatFactor(),clearcoatRoughnessFactor:n.getClearcoatRoughnessFactor()};if(n.getClearcoatTexture()){const c=n.getClearcoatTexture(),f=n.getClearcoatTextureInfo();a.clearcoatTexture=e.createTextureInfoDef(c,f)}if(n.getClearcoatRoughnessTexture()){const c=n.getClearcoatRoughnessTexture(),f=n.getClearcoatRoughnessTextureInfo();a.clearcoatRoughnessTexture=e.createTextureInfoDef(c,f)}if(n.getClearcoatNormalTexture()){const c=n.getClearcoatNormalTexture(),f=n.getClearcoatNormalTextureInfo();a.clearcoatNormalTexture=e.createTextureInfoDef(c,f),n.getClearcoatNormalScale()!==1&&(a.clearcoatNormalTexture.scale=n.getClearcoatNormalScale())}}}),this}}tc.EXTENSION_NAME=mt;const{R:Ip,G:xp,B:Rp,A:Sp}=Be;class rc extends pe{init(){this.extensionName=po,this.propertyType="DiffuseTransmission",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseTransmissionFactor:0,diffuseTransmissionTexture:null,diffuseTransmissionTextureInfo:new re(this.graph,"diffuseTransmissionTextureInfo"),diffuseTransmissionColorFactor:[1,1,1],diffuseTransmissionColorTexture:null,diffuseTransmissionColorTextureInfo:new re(this.graph,"diffuseTransmissionColorTextureInfo")})}getDiffuseTransmissionFactor(){return this.get("diffuseTransmissionFactor")}setDiffuseTransmissionFactor(e){return this.set("diffuseTransmissionFactor",e)}getDiffuseTransmissionTexture(){return this.getRef("diffuseTransmissionTexture")}getDiffuseTransmissionTextureInfo(){return this.getRef("diffuseTransmissionTexture")?this.getRef("diffuseTransmissionTextureInfo"):null}setDiffuseTransmissionTexture(e){return this.setRef("diffuseTransmissionTexture",e,{channels:Sp})}getDiffuseTransmissionColorFactor(){return this.get("diffuseTransmissionColorFactor")}setDiffuseTransmissionColorFactor(e){return this.set("diffuseTransmissionColorFactor",e)}getDiffuseTransmissionColorTexture(){return this.getRef("diffuseTransmissionColorTexture")}getDiffuseTransmissionColorTextureInfo(){return this.getRef("diffuseTransmissionColorTexture")?this.getRef("diffuseTransmissionColorTextureInfo"):null}setDiffuseTransmissionColorTexture(e){return this.setRef("diffuseTransmissionColorTexture",e,{channels:Ip|xp|Rp})}}rc.EXTENSION_NAME=po;const Tt=po;class nc extends ce{constructor(...e){super(...e),this.extensionName=Tt}createDiffuseTransmission(){return new rc(this.document.getGraph())}read(e){const t=e.jsonDoc,s=t.json.materials||[],n=t.json.textures||[];return s.forEach((o,i)=>{if(o.extensions&&o.extensions[Tt]){const a=this.createDiffuseTransmission();e.materials[i].setExtension(Tt,a);const c=o.extensions[Tt];if(c.diffuseTransmissionFactor!==void 0&&a.setDiffuseTransmissionFactor(c.diffuseTransmissionFactor),c.diffuseTransmissionColorFactor!==void 0&&a.setDiffuseTransmissionColorFactor(c.diffuseTransmissionColorFactor),c.diffuseTransmissionTexture!==void 0){const f=c.diffuseTransmissionTexture,u=e.textures[n[f.index].source];a.setDiffuseTransmissionTexture(u),e.setTextureInfo(a.getDiffuseTransmissionTextureInfo(),f)}if(c.diffuseTransmissionColorTexture!==void 0){const f=c.diffuseTransmissionColorTexture,u=e.textures[n[f.index].source];a.setDiffuseTransmissionColorTexture(u),e.setTextureInfo(a.getDiffuseTransmissionColorTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;for(const s of this.document.getRoot().listMaterials()){const n=s.getExtension(Tt);if(!n)continue;const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{};const a=i.extensions[Tt]={diffuseTransmissionFactor:n.getDiffuseTransmissionFactor(),diffuseTransmissionColorFactor:n.getDiffuseTransmissionColorFactor()};if(n.getDiffuseTransmissionTexture()){const c=n.getDiffuseTransmissionTexture(),f=n.getDiffuseTransmissionTextureInfo();a.diffuseTransmissionTexture=e.createTextureInfoDef(c,f)}if(n.getDiffuseTransmissionColorTexture()){const c=n.getDiffuseTransmissionColorTexture(),f=n.getDiffuseTransmissionColorTextureInfo();a.diffuseTransmissionColorTexture=e.createTextureInfoDef(c,f)}}return this}}nc.EXTENSION_NAME=Tt;class sc extends pe{init(){this.extensionName=lo,this.propertyType="Dispersion",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{dispersion:0})}getDispersion(){return this.get("dispersion")}setDispersion(e){return this.set("dispersion",e)}}sc.EXTENSION_NAME=lo;const bt=lo;class oc extends ce{constructor(...e){super(...e),this.extensionName=bt,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createDispersion(){return new sc(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((n,o)=>{if(n.extensions&&n.extensions[bt]){const i=this.createDispersion();e.materials[o].setExtension(bt,i);const a=n.extensions[bt];a.dispersion!==void 0&&i.setDispersion(a.dispersion)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const n=s.getExtension(bt);if(n){const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{},i.extensions[bt]={dispersion:n.getDispersion()}}}),this}}oc.EXTENSION_NAME=bt;class ic extends pe{init(){this.extensionName=fo,this.propertyType="EmissiveStrength",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}ic.EXTENSION_NAME=fo;const Et=fo;class ac extends ce{constructor(...e){super(...e),this.extensionName=Et,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createEmissiveStrength(){return new ic(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((n,o)=>{if(n.extensions&&n.extensions[Et]){const i=this.createEmissiveStrength();e.materials[o].setExtension(Et,i);const a=n.extensions[Et];a.emissiveStrength!==void 0&&i.setEmissiveStrength(a.emissiveStrength)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const n=s.getExtension(Et);if(n){const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{},i.extensions[Et]={emissiveStrength:n.getEmissiveStrength()}}}),this}}ac.EXTENSION_NAME=Et;class cc extends pe{init(){this.extensionName=_o,this.propertyType="IOR",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}cc.EXTENSION_NAME=_o;const At=_o;class xo extends ce{constructor(...e){super(...e),this.extensionName=At,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createIOR(){return new cc(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((n,o)=>{if(n.extensions&&n.extensions[At]){const i=this.createIOR();e.materials[o].setExtension(At,i);const a=n.extensions[At];a.ior!==void 0&&i.setIOR(a.ior)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const n=s.getExtension(At);if(n){const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{},i.extensions[At]={ior:n.getIOR()}}}),this}}xo.EXTENSION_NAME=At;const{R:Mp,G:Np}=Be;class uc extends pe{init(){this.extensionName=ho,this.propertyType="Iridescence",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new re(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new re(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Mp})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Np})}}uc.EXTENSION_NAME=ho;const It=ho;class pc extends ce{constructor(...e){super(...e),this.extensionName=It,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createIridescence(){return new uc(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,s=t.json.materials||[],n=t.json.textures||[];return s.forEach((o,i)=>{if(o.extensions&&o.extensions[It]){const a=this.createIridescence();e.materials[i].setExtension(It,a);const c=o.extensions[It];if(c.iridescenceFactor!==void 0&&a.setIridescenceFactor(c.iridescenceFactor),c.iridescenceIor!==void 0&&a.setIridescenceIOR(c.iridescenceIor),c.iridescenceThicknessMinimum!==void 0&&a.setIridescenceThicknessMinimum(c.iridescenceThicknessMinimum),c.iridescenceThicknessMaximum!==void 0&&a.setIridescenceThicknessMaximum(c.iridescenceThicknessMaximum),c.iridescenceTexture!==void 0){const f=c.iridescenceTexture,u=e.textures[n[f.index].source];a.setIridescenceTexture(u),e.setTextureInfo(a.getIridescenceTextureInfo(),f)}if(c.iridescenceThicknessTexture!==void 0){const f=c.iridescenceThicknessTexture,u=e.textures[n[f.index].source];a.setIridescenceThicknessTexture(u),e.setTextureInfo(a.getIridescenceThicknessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const n=s.getExtension(It);if(n){const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{};const a=i.extensions[It]={};if(n.getIridescenceFactor()>0&&(a.iridescenceFactor=n.getIridescenceFactor()),n.getIridescenceIOR()!==1.3&&(a.iridescenceIor=n.getIridescenceIOR()),n.getIridescenceThicknessMinimum()!==100&&(a.iridescenceThicknessMinimum=n.getIridescenceThicknessMinimum()),n.getIridescenceThicknessMaximum()!==400&&(a.iridescenceThicknessMaximum=n.getIridescenceThicknessMaximum()),n.getIridescenceTexture()){const c=n.getIridescenceTexture(),f=n.getIridescenceTextureInfo();a.iridescenceTexture=e.createTextureInfoDef(c,f)}if(n.getIridescenceThicknessTexture()){const c=n.getIridescenceThicknessTexture(),f=n.getIridescenceThicknessTextureInfo();a.iridescenceThicknessTexture=e.createTextureInfoDef(c,f)}}}),this}}pc.EXTENSION_NAME=It;const{R:Gi,G:Vi,B:ki,A:zi}=Be;class lc extends pe{init(){this.extensionName=yo,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new re(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new re(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:Gi|Vi|ki|zi,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:Gi|Vi|ki|zi})}}lc.EXTENSION_NAME=yo;const xt=yo;class Ro extends ce{constructor(...e){super(...e),this.extensionName=xt,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createPBRSpecularGlossiness(){return new lc(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,s=t.json.materials||[],n=t.json.textures||[];return s.forEach((o,i)=>{if(o.extensions&&o.extensions[xt]){const a=this.createPBRSpecularGlossiness();e.materials[i].setExtension(xt,a);const c=o.extensions[xt];if(c.diffuseFactor!==void 0&&a.setDiffuseFactor(c.diffuseFactor),c.specularFactor!==void 0&&a.setSpecularFactor(c.specularFactor),c.glossinessFactor!==void 0&&a.setGlossinessFactor(c.glossinessFactor),c.diffuseTexture!==void 0){const f=c.diffuseTexture,u=e.textures[n[f.index].source];a.setDiffuseTexture(u),e.setTextureInfo(a.getDiffuseTextureInfo(),f)}if(c.specularGlossinessTexture!==void 0){const f=c.specularGlossinessTexture,u=e.textures[n[f.index].source];a.setSpecularGlossinessTexture(u),e.setTextureInfo(a.getSpecularGlossinessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const n=s.getExtension(xt);if(n){const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{};const a=i.extensions[xt]={diffuseFactor:n.getDiffuseFactor(),specularFactor:n.getSpecularFactor(),glossinessFactor:n.getGlossinessFactor()};if(n.getDiffuseTexture()){const c=n.getDiffuseTexture(),f=n.getDiffuseTextureInfo();a.diffuseTexture=e.createTextureInfoDef(c,f)}if(n.getSpecularGlossinessTexture()){const c=n.getSpecularGlossinessTexture(),f=n.getSpecularGlossinessTextureInfo();a.specularGlossinessTexture=e.createTextureInfoDef(c,f)}}}),this}}Ro.EXTENSION_NAME=xt;const{R:vp,G:wp,B:Op,A:Cp}=Be;class fc extends pe{init(){this.extensionName=go,this.propertyType="Sheen",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new re(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new re(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:vp|wp|Op,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Cp})}}fc.EXTENSION_NAME=go;const Rt=go;class _c extends ce{constructor(...e){super(...e),this.extensionName=Rt,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createSheen(){return new fc(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,s=t.json.materials||[],n=t.json.textures||[];return s.forEach((o,i)=>{if(o.extensions&&o.extensions[Rt]){const a=this.createSheen();e.materials[i].setExtension(Rt,a);const c=o.extensions[Rt];if(c.sheenColorFactor!==void 0&&a.setSheenColorFactor(c.sheenColorFactor),c.sheenRoughnessFactor!==void 0&&a.setSheenRoughnessFactor(c.sheenRoughnessFactor),c.sheenColorTexture!==void 0){const f=c.sheenColorTexture,u=e.textures[n[f.index].source];a.setSheenColorTexture(u),e.setTextureInfo(a.getSheenColorTextureInfo(),f)}if(c.sheenRoughnessTexture!==void 0){const f=c.sheenRoughnessTexture,u=e.textures[n[f.index].source];a.setSheenRoughnessTexture(u),e.setTextureInfo(a.getSheenRoughnessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const n=s.getExtension(Rt);if(n){const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{};const a=i.extensions[Rt]={sheenColorFactor:n.getSheenColorFactor(),sheenRoughnessFactor:n.getSheenRoughnessFactor()};if(n.getSheenColorTexture()){const c=n.getSheenColorTexture(),f=n.getSheenColorTextureInfo();a.sheenColorTexture=e.createTextureInfoDef(c,f)}if(n.getSheenRoughnessTexture()){const c=n.getSheenRoughnessTexture(),f=n.getSheenRoughnessTextureInfo();a.sheenRoughnessTexture=e.createTextureInfoDef(c,f)}}}),this}}_c.EXTENSION_NAME=Rt;const{R:Dp,G:jp,B:Pp,A:Fp}=Be;class dc extends pe{init(){this.extensionName=mo,this.propertyType="Specular",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new re(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new re(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:Fp})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Dp|jp|Pp,isColor:!0})}}dc.EXTENSION_NAME=mo;const St=mo;class So extends ce{constructor(...e){super(...e),this.extensionName=St,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createSpecular(){return new dc(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,s=t.json.materials||[],n=t.json.textures||[];return s.forEach((o,i)=>{if(o.extensions&&o.extensions[St]){const a=this.createSpecular();e.materials[i].setExtension(St,a);const c=o.extensions[St];if(c.specularFactor!==void 0&&a.setSpecularFactor(c.specularFactor),c.specularColorFactor!==void 0&&a.setSpecularColorFactor(c.specularColorFactor),c.specularTexture!==void 0){const f=c.specularTexture,u=e.textures[n[f.index].source];a.setSpecularTexture(u),e.setTextureInfo(a.getSpecularTextureInfo(),f)}if(c.specularColorTexture!==void 0){const f=c.specularColorTexture,u=e.textures[n[f.index].source];a.setSpecularColorTexture(u),e.setTextureInfo(a.getSpecularColorTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const n=s.getExtension(St);if(n){const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{};const a=i.extensions[St]={};if(n.getSpecularFactor()!==1&&(a.specularFactor=n.getSpecularFactor()),Q.eq(n.getSpecularColorFactor(),[1,1,1])||(a.specularColorFactor=n.getSpecularColorFactor()),n.getSpecularTexture()){const c=n.getSpecularTexture(),f=n.getSpecularTextureInfo();a.specularTexture=e.createTextureInfoDef(c,f)}if(n.getSpecularColorTexture()){const c=n.getSpecularColorTexture(),f=n.getSpecularColorTextureInfo();a.specularColorTexture=e.createTextureInfoDef(c,f)}}}),this}}So.EXTENSION_NAME=St;const{R:Lp}=Be;class hc extends pe{init(){this.extensionName=To,this.propertyType="Transmission",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new re(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:Lp})}}hc.EXTENSION_NAME=To;const Mt=To;class yc extends ce{constructor(...e){super(...e),this.extensionName=Mt,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createTransmission(){return new hc(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,s=t.json.materials||[],n=t.json.textures||[];return s.forEach((o,i)=>{if(o.extensions&&o.extensions[Mt]){const a=this.createTransmission();e.materials[i].setExtension(Mt,a);const c=o.extensions[Mt];if(c.transmissionFactor!==void 0&&a.setTransmissionFactor(c.transmissionFactor),c.transmissionTexture!==void 0){const f=c.transmissionTexture,u=e.textures[n[f.index].source];a.setTransmissionTexture(u),e.setTextureInfo(a.getTransmissionTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const n=s.getExtension(Mt);if(n){const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{};const a=i.extensions[Mt]={transmissionFactor:n.getTransmissionFactor()};if(n.getTransmissionTexture()){const c=n.getTransmissionTexture(),f=n.getTransmissionTextureInfo();a.transmissionTexture=e.createTextureInfoDef(c,f)}}}),this}}yc.EXTENSION_NAME=Mt;class gc extends pe{init(){this.extensionName=bo,this.propertyType="Unlit",this.parentTypes=[C.MATERIAL]}}gc.EXTENSION_NAME=bo;const Ut=bo;class mc extends ce{constructor(...e){super(...e),this.extensionName=Ut,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createUnlit(){return new gc(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((s,n)=>{s.extensions&&s.extensions[Ut]&&e.materials[n].setExtension(Ut,this.createUnlit())}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{if(s.getExtension(Ut)){const n=e.materialIndexMap.get(s),o=t.json.materials[n];o.extensions=o.extensions||{},o.extensions[Ut]={}}}),this}}mc.EXTENSION_NAME=Ut;class Tc extends pe{init(){this.extensionName=Ft,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:new ie})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}Tc.EXTENSION_NAME=Ft;class bc extends pe{init(){this.extensionName=Ft,this.propertyType="MappingList",this.parentTypes=[C.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:new ie})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}bc.EXTENSION_NAME=Ft;class Js extends pe{init(){this.extensionName=Ft,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Js.EXTENSION_NAME=Ft;const qe=Ft;class Ec extends ce{constructor(...e){super(...e),this.extensionName=qe}createMappingList(){return new bc(this.document.getGraph())}createVariant(e=""){return new Js(this.document.getGraph(),e)}createMapping(){return new Tc(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Js)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[qe])return this;const o=(t.json.extensions[qe].variants||[]).map(a=>this.createVariant().setName(a.name||""));return(t.json.meshes||[]).forEach((a,c)=>{const f=e.meshes[c];(a.primitives||[]).forEach((l,_)=>{if(!l.extensions||!l.extensions[qe])return;const g=this.createMappingList(),b=l.extensions[qe];for(const I of b.mappings){const A=this.createMapping();I.material!==void 0&&A.setMaterial(e.materials[I.material]);for(const T of I.variants||[])A.addVariant(o[T]);g.addMapping(A)}f.listPrimitives()[_].setExtension(qe,g)})}),this}write(e){const t=e.jsonDoc,s=this.listVariants();if(!s.length)return this;const n=[],o=new Map;for(const i of s)o.set(i,n.length),n.push(e.createPropertyDef(i));for(const i of this.document.getRoot().listMeshes()){const a=e.meshIndexMap.get(i);i.listPrimitives().forEach((c,f)=>{const u=c.getExtension(qe);if(!u)return;const l=e.jsonDoc.json.meshes[a].primitives[f],_=u.listMappings().map(g=>{const b=e.createPropertyDef(g),I=g.getMaterial();return I&&(b.material=e.materialIndexMap.get(I)),b.variants=g.listVariants().map(A=>o.get(A)),b});l.extensions=l.extensions||{},l.extensions[qe]={mappings:_}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[qe]={variants:n},this}}Ec.EXTENSION_NAME=qe;const{G:Up}=Be;class Ac extends pe{init(){this.extensionName=Eo,this.propertyType="Volume",this.parentTypes=[C.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new re(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Up})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}}Ac.EXTENSION_NAME=Eo;const Nt=Eo;class Ic extends ce{constructor(...e){super(...e),this.extensionName=Nt,this.prereadTypes=[C.MESH],this.prewriteTypes=[C.MESH]}createVolume(){return new Ac(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,s=t.json.materials||[],n=t.json.textures||[];return s.forEach((o,i)=>{if(o.extensions&&o.extensions[Nt]){const a=this.createVolume();e.materials[i].setExtension(Nt,a);const c=o.extensions[Nt];if(c.thicknessFactor!==void 0&&a.setThicknessFactor(c.thicknessFactor),c.attenuationDistance!==void 0&&a.setAttenuationDistance(c.attenuationDistance),c.attenuationColor!==void 0&&a.setAttenuationColor(c.attenuationColor),c.thicknessTexture!==void 0){const f=c.thicknessTexture,u=e.textures[n[f.index].source];a.setThicknessTexture(u),e.setTextureInfo(a.getThicknessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const n=s.getExtension(Nt);if(n){const o=e.materialIndexMap.get(s),i=t.json.materials[o];i.extensions=i.extensions||{};const a=i.extensions[Nt]={};if(n.getThicknessFactor()>0&&(a.thicknessFactor=n.getThicknessFactor()),Number.isFinite(n.getAttenuationDistance())&&(a.attenuationDistance=n.getAttenuationDistance()),Q.eq(n.getAttenuationColor(),[1,1,1])||(a.attenuationColor=n.getAttenuationColor()),n.getThicknessTexture()){const c=n.getThicknessTexture(),f=n.getThicknessTextureInfo();a.thicknessTexture=e.createTextureInfoDef(c,f)}}}),this}}Ic.EXTENSION_NAME=Nt;const xc=Qu;class Rc extends ce{constructor(...e){super(...e),this.extensionName=xc}read(e){return this}write(e){return this}}Rc.EXTENSION_NAME=xc;const Hn=Ju;class Bp{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=Ms(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const s=Ms(e).dataFormatDescriptor[0];if(s.colorModel===Vu)return s.samples.length===2&&(s.samples[1].channelType&15)===15?4:3;if(s.colorModel===ku)return(s.samples[0].channelType&15)===3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${s.colorModel}".`)}getVRAMByteLength(e){const t=Ms(e),s=this.getChannels(e)>3;let n=0;for(let o=0;o<t.levels.length;o++){const i=t.levels[o];if(i.uncompressedByteLength)n+=i.uncompressedByteLength;else{const a=Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,o))),c=Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,o))),f=s?16:8;n+=a/4*(c/4)*f}}return n}}class Mo extends ce{constructor(...e){super(...e),this.extensionName=Hn,this.prereadTypes=[C.TEXTURE]}static register(){Ce.registerFormat("image/ktx2",new Bp)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{if(t.extensions&&t.extensions[Hn]){const s=t.extensions[Hn];t.source=s.source}}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/ktx2"){const n=e.imageIndexMap.get(s);t.json.textures.forEach(o=>{o.source===n&&(o.extensions=o.extensions||{},o.extensions[Hn]={source:o.source},delete o.source)})}}),this}}Mo.EXTENSION_NAME=Hn;class Sc extends pe{init(){this.extensionName=Ao,this.propertyType="Transform",this.parentTypes=[C.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}Sc.EXTENSION_NAME=Ao;const vt=Ao;class Mc extends ce{constructor(...e){super(...e),this.extensionName=vt}createTransform(){return new Sc(this.document.getGraph())}read(e){for(const[t,s]of Array.from(e.textureInfos.entries())){if(!s.extensions||!s.extensions[vt])continue;const n=this.createTransform(),o=s.extensions[vt];o.offset!==void 0&&n.setOffset(o.offset),o.rotation!==void 0&&n.setRotation(o.rotation),o.scale!==void 0&&n.setScale(o.scale),o.texCoord!==void 0&&n.setTexCoord(o.texCoord),t.setExtension(vt,n)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[s,n]of t){const o=s.getExtension(vt);if(!o)continue;n.extensions=n.extensions||{};const i={},a=Q.eq;a(o.getOffset(),[0,0])||(i.offset=o.getOffset()),o.getRotation()!==0&&(i.rotation=o.getRotation()),a(o.getScale(),[1,1])||(i.scale=o.getScale()),o.getTexCoord()!=null&&(i.texCoord=o.getTexCoord()),n.extensions[vt]=i}return this}}Mc.EXTENSION_NAME=vt;const Gp=[C.ROOT,C.SCENE,C.NODE,C.MESH,C.MATERIAL,C.TEXTURE,C.ANIMATION];class Nc extends pe{init(){this.extensionName=gs,this.propertyType="Packet",this.parentTypes=Gp}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",Je({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const s=Je({},this.get("properties"));return t?s[e]=t:delete s[e],this.set("properties",s)}toJSONLD(){const e=Ns(this.get("context")),t=Ns(this.get("properties"));return Je({"@context":e},t)}fromJSONLD(e){e=Ns(e);const t=e["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${gs}: Missing context for term, "${e}".`)}}Nc.EXTENSION_NAME=gs;function Ns(r){return JSON.parse(JSON.stringify(r))}const Qe=gs;class vc extends ce{constructor(...e){super(...e),this.extensionName=Qe}createPacket(){return new Nc(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const s=(t=e.jsonDoc.json.extensions)==null?void 0:t[Qe];if(!s||!s.packets)return this;const n=e.jsonDoc.json,o=this.document.getRoot(),i=s.packets.map(f=>this.createPacket().fromJSONLD(f)),a=[[n.asset],n.scenes,n.nodes,n.meshes,n.materials,n.images,n.animations],c=[[o],o.listScenes(),o.listNodes(),o.listMeshes(),o.listMaterials(),o.listTextures(),o.listAnimations()];for(let f=0;f<a.length;f++){const u=a[f]||[];for(let l=0;l<u.length;l++){const _=u[l];if(_.extensions&&_.extensions[Qe]){const g=_.extensions[Qe];c[f][l].setExtension(Qe,i[g.packet])}}}return this}write(e){const{json:t}=e.jsonDoc,s=[];for(const n of this.properties){s.push(n.toJSONLD());for(const o of n.listParents()){let i;switch(o.propertyType){case C.ROOT:i=t.asset;break;case C.SCENE:i=t.scenes[e.sceneIndexMap.get(o)];break;case C.NODE:i=t.nodes[e.nodeIndexMap.get(o)];break;case C.MESH:i=t.meshes[e.meshIndexMap.get(o)];break;case C.MATERIAL:i=t.materials[e.materialIndexMap.get(o)];break;case C.TEXTURE:i=t.images[e.imageIndexMap.get(o)];break;case C.ANIMATION:i=t.animations[e.animationIndexMap.get(o)];break;default:i=null,this.document.getLogger().warn(`[${Qe}]: Unsupported parent property, "${o.propertyType}"`);break}i&&(i.extensions=i.extensions||{},i.extensions[Qe]={packet:s.length-1})}}return s.length>0&&(t.extensions=t.extensions||{},t.extensions[Qe]={packets:s}),this}}vc.EXTENSION_NAME=Qe;const wc=[kt,Qa,Za,tc,nc,oc,ac,xo,pc,Ro,So,_c,yc,mc,Ec,Ic,Rc,Mo,Mc,vc];[...wc];var ms=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Oc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Vp(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var n=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:function(){return r[s]}})}),t}var vs,$i;function kp(){if($i)return vs;$i=1;function r(e){for(var t=new Array(e),s=0;s<e;++s)t[s]=s;return t}return vs=r,vs}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var ws,Hi;function zp(){if(Hi)return ws;Hi=1,ws=function(t){return t!=null&&(r(t)||e(t)||!!t._isBuffer)};function r(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function e(t){return typeof t.readFloatLE=="function"&&typeof t.slice=="function"&&r(t.slice(0,0))}return ws}var Os,qi;function $p(){if(qi)return Os;qi=1;var r=kp(),e=zp(),t=typeof Float64Array<"u";function s(f,u){return f[0]-u[0]}function n(){var f=this.stride,u=new Array(f.length),l;for(l=0;l<u.length;++l)u[l]=[Math.abs(f[l]),l];u.sort(s);var _=new Array(u.length);for(l=0;l<_.length;++l)_[l]=u[l][1];return _}function o(f,u){var l=["View",u,"d",f].join("");u<0&&(l="View_Nil"+f);var _=f==="generic";if(u===-1){var g="function "+l+"(a){this.data=a;};	var proto="+l+".prototype;	proto.dtype='"+f+"';	proto.index=function(){return -1};	proto.size=0;	proto.dimension=-1;	proto.shape=proto.stride=proto.order=[];	proto.lo=proto.hi=proto.transpose=proto.step=	function(){return new "+l+"(this.data);};	proto.get=proto.set=function(){};	proto.pick=function(){return null};	return function construct_"+l+"(a){return new "+l+"(a);}",N=new Function(g);return N()}else if(u===0){var g="function "+l+"(a,d) {	this.data = a;	this.offset = d	};	var proto="+l+".prototype;	proto.dtype='"+f+"';	proto.index=function(){return this.offset};	proto.dimension=0;	proto.size=1;	proto.shape=	proto.stride=	proto.order=[];	proto.lo=	proto.hi=	proto.transpose=	proto.step=function "+l+"_copy() {	return new "+l+"(this.data,this.offset)	};	proto.pick=function "+l+"_pick(){	return TrivialArray(this.data);	};	proto.valueOf=proto.get=function "+l+"_get(){	return "+(_?"this.data.get(this.offset)":"this.data[this.offset]")+"};	proto.set=function "+l+"_set(v){	return "+(_?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"	};	return function construct_"+l+"(a,b,c,d){return new "+l+"(a,d)}",N=new Function("TrivialArray",g);return N(a[f][0])}var g=["'use strict'"],b=r(u),I=b.map(function(w){return"i"+w}),A="this.offset+"+b.map(function(w){return"this.stride["+w+"]*i"+w}).join("+"),T=b.map(function(w){return"b"+w}).join(","),j=b.map(function(w){return"c"+w}).join(",");g.push("function "+l+"(a,"+T+","+j+",d){this.data=a","this.shape=["+T+"]","this.stride=["+j+"]","this.offset=d|0}","var proto="+l+".prototype","proto.dtype='"+f+"'","proto.dimension="+u),g.push("Object.defineProperty(proto,'size',{get:function "+l+"_size(){	return "+b.map(function(w){return"this.shape["+w+"]"}).join("*"),"}})"),u===1?g.push("proto.order=[0]"):(g.push("Object.defineProperty(proto,'order',{get:"),u<4?(g.push("function "+l+"_order(){"),u===2?g.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):u===3&&g.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);	if(s0>s1){	if(s1>s2){	return [2,1,0];	}else if(s0>s2){	return [1,2,0];	}else{	return [1,0,2];	}	}else if(s0>s2){	return [2,0,1];	}else if(s2>s1){	return [0,1,2];	}else{	return [0,2,1];	}}})")):g.push("ORDER})")),g.push("proto.set=function "+l+"_set("+I.join(",")+",v){"),_?g.push("return this.data.set("+A+",v)}"):g.push("return this.data["+A+"]=v}"),g.push("proto.get=function "+l+"_get("+I.join(",")+"){"),_?g.push("return this.data.get("+A+")}"):g.push("return this.data["+A+"]}"),g.push("proto.index=function "+l+"_index(",I.join(),"){return "+A+"}"),g.push("proto.hi=function "+l+"_hi("+I.join(",")+"){return new "+l+"(this.data,"+b.map(function(w){return["(typeof i",w,"!=='number'||i",w,"<0)?this.shape[",w,"]:i",w,"|0"].join("")}).join(",")+","+b.map(function(w){return"this.stride["+w+"]"}).join(",")+",this.offset)}");var S=b.map(function(w){return"a"+w+"=this.shape["+w+"]"}),D=b.map(function(w){return"c"+w+"=this.stride["+w+"]"});g.push("proto.lo=function "+l+"_lo("+I.join(",")+"){var b=this.offset,d=0,"+S.join(",")+","+D.join(","));for(var M=0;M<u;++M)g.push("if(typeof i"+M+"==='number'&&i"+M+">=0){	d=i"+M+"|0;	b+=c"+M+"*d;	a"+M+"-=d}");g.push("return new "+l+"(this.data,"+b.map(function(w){return"a"+w}).join(",")+","+b.map(function(w){return"c"+w}).join(",")+",b)}"),g.push("proto.step=function "+l+"_step("+I.join(",")+"){var "+b.map(function(w){return"a"+w+"=this.shape["+w+"]"}).join(",")+","+b.map(function(w){return"b"+w+"=this.stride["+w+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var M=0;M<u;++M)g.push("if(typeof i"+M+"==='number'){	d=i"+M+"|0;	if(d<0){	c+=b"+M+"*(a"+M+"-1);	a"+M+"=ceil(-a"+M+"/d)	}else{	a"+M+"=ceil(a"+M+"/d)	}	b"+M+"*=d	}");g.push("return new "+l+"(this.data,"+b.map(function(w){return"a"+w}).join(",")+","+b.map(function(w){return"b"+w}).join(",")+",c)}");for(var P=new Array(u),x=new Array(u),M=0;M<u;++M)P[M]="a[i"+M+"]",x[M]="b[i"+M+"]";g.push("proto.transpose=function "+l+"_transpose("+I+"){"+I.map(function(w,F){return w+"=("+w+"===undefined?"+F+":"+w+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+l+"(this.data,"+P.join(",")+","+x.join(",")+",this.offset)}"),g.push("proto.pick=function "+l+"_pick("+I+"){var a=[],b=[],c=this.offset");for(var M=0;M<u;++M)g.push("if(typeof i"+M+"==='number'&&i"+M+">=0){c=(c+this.stride["+M+"]*i"+M+")|0}else{a.push(this.shape["+M+"]);b.push(this.stride["+M+"])}");g.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),g.push("return function construct_"+l+"(data,shape,stride,offset){return new "+l+"(data,"+b.map(function(w){return"shape["+w+"]"}).join(",")+","+b.map(function(w){return"stride["+w+"]"}).join(",")+",offset)}");var N=new Function("CTOR_LIST","ORDER",g.join(`
`));return N(a[f],n)}function i(f){if(e(f))return"buffer";if(t)switch(Object.prototype.toString.call(f)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(f)?"array":"generic"}var a={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function c(f,u,l,_){if(f===void 0){var j=a.array[0];return j([])}else typeof f=="number"&&(f=[f]);u===void 0&&(u=[f.length]);var g=u.length;if(l===void 0){l=new Array(g);for(var b=g-1,I=1;b>=0;--b)l[b]=I,I*=u[b]}if(_===void 0){_=0;for(var b=0;b<g;++b)l[b]<0&&(_-=(u[b]-1)*l[b])}for(var A=i(f),T=a[A];T.length<=g+1;)T.push(o(A,T.length-1));var j=T[g+1];return j(f,u,l,_)}return Os=c,Os}var Hp=$p();const Ie=Oc(Hp);var Cs={},Ds,Wi;function qp(){if(Wi)return Ds;Wi=1;function r(s,n){for(var o=1,i=s.length,a=s[0],c=s[0],f=1;f<i;++f)if(c=a,a=s[f],n(a,c)){if(f===o){o++;continue}s[o++]=a}return s.length=o,s}function e(s){for(var n=1,o=s.length,i=s[0],a=s[0],c=1;c<o;++c,a=i)if(a=i,i=s[c],i!==a){if(c===n){n++;continue}s[n++]=i}return s.length=n,s}function t(s,n,o){return s.length===0?s:n?(o||s.sort(n),r(s,n)):(o||s.sort(),e(s))}return Ds=t,Ds}var js,Ki;function Wp(){if(Ki)return js;Ki=1;var r=qp();function e(a,c,f){var u=a.length,l=c.arrayArgs.length,_=c.indexArgs.length>0,g=[],b=[],I=0,A=0,T,j;for(T=0;T<u;++T)b.push(["i",T,"=0"].join(""));for(j=0;j<l;++j)for(T=0;T<u;++T)A=I,I=a[T],T===0?b.push(["d",j,"s",T,"=t",j,"p",I].join("")):b.push(["d",j,"s",T,"=(t",j,"p",I,"-s",A,"*t",j,"p",A,")"].join(""));for(b.length>0&&g.push("var "+b.join(",")),T=u-1;T>=0;--T)I=a[T],g.push(["for(i",T,"=0;i",T,"<s",I,";++i",T,"){"].join(""));for(g.push(f),T=0;T<u;++T){for(A=I,I=a[T],j=0;j<l;++j)g.push(["p",j,"+=d",j,"s",T].join(""));_&&(T>0&&g.push(["index[",A,"]-=s",A].join("")),g.push(["++index[",I,"]"].join(""))),g.push("}")}return g.join(`
`)}function t(a,c,f,u){for(var l=c.length,_=f.arrayArgs.length,g=f.blockSize,b=f.indexArgs.length>0,I=[],A=0;A<_;++A)I.push(["var offset",A,"=p",A].join(""));for(var A=a;A<l;++A)I.push(["for(var j"+A+"=SS[",c[A],"]|0;j",A,">0;){"].join("")),I.push(["if(j",A,"<",g,"){"].join("")),I.push(["s",c[A],"=j",A].join("")),I.push(["j",A,"=0"].join("")),I.push(["}else{s",c[A],"=",g].join("")),I.push(["j",A,"-=",g,"}"].join("")),b&&I.push(["index[",c[A],"]=j",A].join(""));for(var A=0;A<_;++A){for(var T=["offset"+A],j=a;j<l;++j)T.push(["j",j,"*t",A,"p",c[j]].join(""));I.push(["p",A,"=(",T.join("+"),")"].join(""))}I.push(e(c,f,u));for(var A=a;A<l;++A)I.push("}");return I.join(`
`)}function s(a){for(var c=0,f=a[0].length;c<f;){for(var u=1;u<a.length;++u)if(a[u][c]!==a[0][c])return c;++c}return c}function n(a,c,f){for(var u=a.body,l=[],_=[],g=0;g<a.args.length;++g){var b=a.args[g];if(!(b.count<=0)){var I=new RegExp(b.name,"g"),A="",T=c.arrayArgs.indexOf(g);switch(c.argTypes[g]){case"offset":var j=c.offsetArgIndex.indexOf(g),S=c.offsetArgs[j];T=S.array,A="+q"+j;case"array":A="p"+T+A;var D="l"+g,M="a"+T;if(c.arrayBlockIndices[T]===0)b.count===1?f[T]==="generic"?b.lvalue?(l.push(["var ",D,"=",M,".get(",A,")"].join("")),u=u.replace(I,D),_.push([M,".set(",A,",",D,")"].join(""))):u=u.replace(I,[M,".get(",A,")"].join("")):u=u.replace(I,[M,"[",A,"]"].join("")):f[T]==="generic"?(l.push(["var ",D,"=",M,".get(",A,")"].join("")),u=u.replace(I,D),b.lvalue&&_.push([M,".set(",A,",",D,")"].join(""))):(l.push(["var ",D,"=",M,"[",A,"]"].join("")),u=u.replace(I,D),b.lvalue&&_.push([M,"[",A,"]=",D].join("")));else{for(var P=[b.name],x=[A],N=0;N<Math.abs(c.arrayBlockIndices[T]);N++)P.push("\\s*\\[([^\\]]+)\\]"),x.push("$"+(N+1)+"*t"+T+"b"+N);if(I=new RegExp(P.join(""),"g"),A=x.join("+"),f[T]==="generic")throw new Error("cwise: Generic arrays not supported in combination with blocks!");u=u.replace(I,[M,"[",A,"]"].join(""))}break;case"scalar":u=u.replace(I,"Y"+c.scalarArgs.indexOf(g));break;case"index":u=u.replace(I,"index");break;case"shape":u=u.replace(I,"shape");break}}}return[l.join(`
`),u,_.join(`
`)].join(`
`).trim()}function o(a){for(var c=new Array(a.length),f=!0,u=0;u<a.length;++u){var l=a[u],_=l.match(/\d+/);_?_=_[0]:_="",l.charAt(0)===0?c[u]="u"+l.charAt(1)+_:c[u]=l.charAt(0)+_,u>0&&(f=f&&c[u]===c[u-1])}return f?c[0]:c.join("")}function i(a,c){for(var f=c[1].length-Math.abs(a.arrayBlockIndices[0])|0,u=new Array(a.arrayArgs.length),l=new Array(a.arrayArgs.length),_=0;_<a.arrayArgs.length;++_)l[_]=c[2*_],u[_]=c[2*_+1];for(var g=[],b=[],I=[],A=[],T=[],_=0;_<a.arrayArgs.length;++_){a.arrayBlockIndices[_]<0?(I.push(0),A.push(f),g.push(f),b.push(f+a.arrayBlockIndices[_])):(I.push(a.arrayBlockIndices[_]),A.push(a.arrayBlockIndices[_]+f),g.push(0),b.push(a.arrayBlockIndices[_]));for(var j=[],S=0;S<u[_].length;S++)I[_]<=u[_][S]&&u[_][S]<A[_]&&j.push(u[_][S]-I[_]);T.push(j)}for(var D=["SS"],M=["'use strict'"],P=[],S=0;S<f;++S)P.push(["s",S,"=SS[",S,"]"].join(""));for(var _=0;_<a.arrayArgs.length;++_){D.push("a"+_),D.push("t"+_),D.push("p"+_);for(var S=0;S<f;++S)P.push(["t",_,"p",S,"=t",_,"[",I[_]+S,"]"].join(""));for(var S=0;S<Math.abs(a.arrayBlockIndices[_]);++S)P.push(["t",_,"b",S,"=t",_,"[",g[_]+S,"]"].join(""))}for(var _=0;_<a.scalarArgs.length;++_)D.push("Y"+_);if(a.shapeArgs.length>0&&P.push("shape=SS.slice(0)"),a.indexArgs.length>0){for(var x=new Array(f),_=0;_<f;++_)x[_]="0";P.push(["index=[",x.join(","),"]"].join(""))}for(var _=0;_<a.offsetArgs.length;++_){for(var N=a.offsetArgs[_],w=[],S=0;S<N.offset.length;++S)N.offset[S]!==0&&(N.offset[S]===1?w.push(["t",N.array,"p",S].join("")):w.push([N.offset[S],"*t",N.array,"p",S].join("")));w.length===0?P.push("q"+_+"=0"):P.push(["q",_,"=",w.join("+")].join(""))}var F=r([].concat(a.pre.thisVars).concat(a.body.thisVars).concat(a.post.thisVars));P=P.concat(F),P.length>0&&M.push("var "+P.join(","));for(var _=0;_<a.arrayArgs.length;++_)M.push("p"+_+"|=0");a.pre.body.length>3&&M.push(n(a.pre,a,l));var k=n(a.body,a,l),L=s(T);L<f?M.push(t(L,T[0],a,k)):M.push(e(T[0],a,k)),a.post.body.length>3&&M.push(n(a.post,a,l)),a.debug&&console.log("-----Generated cwise routine for ",c,`:
`+M.join(`
`)+`
----------`);var B=[a.funcName||"unnamed","_cwise_loop_",u[0].join("s"),"m",L,o(l)].join(""),U=new Function(["function ",B,"(",D.join(","),"){",M.join(`
`),"} return ",B].join(""));return U()}return js=i,js}var Ps,Xi;function Kp(){if(Xi)return Ps;Xi=1;var r=Wp();function e(t){var s=["'use strict'","var CACHED={}"],n=[],o=t.funcName+"_cwise_thunk";s.push(["return function ",o,"(",t.shimArgs.join(","),"){"].join(""));for(var i=[],a=[],c=[["array",t.arrayArgs[0],".shape.slice(",Math.max(0,t.arrayBlockIndices[0]),t.arrayBlockIndices[0]<0?","+t.arrayBlockIndices[0]+")":")"].join("")],f=[],u=[],l=0;l<t.arrayArgs.length;++l){var _=t.arrayArgs[l];n.push(["t",_,"=array",_,".dtype,","r",_,"=array",_,".order"].join("")),i.push("t"+_),i.push("r"+_),a.push("t"+_),a.push("r"+_+".join()"),c.push("array"+_+".data"),c.push("array"+_+".stride"),c.push("array"+_+".offset|0"),l>0&&(f.push("array"+t.arrayArgs[0]+".shape.length===array"+_+".shape.length+"+(Math.abs(t.arrayBlockIndices[0])-Math.abs(t.arrayBlockIndices[l]))),u.push("array"+t.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[0])+"]===array"+_+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[l])+"]"))}t.arrayArgs.length>1&&(s.push("if (!("+f.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),s.push("for(var shapeIndex=array"+t.arrayArgs[0]+".shape.length-"+Math.abs(t.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),s.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),s.push("}"));for(var l=0;l<t.scalarArgs.length;++l)c.push("scalar"+t.scalarArgs[l]);n.push(["type=[",a.join(","),"].join()"].join("")),n.push("proc=CACHED[type]"),s.push("var "+n.join(",")),s.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",c.join(","),")}"].join("")),t.debug&&console.log(`-----Generated thunk:
`+s.join(`
`)+`
----------`);var g=new Function("compile",s.join(`
`));return g(r.bind(void 0,t))}return Ps=e,Ps}var Fs,Yi;function Xp(){if(Yi)return Fs;Yi=1;var r=Kp();function e(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function t(s){var n=new e;n.pre=s.pre,n.body=s.body,n.post=s.post;var o=s.args.slice(0);n.argTypes=o;for(var i=0;i<o.length;++i){var a=o[i];if(a==="array"||typeof a=="object"&&a.blockIndices){if(n.argTypes[i]="array",n.arrayArgs.push(i),n.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),n.shimArgs.push("array"+i),i<n.pre.args.length&&n.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array args");if(i<n.post.args.length&&n.post.args[i].count>0)throw new Error("cwise: post() block may not reference array args")}else if(a==="scalar")n.scalarArgs.push(i),n.shimArgs.push("scalar"+i);else if(a==="index"){if(n.indexArgs.push(i),i<n.pre.args.length&&n.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array index");if(i<n.body.args.length&&n.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array index");if(i<n.post.args.length&&n.post.args[i].count>0)throw new Error("cwise: post() block may not reference array index")}else if(a==="shape"){if(n.shapeArgs.push(i),i<n.pre.args.length&&n.pre.args[i].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(i<n.body.args.length&&n.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array shape");if(i<n.post.args.length&&n.post.args[i].lvalue)throw new Error("cwise: post() block may not write to array shape")}else if(typeof a=="object"&&a.offset)n.argTypes[i]="offset",n.offsetArgs.push({array:a.array,offset:a.offset}),n.offsetArgIndex.push(i);else throw new Error("cwise: Unknown argument type "+o[i])}if(n.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(n.pre.args.length>o.length)throw new Error("cwise: Too many arguments in pre() block");if(n.body.args.length>o.length)throw new Error("cwise: Too many arguments in body() block");if(n.post.args.length>o.length)throw new Error("cwise: Too many arguments in post() block");return n.debug=!!s.printCode||!!s.debug,n.funcName=s.funcName||"cwise",n.blockSize=s.blockSize||64,r(n)}return Fs=t,Fs}var Qi;function Yp(){return Qi||(Qi=1,function(r){var e=Xp(),t={body:"",args:[],thisVars:[],localVars:[]};function s(_){if(!_)return t;for(var g=0;g<_.args.length;++g){var b=_.args[g];g===0?_.args[g]={name:b,lvalue:!0,rvalue:!!_.rvalue,count:_.count||1}:_.args[g]={name:b,lvalue:!1,rvalue:!0,count:1}}return _.thisVars||(_.thisVars=[]),_.localVars||(_.localVars=[]),_}function n(_){return e({args:_.args,pre:s(_.pre),body:s(_.body),post:s(_.proc),funcName:_.funcName})}function o(_){for(var g=[],b=0;b<_.args.length;++b)g.push("a"+b);var I=new Function("P",["return function ",_.funcName,"_ndarrayops(",g.join(","),") {P(",g.join(","),");return a0}"].join(""));return I(n(_))}var i={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var _ in i){var g=i[_];r[_]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+g+"c"},funcName:_}),r[_+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a"+g+"=b"},funcName:_+"eq"}),r[_+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+g+"s"},funcName:_+"s"}),r[_+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a"+g+"=s"},funcName:_+"seq"})}})();var a={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var _ in a){var g=a[_];r[_]=o({args:["array","array"],body:{args:["a","b"],body:"a="+g+"b"},funcName:_}),r[_+"eq"]=o({args:["array"],body:{args:["a"],body:"a="+g+"a"},funcName:_+"eq"})}})();var c={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var _ in c){var g=c[_];r[_]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+g+"c"},funcName:_}),r[_+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+g+"s"},funcName:_+"s"}),r[_+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a=a"+g+"b"},funcName:_+"eq"}),r[_+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+g+"s"},funcName:_+"seq"})}})();var f=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var _=0;_<f.length;++_){var g=f[_];r[g]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+g,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:g}),r[g+"eq"]=o({args:["array"],pre:{args:[],body:"this_f=Math."+g,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},funcName:g+"eq"})}})();var u=["max","min","atan2","pow"];(function(){for(var _=0;_<u.length;++_){var g=u[_];r[g]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+g,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:g}),r[g+"s"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+g,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:g+"s"}),r[g+"eq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+g,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},funcName:g+"eq"}),r[g+"seq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+g,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},funcName:g+"seq"})}})();var l=["atan2","pow"];(function(){for(var _=0;_<l.length;++_){var g=l[_];r[g+"op"]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+g,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:g+"op"}),r[g+"ops"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+g,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:g+"ops"}),r[g+"opeq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+g,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},funcName:g+"opeq"}),r[g+"opseq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+g,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},funcName:g+"opseq"})}})(),r.any=e({args:["array"],pre:t,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),r.all=e({args:["array"],pre:t,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),r.sum=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),r.prod=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),r.norm2squared=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),r.norm2=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),r.norminf=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),r.norm1=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),r.sup=e({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),r.inf=e({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),r.argmin=e({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),r.argmax=e({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),r.random=o({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),r.assign=o({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),r.assigns=o({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),r.equals=e({args:["array","array"],pre:t,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}(Cs)),Cs}var Qp=Yp();const ht=Oc(Qp);function Jp(r,e){if(!(r instanceof Uint8Array))throw new Error("[ndarray-pixels] Input must be Uint8Array or Buffer.");const t=new Blob([r],{type:e}),s=URL.createObjectURL(t);return new Promise((n,o)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=function(){URL.revokeObjectURL(s);const c=new OffscreenCanvas(i.width,i.height).getContext("2d");c.drawImage(i,0,0);const f=c.getImageData(0,0,i.width,i.height);n(Ie(new Uint8Array(f.data),[i.width,i.height,4],[4,4*i.width,1],0))},i.onerror=a=>{URL.revokeObjectURL(s),o(a)},i.src=s})}function Cc(r,e,t=-1){if(r.shape.length===4)return Cc(r.pick(t),e,0);if(r.shape.length===3)if(r.shape[2]===3)ht.assign(Ie(e,[r.shape[0],r.shape[1],3],[4,4*r.shape[0],1]),r),ht.assigns(Ie(e,[r.shape[0]*r.shape[1]],[4],3),255);else if(r.shape[2]===4)ht.assign(Ie(e,[r.shape[0],r.shape[1],4],[4,r.shape[0]*4,1]),r);else if(r.shape[2]===1)ht.assign(Ie(e,[r.shape[0],r.shape[1],3],[4,4*r.shape[0],1]),Ie(r.data,[r.shape[0],r.shape[1],3],[r.stride[0],r.stride[1],0],r.offset)),ht.assigns(Ie(e,[r.shape[0]*r.shape[1]],[4],3),255);else throw new Error("[ndarray-pixels] Incompatible array shape.");else if(r.shape.length===2)ht.assign(Ie(e,[r.shape[0],r.shape[1],3],[4,4*r.shape[0],1]),Ie(r.data,[r.shape[0],r.shape[1],3],[r.stride[0],r.stride[1],0],r.offset)),ht.assigns(Ie(e,[r.shape[0]*r.shape[1]],[4],3),255);else throw new Error("[ndarray-pixels] Incompatible array shape.");return e}async function Zp(r,e){const t=new OffscreenCanvas(r.shape[0],r.shape[1]),s=t.getContext("2d"),n=s.getImageData(0,0,t.width,t.height);return Cc(r,n.data),s.putImageData(n,0,0),el(t,e)}async function el(r,e){const s=await(await r.convertToBlob(e)).arrayBuffer();return new Uint8Array(s)}async function No(r,e){return Jp(r,e)}async function zt(r,e){let t;return typeof e=="string"?t={type:e,quality:void 0}:t={type:e.type,quality:e.quality},Zp(r,t)}const tl=(r,e)=>{if(r<=-e||r>=e)return 0;if(r>-11920929e-14&&r<11920929e-14)return 1;const t=r*Math.PI;return Math.sin(t)/t*Math.sin(t/e)/(t/e)},Ji=(r,e,t,s,n,o,i,a)=>{const c=2**a-1,f=A=>Math.round(A*c),u=n?2:3,l=1/t,_=Math.min(1,t),g=u/_,b=new i((Math.floor(2*(g+1))+2)*e);let I=0;for(let A=0;A<e;A++){const T=(A+.5)*l+s,j=Math.max(0,Math.floor(T-g)),S=Math.min(r-1,Math.ceil(T+g)),D=S-j+1,M=new o(D),P=new i(D);let x=0,N=0;for(let B=j;B<=S;B++){const U=tl((B+.5-T)*_,u);x+=U,M[N]=U,N++}let w=0;for(let B=0;B<M.length;B++){const U=M[B]/x;w+=U,P[B]=f(U)}P[e>>1]+=f(1-w);let F=0;for(;F<P.length&&P[F]===0;)F++;let k=P.length-1;for(;k>0&&P[k]===0;)k--;const L=k-F+1;b[I++]=j+F,b[I++]=L,b.set(P.subarray(F,k+1),I),I+=L}return b},Zi=(r,e,t,s)=>{const[n,o]=r.shape,[i]=e.shape,a=2**(8*e.data.BYTES_PER_ELEMENT)-1,c=l=>l<0?0:l>a?a:l,f=2**(s-1),u=2*f;for(let l=0;l<o;l++){const _=l;let g=0;for(let b=0;b<i;b++){let I=t[g++],A=0,T=0,j=0,S=0;for(let D=t[g++];D>0;D--){const M=t[g++];A+=M*r.get(I,l,0),T+=M*r.get(I,l,1),j+=M*r.get(I,l,2),S+=M*r.get(I,l,3),I++}e.set(b,_,0,c((A+f)/u)),e.set(b,_,1,c((T+f)/u)),e.set(b,_,2,c((j+f)/u)),e.set(b,_,3,c((S+f)/u))}}};var qt;function Dc(r,e,t){if(r.shape.length!==3||e.shape.length!==3)throw new TypeError("Input and output must have exactly 3 dimensions (width, height and colorspace)");const[s,n]=r.shape,[o,i]=e.shape,a=o/s,c=i/n;let f,u;switch(e.dtype){case"uint8_clamped":case"uint8":f=Float32Array,u=Int16Array;break;case"uint16":case"uint32":f=Float64Array,u=Int32Array;break;default:throw TypeError(`Unsupported data type ${e.dtype}`)}const l=7*u.BYTES_PER_ELEMENT,_=Ji(s,o,a,0,t===qt.LANCZOS_2,f,u,l),g=Ji(n,i,c,0,t===qt.LANCZOS_2,f,u,l),b=Ie(new e.data.constructor(o*n*4),[n,o,4]),I=b.transpose(1,0),A=e.transpose(1,0);Zi(r,I,_,l),Zi(b,A,g,l)}function rl(r,e){Dc(r,e,qt.LANCZOS_3)}function nl(r,e){Dc(r,e,qt.LANCZOS_2)}(function(r){r[r.LANCZOS_3=3]="LANCZOS_3",r[r.LANCZOS_2=2]="LANCZOS_2"})(qt||(qt={}));function Wt(){return Wt=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},Wt.apply(null,arguments)}const{POINTS:ea,LINES:os,LINE_STRIP:sl,LINE_LOOP:ol,TRIANGLES:is,TRIANGLE_STRIP:il,TRIANGLE_FAN:al}=_e.Mode;function Ke(r,e){return Object.defineProperty(e,"name",{value:r}),e}function Xe(r,e){const t=Wt({},r);for(const s in e)e[s]!==void 0&&(t[s]=e[s]);return t}async function ta(r,e,t){if(!r)return null;const s=r.getImage();if(!s)return null;const n=await No(s,r.getMimeType());for(let i=0;i<n.shape[0];++i)for(let a=0;a<n.shape[1];++a)t(n,i,a);const o=await zt(n,"image/png");return e.setImage(o).setMimeType("image/png")}function jc(r){const e=r.getIndices(),t=r.getAttribute("POSITION");switch(r.getMode()){case _e.Mode.POINTS:return e?e.getCount():t.getCount();case _e.Mode.LINES:return e?e.getCount()/2:t.getCount()/2;case _e.Mode.LINE_LOOP:return e?e.getCount():t.getCount();case _e.Mode.LINE_STRIP:return e?e.getCount()-1:t.getCount()-1;case _e.Mode.TRIANGLES:return e?e.getCount()/3:t.getCount()/3;case _e.Mode.TRIANGLE_STRIP:case _e.Mode.TRIANGLE_FAN:return e?e.getCount()-2:t.getCount()-2;default:throw new Error("Unexpected mode: "+r.getMode())}}const cl=new Intl.NumberFormat(void 0,{maximumFractionDigits:0});function Zs(r){return cl.format(r)}function ul(r,e,t=2){return(r>e?"":"+")+(Math.abs(r-e)/r*100).toFixed(t)+"%"}function pl(r,e){return`${Zs(r)}  ${Zs(e)} (${ul(r,e)})`}function Pc(r){const e=[];for(const t of r.listAttributes())e.push(t);for(const t of r.listTargets())for(const s of t.listAttributes())e.push(s);return Array.from(new Set(e))}function ll(r,e){if(r==null&&e==null)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Kt(r,e){return r.createAccessor(e.getName()).setArray(e.getArray()).setType(e.getType()).setBuffer(e.getBuffer()).setNormalized(e.getNormalized()).setSparse(e.getSparse())}function fl(r,e=r){const t=vo(r,e);for(let s=0;s<t.length;s++)t[s]=s;return t}function vo(r,e=r){return e<=65534?new Uint16Array(r):new Uint32Array(r)}function _l(r){return r.listParents().some(e=>e.propertyType!==C.ROOT)}function Fc(r){for(const e in r)return!1;return!0}function Lc(r){const e=Ge.fromGraph(r.getGraph()),t=r.getMaterial(),s=e.getRoot().listMaterials().indexOf(t),n=hl[r.getMode()],o=!!r.getIndices(),i=r.listSemantics().sort().map(c=>{const f=r.getAttribute(c),u=f.getElementSize(),l=f.getComponentType();return`${c}:${u}:${l}`}).join("+"),a=r.listTargets().map(c=>c.listSemantics().sort().map(f=>{const u=r.getAttribute(f),l=u.getElementSize(),_=u.getComponentType();return`${f}:${l}:${_}`}).join("+")).join("~");return`${s}|${n}|${o}|${i}|${a}`}function Uc(r,e){const[t,s]=e,[n,o]=r;if(n<=t&&o<=s)return r;let i=n,a=o;return i>t&&(a=Math.floor(a*(t/i)),i=t),a>s&&(i=Math.floor(i*(s/a)),a=s),[i,a]}function Bc(r,e){if(ra(r[0])&&ra(r[1]))return r;switch(e){case"nearest-pot":return r.map(dl);case"ceil-pot":return r.map(wo);case"floor-pot":return r.map(Gc)}}function ra(r){return r<=2?!0:(r&r-1)===0&&r!==0}function dl(r){if(r<=4)return 4;const e=Gc(r),t=wo(r);return t-r>r-e?e:t}function Gc(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function wo(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}const hl={[ea]:ea,[os]:os,[sl]:os,[ol]:os,[is]:is,[il]:is,[al]:is};function yl(r){const e=new Set;let t=r,s;for(;s=t.getParentNode();){if(e.has(s))throw new Error("Circular dependency in scene graph.");e.add(s),t=s}return t.listParents().filter(n=>n instanceof Is)}function gl(r){const e=yl(r),t=r.getParentNode();if(!t)return r;r.setMatrix(r.getWorldMatrix()),t.removeChild(r);for(const s of e)s.addChild(r);return r}var Xt=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function ml(r,e){var t=e[0],s=e[1],n=e[2],o=e[3],i=e[4],a=e[5],c=e[6],f=e[7],u=e[8],l=e[9],_=e[10],g=e[11],b=e[12],I=e[13],A=e[14],T=e[15],j=t*a-s*i,S=t*c-n*i,D=t*f-o*i,M=s*c-n*a,P=s*f-o*a,x=n*f-o*c,N=u*I-l*b,w=u*A-_*b,F=u*T-g*b,k=l*A-_*I,L=l*T-g*I,B=_*T-g*A,U=j*B-S*L+D*k+M*F-P*w+x*N;return U?(U=1/U,r[0]=(a*B-c*L+f*k)*U,r[1]=(n*L-s*B-o*k)*U,r[2]=(I*x-A*P+T*M)*U,r[3]=(_*P-l*x-g*M)*U,r[4]=(c*F-i*B-f*w)*U,r[5]=(t*B-n*F+o*w)*U,r[6]=(A*D-b*x-T*S)*U,r[7]=(u*x-_*D+g*S)*U,r[8]=(i*L-a*F+f*N)*U,r[9]=(s*F-t*L-o*N)*U,r[10]=(b*P-I*D+T*j)*U,r[11]=(l*D-u*P-g*j)*U,r[12]=(a*w-i*k-c*N)*U,r[13]=(t*k-s*w+n*N)*U,r[14]=(I*S-b*M-A*j)*U,r[15]=(u*M-l*S+_*j)*U,r):null}function Tl(r){var e=r[0],t=r[1],s=r[2],n=r[3],o=r[4],i=r[5],a=r[6],c=r[7],f=r[8],u=r[9],l=r[10],_=r[11],g=r[12],b=r[13],I=r[14],A=r[15],T=e*i-t*o,j=e*a-s*o,S=e*c-n*o,D=t*a-s*i,M=t*c-n*i,P=s*c-n*a,x=f*b-u*g,N=f*I-l*g,w=f*A-_*g,F=u*I-l*b,k=u*A-_*b,L=l*A-_*I;return T*L-j*k+S*F+D*w-M*N+P*x}function bl(r,e,t){var s=e[0],n=e[1],o=e[2],i=e[3],a=e[4],c=e[5],f=e[6],u=e[7],l=e[8],_=e[9],g=e[10],b=e[11],I=e[12],A=e[13],T=e[14],j=e[15],S=t[0],D=t[1],M=t[2],P=t[3];return r[0]=S*s+D*a+M*l+P*I,r[1]=S*n+D*c+M*_+P*A,r[2]=S*o+D*f+M*g+P*T,r[3]=S*i+D*u+M*b+P*j,S=t[4],D=t[5],M=t[6],P=t[7],r[4]=S*s+D*a+M*l+P*I,r[5]=S*n+D*c+M*_+P*A,r[6]=S*o+D*f+M*g+P*T,r[7]=S*i+D*u+M*b+P*j,S=t[8],D=t[9],M=t[10],P=t[11],r[8]=S*s+D*a+M*l+P*I,r[9]=S*n+D*c+M*_+P*A,r[10]=S*o+D*f+M*g+P*T,r[11]=S*i+D*u+M*b+P*j,S=t[12],D=t[13],M=t[14],P=t[15],r[12]=S*s+D*a+M*l+P*I,r[13]=S*n+D*c+M*_+P*A,r[14]=S*o+D*f+M*g+P*T,r[15]=S*i+D*u+M*b+P*j,r}function El(){var r=new Xt(9);return Xt!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Al(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r}function Il(r,e){if(r===e){var t=e[1],s=e[2],n=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=s,r[7]=n}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function xl(r,e){var t=e[0],s=e[1],n=e[2],o=e[3],i=e[4],a=e[5],c=e[6],f=e[7],u=e[8],l=u*i-a*f,_=-u*o+a*c,g=f*o-i*c,b=t*l+s*_+n*g;return b?(b=1/b,r[0]=l*b,r[1]=(-u*s+n*f)*b,r[2]=(a*s-n*i)*b,r[3]=_*b,r[4]=(u*t-n*c)*b,r[5]=(-a*t+n*o)*b,r[6]=g*b,r[7]=(-f*t+s*c)*b,r[8]=(i*t-s*o)*b,r):null}function xs(){var r=new Xt(3);return Xt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Rl(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function Vc(r,e){var t=e[0],s=e[1],n=e[2],o=t*t+s*s+n*n;return o>0&&(o=1/Math.sqrt(o)),r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r}function Sl(r,e,t){var s=e[0],n=e[1],o=e[2],i=t[3]*s+t[7]*n+t[11]*o+t[15];return i=i||1,r[0]=(t[0]*s+t[4]*n+t[8]*o+t[12])/i,r[1]=(t[1]*s+t[5]*n+t[9]*o+t[13])/i,r[2]=(t[2]*s+t[6]*n+t[10]*o+t[14])/i,r}function Ml(r,e,t){var s=e[0],n=e[1],o=e[2];return r[0]=s*t[0]+n*t[3]+o*t[6],r[1]=s*t[1]+n*t[4]+o*t[7],r[2]=s*t[2]+n*t[5]+o*t[8],r}var Nl=Rl;(function(){var r=xs();return function(e,t,s,n,o,i){var a,c;for(t||(t=3),s||(s=0),n?c=Math.min(n*t+s,e.length):c=e.length,a=s;a<c;a+=t)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],o(r,r,i),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2];return e}})();const at="dedup",Ls={keepUniqueNames:!1,propertyTypes:[C.ACCESSOR,C.MESH,C.TEXTURE,C.MATERIAL,C.SKIN]};function Oo(r=Ls){const e=Xe(Ls,r),t=new Set(e.propertyTypes);for(const s of e.propertyTypes)if(!Ls.propertyTypes.includes(s))throw new Error(`${at}: Unsupported deduplication on type "${s}".`);return Ke(at,s=>{const n=s.getLogger();t.has(C.ACCESSOR)&&vl(s),t.has(C.TEXTURE)&&Ol(s,e),t.has(C.MATERIAL)&&Cl(s,e),t.has(C.MESH)&&wl(s,e),t.has(C.SKIN)&&Dl(s,e),n.debug(`${at}: Complete.`)})}function vl(r){const e=r.getLogger(),t=new Map,s=new Map,n=new Map,o=new Map,i=r.getRoot().listMeshes();i.forEach(l=>{l.listPrimitives().forEach(_=>{_.listAttributes().forEach(g=>a(g,s)),a(_.getIndices(),t)})});for(const l of r.getRoot().listAnimations())for(const _ of l.listSamplers())a(_.getInput(),n),a(_.getOutput(),o);function a(l,_){if(!l)return;const g=[l.getCount(),l.getType(),l.getComponentType(),l.getNormalized(),l.getSparse()].join(":");let b=_.get(g);b||_.set(g,b=new Set),b.add(l)}function c(l,_){for(let g=0;g<l.length;g++){const b=l[g],I=Y.toView(b.getArray());if(!_.has(b))for(let A=g+1;A<l.length;A++){const T=l[A];_.has(T)||Y.equals(I,Y.toView(T.getArray()))&&_.set(T,b)}}}let f=0;const u=new Map;for(const l of[s,t,n,o])for(const _ of l.values())f+=_.size,c(Array.from(_),u);e.debug(`${at}: Merged ${u.size} of ${f} accessors.`),i.forEach(l=>{l.listPrimitives().forEach(_=>{_.listAttributes().forEach(b=>{u.has(b)&&_.swap(b,u.get(b))});const g=_.getIndices();g&&u.has(g)&&_.swap(g,u.get(g))})});for(const l of r.getRoot().listAnimations())for(const _ of l.listSamplers()){const g=_.getInput(),b=_.getOutput();g&&u.has(g)&&_.swap(g,u.get(g)),b&&u.has(b)&&_.swap(b,u.get(b))}Array.from(u.keys()).forEach(l=>l.dispose())}function wl(r,e){const t=r.getLogger(),s=r.getRoot(),n=new Map;s.listAccessors().forEach((a,c)=>n.set(a,c)),s.listMaterials().forEach((a,c)=>n.set(a,c));const o=s.listMeshes().length,i=new Map;for(const a of s.listMeshes()){const c=[];for(const u of a.listPrimitives())c.push(kc(u,n));let f="";if(e.keepUniqueNames&&(f+=a.getName()+";"),f+=c.join(";"),i.has(f)){const u=i.get(f);a.listParents().forEach(l=>{l.propertyType!==C.ROOT&&l.swap(a,u)}),a.dispose()}else i.set(f,a)}t.debug(`${at}: Merged ${o-i.size} of ${o} meshes.`)}function Ol(r,e){const t=r.getLogger(),s=r.getRoot(),n=s.listTextures(),o=new Map;for(let i=0;i<n.length;i++){const a=n[i],c=a.getImage();if(!o.has(a))for(let f=i+1;f<n.length;f++){const u=n[f],l=u.getImage();if(o.has(u)||a.getMimeType()!==u.getMimeType()||e.keepUniqueNames&&a.getName()!==u.getName())continue;const _=a.getSize(),g=u.getSize();!_||!g||_[0]===g[0]&&_[1]===g[1]&&(!c||!l||Y.equals(c,l)&&o.set(u,a))}}t.debug(`${at}: Merged ${o.size} of ${s.listTextures().length} textures.`),Array.from(o.entries()).forEach(([i,a])=>{i.listParents().forEach(c=>{c instanceof Pt||c.swap(i,a)}),i.dispose()})}function Cl(r,e){const t=r.getLogger(),n=r.getRoot().listMaterials(),o=new Map,i=new Map,a=new Set;e.keepUniqueNames||a.add("name");for(let c=0;c<n.length;c++){const f=n[c];if(!o.has(f)&&!na(f,i))for(let u=c+1;u<n.length;u++){const l=n[u];o.has(l)||na(l,i)||f.equals(l,a)&&o.set(l,f)}}t.debug(`${at}: Merged ${o.size} of ${n.length} materials.`),Array.from(o.entries()).forEach(([c,f])=>{c.listParents().forEach(u=>{u instanceof Pt||u.swap(c,f)}),c.dispose()})}function Dl(r,e){const t=r.getLogger(),n=r.getRoot().listSkins(),o=new Map,i=new Set(["joints"]);e.keepUniqueNames||i.add("name");for(let a=0;a<n.length;a++){const c=n[a];if(!o.has(c))for(let f=a+1;f<n.length;f++){const u=n[f];o.has(u)||c.equals(u,i)&&ll(c.listJoints(),u.listJoints())&&o.set(u,c)}}t.debug(`${at}: Merged ${o.size} of ${n.length} skins.`),Array.from(o.entries()).forEach(([a,c])=>{a.listParents().forEach(f=>{f instanceof Pt||f.swap(a,c)}),a.dispose()})}function kc(r,e){const t=[];for(const s of r.listSemantics()){const n=r.getAttribute(s);t.push(s+":"+e.get(n))}if(r instanceof _e){const s=r.getIndices();s&&t.push("indices:"+e.get(s));const n=r.getMaterial();n&&t.push("material:"+e.get(n)),t.push("mode:"+r.getMode());for(const o of r.listTargets())t.push("target:"+kc(o,e))}return t.join(",")}function na(r,e){if(e.has(r))return e.get(r);const t=r.getGraph(),s=new Set,n=t.listParentEdges(r);for(;n.length>0;){const o=n.pop();if(o.getAttributes().modifyChild===!0)return e.set(r,!0),!0;const i=o.getChild();if(!s.has(i))for(const a of t.listChildEdges(i))n.push(a)}return e.set(r,!1),!1}function zc(){var r=new Xt(4);return Xt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function jl(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function Pl(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r}function Fl(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r}function Ll(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function Ul(r){var e=r[0],t=r[1],s=r[2],n=r[3];return Math.hypot(e,t,s,n)}var $c=Pl,Bl=Fl,Hc=Ul;(function(){var r=zc();return function(e,t,s,n,o,i){var a,c;for(t||(t=4),s||(s=0),n?c=Math.min(n*t+s,e.length):c=e.length,a=s;a<c;a+=t)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],r[3]=e[a+3],o(r,r,i),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2],e[a+3]=r[3];return e}})();const Gl=/color|emissive|diffuse/i;function Vl(r){return r.getGraph().listParentEdges(r).some(n=>n.getAttributes().isColor||Gl.test(n.getName()))?"srgb":null}function kl(r){const e=r.getGraph(),t=new Set,s=new Set;function n(o){const i=new Set;for(const a of e.listChildEdges(o))a.getChild()instanceof Kn&&i.add(a.getName()+"Info");for(const a of e.listChildEdges(o)){const c=a.getChild();t.has(c)||(t.add(c),c instanceof re&&i.has(a.getName())?s.add(c):c instanceof pe&&n(c))}}return n(r),Array.from(s)}function zl(r){const t=Ge.fromGraph(r.getGraph()).getRoot(),s=r.getGraph().listParentEdges(r).filter(n=>n.getParent()!==t).map(n=>n.getName());return Array.from(new Set(s))}const Gt="prune",eo=3/255,sa={propertyTypes:[C.NODE,C.SKIN,C.MESH,C.CAMERA,C.PRIMITIVE,C.PRIMITIVE_TARGET,C.ANIMATION,C.MATERIAL,C.TEXTURE,C.ACCESSOR,C.BUFFER],keepLeaves:!1,keepAttributes:!1,keepIndices:!1,keepSolidTextures:!1,keepExtras:!1};function Dt(r=sa){const e=Xe(sa,r),t=new Set(e.propertyTypes),s=e.keepExtras;return Ke(Gt,async n=>{const o=n.getLogger(),i=n.getRoot(),a=n.getGraph(),c=new $l,f=u=>c.dispose(u.target);if(a.addEventListener("node:dispose",f),t.has(C.MESH))for(const u of i.listMeshes())u.listPrimitives().length>0||u.dispose();if(t.has(C.NODE)){if(!e.keepLeaves)for(const u of i.listScenes())qc(a,u,s);for(const u of i.listNodes())Pe(u,s)}if(t.has(C.SKIN))for(const u of i.listSkins())Pe(u,s);if(t.has(C.MESH))for(const u of i.listMeshes())Pe(u,s);if(t.has(C.CAMERA))for(const u of i.listCameras())Pe(u,s);if(t.has(C.PRIMITIVE)&&oa(a,C.PRIMITIVE,s),t.has(C.PRIMITIVE_TARGET)&&oa(a,C.PRIMITIVE_TARGET,s),!e.keepAttributes&&t.has(C.ACCESSOR)){const u=new Map;for(const l of i.listMeshes())for(const _ of l.listPrimitives()){const g=_.getMaterial();if(!g)continue;const b=Wc(n,_,g),I=ql(_,b);ia(_,I),_.listTargets().forEach(A=>ia(A,I)),u.has(g)?u.get(g).add(_):u.set(g,new Set([_]))}for(const[l,_]of u)Wl(l,Array.from(_))}if(!e.keepIndices&&t.has(C.ACCESSOR))for(const u of i.listMeshes())for(const l of u.listPrimitives())Hl(l);if(t.has(C.ANIMATION))for(const u of i.listAnimations()){for(const l of u.listChannels())l.getTargetNode()||l.dispose();if(u.listChannels().length)u.listSamplers().forEach(l=>Pe(l,s));else{const l=u.listSamplers();Pe(u,s),l.forEach(_=>Pe(_,s))}}if(t.has(C.MATERIAL)&&i.listMaterials().forEach(u=>Pe(u,s)),t.has(C.TEXTURE)&&(i.listTextures().forEach(u=>Pe(u,s)),e.keepSolidTextures||await Kl(n)),t.has(C.ACCESSOR)&&i.listAccessors().forEach(u=>Pe(u,s)),t.has(C.BUFFER)&&i.listBuffers().forEach(u=>Pe(u,s)),a.removeEventListener("node:dispose",f),c.empty())o.debug(`${Gt}: No unused properties found.`);else{const u=c.entries().map(([l,_])=>`${l} (${_})`).join(", ");o.info(`${Gt}: Removed types... ${u}`)}o.debug(`${Gt}: Complete.`)})}class $l{constructor(){this.disposed={}}empty(){for(const e in this.disposed)return!1;return!0}entries(){return Object.entries(this.disposed)}dispose(e){this.disposed[e.propertyType]=this.disposed[e.propertyType]||0,this.disposed[e.propertyType]++}}function Pe(r,e){const t=r.listParents().filter(n=>!(n instanceof Pt||n instanceof Yt)),s=e&&!Fc(r.getExtras());!t.length&&!s&&r.dispose()}function oa(r,e,t){for(const s of r.listEdges()){const n=s.getParent();n.propertyType===e&&Pe(n,t)}}function qc(r,e,t){if(e.listChildren().forEach(i=>qc(r,i,t)),e instanceof Is)return;const s=r.listParentEdges(e).some(i=>{const a=i.getParent().propertyType;return a!==C.ROOT&&a!==C.SCENE&&a!==C.NODE}),n=r.listChildren(e).length===0,o=t&&!Fc(e.getExtras());n&&!s&&!o&&e.dispose()}function ia(r,e){for(const t of e)r.setAttribute(t,null)}function Hl(r){const e=r.getIndices(),t=e&&e.getArray(),s=r.listAttributes()[0];if(!(!t||!s)&&e.getCount()===s.getCount()){for(let n=0,o=t.length;n<o;n++)if(n!==t[n])return;r.setIndices(null)}}function ql(r,e){const t=[];for(const s of r.listSemantics())(s==="NORMAL"&&!e.has(s)||s==="TANGENT"&&!e.has(s)||s.startsWith("TEXCOORD_")&&!e.has(s)||s.startsWith("COLOR_")&&s!=="COLOR_0")&&t.push(s);return t}function Wc(r,e,t,s=new Set){const o=r.getGraph().listChildEdges(t),i=new Set;for(const f of o)f.getChild()instanceof Kn&&i.add(f.getName());for(const f of o){const u=f.getName(),l=f.getChild();l instanceof re&&i.has(u.replace(/Info$/,""))&&s.add(`TEXCOORD_${l.getTexCoord()}`),l instanceof Kn&&u.match(/normalTexture/i)&&s.add("TANGENT"),l instanceof pe&&Wc(r,e,l,s)}const a=t instanceof Ze&&!t.getExtension("KHR_materials_unlit"),c=e.getMode()===_e.Mode.POINTS;return a&&!c&&s.add("NORMAL"),s}function Wl(r,e){const t=kl(r),s=new Set(t.map(c=>c.getTexCoord())),n=Array.from(s).sort(),o=new Map(n.map((c,f)=>[c,f])),i=new Map(n.map((c,f)=>[`TEXCOORD_${c}`,`TEXCOORD_${f}`]));for(const c of t){const f=c.getTexCoord();c.setTexCoord(o.get(f))}for(const c of e){const f=c.listSemantics().filter(u=>u.startsWith("TEXCOORD_")).sort();a(c,f),c.listTargets().forEach(u=>a(u,f))}function a(c,f){for(const u of f){const l=c.getAttribute(u);if(!l)continue;const _=i.get(u);_!==u&&(c.setAttribute(_,l),c.setAttribute(u,null))}}}async function Kl(r){const e=r.getRoot(),t=r.getGraph(),s=r.getLogger(),o=e.listTextures().map(async i=>{var a;const c=await Yl(i);if(!c)return;Vl(i)==="srgb"&&ds.convertSRGBToLinear(c,c);const f=i.getName()||i.getURI(),u=(a=i.getSize())==null?void 0:a.join("x"),l=zl(i);for(const _ of t.listParentEdges(i)){const g=_.getParent();g!==e&&Xl(g,c,_.getName(),s)&&_.dispose()}i.listParents().length===1&&(i.dispose(),s.debug(`${Gt}: Removed solid-color texture "${f}" (${u}px ${l.join(", ")})`))});await Promise.all(o)}function Xl(r,e,t,s){if(r instanceof Ze)switch(t){case"baseColorTexture":return r.setBaseColorFactor(Bl(e,e,r.getBaseColorFactor())),!0;case"emissiveTexture":return r.setEmissiveFactor(Nl([0,0,0],e.slice(0,3),r.getEmissiveFactor())),!0;case"occlusionTexture":return Math.abs(e[0]-1)<=eo;case"metallicRoughnessTexture":return r.setRoughnessFactor(e[1]*r.getRoughnessFactor()),r.setMetallicFactor(e[2]*r.getMetallicFactor()),!0;case"normalTexture":return Hc($c(zc(),e,[.5,.5,1,1]))<=eo}return s.warn(`${Gt}: Detected single-color ${t} texture. Pruning ${t} not yet supported.`),!1}async function Yl(r){const e=await Ql(r);if(!e)return null;const t=[1/0,1/0,1/0,1/0],s=[-1/0,-1/0,-1/0,-1/0],n=[0,0,0,0],[o,i]=e.shape;for(let a=0;a<o;a++){for(let c=0;c<i;c++)for(let f=0;f<4;f++)t[f]=Math.min(t[f],e.get(a,c,f)),s[f]=Math.max(s[f],e.get(a,c,f));if(Hc($c(n,s,t))/255>eo)return null}return Ll(n,jl(n,s,t),.5/255)}async function Ql(r){try{return await No(r.getImage(),r.getMimeType())}catch{return null}}const st=2**32-1;class Jl{constructor(e){this.attributes=[],this.u8=void 0,this.u32=void 0;let t=0;for(const s of Pc(e))t+=this._initAttribute(s);this.u8=new Uint8Array(t),this.u32=new Uint32Array(this.u8.buffer)}_initAttribute(e){const t=e.getArray(),s=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=e.getElementSize()*e.getComponentSize(),o=Y.padNumber(n);return this.attributes.push({u8:s,byteStride:n,paddedByteStride:o}),o}hash(e){let t=0;for(const{u8:s,byteStride:n,paddedByteStride:o}of this.attributes){for(let i=0;i<o;i++)i<n?this.u8[t+i]=s[e*n+i]:this.u8[t+i]=0;t+=o}return Zl(0,this.u32)}equal(e,t){for(const{u8:s,byteStride:n}of this.attributes)for(let o=0;o<n;o++)if(s[e*n+o]!==s[t*n+o])return!1;return!0}}function Zl(r,e){for(let n=0,o=e.length;n<o;n++){let i=e[n];i=Math.imul(i,1540483477)>>>0,i=(i^i>>24)>>>0,i=Math.imul(i,1540483477)>>>0,r=Math.imul(r,1540483477)>>>0,r=(r^i)>>>0}return r}function ef(r,e,t,s,n=st){const o=e-1;let a=t.hash(s)&o;for(let c=0;c<=o;c++){const f=r[a];if(f===n||t.equal(f,s))return a;a=a+c+1&o}throw new Error("Hash table full.")}var Fe;(function(r){r.RENDER="render",r.RENDER_CACHED="render-cached",r.UPLOAD="upload",r.UPLOAD_NAIVE="upload-naive",r.DISTINCT="distinct",r.DISTINCT_POSITION="distinct-position",r.UNUSED="unused"})(Fe||(Fe={}));function Co(r,e){const t=r.getAttribute("POSITION"),s=r.getIndices();switch(e){case Fe.RENDER:return s?s.getCount():t.getCount();case Fe.RENDER_CACHED:return s?new Set(s.getArray()).size:t.getCount();case Fe.UPLOAD_NAIVE:case Fe.UPLOAD:return t.getCount();case Fe.DISTINCT:case Fe.DISTINCT_POSITION:return tf(e);case Fe.UNUSED:return s?t.getCount()-new Set(s.getArray()).size:0;default:return rf(e)}}function tf(r){throw new Error(`Not implemented: ${r}`)}function rf(r){throw new Error(`Unexpected value: ${r}`)}function Kc(r,e,t){const s=Ge.fromGraph(r.getGraph());(!e||!t)&&([e,t]=nf(r));const n=r.getIndices(),o=n?n.getArray():null,i=Co(r,Fe.RENDER),a=s.createAccessor(),c=i,f=vo(c,t);for(let l=0;l<c;l++)f[l]=e[o?o[l]:l];r.setIndices(a.setArray(f));const u=Pc(r);for(const l of r.listAttributes()){const _=Kt(s,l);aa(l,n,e,_,t),r.swap(l,_)}for(const l of r.listTargets())for(const _ of l.listAttributes()){const g=Kt(s,_);aa(_,n,e,g,t),l.swap(_,g)}n&&n.listParents().length===1&&n.dispose();for(const l of u)l.listParents().length===1&&l.dispose();return r}function aa(r,e,t,s,n){const o=r.getElementSize(),i=r.getArray(),a=e?e.getArray():null,c=e?e.getCount():r.getCount(),f=new i.constructor(n*o),u=new Uint8Array(n);for(let l=0;l<c;l++){const _=a?a[l]:l,g=t[_];if(!u[g]){for(let b=0;b<o;b++)f[g*o+b]=i[_*o+b];u[g]=1}}return s.setArray(f)}function nf(r){const e=Co(r,Fe.UPLOAD),t=r.getIndices(),s=t?t.getArray():null;if(!t||!s)return[fl(e,1e6),e];const n=new Uint32Array(e).fill(st);let o=0;for(let i=0;i<s.length;i++){const a=s[i];n[a]===st&&(n[a]=o++)}return[n,o]}const to="weld",Ts={overwrite:!0,cleanup:!0};function Xc(r=Ts){const e=Xe(Ts,r);return Ke(to,async t=>{const s=t.getLogger();for(const n of t.getRoot().listMeshes()){for(const o of n.listPrimitives())Rs(o,e),Co(o,Fe.RENDER)===0&&o.dispose();n.listPrimitives().length===0&&n.dispose()}e.cleanup&&await t.transform(Dt({propertyTypes:[C.ACCESSOR,C.NODE],keepAttributes:!0,keepIndices:!0,keepLeaves:!1}),Oo({propertyTypes:[C.ACCESSOR]})),s.debug(`${to}: Complete.`)})}function Rs(r,e=Ts){const t=r.getGraph(),n=Ge.fromGraph(t).getLogger(),o=Wt({},Ts,e);if(r.getIndices()&&!o.overwrite||r.getMode()===_e.Mode.POINTS)return;const i=r.getAttribute("POSITION").getCount(),a=r.getIndices(),c=a==null?void 0:a.getArray(),f=a?a.getCount():i,u=new Jl(r),l=wo(i+i/4),_=new Uint32Array(l).fill(st),g=new Uint32Array(i).fill(st);let b=0;for(let I=0;I<f;I++){const A=c?c[I]:I;if(g[A]!==st)continue;const T=ef(_,l,u,A,st),j=_[T];j===st?(_[T]=A,g[A]=b++):g[A]=g[j]}n.debug(`${to}: ${pl(i,b)} vertices.`),Kc(r,g,b)}const{FLOAT:sf}=W.ComponentType;function of(r,e){const t=r.getAttribute("POSITION");t&&ca(e,t);const s=r.getAttribute("NORMAL");s&&ua(e,s);const n=r.getAttribute("TANGENT");n&&pa(e,n);for(const o of r.listTargets()){const i=o.getAttribute("POSITION");i&&ca(e,i);const a=o.getAttribute("NORMAL");a&&ua(e,a);const c=o.getAttribute("TANGENT");c&&pa(e,c)}Tl(e)<0&&af(r)}function ca(r,e){const t=e.getComponentType(),s=e.getNormalized(),n=e.getArray(),o=t===sf?n:new Float32Array(n.length),i=xs();for(let a=0,c=e.getCount();a<c;a++)s?(i[0]=Q.decodeNormalizedInt(n[a*3],t),i[1]=Q.decodeNormalizedInt(n[a*3+1],t),i[2]=Q.decodeNormalizedInt(n[a*3+2],t)):(i[0]=n[a*3],i[1]=n[a*3+1],i[2]=n[a*3+2]),Sl(i,i,r),o[a*3]=i[0],o[a*3+1]=i[1],o[a*3+2]=i[2];e.setArray(o).setNormalized(!1)}function ua(r,e){const t=e.getArray(),s=e.getNormalized(),n=e.getComponentType(),o=El();Al(o,r),xl(o,o),Il(o,o);const i=xs();for(let a=0,c=e.getCount();a<c;a++)s?(i[0]=Q.decodeNormalizedInt(t[a*3],n),i[1]=Q.decodeNormalizedInt(t[a*3+1],n),i[2]=Q.decodeNormalizedInt(t[a*3+2],n)):(i[0]=t[a*3],i[1]=t[a*3+1],i[2]=t[a*3+2]),Ml(i,i,o),Vc(i,i),s?(t[a*3]=Q.decodeNormalizedInt(i[0],n),t[a*3+1]=Q.decodeNormalizedInt(i[1],n),t[a*3+2]=Q.decodeNormalizedInt(i[2],n)):(t[a*3]=i[0],t[a*3+1]=i[1],t[a*3+2]=i[2])}function pa(r,e){const t=e.getArray(),s=e.getNormalized(),n=e.getComponentType(),o=xs();for(let i=0,a=e.getCount();i<a;i++)s?(o[0]=Q.decodeNormalizedInt(t[i*4],n),o[1]=Q.decodeNormalizedInt(t[i*4+1],n),o[2]=Q.decodeNormalizedInt(t[i*4+2],n)):(o[0]=t[i*4],o[1]=t[i*4+1],o[2]=t[i*4+2]),o[0]=r[0]*o[0]+r[4]*o[1]+r[8]*o[2],o[1]=r[1]*o[0]+r[5]*o[1]+r[9]*o[2],o[2]=r[2]*o[0]+r[6]*o[1]+r[10]*o[2],Vc(o,o),s?(t[i*4]=Q.decodeNormalizedInt(o[0],n),t[i*4+1]=Q.decodeNormalizedInt(o[1],n),t[i*4+2]=Q.decodeNormalizedInt(o[2],n)):(t[i*4]=o[0],t[i*4+1]=o[1],t[i*4+2]=o[2])}function af(r){if(r.getMode()!==_e.Mode.TRIANGLES)return;r.getIndices()||Rs(r);const e=r.getIndices();for(let t=0,s=e.getCount();t<s;t+=3){const n=e.getScalar(t),o=e.getScalar(t+2);e.setScalar(t,o),e.setScalar(t+2,n)}}const{LINES:cf,LINE_STRIP:uf,LINE_LOOP:pf,TRIANGLES:lf,TRIANGLE_STRIP:ff,TRIANGLE_FAN:_f}=_e.Mode;function df(r){const e=r.getGraph(),t=Ge.fromGraph(e);r.getIndices()||Rs(r);const s=r.getIndices(),n=s.getArray(),o=jc(r),i=ut[s.getComponentType()],a=new i(o*2),c=r.getMode();if(c===uf)for(let u=0;u<o;u++)a[u*2]=n[u],a[u*2+1]=n[u+1];else if(c===pf)for(let u=0;u<o;u++)u<o-1?(a[u*2]=n[u],a[u*2+1]=n[u+1]):(a[u*2]=n[u],a[u*2+1]=n[0]);else throw new Error("Only LINE_STRIP and LINE_LOOP may be converted to LINES.");r.setMode(cf);const f=t.getRoot();s.listParents().some(u=>u!==f&&u!==r)?r.setIndices(Kt(t,s).setArray(a)):s.setArray(a)}function hf(r){const e=r.getGraph(),t=Ge.fromGraph(e);r.getIndices()||Rs(r);const s=r.getIndices(),n=s.getArray(),o=jc(r),i=ut[s.getComponentType()],a=new i(o*3),c=r.getMode();if(c===ff)for(let u=0,l=n.length;u<l-2;u++)u%2?(a[u*3]=n[u+1],a[u*3+1]=n[u],a[u*3+2]=n[u+2]):(a[u*3]=n[u],a[u*3+1]=n[u+1],a[u*3+2]=n[u+2]);else if(c===_f)for(let u=0;u<o;u++)a[u*3]=n[0],a[u*3+1]=n[u+1],a[u*3+2]=n[u+2];else throw new Error("Only TRIANGLE_STRIP and TRIANGLE_FAN may be converted to TRIANGLES.");r.setMode(lf);const f=t.getRoot();s.listParents().some(u=>u!==f&&u!==r)?r.setIndices(Kt(t,s).setArray(a)):s.setArray(a)}function yf(r){const e=r.getArray();if(!e)return;const t=gf(e,r.getComponentType(),r.getNormalized());r.setArray(t).setNormalized(!1)}function gf(r,e,t){const s=new Float32Array(r.length);for(let n=0,o=r.length;n<o;n++)t?s[n]=Q.decodeNormalizedInt(r[n],e):s[n]=r[n];return s}const{TEXTURE_INFO:l_,ROOT:f_}=C,mf="draco",la={method:"edgebreaker",encodeSpeed:5,decodeSpeed:5,quantizePosition:14,quantizeNormal:10,quantizeColor:8,quantizeTexcoord:12,quantizeGeneric:12,quantizationVolume:"mesh"};function Tf(r=la){const e=Xe(la,r);return Ke(mf,async t=>{await t.transform(Xc()),t.createExtension(kt).setRequired(!0).setEncoderOptions({method:e.method==="edgebreaker"?kt.EncoderMethod.EDGEBREAKER:kt.EncoderMethod.SEQUENTIAL,encodeSpeed:e.encodeSpeed,decodeSpeed:e.decodeSpeed,quantizationBits:{POSITION:e.quantizePosition,NORMAL:e.quantizeNormal,COLOR:e.quantizeColor,TEX_COORD:e.quantizeTexcoord,GENERIC:e.quantizeGeneric},quantizationVolume:e.quantizationVolume})})}const Us="flatten",fa={cleanup:!0};function bf(r=fa){const e=Xe(fa,r);return Ke(Us,async t=>{const s=t.getRoot(),n=t.getLogger(),o=new Set;for(const f of s.listSkins())for(const u of f.listJoints())o.add(u);const i=new Set;for(const f of s.listAnimations())for(const u of f.listChannels()){const l=u.getTargetNode();l&&u.getTargetPath()!=="weights"&&i.add(l)}const a=new Set,c=new Set;for(const f of s.listScenes())f.traverse(u=>{const l=u.getParentNode();l&&((o.has(l)||a.has(l))&&a.add(u),(i.has(l)||c.has(l))&&c.add(u))});for(const f of s.listScenes())f.traverse(u=>{i.has(u)||a.has(u)||c.has(u)||gl(u)});i.size&&n.debug(`${Us}: Flattening node hierarchies with TRS animation not yet supported.`),e.cleanup&&await t.transform(Dt({propertyTypes:[C.NODE],keepLeaves:!1})),n.debug(`${Us}: Complete.`)})}const Ef={skipValidation:!1},_a=2**32-1,{LINE_STRIP:Af,LINE_LOOP:If,TRIANGLE_STRIP:xf,TRIANGLE_FAN:Rf}=_e.Mode;function Sf(r,e={}){const t=Xe(Ef,e),s=r[0],n=Ge.fromGraph(s.getGraph());if(!t.skipValidation&&new Set(r.map(Lc)).size>1)throw new Error("Requires >=2 Primitives, sharing the same Material and Mode, with compatible vertex attributes and indices.");for(const g of r)switch(g.getMode()){case Af:case If:df(g);break;case xf:case Rf:hf(g);break}const o=[],i=new Uint32Array(r.length);let a=0,c=0;for(let g=0;g<r.length;g++){const b=r[g],I=b.getIndices(),A=b.getAttribute("POSITION").getCount(),T=I?I.getArray():null,j=I?I.getCount():A,S=new Uint32Array(A).fill(_a);for(let D=0;D<j;D++){const M=T?T[D]:D;S[M]===_a&&(S[M]=a++,i[g]++)}o.push(S),c+=j}const f=n.createPrimitive().setMode(s.getMode()).setMaterial(s.getMaterial());for(const g of s.listSemantics()){const b=s.getAttribute(g),I=ut[b.getComponentType()],A=Kt(n,b).setArray(new I(a*b.getElementSize()));f.setAttribute(g,A)}const u=s.getIndices(),l=u?Kt(n,u).setArray(vo(c,a)):null;f.setIndices(l);let _=0;for(let g=0;g<o.length;g++){const b=r[g],I=b.getIndices(),A=I?I.getCount():-1,T=o[g];I&&l&&(Nf(I,T,l,_),_+=A);for(const j of f.listSemantics()){const S=b.getAttribute(j),D=f.getAttribute(j);Mf(S,I,T,D)}}return f}function Mf(r,e,t,s){const n=r.getElementSize(),o=e?e.getArray():null,i=r.getCount(),a=r.getArray(),c=s.getArray(),f=new Uint8Array(r.getCount());for(let u=0,l=e?e.getCount():i;u<l;u++){const _=o?o[u]:u,g=t[_];if(!f[g]){for(let b=0;b<n;b++)c[g*n+b]=a[_*n+b];f[g]=1}}}function Nf(r,e,t,s){const n=r.getCount(),o=r.getArray(),i=t.getArray();for(let a=0;a<n;a++){const c=o[a],f=e[c];i[s+a]=f}}const ro="join",{ROOT:vf,NODE:wf,MESH:Of,PRIMITIVE:Cf,ACCESSOR:Df}=C,Bs=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],da={keepMeshes:!1,keepNamed:!1,cleanup:!0,filter:()=>!0};function jf(r=da){const e=Xe(da,r);return Ke(ro,async t=>{const s=t.getRoot(),n=t.getLogger();for(const o of s.listScenes())ha(t,o,e),o.traverse(i=>ha(t,i,e));e.cleanup&&await t.transform(Dt({propertyTypes:[wf,Of,Cf,Df],keepAttributes:!0,keepIndices:!0,keepLeaves:!1})),n.debug(`${ro}: Complete.`)})}function ha(r,e,t){const s=r.getLogger(),n={},o=e.listChildren();for(let c=0;c<o.length;c++){const f=o[c];if(!t.filter(f)||f.listParents().some(_=>_ instanceof Yt))continue;const l=f.getMesh();if(l&&!f.getExtension("EXT_mesh_gpu_instancing")&&!f.getSkin())for(const _ of l.listPrimitives()){if(_.listTargets().length>0)continue;const g=_.getMaterial();if(g&&g.getExtension("KHR_materials_volume"))continue;Kc(_),Ff(_);let b=Lc(_);const I=l.getName()||f.getName();(t.keepMeshes||t.keepNamed&&I)&&(b+=`|${c}`),b in n||(n[b]={prims:[],primMeshes:[],primNodes:[],dstNode:f,dstMesh:void 0});const A=n[b];A.prims.push(_),A.primNodes.push(f)}}const i=Object.values(n).filter(({prims:c})=>c.length>1),a=new Set(i.flatMap(c=>c.primNodes));for(const c of a){const f=c.getMesh();f.listParents().some(l=>l.propertyType!==vf&&c!==l)&&c.setMesh(f.clone())}for(const c of i){const{dstNode:f,primNodes:u}=c;c.dstMesh=f.getMesh(),c.primMeshes=u.map(l=>l.getMesh())}for(const c of i){const{prims:f,primNodes:u,primMeshes:l,dstNode:_,dstMesh:g}=c,b=_.getMatrix();for(let T=0;T<f.length;T++){const j=u[T],S=l[T];let D=f[T];S.removePrimitive(D),_l(D)&&(D=f[T]=Pf(f[T])),j!==_&&(bl(Bs,ml(Bs,b),j.getMatrix()),of(D,Bs))}const I=Sf(f),A=I.listAttributes()[0].getCount();g.addPrimitive(I),s.debug(`${ro}: Joined Primitives (${f.length}) containing ${Zs(A)} vertices under Node "${_.getName()}".`)}}function Pf(r){const e=r.clone();for(const s of e.listSemantics())e.setAttribute(s,e.getAttribute(s).clone());const t=e.getIndices();return t&&e.setIndices(t.clone()),e}function Ff(r){for(const e of["POSITION","NORMAL","TANGENT"]){const t=r.getAttribute(e);t&&yf(t)}}const{TRANSLATION:__,ROTATION:d_,SCALE:h_,WEIGHTS:y_}=Yt.TargetPath,Lf={pattern:/.*/,quantizationVolume:"mesh",quantizePosition:14,quantizeNormal:10,quantizeTexcoord:12,quantizeColor:8,quantizeWeight:8,quantizeGeneric:12,normalizeWeights:!0,cleanup:!0};Wt({level:"high"},Lf);const Gs="metalRough",Uf={};function Bf(r=Uf){return Ke(Gs,async e=>{const t=e.getLogger();if(!e.getRoot().listExtensionsUsed().map(c=>c.extensionName).includes("KHR_materials_pbrSpecularGlossiness")){t.warn(`${Gs}: KHR_materials_pbrSpecularGlossiness not found on document.`);return}const n=e.createExtension(xo),o=e.createExtension(So),i=e.createExtension(Ro),a=new Set;for(const c of e.getRoot().listMaterials()){const f=c.getExtension("KHR_materials_pbrSpecularGlossiness");if(!f)continue;const u=o.createSpecular().setSpecularFactor(1).setSpecularColorFactor(f.getSpecularFactor());a.add(f.getSpecularGlossinessTexture()),a.add(c.getBaseColorTexture()),a.add(c.getMetallicRoughnessTexture()),c.setBaseColorFactor(f.getDiffuseFactor()).setMetallicFactor(0).setRoughnessFactor(1).setExtension("KHR_materials_ior",n.createIOR().setIOR(1e3)).setExtension("KHR_materials_specular",u);const l=f.getDiffuseTexture();l&&(c.setBaseColorTexture(l),c.getBaseColorTextureInfo().copy(f.getDiffuseTextureInfo()));const _=f.getSpecularGlossinessTexture();if(_){const g=f.getSpecularGlossinessTextureInfo(),b=e.createTexture();await ta(_,b,(T,j,S)=>{T.set(j,S,3,255)}),u.setSpecularTexture(b),u.setSpecularColorTexture(b),u.getSpecularTextureInfo().copy(g),u.getSpecularColorTextureInfo().copy(g);const I=f.getGlossinessFactor(),A=e.createTexture();await ta(_,A,(T,j,S)=>{const D=255-Math.round(T.get(j,S,3)*I);T.set(j,S,0,0),T.set(j,S,1,D),T.set(j,S,2,0),T.set(j,S,3,255)}),c.setMetallicRoughnessTexture(A),c.getMetallicRoughnessTextureInfo().copy(g)}else u.setSpecularColorFactor(f.getSpecularFactor()),c.setRoughnessFactor(1-f.getGlossinessFactor());c.setExtension("KHR_materials_pbrSpecularGlossiness",null)}i.dispose();for(const c of a)c&&c.listParents().length===1&&c.dispose();t.debug(`${Gs}: Complete.`)})}const as="palette",ya={blockSize:4,min:5,keepAttributes:!1,cleanup:!0};function Gf(r=ya){const e=Xe(ya,r),t=Math.max(e.blockSize,1),s=Math.max(e.min,1);return Ke(as,async n=>{const o=n.getLogger(),i=n.getRoot();e.keepAttributes||await n.transform(Dt({propertyTypes:[C.ACCESSOR],keepAttributes:!1,keepIndices:!0,keepLeaves:!0}));const a=new Set,c=new Set;for(const L of i.listMeshes())for(const B of L.listPrimitives()){const U=B.getMaterial();!U||B.getAttribute("TEXCOORD_0")||(a.add(B),c.add(U))}const f=new Set,u=new Map,l={baseColor:new Set,emissive:new Set,metallicRoughness:new Set};for(const L of c){const B=ga(L.getBaseColorFactor().slice()),U=ga([...L.getEmissiveFactor(),1]),V=no(L.getRoughnessFactor()),$=no(L.getMetallicFactor()),q=`baseColor:${B},emissive:${U},metallicRoughness:${$}${V}`;l.baseColor.add(B),l.emissive.add(U),l.metallicRoughness.add($+"+"+V),f.add(q),u.set(L,q)}const _=f.size;if(_<s){o.debug(`${as}: Found <${s} unique material properties. Exiting.`);return}const g=ma(_*t),b=ma(t),I=g-_*t,A={baseColor:null,emissive:null,metallicRoughness:null},T=new Set(["name","extras"]),j=(...L)=>L.forEach(B=>T.add(B));let S=null,D=null,M=null;if(l.baseColor.size>=s){const L="PaletteBaseColor";S=n.createTexture(L).setURI(`${L}.png`),A.baseColor=Ie(new Uint8Array(g*b*4),[g,b,4]),j("baseColorFactor","baseColorTexture","baseColorTextureInfo")}if(l.emissive.size>=s){const L="PaletteEmissive";D=n.createTexture(L).setURI(`${L}.png`),A.emissive=Ie(new Uint8Array(g*b*4),[g,b,4]),j("emissiveFactor","emissiveTexture","emissiveTextureInfo")}if(l.metallicRoughness.size>=s){const L="PaletteMetallicRoughness";M=n.createTexture(L).setURI(`${L}.png`),A.metallicRoughness=Ie(new Uint8Array(g*b*4),[g,b,4]),j("metallicFactor","roughnessFactor","metallicRoughnessTexture","metallicRoughnessTextureInfo")}if(!(S||D||M)){o.debug(`${as}: No material property has >=${s} unique values. Exiting.`);return}const P=new Set,x=new Map,N=[];let w=0;for(const L of c){const B=u.get(L);if(P.has(B))continue;const U=w++;if(A.baseColor){const V=A.baseColor,$=[...L.getBaseColorFactor()];ds.convertLinearToSRGB($,$),Vs(V,U,$,t)}if(A.emissive){const V=A.emissive,$=[...L.getEmissiveFactor(),1];ds.convertLinearToSRGB($,$),Vs(V,U,$,t)}if(A.metallicRoughness){const V=A.metallicRoughness,$=L.getMetallicFactor(),q=L.getRoughnessFactor();Vs(V,U,[0,q,$,1],t)}P.add(B),x.set(B,U)}const F="image/png";if(S){const L=await zt(A.baseColor,F);S.setImage(L).setMimeType(F)}if(D){const L=await zt(A.emissive,F);D.setImage(L).setMimeType(F)}if(M){const L=await zt(A.metallicRoughness,F);M.setImage(L).setMimeType(F)}let k=1;for(const L of a){const B=L.getMaterial(),U=u.get(B),q=(x.get(U)+.5)/_*(g-I)/g,d=L.getAttribute("POSITION"),te=d.getBuffer(),oe=new Float32Array(d.getCount()*2).fill(q),ae=n.createAccessor().setType("VEC2").setArray(oe).setBuffer(te);let Z;for(const H of N)H.equals(B,T)&&(Z=H);if(!Z){const H=(k++).toString().padStart(3,"0");Z=B.clone().setName(`PaletteMaterial${H}`),S&&Z.setBaseColorFactor([1,1,1,1]).setBaseColorTexture(S).getBaseColorTextureInfo().setMinFilter(re.MinFilter.NEAREST).setMagFilter(re.MagFilter.NEAREST),D&&Z.setEmissiveFactor([1,1,1]).setEmissiveTexture(D).getEmissiveTextureInfo().setMinFilter(re.MinFilter.NEAREST).setMagFilter(re.MagFilter.NEAREST),M&&Z.setMetallicFactor(1).setRoughnessFactor(1).setMetallicRoughnessTexture(M).getMetallicRoughnessTextureInfo().setMinFilter(re.MinFilter.NEAREST).setMagFilter(re.MagFilter.NEAREST),N.push(Z)}L.setMaterial(Z).setAttribute("TEXCOORD_0",ae)}e.cleanup&&await n.transform(Dt({propertyTypes:[C.MATERIAL]})),o.debug(`${as}: Complete.`)})}function no(r){const e=Math.round(r*255).toString(16);return e.length===1?"0"+e:e}function ga(r){return ds.convertLinearToSRGB(r,r),r.map(no).join("")}function ma(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Vs(r,e,t,s){for(let n=0;n<s;n++)for(let o=0;o<s;o++)r.set(e*s+n,o,0,t[0]*255),r.set(e*s+n,o,1,t[1]*255),r.set(e*s+n,o,2,t[2]*255),r.set(e*s+n,o,3,t[3]*255)}var Ta;(function(r){r[r.STEP=0]="STEP",r[r.LERP=1]="LERP",r[r.SLERP=2]="SLERP"})(Ta||(Ta={}));const Vf=1e-6;function kf(r,e,t,s=1e-4){const n=e.length/r.length,o=new Array(n).fill(0),i=new Array(n).fill(0),a=new Array(n).fill(0),c=new Array(n).fill(0),f=r.length-1;let u=1;for(let l=1;l<f;++l){const _=r[u-1],g=r[l],b=r[l+1],I=(g-_)/(b-_);let A=!1;if(g!==b&&(l!==1||g!==r[0]))if(kn(e,u-1,c),kn(e,l,i),kn(e,l+1,a),t==="slerp"){const T=Hf(o,c,a,I),j=Ea(c,i)+Ea(i,a);A=!cs(i,T,s)||j+Number.EPSILON>=Math.PI}else if(t==="lerp"){const T=$f(o,c,a,I);A=!cs(i,T,s)}else t==="step"&&(A=!cs(i,c)||!cs(i,a));A&&(l!==u&&(r[u]=r[l],ba(e,u,kn(e,l,o))),u++)}return f>0&&(r[u]=r[f],ba(e,u,kn(e,f,o)),u++),u}function kn(r,e,t){for(let s=0,n=t.length;s<n;s++)t[s]=r[e*n+s];return t}function ba(r,e,t){for(let s=0,n=t.length;s<n;s++)r[e*n+s]=t[s]}function cs(r,e,t=0){if(r.length!==e.length)return!1;for(let s=0;s<r.length;s++)if(Math.abs(r[s]-e[s])>t)return!1;return!0}function zf(r,e,t){return r*(1-t)+e*t}function $f(r,e,t,s){for(let n=0;n<e.length;n++)r[n]=zf(e[n],t[n],s);return r}function Hf(r,e,t,s){let n=e[0],o=e[1],i=e[2],a=e[3],c=t[0],f=t[1],u=t[2],l=t[3],_,g,b,I,A;return g=n*c+o*f+i*u+a*l,g<0&&(g=-g,c=-c,f=-f,u=-u,l=-l),1-g>Vf?(_=Math.acos(g),b=Math.sin(_),I=Math.sin((1-s)*_)/b,A=Math.sin(s*_)/b):(I=1-s,A=s),r[0]=I*n+A*c,r[1]=I*o+A*f,r[2]=I*i+A*u,r[3]=I*a+A*l,r}function Ea(r,e){const t=qf(r,e);return Math.acos(2*t*t-1)}function qf(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}const Aa="resample",Ia=new Float32Array(0),xa={ready:Promise.resolve(),resample:kf,tolerance:1e-4,cleanup:!0};function Wf(r=xa){const e=Xe(xa,r);return Ke(Aa,async t=>{const s=new Set,n=t.getRoot().listAccessors().length,o=t.getLogger(),i=e.ready,a=e.resample;await i;for(const f of t.getRoot().listAnimations()){const u=new Map;for(const l of f.listChannels())u.set(l.getSampler(),l.getTargetPath());for(const l of f.listSamplers()){const _=l.getInterpolation();if(_==="STEP"||_==="LINEAR"){const g=l.getInput(),b=l.getOutput();s.add(g),s.add(b);const I=Ra(g.getArray(),g.getComponentType(),g.getNormalized()),A=Ra(b.getArray(),b.getComponentType(),b.getNormalized()),T=A.length/I.length,j=I.length;let S;if(_==="STEP"?S=a(I,A,"step",e.tolerance):u.get(l)==="rotation"?S=a(I,A,"slerp",e.tolerance):S=a(I,A,"lerp",e.tolerance),S<j){const D=g.getArray(),M=b.getArray(),P=Sa(new Float32Array(I.buffer,I.byteOffset,S),g.getComponentType(),g.getNormalized()),x=Sa(new Float32Array(A.buffer,A.byteOffset,S*T),b.getComponentType(),b.getNormalized());g.setArray(Ia),b.setArray(Ia),l.setInput(g.clone().setArray(P)),l.setOutput(b.clone().setArray(x)),g.setArray(D),b.setArray(M)}}}}for(const f of Array.from(s.values()))f.listParents().some(l=>!(l instanceof Pt))||f.dispose();t.getRoot().listAccessors().length>n&&e.cleanup&&await t.transform(Oo({propertyTypes:[C.ACCESSOR]})),o.debug(`${Aa}: Complete.`)})}function Ra(r,e,t){if(r instanceof Float32Array)return r.slice();const s=new Float32Array(r);if(!t)return s;for(let n=0;n<s.length;n++)s[n]=Q.decodeNormalizedInt(s[n],e);return s}function Sa(r,e,t){if(e===W.ComponentType.FLOAT)return r.slice();const s=ut[e],n=new s(r.length);for(let o=0;o<n.length;o++)n[o]=t?Q.encodeNormalizedInt(r[o],e):r[o];return n}const{POINTS:g_,LINES:m_,LINE_STRIP:T_,LINE_LOOP:b_,TRIANGLES:E_,TRIANGLE_STRIP:A_,TRIANGLE_FAN:I_}=_e.Mode,us="sparse",Ma={ratio:1/3};function Kf(r=Ma){const t=Xe(Ma,r).ratio;if(t<0||t>1)throw new Error(`${us}: Ratio must be between 0 and 1.`);return Ke(us,s=>{const n=s.getRoot(),o=s.getLogger();let i=0;for(const a of n.listAccessors()){const c=a.getCount(),f=Array(a.getElementSize()).fill(0),u=Array(a.getElementSize()).fill(0);let l=0;for(let g=0;g<c&&(a.getElement(g,u),Q.eq(u,f,0)||l++,!(l/c>=t));g++);const _=l/c<t;_!==a.getSparse()&&(a.setSparse(_),i++)}o.debug(`${us}: Updated ${i} accessors.`),o.debug(`${us}: Complete.`)})}const Xf=["jpeg","png","webp","avif"];var bs;(function(r){r.LANCZOS3="lanczos3",r.LANCZOS2="lanczos2"})(bs||(bs={}));const Yf={resizeFilter:bs.LANCZOS3,pattern:void 0,formats:void 0,slots:void 0,quality:void 0,effort:void 0,lossless:!1,nearLossless:!1,limitInputPixels:!0};async function Qf(r,e){const t=Wt({},Yf,e),s=t.encoder,n=r.getURI(),o=e_(r),i=t.targetFormat||o,a=r.getMimeType(),c=`image/${i}`,f=r.getImage(),u=s?await Jf(f,a,c,t):await Zf(f,a,c,t),l=f.byteLength,_=u.byteLength;if(!(a===c&&_>=l&&!t.resize))if(a===c)r.setImage(u);else{const g=n?Ct.extension(n):Ce.mimeTypeToExtension(a),b=Ce.mimeTypeToExtension(c),I=r.getURI().replace(new RegExp(`\\.${g}$`),`.${b}`);r.setImage(u).setMimeType(c).setURI(I)}}async function Jf(r,e,t,s){const n=s.encoder;let o={};const i=Yc(t);switch(i){case"jpeg":o={quality:s.quality};break;case"png":o={quality:s.quality,effort:ks(s.effort,100,10)};break;case"webp":o={quality:s.quality,effort:ks(s.effort,100,6),lossless:s.lossless,nearLossless:s.nearLossless};break;case"avif":o={quality:s.quality,effort:ks(s.effort,100,9),lossless:s.lossless};break}const a=s.limitInputPixels,c=n(r,{limitInputPixels:a}).toFormat(i,o);if(s.resize){const f=Ce.getSize(r,e),u=Array.isArray(s.resize)?Uc(f,s.resize):Bc(f,s.resize);c.resize(u[0],u[1],{fit:"fill",kernel:s.resizeFilter})}return Y.toView(await c.toBuffer())}async function Zf(r,e,t,s){const n=await No(r,e);if(s.resize){const[o,i]=n.shape,a=Array.isArray(s.resize)?Uc([o,i],s.resize):Bc([o,i],s.resize),c=Ie(new Uint8Array(a[0]*a[1]*4),[...a,4]);return s.resizeFilter===bs.LANCZOS3?rl(n,c):nl(n,c),zt(c,t)}return zt(n,t)}function e_(r){return Yc(r.getMimeType())}function Yc(r){const e=r.split("/").pop();if(!e||!Xf.includes(e))throw new Error(`Unknown MIME type "${r}".`);return e}function ks(r,e,t){if(r!=null)return Math.round(r/e*t)}var ls={exports:{}};const t_={},r_=Object.freeze(Object.defineProperty({__proto__:null,default:t_},Symbol.toStringTag,{value:"Module"})),Es=Vp(r_);var n_=ls.exports,Na;function s_(){return Na||(Na=1,function(r,e){var t=t||{};t.scope={},t.arrayIteratorImpl=function(n){var o=0;return function(){return o<n.length?{done:!1,value:n[o++]}:{done:!0}}},t.arrayIterator=function(n){return{next:t.arrayIteratorImpl(n)}},t.makeIterator=function(n){var o=typeof Symbol<"u"&&Symbol.iterator&&n[Symbol.iterator];return o?o.call(n):t.arrayIterator(n)},t.ASSUME_ES5=!1,t.ASSUME_NO_NATIVE_MAP=!1,t.ASSUME_NO_NATIVE_SET=!1,t.SIMPLE_FROUND_POLYFILL=!1,t.ISOLATE_POLYFILLS=!1,t.FORCE_POLYFILL_PROMISE=!1,t.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,t.getGlobal=function(n){n=[typeof globalThis=="object"&&globalThis,n,typeof window=="object"&&window,typeof self=="object"&&self,typeof ms=="object"&&ms];for(var o=0;o<n.length;++o){var i=n[o];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")},t.global=t.getGlobal(n_),t.defineProperty=t.ASSUME_ES5||typeof Object.defineProperties=="function"?Object.defineProperty:function(n,o,i){return n==Array.prototype||n==Object.prototype||(n[o]=i.value),n},t.IS_SYMBOL_NATIVE=typeof Symbol=="function"&&typeof Symbol("x")=="symbol",t.TRUST_ES6_POLYFILLS=!t.ISOLATE_POLYFILLS||t.IS_SYMBOL_NATIVE,t.polyfills={},t.propertyToPolyfillSymbol={},t.POLYFILL_PREFIX="$jscp$",t.polyfill=function(n,o,i,a){o&&(t.ISOLATE_POLYFILLS?t.polyfillIsolated(n,o,i,a):t.polyfillUnisolated(n,o,i,a))},t.polyfillUnisolated=function(n,o,i,a){for(i=t.global,n=n.split("."),a=0;a<n.length-1;a++){var c=n[a];if(!(c in i))return;i=i[c]}n=n[n.length-1],a=i[n],o=o(a),o!=a&&o!=null&&t.defineProperty(i,n,{configurable:!0,writable:!0,value:o})},t.polyfillIsolated=function(n,o,i,a){var c=n.split(".");n=c.length===1,a=c[0],a=!n&&a in t.polyfills?t.polyfills:t.global;for(var f=0;f<c.length-1;f++){var u=c[f];if(!(u in a))return;a=a[u]}c=c[c.length-1],i=t.IS_SYMBOL_NATIVE&&i==="es6"?a[c]:null,o=o(i),o!=null&&(n?t.defineProperty(t.polyfills,c,{configurable:!0,writable:!0,value:o}):o!==i&&(t.propertyToPolyfillSymbol[c]===void 0&&(i=1e9*Math.random()>>>0,t.propertyToPolyfillSymbol[c]=t.IS_SYMBOL_NATIVE?t.global.Symbol(c):t.POLYFILL_PREFIX+i+"$"+c),t.defineProperty(a,t.propertyToPolyfillSymbol[c],{configurable:!0,writable:!0,value:o})))},t.polyfill("Promise",function(n){function o(){this.batch_=null}function i(u){return u instanceof c?u:new c(function(l,_){l(u)})}if(n&&(!(t.FORCE_POLYFILL_PROMISE||t.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&typeof t.global.PromiseRejectionEvent>"u")||!t.global.Promise||t.global.Promise.toString().indexOf("[native code]")===-1))return n;o.prototype.asyncExecute=function(u){if(this.batch_==null){this.batch_=[];var l=this;this.asyncExecuteFunction(function(){l.executeBatch_()})}this.batch_.push(u)};var a=t.global.setTimeout;o.prototype.asyncExecuteFunction=function(u){a(u,0)},o.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var u=this.batch_;this.batch_=[];for(var l=0;l<u.length;++l){var _=u[l];u[l]=null;try{_()}catch(g){this.asyncThrow_(g)}}}this.batch_=null},o.prototype.asyncThrow_=function(u){this.asyncExecuteFunction(function(){throw u})};var c=function(u){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[],this.isRejectionHandled_=!1;var l=this.createResolveAndReject_();try{u(l.resolve,l.reject)}catch(_){l.reject(_)}};c.prototype.createResolveAndReject_=function(){function u(g){return function(b){_||(_=!0,g.call(l,b))}}var l=this,_=!1;return{resolve:u(this.resolveTo_),reject:u(this.reject_)}},c.prototype.resolveTo_=function(u){if(u===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(u instanceof c)this.settleSameAsPromise_(u);else{e:switch(typeof u){case"object":var l=u!=null;break e;case"function":l=!0;break e;default:l=!1}l?this.resolveToNonPromiseObj_(u):this.fulfill_(u)}},c.prototype.resolveToNonPromiseObj_=function(u){var l=void 0;try{l=u.then}catch(_){this.reject_(_);return}typeof l=="function"?this.settleSameAsThenable_(l,u):this.fulfill_(u)},c.prototype.reject_=function(u){this.settle_(2,u)},c.prototype.fulfill_=function(u){this.settle_(1,u)},c.prototype.settle_=function(u,l){if(this.state_!=0)throw Error("Cannot settle("+u+", "+l+"): Promise already settled in state"+this.state_);this.state_=u,this.result_=l,this.state_===2&&this.scheduleUnhandledRejectionCheck_(),this.executeOnSettledCallbacks_()},c.prototype.scheduleUnhandledRejectionCheck_=function(){var u=this;a(function(){if(u.notifyUnhandledRejection_()){var l=t.global.console;typeof l<"u"&&l.error(u.result_)}},1)},c.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var u=t.global.CustomEvent,l=t.global.Event,_=t.global.dispatchEvent;return typeof _>"u"?!0:(typeof u=="function"?u=new u("unhandledrejection",{cancelable:!0}):typeof l=="function"?u=new l("unhandledrejection",{cancelable:!0}):(u=t.global.document.createEvent("CustomEvent"),u.initCustomEvent("unhandledrejection",!1,!0,u)),u.promise=this,u.reason=this.result_,_(u))},c.prototype.executeOnSettledCallbacks_=function(){if(this.onSettledCallbacks_!=null){for(var u=0;u<this.onSettledCallbacks_.length;++u)f.asyncExecute(this.onSettledCallbacks_[u]);this.onSettledCallbacks_=null}};var f=new o;return c.prototype.settleSameAsPromise_=function(u){var l=this.createResolveAndReject_();u.callWhenSettled_(l.resolve,l.reject)},c.prototype.settleSameAsThenable_=function(u,l){var _=this.createResolveAndReject_();try{u.call(l,_.resolve,_.reject)}catch(g){_.reject(g)}},c.prototype.then=function(u,l){function _(A,T){return typeof A=="function"?function(j){try{g(A(j))}catch(S){b(S)}}:T}var g,b,I=new c(function(A,T){g=A,b=T});return this.callWhenSettled_(_(u,g),_(l,b)),I},c.prototype.catch=function(u){return this.then(void 0,u)},c.prototype.callWhenSettled_=function(u,l){function _(){switch(g.state_){case 1:u(g.result_);break;case 2:l(g.result_);break;default:throw Error("Unexpected state: "+g.state_)}}var g=this;this.onSettledCallbacks_==null?f.asyncExecute(_):this.onSettledCallbacks_.push(_),this.isRejectionHandled_=!0},c.resolve=i,c.reject=function(u){return new c(function(l,_){_(u)})},c.race=function(u){return new c(function(l,_){for(var g=t.makeIterator(u),b=g.next();!b.done;b=g.next())i(b.value).callWhenSettled_(l,_)})},c.all=function(u){var l=t.makeIterator(u),_=l.next();return _.done?i([]):new c(function(g,b){function I(j){return function(S){A[j]=S,T--,T==0&&g(A)}}var A=[],T=0;do A.push(void 0),T++,i(_.value).callWhenSettled_(I(A.length-1),b),_=l.next();while(!_.done)})},c},"es6","es3"),t.owns=function(n,o){return Object.prototype.hasOwnProperty.call(n,o)},t.assign=t.TRUST_ES6_POLYFILLS&&typeof Object.assign=="function"?Object.assign:function(n,o){for(var i=1;i<arguments.length;i++){var a=arguments[i];if(a)for(var c in a)t.owns(a,c)&&(n[c]=a[c])}return n},t.polyfill("Object.assign",function(n){return n||t.assign},"es6","es3"),t.checkStringArgs=function(n,o,i){if(n==null)throw new TypeError("The 'this' value for String.prototype."+i+" must not be null or undefined");if(o instanceof RegExp)throw new TypeError("First argument to String.prototype."+i+" must not be a regular expression");return n+""},t.polyfill("String.prototype.startsWith",function(n){return n||function(o,i){var a=t.checkStringArgs(this,o,"startsWith");o+="";var c=a.length,f=o.length;i=Math.max(0,Math.min(i|0,a.length));for(var u=0;u<f&&i<c;)if(a[i++]!=o[u++])return!1;return u>=f}},"es6","es3"),t.polyfill("Array.prototype.copyWithin",function(n){function o(i){return i=Number(i),i===1/0||i===-1/0?i:i|0}return n||function(i,a,c){var f=this.length;if(i=o(i),a=o(a),c=c===void 0?f:o(c),i=0>i?Math.max(f+i,0):Math.min(i,f),a=0>a?Math.max(f+a,0):Math.min(a,f),c=0>c?Math.max(f+c,0):Math.min(c,f),i<a)for(;a<c;)a in this?this[i++]=this[a++]:(delete this[i++],a++);else for(c=Math.min(c,f+a-i),i+=c-a;c>a;)--c in this?this[--i]=this[c]:delete this[--i];return this}},"es6","es3"),t.typedArrayCopyWithin=function(n){return n||Array.prototype.copyWithin},t.polyfill("Int8Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint8Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint8ClampedArray.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Int16Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint16Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Int32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Float32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Float64Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5");var s=function(){var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(o){function i(y){return d.locateFile?d.locateFile(y,ge):ge+y}function a(){var y=Ve.buffer;d.HEAP8=Ne=new Int8Array(y),d.HEAP16=Ye=new Int16Array(y),d.HEAP32=ve=new Int32Array(y),d.HEAPU8=ft=new Uint8Array(y),d.HEAPU16=new Uint16Array(y),d.HEAPU32=we=new Uint32Array(y),d.HEAPF32=Lt=new Float32Array(y),d.HEAPF64=new Float64Array(y)}function c(y){throw d.onAbort&&d.onAbort(y),y="Aborted("+y+")",le(y),Jt=!0,y=new WebAssembly.RuntimeError(y+". Build with -sASSERTIONS for more info."),oe(y),y}function f(y){try{if(y==ye&&ze)return new Uint8Array(ze);if(ue)return ue(y);throw"both async and sync fetching of the wasm failed"}catch(m){c(m)}}function u(){if(!ze&&(p||Se)){if(typeof fetch=="function"&&!ye.startsWith("file://"))return fetch(ye,{credentials:"same-origin"}).then(function(y){if(!y.ok)throw"failed to load wasm binary file at '"+ye+"'";return y.arrayBuffer()}).catch(function(){return f(ye)});if(me)return new Promise(function(y,m){me(ye,function(R){y(new Uint8Array(R))},m)})}return Promise.resolve().then(function(){return f(ye)})}function l(y){for(;0<y.length;)y.shift()(d)}function _(y){this.excPtr=y,this.ptr=y-24,this.set_type=function(m){we[this.ptr+4>>2]=m},this.get_type=function(){return we[this.ptr+4>>2]},this.set_destructor=function(m){we[this.ptr+8>>2]=m},this.get_destructor=function(){return we[this.ptr+8>>2]},this.set_refcount=function(m){ve[this.ptr>>2]=m},this.set_caught=function(m){Ne[this.ptr+12>>0]=m?1:0},this.get_caught=function(){return Ne[this.ptr+12>>0]!=0},this.set_rethrown=function(m){Ne[this.ptr+13>>0]=m?1:0},this.get_rethrown=function(){return Ne[this.ptr+13>>0]!=0},this.init=function(m,R){this.set_adjusted_ptr(0),this.set_type(m),this.set_destructor(R),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){ve[this.ptr>>2]+=1},this.release_ref=function(){var m=ve[this.ptr>>2];return ve[this.ptr>>2]=m-1,m===1},this.set_adjusted_ptr=function(m){we[this.ptr+16>>2]=m},this.get_adjusted_ptr=function(){return we[this.ptr+16>>2]},this.get_exception_ptr=function(){if(Un(this.get_type()))return we[this.excPtr>>2];var m=this.get_adjusted_ptr();return m!==0?m:this.excPtr}}function g(){function y(){if(!dt&&(dt=!0,d.calledRun=!0,!Jt)){if(tt=!0,l(Oe),te(d),d.onRuntimeInitialized&&d.onRuntimeInitialized(),d.postRun)for(typeof d.postRun=="function"&&(d.postRun=[d.postRun]);d.postRun.length;)_t.unshift(d.postRun.shift());l(_t)}}if(!(0<Te)){if(d.preRun)for(typeof d.preRun=="function"&&(d.preRun=[d.preRun]);d.preRun.length;)Zt.unshift(d.preRun.shift());l(Zt),0<Te||(d.setStatus?(d.setStatus("Running..."),setTimeout(function(){setTimeout(function(){d.setStatus("")},1),y()},1)):y())}}function b(){}function I(y){return(y||b).__cache__}function A(y,m){var R=I(m),O=R[y];return O||(O=Object.create((m||b).prototype),O.ptr=y,R[y]=O)}function T(y){if(typeof y=="string"){for(var m=0,R=0;R<y.length;++R){var O=y.charCodeAt(R);127>=O?m++:2047>=O?m+=2:55296<=O&&57343>=O?(m+=4,++R):m+=3}if(m=Array(m+1),R=0,O=m.length,0<O){O=R+O-1;for(var G=0;G<y.length;++G){var K=y.charCodeAt(G);if(55296<=K&&57343>=K){var Bn=y.charCodeAt(++G);K=65536+((K&1023)<<10)|Bn&1023}if(127>=K){if(R>=O)break;m[R++]=K}else{if(2047>=K){if(R+1>=O)break;m[R++]=192|K>>6}else{if(65535>=K){if(R+2>=O)break;m[R++]=224|K>>12}else{if(R+3>=O)break;m[R++]=240|K>>18,m[R++]=128|K>>12&63}m[R++]=128|K>>6&63}m[R++]=128|K&63}}m[R]=0}return y=X.alloc(m,Ne),X.copy(m,Ne,y),y}return y}function j(y){if(typeof y=="object"){var m=X.alloc(y,Ne);return X.copy(y,Ne,m),m}return y}function S(y){if(typeof y=="object"){var m=X.alloc(y,Ye);return X.copy(y,Ye,m),m}return y}function D(y){if(typeof y=="object"){var m=X.alloc(y,ve);return X.copy(y,ve,m),m}return y}function M(y){if(typeof y=="object"){var m=X.alloc(y,Lt);return X.copy(y,Lt,m),m}return y}function P(){throw"cannot construct a VoidPtr, no constructor in IDL"}function x(){this.ptr=$e(),I(x)[this.ptr]=this}function N(){this.ptr=be(),I(N)[this.ptr]=this}function w(){this.ptr=ur(),I(w)[this.ptr]=this}function F(){this.ptr=_r(),I(F)[this.ptr]=this}function k(){this.ptr=Tr(),I(k)[this.ptr]=this}function L(){this.ptr=Er(),I(L)[this.ptr]=this}function B(){this.ptr=Rr(),I(B)[this.ptr]=this}function U(){this.ptr=Or(),I(U)[this.ptr]=this}function V(){this.ptr=zr(),I(V)[this.ptr]=this}function $(){this.ptr=on(),I($)[this.ptr]=this}function q(y){y&&typeof y=="object"&&(y=y.ptr),this.ptr=gn(y),I(q)[this.ptr]=this}o=o===void 0?{}:o;var d=typeof o<"u"?o:{},te,oe;d.ready=new Promise(function(y,m){te=y,oe=m});var ae=!1,Z=!1;d.onRuntimeInitialized=function(){ae=!0,Z&&typeof d.onModuleLoaded=="function"&&d.onModuleLoaded(d)},d.onModuleParsed=function(){Z=!0,ae&&typeof d.onModuleLoaded=="function"&&d.onModuleLoaded(d)},d.isVersionSupported=function(y){return typeof y!="string"?!1:(y=y.split("."),2>y.length||3<y.length?!1:y[0]==1&&0<=y[1]&&5>=y[1]?!0:!(y[0]!=0||10<y[1]))};var H=Object.assign({},d),p=typeof window=="object",Se=typeof importScripts=="function",Me=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",ge="";if(Me){var pt=Es,et=Es;ge=Se?et.dirname(ge)+"/":__dirname+"/";var lt=function(y,m){return y=y.startsWith("file://")?new URL(y):et.normalize(y),pt.readFileSync(y,m?void 0:"utf8")},ue=function(y){return y=lt(y,!0),y.buffer||(y=new Uint8Array(y)),y},me=function(y,m,R){y=y.startsWith("file://")?new URL(y):et.normalize(y),pt.readFile(y,function(O,G){O?R(O):m(G.buffer)})};1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),d.inspect=function(){return"[Emscripten Module object]"}}else(p||Se)&&(Se?ge=self.location.href:typeof document<"u"&&document.currentScript&&(ge=document.currentScript.src),n&&(ge=n),ge=ge.indexOf("blob:")!==0?ge.substr(0,ge.replace(/[?#].*/,"").lastIndexOf("/")+1):"",lt=function(y){var m=new XMLHttpRequest;return m.open("GET",y,!1),m.send(null),m.responseText},Se&&(ue=function(y){var m=new XMLHttpRequest;return m.open("GET",y,!1),m.responseType="arraybuffer",m.send(null),new Uint8Array(m.response)}),me=function(y,m,R){var O=new XMLHttpRequest;O.open("GET",y,!0),O.responseType="arraybuffer",O.onload=function(){O.status==200||O.status==0&&O.response?m(O.response):R()},O.onerror=R,O.send(null)});d.print||console.log.bind(console);var le=d.printErr||console.warn.bind(console);Object.assign(d,H),H=null;var ze;d.wasmBinary&&(ze=d.wasmBinary),typeof WebAssembly!="object"&&c("no native wasm support detected");var Ve,Jt=!1,Ne,ft,Ye,ve,we,Lt,Zt=[],Oe=[],_t=[],tt=!1,Te=0,rt=null,ye="draco_encoder.wasm";ye.startsWith("data:application/octet-stream;base64,")||(ye=i(ye));var Jn={b:function(y,m,R){throw new _(y).init(m,R),y},a:function(){c("")},d:function(y,m,R){ft.copyWithin(y,m,m+R)},c:function(y){var m=ft.length;if(y>>>=0,2147483648<y)return!1;for(var R=1;4>=R;R*=2){var O=m*(1+.2/R);O=Math.min(O,y+100663296);var G=Math;O=Math.max(y,O),G=G.min.call(G,2147483648,O+(65536-O%65536)%65536);e:{O=Ve.buffer;try{Ve.grow(G-O.byteLength+65535>>>16),a();var K=1;break e}catch{}K=void 0}if(K)return!0}return!1}};(function(){function y(G,K){d.asm=G.exports,Ve=d.asm.e,a(),Oe.unshift(d.asm.f),Te--,d.monitorRunDependencies&&d.monitorRunDependencies(Te),Te==0&&rt&&(G=rt,rt=null,G())}function m(G){y(G.instance)}function R(G){return u().then(function(K){return WebAssembly.instantiate(K,O)}).then(function(K){return K}).then(G,function(K){le("failed to asynchronously prepare wasm: "+K),c(K)})}var O={a:Jn};if(Te++,d.monitorRunDependencies&&d.monitorRunDependencies(Te),d.instantiateWasm)try{return d.instantiateWasm(O,y)}catch(G){le("Module.instantiateWasm callback failed with error: "+G),oe(G)}return function(){return ze||typeof WebAssembly.instantiateStreaming!="function"||ye.startsWith("data:application/octet-stream;base64,")||ye.startsWith("file://")||Me||typeof fetch!="function"?R(m):fetch(ye,{credentials:"same-origin"}).then(function(G){return WebAssembly.instantiateStreaming(G,O).then(m,function(K){return le("wasm streaming compile failed: "+K),le("falling back to ArrayBuffer instantiation"),R(m)})})}().catch(oe),{}})();var er=d._emscripten_bind_VoidPtr___destroy___0=function(){return(er=d._emscripten_bind_VoidPtr___destroy___0=d.asm.h).apply(null,arguments)},$e=d._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return($e=d._emscripten_bind_GeometryAttribute_GeometryAttribute_0=d.asm.i).apply(null,arguments)},nt=d._emscripten_bind_GeometryAttribute___destroy___0=function(){return(nt=d._emscripten_bind_GeometryAttribute___destroy___0=d.asm.j).apply(null,arguments)},be=d._emscripten_bind_PointAttribute_PointAttribute_0=function(){return(be=d._emscripten_bind_PointAttribute_PointAttribute_0=d.asm.k).apply(null,arguments)},Zn=d._emscripten_bind_PointAttribute_size_0=function(){return(Zn=d._emscripten_bind_PointAttribute_size_0=d.asm.l).apply(null,arguments)},tr=d._emscripten_bind_PointAttribute_attribute_type_0=function(){return(tr=d._emscripten_bind_PointAttribute_attribute_type_0=d.asm.m).apply(null,arguments)},rr=d._emscripten_bind_PointAttribute_data_type_0=function(){return(rr=d._emscripten_bind_PointAttribute_data_type_0=d.asm.n).apply(null,arguments)},nr=d._emscripten_bind_PointAttribute_num_components_0=function(){return(nr=d._emscripten_bind_PointAttribute_num_components_0=d.asm.o).apply(null,arguments)},sr=d._emscripten_bind_PointAttribute_normalized_0=function(){return(sr=d._emscripten_bind_PointAttribute_normalized_0=d.asm.p).apply(null,arguments)},or=d._emscripten_bind_PointAttribute_byte_stride_0=function(){return(or=d._emscripten_bind_PointAttribute_byte_stride_0=d.asm.q).apply(null,arguments)},ir=d._emscripten_bind_PointAttribute_byte_offset_0=function(){return(ir=d._emscripten_bind_PointAttribute_byte_offset_0=d.asm.r).apply(null,arguments)},ar=d._emscripten_bind_PointAttribute_unique_id_0=function(){return(ar=d._emscripten_bind_PointAttribute_unique_id_0=d.asm.s).apply(null,arguments)},cr=d._emscripten_bind_PointAttribute___destroy___0=function(){return(cr=d._emscripten_bind_PointAttribute___destroy___0=d.asm.t).apply(null,arguments)},ur=d._emscripten_bind_PointCloud_PointCloud_0=function(){return(ur=d._emscripten_bind_PointCloud_PointCloud_0=d.asm.u).apply(null,arguments)},pr=d._emscripten_bind_PointCloud_num_attributes_0=function(){return(pr=d._emscripten_bind_PointCloud_num_attributes_0=d.asm.v).apply(null,arguments)},lr=d._emscripten_bind_PointCloud_num_points_0=function(){return(lr=d._emscripten_bind_PointCloud_num_points_0=d.asm.w).apply(null,arguments)},fr=d._emscripten_bind_PointCloud___destroy___0=function(){return(fr=d._emscripten_bind_PointCloud___destroy___0=d.asm.x).apply(null,arguments)},_r=d._emscripten_bind_Mesh_Mesh_0=function(){return(_r=d._emscripten_bind_Mesh_Mesh_0=d.asm.y).apply(null,arguments)},dr=d._emscripten_bind_Mesh_num_faces_0=function(){return(dr=d._emscripten_bind_Mesh_num_faces_0=d.asm.z).apply(null,arguments)},hr=d._emscripten_bind_Mesh_num_attributes_0=function(){return(hr=d._emscripten_bind_Mesh_num_attributes_0=d.asm.A).apply(null,arguments)},yr=d._emscripten_bind_Mesh_num_points_0=function(){return(yr=d._emscripten_bind_Mesh_num_points_0=d.asm.B).apply(null,arguments)},gr=d._emscripten_bind_Mesh_set_num_points_1=function(){return(gr=d._emscripten_bind_Mesh_set_num_points_1=d.asm.C).apply(null,arguments)},mr=d._emscripten_bind_Mesh___destroy___0=function(){return(mr=d._emscripten_bind_Mesh___destroy___0=d.asm.D).apply(null,arguments)},Tr=d._emscripten_bind_Metadata_Metadata_0=function(){return(Tr=d._emscripten_bind_Metadata_Metadata_0=d.asm.E).apply(null,arguments)},br=d._emscripten_bind_Metadata___destroy___0=function(){return(br=d._emscripten_bind_Metadata___destroy___0=d.asm.F).apply(null,arguments)},Er=d._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return(Er=d._emscripten_bind_DracoInt8Array_DracoInt8Array_0=d.asm.G).apply(null,arguments)},Ar=d._emscripten_bind_DracoInt8Array_GetValue_1=function(){return(Ar=d._emscripten_bind_DracoInt8Array_GetValue_1=d.asm.H).apply(null,arguments)},Ir=d._emscripten_bind_DracoInt8Array_size_0=function(){return(Ir=d._emscripten_bind_DracoInt8Array_size_0=d.asm.I).apply(null,arguments)},xr=d._emscripten_bind_DracoInt8Array___destroy___0=function(){return(xr=d._emscripten_bind_DracoInt8Array___destroy___0=d.asm.J).apply(null,arguments)},Rr=d._emscripten_bind_MetadataBuilder_MetadataBuilder_0=function(){return(Rr=d._emscripten_bind_MetadataBuilder_MetadataBuilder_0=d.asm.K).apply(null,arguments)},Sr=d._emscripten_bind_MetadataBuilder_AddStringEntry_3=function(){return(Sr=d._emscripten_bind_MetadataBuilder_AddStringEntry_3=d.asm.L).apply(null,arguments)},Mr=d._emscripten_bind_MetadataBuilder_AddIntEntry_3=function(){return(Mr=d._emscripten_bind_MetadataBuilder_AddIntEntry_3=d.asm.M).apply(null,arguments)},Nr=d._emscripten_bind_MetadataBuilder_AddIntEntryArray_4=function(){return(Nr=d._emscripten_bind_MetadataBuilder_AddIntEntryArray_4=d.asm.N).apply(null,arguments)},vr=d._emscripten_bind_MetadataBuilder_AddDoubleEntry_3=function(){return(vr=d._emscripten_bind_MetadataBuilder_AddDoubleEntry_3=d.asm.O).apply(null,arguments)},wr=d._emscripten_bind_MetadataBuilder___destroy___0=function(){return(wr=d._emscripten_bind_MetadataBuilder___destroy___0=d.asm.P).apply(null,arguments)},Or=d._emscripten_bind_PointCloudBuilder_PointCloudBuilder_0=function(){return(Or=d._emscripten_bind_PointCloudBuilder_PointCloudBuilder_0=d.asm.Q).apply(null,arguments)},Cr=d._emscripten_bind_PointCloudBuilder_AddFloatAttribute_5=function(){return(Cr=d._emscripten_bind_PointCloudBuilder_AddFloatAttribute_5=d.asm.R).apply(null,arguments)},Dr=d._emscripten_bind_PointCloudBuilder_AddInt8Attribute_5=function(){return(Dr=d._emscripten_bind_PointCloudBuilder_AddInt8Attribute_5=d.asm.S).apply(null,arguments)},jr=d._emscripten_bind_PointCloudBuilder_AddUInt8Attribute_5=function(){return(jr=d._emscripten_bind_PointCloudBuilder_AddUInt8Attribute_5=d.asm.T).apply(null,arguments)},Pr=d._emscripten_bind_PointCloudBuilder_AddInt16Attribute_5=function(){return(Pr=d._emscripten_bind_PointCloudBuilder_AddInt16Attribute_5=d.asm.U).apply(null,arguments)},Fr=d._emscripten_bind_PointCloudBuilder_AddUInt16Attribute_5=function(){return(Fr=d._emscripten_bind_PointCloudBuilder_AddUInt16Attribute_5=d.asm.V).apply(null,arguments)},Lr=d._emscripten_bind_PointCloudBuilder_AddInt32Attribute_5=function(){return(Lr=d._emscripten_bind_PointCloudBuilder_AddInt32Attribute_5=d.asm.W).apply(null,arguments)},Ur=d._emscripten_bind_PointCloudBuilder_AddUInt32Attribute_5=function(){return(Ur=d._emscripten_bind_PointCloudBuilder_AddUInt32Attribute_5=d.asm.X).apply(null,arguments)},Br=d._emscripten_bind_PointCloudBuilder_AddMetadata_2=function(){return(Br=d._emscripten_bind_PointCloudBuilder_AddMetadata_2=d.asm.Y).apply(null,arguments)},Gr=d._emscripten_bind_PointCloudBuilder_SetMetadataForAttribute_3=function(){return(Gr=d._emscripten_bind_PointCloudBuilder_SetMetadataForAttribute_3=d.asm.Z).apply(null,arguments)},Vr=d._emscripten_bind_PointCloudBuilder_SetNormalizedFlagForAttribute_3=function(){return(Vr=d._emscripten_bind_PointCloudBuilder_SetNormalizedFlagForAttribute_3=d.asm._).apply(null,arguments)},kr=d._emscripten_bind_PointCloudBuilder___destroy___0=function(){return(kr=d._emscripten_bind_PointCloudBuilder___destroy___0=d.asm.$).apply(null,arguments)},zr=d._emscripten_bind_MeshBuilder_MeshBuilder_0=function(){return(zr=d._emscripten_bind_MeshBuilder_MeshBuilder_0=d.asm.aa).apply(null,arguments)},$r=d._emscripten_bind_MeshBuilder_AddFacesToMesh_3=function(){return($r=d._emscripten_bind_MeshBuilder_AddFacesToMesh_3=d.asm.ba).apply(null,arguments)},Hr=d._emscripten_bind_MeshBuilder_AddFloatAttributeToMesh_5=function(){return(Hr=d._emscripten_bind_MeshBuilder_AddFloatAttributeToMesh_5=d.asm.ca).apply(null,arguments)},qr=d._emscripten_bind_MeshBuilder_AddInt32AttributeToMesh_5=function(){return(qr=d._emscripten_bind_MeshBuilder_AddInt32AttributeToMesh_5=d.asm.da).apply(null,arguments)},Wr=d._emscripten_bind_MeshBuilder_AddMetadataToMesh_2=function(){return(Wr=d._emscripten_bind_MeshBuilder_AddMetadataToMesh_2=d.asm.ea).apply(null,arguments)},Kr=d._emscripten_bind_MeshBuilder_AddFloatAttribute_5=function(){return(Kr=d._emscripten_bind_MeshBuilder_AddFloatAttribute_5=d.asm.fa).apply(null,arguments)},Xr=d._emscripten_bind_MeshBuilder_AddInt8Attribute_5=function(){return(Xr=d._emscripten_bind_MeshBuilder_AddInt8Attribute_5=d.asm.ga).apply(null,arguments)},Yr=d._emscripten_bind_MeshBuilder_AddUInt8Attribute_5=function(){return(Yr=d._emscripten_bind_MeshBuilder_AddUInt8Attribute_5=d.asm.ha).apply(null,arguments)},Qr=d._emscripten_bind_MeshBuilder_AddInt16Attribute_5=function(){return(Qr=d._emscripten_bind_MeshBuilder_AddInt16Attribute_5=d.asm.ia).apply(null,arguments)},Jr=d._emscripten_bind_MeshBuilder_AddUInt16Attribute_5=function(){return(Jr=d._emscripten_bind_MeshBuilder_AddUInt16Attribute_5=d.asm.ja).apply(null,arguments)},Zr=d._emscripten_bind_MeshBuilder_AddInt32Attribute_5=function(){return(Zr=d._emscripten_bind_MeshBuilder_AddInt32Attribute_5=d.asm.ka).apply(null,arguments)},en=d._emscripten_bind_MeshBuilder_AddUInt32Attribute_5=function(){return(en=d._emscripten_bind_MeshBuilder_AddUInt32Attribute_5=d.asm.la).apply(null,arguments)},tn=d._emscripten_bind_MeshBuilder_AddMetadata_2=function(){return(tn=d._emscripten_bind_MeshBuilder_AddMetadata_2=d.asm.ma).apply(null,arguments)},rn=d._emscripten_bind_MeshBuilder_SetMetadataForAttribute_3=function(){return(rn=d._emscripten_bind_MeshBuilder_SetMetadataForAttribute_3=d.asm.na).apply(null,arguments)},nn=d._emscripten_bind_MeshBuilder_SetNormalizedFlagForAttribute_3=function(){return(nn=d._emscripten_bind_MeshBuilder_SetNormalizedFlagForAttribute_3=d.asm.oa).apply(null,arguments)},sn=d._emscripten_bind_MeshBuilder___destroy___0=function(){return(sn=d._emscripten_bind_MeshBuilder___destroy___0=d.asm.pa).apply(null,arguments)},on=d._emscripten_bind_Encoder_Encoder_0=function(){return(on=d._emscripten_bind_Encoder_Encoder_0=d.asm.qa).apply(null,arguments)},an=d._emscripten_bind_Encoder_SetEncodingMethod_1=function(){return(an=d._emscripten_bind_Encoder_SetEncodingMethod_1=d.asm.ra).apply(null,arguments)},cn=d._emscripten_bind_Encoder_SetAttributeQuantization_2=function(){return(cn=d._emscripten_bind_Encoder_SetAttributeQuantization_2=d.asm.sa).apply(null,arguments)},un=d._emscripten_bind_Encoder_SetAttributeExplicitQuantization_5=function(){return(un=d._emscripten_bind_Encoder_SetAttributeExplicitQuantization_5=d.asm.ta).apply(null,arguments)},pn=d._emscripten_bind_Encoder_SetSpeedOptions_2=function(){return(pn=d._emscripten_bind_Encoder_SetSpeedOptions_2=d.asm.ua).apply(null,arguments)},ln=d._emscripten_bind_Encoder_SetTrackEncodedProperties_1=function(){return(ln=d._emscripten_bind_Encoder_SetTrackEncodedProperties_1=d.asm.va).apply(null,arguments)},fn=d._emscripten_bind_Encoder_EncodeMeshToDracoBuffer_2=function(){return(fn=d._emscripten_bind_Encoder_EncodeMeshToDracoBuffer_2=d.asm.wa).apply(null,arguments)},_n=d._emscripten_bind_Encoder_EncodePointCloudToDracoBuffer_3=function(){return(_n=d._emscripten_bind_Encoder_EncodePointCloudToDracoBuffer_3=d.asm.xa).apply(null,arguments)},dn=d._emscripten_bind_Encoder_GetNumberOfEncodedPoints_0=function(){return(dn=d._emscripten_bind_Encoder_GetNumberOfEncodedPoints_0=d.asm.ya).apply(null,arguments)},hn=d._emscripten_bind_Encoder_GetNumberOfEncodedFaces_0=function(){return(hn=d._emscripten_bind_Encoder_GetNumberOfEncodedFaces_0=d.asm.za).apply(null,arguments)},yn=d._emscripten_bind_Encoder___destroy___0=function(){return(yn=d._emscripten_bind_Encoder___destroy___0=d.asm.Aa).apply(null,arguments)},gn=d._emscripten_bind_ExpertEncoder_ExpertEncoder_1=function(){return(gn=d._emscripten_bind_ExpertEncoder_ExpertEncoder_1=d.asm.Ba).apply(null,arguments)},mn=d._emscripten_bind_ExpertEncoder_SetEncodingMethod_1=function(){return(mn=d._emscripten_bind_ExpertEncoder_SetEncodingMethod_1=d.asm.Ca).apply(null,arguments)},Tn=d._emscripten_bind_ExpertEncoder_SetAttributeQuantization_2=function(){return(Tn=d._emscripten_bind_ExpertEncoder_SetAttributeQuantization_2=d.asm.Da).apply(null,arguments)},bn=d._emscripten_bind_ExpertEncoder_SetAttributeExplicitQuantization_5=function(){return(bn=d._emscripten_bind_ExpertEncoder_SetAttributeExplicitQuantization_5=d.asm.Ea).apply(null,arguments)},En=d._emscripten_bind_ExpertEncoder_SetSpeedOptions_2=function(){return(En=d._emscripten_bind_ExpertEncoder_SetSpeedOptions_2=d.asm.Fa).apply(null,arguments)},An=d._emscripten_bind_ExpertEncoder_SetTrackEncodedProperties_1=function(){return(An=d._emscripten_bind_ExpertEncoder_SetTrackEncodedProperties_1=d.asm.Ga).apply(null,arguments)},In=d._emscripten_bind_ExpertEncoder_EncodeToDracoBuffer_2=function(){return(In=d._emscripten_bind_ExpertEncoder_EncodeToDracoBuffer_2=d.asm.Ha).apply(null,arguments)},xn=d._emscripten_bind_ExpertEncoder_GetNumberOfEncodedPoints_0=function(){return(xn=d._emscripten_bind_ExpertEncoder_GetNumberOfEncodedPoints_0=d.asm.Ia).apply(null,arguments)},Rn=d._emscripten_bind_ExpertEncoder_GetNumberOfEncodedFaces_0=function(){return(Rn=d._emscripten_bind_ExpertEncoder_GetNumberOfEncodedFaces_0=d.asm.Ja).apply(null,arguments)},Sn=d._emscripten_bind_ExpertEncoder___destroy___0=function(){return(Sn=d._emscripten_bind_ExpertEncoder___destroy___0=d.asm.Ka).apply(null,arguments)},Mn=d._emscripten_enum_draco_GeometryAttribute_Type_INVALID=function(){return(Mn=d._emscripten_enum_draco_GeometryAttribute_Type_INVALID=d.asm.La).apply(null,arguments)},Nn=d._emscripten_enum_draco_GeometryAttribute_Type_POSITION=function(){return(Nn=d._emscripten_enum_draco_GeometryAttribute_Type_POSITION=d.asm.Ma).apply(null,arguments)},vn=d._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return(vn=d._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=d.asm.Na).apply(null,arguments)},wn=d._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return(wn=d._emscripten_enum_draco_GeometryAttribute_Type_COLOR=d.asm.Oa).apply(null,arguments)},On=d._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return(On=d._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=d.asm.Pa).apply(null,arguments)},Cn=d._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return(Cn=d._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=d.asm.Qa).apply(null,arguments)},Dn=d._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return(Dn=d._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=d.asm.Ra).apply(null,arguments)},jn=d._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return(jn=d._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=d.asm.Sa).apply(null,arguments)},Pn=d._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return(Pn=d._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=d.asm.Ta).apply(null,arguments)},Fn=d._emscripten_enum_draco_MeshEncoderMethod_MESH_SEQUENTIAL_ENCODING=function(){return(Fn=d._emscripten_enum_draco_MeshEncoderMethod_MESH_SEQUENTIAL_ENCODING=d.asm.Ua).apply(null,arguments)},Ln=d._emscripten_enum_draco_MeshEncoderMethod_MESH_EDGEBREAKER_ENCODING=function(){return(Ln=d._emscripten_enum_draco_MeshEncoderMethod_MESH_EDGEBREAKER_ENCODING=d.asm.Va).apply(null,arguments)};d._malloc=function(){return(d._malloc=d.asm.Wa).apply(null,arguments)},d._free=function(){return(d._free=d.asm.Xa).apply(null,arguments)};var Un=function(){return(Un=d.asm.Ya).apply(null,arguments)};d.___start_em_js=19116,d.___stop_em_js=19214;var dt;if(rt=function y(){dt||g(),dt||(rt=y)},d.preInit)for(typeof d.preInit=="function"&&(d.preInit=[d.preInit]);0<d.preInit.length;)d.preInit.pop()();g(),b.prototype=Object.create(b.prototype),b.prototype.constructor=b,b.prototype.__class__=b,b.__cache__={},d.WrapperObject=b,d.getCache=I,d.wrapPointer=A,d.castObject=function(y,m){return A(y.ptr,m)},d.NULL=A(0),d.destroy=function(y){if(!y.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";y.__destroy__(),delete I(y.__class__)[y.ptr]},d.compare=function(y,m){return y.ptr===m.ptr},d.getPointer=function(y){return y.ptr},d.getClass=function(y){return y.__class__};var X={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(X.needed){for(var y=0;y<X.temps.length;y++)d._free(X.temps[y]);X.temps.length=0,d._free(X.buffer),X.buffer=0,X.size+=X.needed,X.needed=0}X.buffer||(X.size+=128,X.buffer=d._malloc(X.size),X.buffer||c(void 0)),X.pos=0},alloc:function(y,m){return X.buffer||c(void 0),y=y.length*m.BYTES_PER_ELEMENT,y=y+7&-8,X.pos+y>=X.size?(0<y||c(void 0),X.needed+=y,m=d._malloc(y),X.temps.push(m)):(m=X.buffer+X.pos,X.pos+=y),m},copy:function(y,m,R){switch(R>>>=0,m.BYTES_PER_ELEMENT){case 2:R>>>=1;break;case 4:R>>>=2;break;case 8:R>>>=3}for(var O=0;O<y.length;O++)m[R+O]=y[O]}};return P.prototype=Object.create(b.prototype),P.prototype.constructor=P,P.prototype.__class__=P,P.__cache__={},d.VoidPtr=P,P.prototype.__destroy__=P.prototype.__destroy__=function(){er(this.ptr)},x.prototype=Object.create(b.prototype),x.prototype.constructor=x,x.prototype.__class__=x,x.__cache__={},d.GeometryAttribute=x,x.prototype.__destroy__=x.prototype.__destroy__=function(){nt(this.ptr)},N.prototype=Object.create(b.prototype),N.prototype.constructor=N,N.prototype.__class__=N,N.__cache__={},d.PointAttribute=N,N.prototype.size=N.prototype.size=function(){return Zn(this.ptr)},N.prototype.attribute_type=N.prototype.attribute_type=function(){return tr(this.ptr)},N.prototype.data_type=N.prototype.data_type=function(){return rr(this.ptr)},N.prototype.num_components=N.prototype.num_components=function(){return nr(this.ptr)},N.prototype.normalized=N.prototype.normalized=function(){return!!sr(this.ptr)},N.prototype.byte_stride=N.prototype.byte_stride=function(){return or(this.ptr)},N.prototype.byte_offset=N.prototype.byte_offset=function(){return ir(this.ptr)},N.prototype.unique_id=N.prototype.unique_id=function(){return ar(this.ptr)},N.prototype.__destroy__=N.prototype.__destroy__=function(){cr(this.ptr)},w.prototype=Object.create(b.prototype),w.prototype.constructor=w,w.prototype.__class__=w,w.__cache__={},d.PointCloud=w,w.prototype.num_attributes=w.prototype.num_attributes=function(){return pr(this.ptr)},w.prototype.num_points=w.prototype.num_points=function(){return lr(this.ptr)},w.prototype.__destroy__=w.prototype.__destroy__=function(){fr(this.ptr)},F.prototype=Object.create(b.prototype),F.prototype.constructor=F,F.prototype.__class__=F,F.__cache__={},d.Mesh=F,F.prototype.num_faces=F.prototype.num_faces=function(){return dr(this.ptr)},F.prototype.num_attributes=F.prototype.num_attributes=function(){return hr(this.ptr)},F.prototype.num_points=F.prototype.num_points=function(){return yr(this.ptr)},F.prototype.set_num_points=F.prototype.set_num_points=function(y){var m=this.ptr;y&&typeof y=="object"&&(y=y.ptr),gr(m,y)},F.prototype.__destroy__=F.prototype.__destroy__=function(){mr(this.ptr)},k.prototype=Object.create(b.prototype),k.prototype.constructor=k,k.prototype.__class__=k,k.__cache__={},d.Metadata=k,k.prototype.__destroy__=k.prototype.__destroy__=function(){br(this.ptr)},L.prototype=Object.create(b.prototype),L.prototype.constructor=L,L.prototype.__class__=L,L.__cache__={},d.DracoInt8Array=L,L.prototype.GetValue=L.prototype.GetValue=function(y){var m=this.ptr;return y&&typeof y=="object"&&(y=y.ptr),Ar(m,y)},L.prototype.size=L.prototype.size=function(){return Ir(this.ptr)},L.prototype.__destroy__=L.prototype.__destroy__=function(){xr(this.ptr)},B.prototype=Object.create(b.prototype),B.prototype.constructor=B,B.prototype.__class__=B,B.__cache__={},d.MetadataBuilder=B,B.prototype.AddStringEntry=B.prototype.AddStringEntry=function(y,m,R){var O=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m=m&&typeof m=="object"?m.ptr:T(m),R=R&&typeof R=="object"?R.ptr:T(R),!!Sr(O,y,m,R)},B.prototype.AddIntEntry=B.prototype.AddIntEntry=function(y,m,R){var O=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m=m&&typeof m=="object"?m.ptr:T(m),R&&typeof R=="object"&&(R=R.ptr),!!Mr(O,y,m,R)},B.prototype.AddIntEntryArray=B.prototype.AddIntEntryArray=function(y,m,R,O){var G=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m=m&&typeof m=="object"?m.ptr:T(m),typeof R=="object"&&(R=D(R)),O&&typeof O=="object"&&(O=O.ptr),!!Nr(G,y,m,R,O)},B.prototype.AddDoubleEntry=B.prototype.AddDoubleEntry=function(y,m,R){var O=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m=m&&typeof m=="object"?m.ptr:T(m),R&&typeof R=="object"&&(R=R.ptr),!!vr(O,y,m,R)},B.prototype.__destroy__=B.prototype.__destroy__=function(){wr(this.ptr)},U.prototype=Object.create(b.prototype),U.prototype.constructor=U,U.prototype.__class__=U,U.__cache__={},d.PointCloudBuilder=U,U.prototype.AddFloatAttribute=U.prototype.AddFloatAttribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=M(G)),Cr(K,y,m,R,O,G)},U.prototype.AddInt8Attribute=U.prototype.AddInt8Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=j(G)),Dr(K,y,m,R,O,G)},U.prototype.AddUInt8Attribute=U.prototype.AddUInt8Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=j(G)),jr(K,y,m,R,O,G)},U.prototype.AddInt16Attribute=U.prototype.AddInt16Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=S(G)),Pr(K,y,m,R,O,G)},U.prototype.AddUInt16Attribute=U.prototype.AddUInt16Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=S(G)),Fr(K,y,m,R,O,G)},U.prototype.AddInt32Attribute=U.prototype.AddInt32Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=D(G)),Lr(K,y,m,R,O,G)},U.prototype.AddUInt32Attribute=U.prototype.AddUInt32Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=D(G)),Ur(K,y,m,R,O,G)},U.prototype.AddMetadata=U.prototype.AddMetadata=function(y,m){var R=this.ptr;return y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),!!Br(R,y,m)},U.prototype.SetMetadataForAttribute=U.prototype.SetMetadataForAttribute=function(y,m,R){var O=this.ptr;return y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),!!Gr(O,y,m,R)},U.prototype.SetNormalizedFlagForAttribute=U.prototype.SetNormalizedFlagForAttribute=function(y,m,R){var O=this.ptr;return y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),!!Vr(O,y,m,R)},U.prototype.__destroy__=U.prototype.__destroy__=function(){kr(this.ptr)},V.prototype=Object.create(b.prototype),V.prototype.constructor=V,V.prototype.__class__=V,V.__cache__={},d.MeshBuilder=V,V.prototype.AddFacesToMesh=V.prototype.AddFacesToMesh=function(y,m,R){var O=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),typeof R=="object"&&(R=D(R)),!!$r(O,y,m,R)},V.prototype.AddFloatAttributeToMesh=V.prototype.AddFloatAttributeToMesh=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=M(G)),Hr(K,y,m,R,O,G)},V.prototype.AddInt32AttributeToMesh=V.prototype.AddInt32AttributeToMesh=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=D(G)),qr(K,y,m,R,O,G)},V.prototype.AddMetadataToMesh=V.prototype.AddMetadataToMesh=function(y,m){var R=this.ptr;return y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),!!Wr(R,y,m)},V.prototype.AddFloatAttribute=V.prototype.AddFloatAttribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=M(G)),Kr(K,y,m,R,O,G)},V.prototype.AddInt8Attribute=V.prototype.AddInt8Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=j(G)),Xr(K,y,m,R,O,G)},V.prototype.AddUInt8Attribute=V.prototype.AddUInt8Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=j(G)),Yr(K,y,m,R,O,G)},V.prototype.AddInt16Attribute=V.prototype.AddInt16Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=S(G)),Qr(K,y,m,R,O,G)},V.prototype.AddUInt16Attribute=V.prototype.AddUInt16Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=S(G)),Jr(K,y,m,R,O,G)},V.prototype.AddInt32Attribute=V.prototype.AddInt32Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=D(G)),Zr(K,y,m,R,O,G)},V.prototype.AddUInt32Attribute=V.prototype.AddUInt32Attribute=function(y,m,R,O,G){var K=this.ptr;return X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),O&&typeof O=="object"&&(O=O.ptr),typeof G=="object"&&(G=D(G)),en(K,y,m,R,O,G)},V.prototype.AddMetadata=V.prototype.AddMetadata=function(y,m){var R=this.ptr;return y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),!!tn(R,y,m)},V.prototype.SetMetadataForAttribute=V.prototype.SetMetadataForAttribute=function(y,m,R){var O=this.ptr;return y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),!!rn(O,y,m,R)},V.prototype.SetNormalizedFlagForAttribute=V.prototype.SetNormalizedFlagForAttribute=function(y,m,R){var O=this.ptr;return y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),!!nn(O,y,m,R)},V.prototype.__destroy__=V.prototype.__destroy__=function(){sn(this.ptr)},$.prototype=Object.create(b.prototype),$.prototype.constructor=$,$.prototype.__class__=$,$.__cache__={},d.Encoder=$,$.prototype.SetEncodingMethod=$.prototype.SetEncodingMethod=function(y){var m=this.ptr;y&&typeof y=="object"&&(y=y.ptr),an(m,y)},$.prototype.SetAttributeQuantization=$.prototype.SetAttributeQuantization=function(y,m){var R=this.ptr;y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),cn(R,y,m)},$.prototype.SetAttributeExplicitQuantization=$.prototype.SetAttributeExplicitQuantization=function(y,m,R,O,G){var K=this.ptr;X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),typeof O=="object"&&(O=M(O)),G&&typeof G=="object"&&(G=G.ptr),un(K,y,m,R,O,G)},$.prototype.SetSpeedOptions=$.prototype.SetSpeedOptions=function(y,m){var R=this.ptr;y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),pn(R,y,m)},$.prototype.SetTrackEncodedProperties=$.prototype.SetTrackEncodedProperties=function(y){var m=this.ptr;y&&typeof y=="object"&&(y=y.ptr),ln(m,y)},$.prototype.EncodeMeshToDracoBuffer=$.prototype.EncodeMeshToDracoBuffer=function(y,m){var R=this.ptr;return y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),fn(R,y,m)},$.prototype.EncodePointCloudToDracoBuffer=$.prototype.EncodePointCloudToDracoBuffer=function(y,m,R){var O=this.ptr;return y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),_n(O,y,m,R)},$.prototype.GetNumberOfEncodedPoints=$.prototype.GetNumberOfEncodedPoints=function(){return dn(this.ptr)},$.prototype.GetNumberOfEncodedFaces=$.prototype.GetNumberOfEncodedFaces=function(){return hn(this.ptr)},$.prototype.__destroy__=$.prototype.__destroy__=function(){yn(this.ptr)},q.prototype=Object.create(b.prototype),q.prototype.constructor=q,q.prototype.__class__=q,q.__cache__={},d.ExpertEncoder=q,q.prototype.SetEncodingMethod=q.prototype.SetEncodingMethod=function(y){var m=this.ptr;y&&typeof y=="object"&&(y=y.ptr),mn(m,y)},q.prototype.SetAttributeQuantization=q.prototype.SetAttributeQuantization=function(y,m){var R=this.ptr;y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),Tn(R,y,m)},q.prototype.SetAttributeExplicitQuantization=q.prototype.SetAttributeExplicitQuantization=function(y,m,R,O,G){var K=this.ptr;X.prepare(),y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),R&&typeof R=="object"&&(R=R.ptr),typeof O=="object"&&(O=M(O)),G&&typeof G=="object"&&(G=G.ptr),bn(K,y,m,R,O,G)},q.prototype.SetSpeedOptions=q.prototype.SetSpeedOptions=function(y,m){var R=this.ptr;y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),En(R,y,m)},q.prototype.SetTrackEncodedProperties=q.prototype.SetTrackEncodedProperties=function(y){var m=this.ptr;y&&typeof y=="object"&&(y=y.ptr),An(m,y)},q.prototype.EncodeToDracoBuffer=q.prototype.EncodeToDracoBuffer=function(y,m){var R=this.ptr;return y&&typeof y=="object"&&(y=y.ptr),m&&typeof m=="object"&&(m=m.ptr),In(R,y,m)},q.prototype.GetNumberOfEncodedPoints=q.prototype.GetNumberOfEncodedPoints=function(){return xn(this.ptr)},q.prototype.GetNumberOfEncodedFaces=q.prototype.GetNumberOfEncodedFaces=function(){return Rn(this.ptr)},q.prototype.__destroy__=q.prototype.__destroy__=function(){Sn(this.ptr)},function(){function y(){d.INVALID=Mn(),d.POSITION=Nn(),d.NORMAL=vn(),d.COLOR=wn(),d.TEX_COORD=On(),d.GENERIC=Cn(),d.INVALID_GEOMETRY_TYPE=Dn(),d.POINT_CLOUD=jn(),d.TRIANGULAR_MESH=Pn(),d.MESH_SEQUENTIAL_ENCODING=Fn(),d.MESH_EDGEBREAKER_ENCODING=Ln()}tt?y():Oe.unshift(y)}(),typeof d.onModuleParsed=="function"&&d.onModuleParsed(),o.ready}}();r.exports=s}(ls)),ls.exports}var fs={exports:{}},o_=fs.exports,va;function i_(){return va||(va=1,function(r,e){var t=t||{};t.scope={},t.arrayIteratorImpl=function(n){var o=0;return function(){return o<n.length?{done:!1,value:n[o++]}:{done:!0}}},t.arrayIterator=function(n){return{next:t.arrayIteratorImpl(n)}},t.makeIterator=function(n){var o=typeof Symbol<"u"&&Symbol.iterator&&n[Symbol.iterator];return o?o.call(n):t.arrayIterator(n)},t.ASSUME_ES5=!1,t.ASSUME_NO_NATIVE_MAP=!1,t.ASSUME_NO_NATIVE_SET=!1,t.SIMPLE_FROUND_POLYFILL=!1,t.ISOLATE_POLYFILLS=!1,t.FORCE_POLYFILL_PROMISE=!1,t.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,t.getGlobal=function(n){n=[typeof globalThis=="object"&&globalThis,n,typeof window=="object"&&window,typeof self=="object"&&self,typeof ms=="object"&&ms];for(var o=0;o<n.length;++o){var i=n[o];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")},t.global=t.getGlobal(o_),t.defineProperty=t.ASSUME_ES5||typeof Object.defineProperties=="function"?Object.defineProperty:function(n,o,i){return n==Array.prototype||n==Object.prototype||(n[o]=i.value),n},t.IS_SYMBOL_NATIVE=typeof Symbol=="function"&&typeof Symbol("x")=="symbol",t.TRUST_ES6_POLYFILLS=!t.ISOLATE_POLYFILLS||t.IS_SYMBOL_NATIVE,t.polyfills={},t.propertyToPolyfillSymbol={},t.POLYFILL_PREFIX="$jscp$",t.polyfill=function(n,o,i,a){o&&(t.ISOLATE_POLYFILLS?t.polyfillIsolated(n,o,i,a):t.polyfillUnisolated(n,o,i,a))},t.polyfillUnisolated=function(n,o,i,a){for(i=t.global,n=n.split("."),a=0;a<n.length-1;a++){var c=n[a];if(!(c in i))return;i=i[c]}n=n[n.length-1],a=i[n],o=o(a),o!=a&&o!=null&&t.defineProperty(i,n,{configurable:!0,writable:!0,value:o})},t.polyfillIsolated=function(n,o,i,a){var c=n.split(".");n=c.length===1,a=c[0],a=!n&&a in t.polyfills?t.polyfills:t.global;for(var f=0;f<c.length-1;f++){var u=c[f];if(!(u in a))return;a=a[u]}c=c[c.length-1],i=t.IS_SYMBOL_NATIVE&&i==="es6"?a[c]:null,o=o(i),o!=null&&(n?t.defineProperty(t.polyfills,c,{configurable:!0,writable:!0,value:o}):o!==i&&(t.propertyToPolyfillSymbol[c]===void 0&&(i=1e9*Math.random()>>>0,t.propertyToPolyfillSymbol[c]=t.IS_SYMBOL_NATIVE?t.global.Symbol(c):t.POLYFILL_PREFIX+i+"$"+c),t.defineProperty(a,t.propertyToPolyfillSymbol[c],{configurable:!0,writable:!0,value:o})))},t.polyfill("Promise",function(n){function o(){this.batch_=null}function i(u){return u instanceof c?u:new c(function(l,_){l(u)})}if(n&&(!(t.FORCE_POLYFILL_PROMISE||t.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&typeof t.global.PromiseRejectionEvent>"u")||!t.global.Promise||t.global.Promise.toString().indexOf("[native code]")===-1))return n;o.prototype.asyncExecute=function(u){if(this.batch_==null){this.batch_=[];var l=this;this.asyncExecuteFunction(function(){l.executeBatch_()})}this.batch_.push(u)};var a=t.global.setTimeout;o.prototype.asyncExecuteFunction=function(u){a(u,0)},o.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var u=this.batch_;this.batch_=[];for(var l=0;l<u.length;++l){var _=u[l];u[l]=null;try{_()}catch(g){this.asyncThrow_(g)}}}this.batch_=null},o.prototype.asyncThrow_=function(u){this.asyncExecuteFunction(function(){throw u})};var c=function(u){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[],this.isRejectionHandled_=!1;var l=this.createResolveAndReject_();try{u(l.resolve,l.reject)}catch(_){l.reject(_)}};c.prototype.createResolveAndReject_=function(){function u(g){return function(b){_||(_=!0,g.call(l,b))}}var l=this,_=!1;return{resolve:u(this.resolveTo_),reject:u(this.reject_)}},c.prototype.resolveTo_=function(u){if(u===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(u instanceof c)this.settleSameAsPromise_(u);else{e:switch(typeof u){case"object":var l=u!=null;break e;case"function":l=!0;break e;default:l=!1}l?this.resolveToNonPromiseObj_(u):this.fulfill_(u)}},c.prototype.resolveToNonPromiseObj_=function(u){var l=void 0;try{l=u.then}catch(_){this.reject_(_);return}typeof l=="function"?this.settleSameAsThenable_(l,u):this.fulfill_(u)},c.prototype.reject_=function(u){this.settle_(2,u)},c.prototype.fulfill_=function(u){this.settle_(1,u)},c.prototype.settle_=function(u,l){if(this.state_!=0)throw Error("Cannot settle("+u+", "+l+"): Promise already settled in state"+this.state_);this.state_=u,this.result_=l,this.state_===2&&this.scheduleUnhandledRejectionCheck_(),this.executeOnSettledCallbacks_()},c.prototype.scheduleUnhandledRejectionCheck_=function(){var u=this;a(function(){if(u.notifyUnhandledRejection_()){var l=t.global.console;typeof l<"u"&&l.error(u.result_)}},1)},c.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var u=t.global.CustomEvent,l=t.global.Event,_=t.global.dispatchEvent;return typeof _>"u"?!0:(typeof u=="function"?u=new u("unhandledrejection",{cancelable:!0}):typeof l=="function"?u=new l("unhandledrejection",{cancelable:!0}):(u=t.global.document.createEvent("CustomEvent"),u.initCustomEvent("unhandledrejection",!1,!0,u)),u.promise=this,u.reason=this.result_,_(u))},c.prototype.executeOnSettledCallbacks_=function(){if(this.onSettledCallbacks_!=null){for(var u=0;u<this.onSettledCallbacks_.length;++u)f.asyncExecute(this.onSettledCallbacks_[u]);this.onSettledCallbacks_=null}};var f=new o;return c.prototype.settleSameAsPromise_=function(u){var l=this.createResolveAndReject_();u.callWhenSettled_(l.resolve,l.reject)},c.prototype.settleSameAsThenable_=function(u,l){var _=this.createResolveAndReject_();try{u.call(l,_.resolve,_.reject)}catch(g){_.reject(g)}},c.prototype.then=function(u,l){function _(A,T){return typeof A=="function"?function(j){try{g(A(j))}catch(S){b(S)}}:T}var g,b,I=new c(function(A,T){g=A,b=T});return this.callWhenSettled_(_(u,g),_(l,b)),I},c.prototype.catch=function(u){return this.then(void 0,u)},c.prototype.callWhenSettled_=function(u,l){function _(){switch(g.state_){case 1:u(g.result_);break;case 2:l(g.result_);break;default:throw Error("Unexpected state: "+g.state_)}}var g=this;this.onSettledCallbacks_==null?f.asyncExecute(_):this.onSettledCallbacks_.push(_),this.isRejectionHandled_=!0},c.resolve=i,c.reject=function(u){return new c(function(l,_){_(u)})},c.race=function(u){return new c(function(l,_){for(var g=t.makeIterator(u),b=g.next();!b.done;b=g.next())i(b.value).callWhenSettled_(l,_)})},c.all=function(u){var l=t.makeIterator(u),_=l.next();return _.done?i([]):new c(function(g,b){function I(j){return function(S){A[j]=S,T--,T==0&&g(A)}}var A=[],T=0;do A.push(void 0),T++,i(_.value).callWhenSettled_(I(A.length-1),b),_=l.next();while(!_.done)})},c},"es6","es3"),t.owns=function(n,o){return Object.prototype.hasOwnProperty.call(n,o)},t.assign=t.TRUST_ES6_POLYFILLS&&typeof Object.assign=="function"?Object.assign:function(n,o){for(var i=1;i<arguments.length;i++){var a=arguments[i];if(a)for(var c in a)t.owns(a,c)&&(n[c]=a[c])}return n},t.polyfill("Object.assign",function(n){return n||t.assign},"es6","es3"),t.checkStringArgs=function(n,o,i){if(n==null)throw new TypeError("The 'this' value for String.prototype."+i+" must not be null or undefined");if(o instanceof RegExp)throw new TypeError("First argument to String.prototype."+i+" must not be a regular expression");return n+""},t.polyfill("String.prototype.startsWith",function(n){return n||function(o,i){var a=t.checkStringArgs(this,o,"startsWith");o+="";var c=a.length,f=o.length;i=Math.max(0,Math.min(i|0,a.length));for(var u=0;u<f&&i<c;)if(a[i++]!=o[u++])return!1;return u>=f}},"es6","es3"),t.polyfill("Array.prototype.copyWithin",function(n){function o(i){return i=Number(i),i===1/0||i===-1/0?i:i|0}return n||function(i,a,c){var f=this.length;if(i=o(i),a=o(a),c=c===void 0?f:o(c),i=0>i?Math.max(f+i,0):Math.min(i,f),a=0>a?Math.max(f+a,0):Math.min(a,f),c=0>c?Math.max(f+c,0):Math.min(c,f),i<a)for(;a<c;)a in this?this[i++]=this[a++]:(delete this[i++],a++);else for(c=Math.min(c,f+a-i),i+=c-a;c>a;)--c in this?this[--i]=this[c]:delete this[--i];return this}},"es6","es3"),t.typedArrayCopyWithin=function(n){return n||Array.prototype.copyWithin},t.polyfill("Int8Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint8Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint8ClampedArray.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Int16Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint16Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Int32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Float32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Float64Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5");var s=function(){var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(o){function i(h){return p.locateFile?p.locateFile(h,le):le+h}function a(h,E){if(h){var v=_t,z=h+E;for(E=h;v[E]&&!(E>=z);)++E;if(16<E-h&&v.buffer&&Zt)v=Zt.decode(v.subarray(h,E));else{for(z="";h<E;){var J=v[h++];if(J&128){var ne=v[h++]&63;if((J&224)==192)z+=String.fromCharCode((J&31)<<6|ne);else{var Gn=v[h++]&63;J=(J&240)==224?(J&15)<<12|ne<<6|Gn:(J&7)<<18|ne<<12|Gn<<6|v[h++]&63,65536>J?z+=String.fromCharCode(J):(J-=65536,z+=String.fromCharCode(55296|J>>10,56320|J&1023))}}else z+=String.fromCharCode(J)}v=z}}else v="";return v}function c(){var h=we.buffer;p.HEAP8=Oe=new Int8Array(h),p.HEAP16=new Int16Array(h),p.HEAP32=tt=new Int32Array(h),p.HEAPU8=_t=new Uint8Array(h),p.HEAPU16=new Uint16Array(h),p.HEAPU32=Te=new Uint32Array(h),p.HEAPF32=new Float32Array(h),p.HEAPF64=new Float64Array(h)}function f(h){throw p.onAbort&&p.onAbort(h),h="Aborted("+h+")",Ye(h),Lt=!0,h=new WebAssembly.RuntimeError(h+". Build with -sASSERTIONS for more info."),Me(h),h}function u(h){try{if(h==be&&ve)return new Uint8Array(ve);if(Ne)return Ne(h);throw"both async and sync fetching of the wasm failed"}catch(E){f(E)}}function l(){if(!ve&&(lt||ue)){if(typeof fetch=="function"&&!be.startsWith("file://"))return fetch(be,{credentials:"same-origin"}).then(function(h){if(!h.ok)throw"failed to load wasm binary file at '"+be+"'";return h.arrayBuffer()}).catch(function(){return u(be)});if(ft)return new Promise(function(h,E){ft(be,function(v){h(new Uint8Array(v))},E)})}return Promise.resolve().then(function(){return u(be)})}function _(h){for(;0<h.length;)h.shift()(p)}function g(h){this.excPtr=h,this.ptr=h-24,this.set_type=function(E){Te[this.ptr+4>>2]=E},this.get_type=function(){return Te[this.ptr+4>>2]},this.set_destructor=function(E){Te[this.ptr+8>>2]=E},this.get_destructor=function(){return Te[this.ptr+8>>2]},this.set_refcount=function(E){tt[this.ptr>>2]=E},this.set_caught=function(E){Oe[this.ptr+12>>0]=E?1:0},this.get_caught=function(){return Oe[this.ptr+12>>0]!=0},this.set_rethrown=function(E){Oe[this.ptr+13>>0]=E?1:0},this.get_rethrown=function(){return Oe[this.ptr+13>>0]!=0},this.init=function(E,v){this.set_adjusted_ptr(0),this.set_type(E),this.set_destructor(v),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){tt[this.ptr>>2]+=1},this.release_ref=function(){var E=tt[this.ptr>>2];return tt[this.ptr>>2]=E-1,E===1},this.set_adjusted_ptr=function(E){Te[this.ptr+16>>2]=E},this.get_adjusted_ptr=function(){return Te[this.ptr+16>>2]},this.get_exception_ptr=function(){if(Ai(this.get_type()))return Te[this.excPtr>>2];var E=this.get_adjusted_ptr();return E!==0?E:this.excPtr}}function b(){function h(){if(!es&&(es=!0,p.calledRun=!0,!Lt)){if(er=!0,_(ye),Se(p),p.onRuntimeInitialized&&p.onRuntimeInitialized(),p.postRun)for(typeof p.postRun=="function"&&(p.postRun=[p.postRun]);p.postRun.length;)Jn.unshift(p.postRun.shift());_(Jn)}}if(!(0<$e)){if(p.preRun)for(typeof p.preRun=="function"&&(p.preRun=[p.preRun]);p.preRun.length;)rt.unshift(p.preRun.shift());_(rt),0<$e||(p.setStatus?(p.setStatus("Running..."),setTimeout(function(){setTimeout(function(){p.setStatus("")},1),h()},1)):h())}}function I(){}function A(h){return(h||I).__cache__}function T(h,E){var v=A(E),z=v[h];return z||(z=Object.create((E||I).prototype),z.ptr=h,v[h]=z)}function j(h){if(typeof h=="string"){for(var E=0,v=0;v<h.length;++v){var z=h.charCodeAt(v);127>=z?E++:2047>=z?E+=2:55296<=z&&57343>=z?(E+=4,++v):E+=3}if(E=Array(E+1),v=0,z=E.length,0<z){z=v+z-1;for(var J=0;J<h.length;++J){var ne=h.charCodeAt(J);if(55296<=ne&&57343>=ne){var Gn=h.charCodeAt(++J);ne=65536+((ne&1023)<<10)|Gn&1023}if(127>=ne){if(v>=z)break;E[v++]=ne}else{if(2047>=ne){if(v+1>=z)break;E[v++]=192|ne>>6}else{if(65535>=ne){if(v+2>=z)break;E[v++]=224|ne>>12}else{if(v+3>=z)break;E[v++]=240|ne>>18,E[v++]=128|ne>>12&63}E[v++]=128|ne>>6&63}E[v++]=128|ne&63}}E[v]=0}return h=ee.alloc(E,Oe),ee.copy(E,Oe,h),h}return h}function S(h){if(typeof h=="object"){var E=ee.alloc(h,Oe);return ee.copy(h,Oe,E),E}return h}function D(){throw"cannot construct a VoidPtr, no constructor in IDL"}function M(){this.ptr=rr(),A(M)[this.ptr]=this}function P(){this.ptr=or(),A(P)[this.ptr]=this}function x(){this.ptr=cr(),A(x)[this.ptr]=this}function N(){this.ptr=pr(),A(N)[this.ptr]=this}function w(){this.ptr=Er(),A(w)[this.ptr]=this}function F(){this.ptr=Mr(),A(F)[this.ptr]=this}function k(){this.ptr=Or(),A(k)[this.ptr]=this}function L(){this.ptr=Pr(),A(L)[this.ptr]=this}function B(){this.ptr=Gr(),A(B)[this.ptr]=this}function U(){throw"cannot construct a Status, no constructor in IDL"}function V(){this.ptr=qr(),A(V)[this.ptr]=this}function $(){this.ptr=Yr(),A($)[this.ptr]=this}function q(){this.ptr=en(),A(q)[this.ptr]=this}function d(){this.ptr=sn(),A(d)[this.ptr]=this}function te(){this.ptr=un(),A(te)[this.ptr]=this}function oe(){this.ptr=_n(),A(oe)[this.ptr]=this}function ae(){this.ptr=gn(),A(ae)[this.ptr]=this}function Z(){this.ptr=En(),A(Z)[this.ptr]=this}function H(){this.ptr=wn(),A(H)[this.ptr]=this}o=o===void 0?{}:o;var p=typeof o<"u"?o:{},Se,Me;p.ready=new Promise(function(h,E){Se=h,Me=E});var ge=!1,pt=!1;p.onRuntimeInitialized=function(){ge=!0,pt&&typeof p.onModuleLoaded=="function"&&p.onModuleLoaded(p)},p.onModuleParsed=function(){pt=!0,ge&&typeof p.onModuleLoaded=="function"&&p.onModuleLoaded(p)},p.isVersionSupported=function(h){return typeof h!="string"?!1:(h=h.split("."),2>h.length||3<h.length?!1:h[0]==1&&0<=h[1]&&5>=h[1]?!0:!(h[0]!=0||10<h[1]))};var et=Object.assign({},p),lt=typeof window=="object",ue=typeof importScripts=="function",me=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",le="";if(me){var ze=Es,Ve=Es;le=ue?Ve.dirname(le)+"/":__dirname+"/";var Jt=function(h,E){return h=h.startsWith("file://")?new URL(h):Ve.normalize(h),ze.readFileSync(h,E?void 0:"utf8")},Ne=function(h){return h=Jt(h,!0),h.buffer||(h=new Uint8Array(h)),h},ft=function(h,E,v){h=h.startsWith("file://")?new URL(h):Ve.normalize(h),ze.readFile(h,function(z,J){z?v(z):E(J.buffer)})};1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),p.inspect=function(){return"[Emscripten Module object]"}}else(lt||ue)&&(ue?le=self.location.href:typeof document<"u"&&document.currentScript&&(le=document.currentScript.src),n&&(le=n),le=le.indexOf("blob:")!==0?le.substr(0,le.replace(/[?#].*/,"").lastIndexOf("/")+1):"",Jt=function(h){var E=new XMLHttpRequest;return E.open("GET",h,!1),E.send(null),E.responseText},ue&&(Ne=function(h){var E=new XMLHttpRequest;return E.open("GET",h,!1),E.responseType="arraybuffer",E.send(null),new Uint8Array(E.response)}),ft=function(h,E,v){var z=new XMLHttpRequest;z.open("GET",h,!0),z.responseType="arraybuffer",z.onload=function(){z.status==200||z.status==0&&z.response?E(z.response):v()},z.onerror=v,z.send(null)});p.print||console.log.bind(console);var Ye=p.printErr||console.warn.bind(console);Object.assign(p,et),et=null;var ve;p.wasmBinary&&(ve=p.wasmBinary),typeof WebAssembly!="object"&&f("no native wasm support detected");var we,Lt=!1,Zt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Oe,_t,tt,Te,rt=[],ye=[],Jn=[],er=!1,$e=0,nt=null,be="draco_decoder_gltf.wasm";be.startsWith("data:application/octet-stream;base64,")||(be=i(be));var Zn={b:function(h,E,v){throw new g(h).init(E,v),h},a:function(){f("")},d:function(h,E,v){_t.copyWithin(h,E,E+v)},c:function(h){var E=_t.length;if(h>>>=0,2147483648<h)return!1;for(var v=1;4>=v;v*=2){var z=E*(1+.2/v);z=Math.min(z,h+100663296);var J=Math;z=Math.max(h,z),J=J.min.call(J,2147483648,z+(65536-z%65536)%65536);e:{z=we.buffer;try{we.grow(J-z.byteLength+65535>>>16),c();var ne=1;break e}catch{}ne=void 0}if(ne)return!0}return!1}};(function(){function h(J,ne){p.asm=J.exports,we=p.asm.e,c(),ye.unshift(p.asm.f),$e--,p.monitorRunDependencies&&p.monitorRunDependencies($e),$e==0&&nt&&(J=nt,nt=null,J())}function E(J){h(J.instance)}function v(J){return l().then(function(ne){return WebAssembly.instantiate(ne,z)}).then(function(ne){return ne}).then(J,function(ne){Ye("failed to asynchronously prepare wasm: "+ne),f(ne)})}var z={a:Zn};if($e++,p.monitorRunDependencies&&p.monitorRunDependencies($e),p.instantiateWasm)try{return p.instantiateWasm(z,h)}catch(J){Ye("Module.instantiateWasm callback failed with error: "+J),Me(J)}return function(){return ve||typeof WebAssembly.instantiateStreaming!="function"||be.startsWith("data:application/octet-stream;base64,")||be.startsWith("file://")||me||typeof fetch!="function"?v(E):fetch(be,{credentials:"same-origin"}).then(function(J){return WebAssembly.instantiateStreaming(J,z).then(E,function(ne){return Ye("wasm streaming compile failed: "+ne),Ye("falling back to ArrayBuffer instantiation"),v(E)})})}().catch(Me),{}})();var tr=p._emscripten_bind_VoidPtr___destroy___0=function(){return(tr=p._emscripten_bind_VoidPtr___destroy___0=p.asm.h).apply(null,arguments)},rr=p._emscripten_bind_DecoderBuffer_DecoderBuffer_0=function(){return(rr=p._emscripten_bind_DecoderBuffer_DecoderBuffer_0=p.asm.i).apply(null,arguments)},nr=p._emscripten_bind_DecoderBuffer_Init_2=function(){return(nr=p._emscripten_bind_DecoderBuffer_Init_2=p.asm.j).apply(null,arguments)},sr=p._emscripten_bind_DecoderBuffer___destroy___0=function(){return(sr=p._emscripten_bind_DecoderBuffer___destroy___0=p.asm.k).apply(null,arguments)},or=p._emscripten_bind_AttributeTransformData_AttributeTransformData_0=function(){return(or=p._emscripten_bind_AttributeTransformData_AttributeTransformData_0=p.asm.l).apply(null,arguments)},ir=p._emscripten_bind_AttributeTransformData_transform_type_0=function(){return(ir=p._emscripten_bind_AttributeTransformData_transform_type_0=p.asm.m).apply(null,arguments)},ar=p._emscripten_bind_AttributeTransformData___destroy___0=function(){return(ar=p._emscripten_bind_AttributeTransformData___destroy___0=p.asm.n).apply(null,arguments)},cr=p._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return(cr=p._emscripten_bind_GeometryAttribute_GeometryAttribute_0=p.asm.o).apply(null,arguments)},ur=p._emscripten_bind_GeometryAttribute___destroy___0=function(){return(ur=p._emscripten_bind_GeometryAttribute___destroy___0=p.asm.p).apply(null,arguments)},pr=p._emscripten_bind_PointAttribute_PointAttribute_0=function(){return(pr=p._emscripten_bind_PointAttribute_PointAttribute_0=p.asm.q).apply(null,arguments)},lr=p._emscripten_bind_PointAttribute_size_0=function(){return(lr=p._emscripten_bind_PointAttribute_size_0=p.asm.r).apply(null,arguments)},fr=p._emscripten_bind_PointAttribute_GetAttributeTransformData_0=function(){return(fr=p._emscripten_bind_PointAttribute_GetAttributeTransformData_0=p.asm.s).apply(null,arguments)},_r=p._emscripten_bind_PointAttribute_attribute_type_0=function(){return(_r=p._emscripten_bind_PointAttribute_attribute_type_0=p.asm.t).apply(null,arguments)},dr=p._emscripten_bind_PointAttribute_data_type_0=function(){return(dr=p._emscripten_bind_PointAttribute_data_type_0=p.asm.u).apply(null,arguments)},hr=p._emscripten_bind_PointAttribute_num_components_0=function(){return(hr=p._emscripten_bind_PointAttribute_num_components_0=p.asm.v).apply(null,arguments)},yr=p._emscripten_bind_PointAttribute_normalized_0=function(){return(yr=p._emscripten_bind_PointAttribute_normalized_0=p.asm.w).apply(null,arguments)},gr=p._emscripten_bind_PointAttribute_byte_stride_0=function(){return(gr=p._emscripten_bind_PointAttribute_byte_stride_0=p.asm.x).apply(null,arguments)},mr=p._emscripten_bind_PointAttribute_byte_offset_0=function(){return(mr=p._emscripten_bind_PointAttribute_byte_offset_0=p.asm.y).apply(null,arguments)},Tr=p._emscripten_bind_PointAttribute_unique_id_0=function(){return(Tr=p._emscripten_bind_PointAttribute_unique_id_0=p.asm.z).apply(null,arguments)},br=p._emscripten_bind_PointAttribute___destroy___0=function(){return(br=p._emscripten_bind_PointAttribute___destroy___0=p.asm.A).apply(null,arguments)},Er=p._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=function(){return(Er=p._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=p.asm.B).apply(null,arguments)},Ar=p._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=function(){return(Ar=p._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=p.asm.C).apply(null,arguments)},Ir=p._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=function(){return(Ir=p._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=p.asm.D).apply(null,arguments)},xr=p._emscripten_bind_AttributeQuantizationTransform_min_value_1=function(){return(xr=p._emscripten_bind_AttributeQuantizationTransform_min_value_1=p.asm.E).apply(null,arguments)},Rr=p._emscripten_bind_AttributeQuantizationTransform_range_0=function(){return(Rr=p._emscripten_bind_AttributeQuantizationTransform_range_0=p.asm.F).apply(null,arguments)},Sr=p._emscripten_bind_AttributeQuantizationTransform___destroy___0=function(){return(Sr=p._emscripten_bind_AttributeQuantizationTransform___destroy___0=p.asm.G).apply(null,arguments)},Mr=p._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=function(){return(Mr=p._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=p.asm.H).apply(null,arguments)},Nr=p._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=function(){return(Nr=p._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=p.asm.I).apply(null,arguments)},vr=p._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=function(){return(vr=p._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=p.asm.J).apply(null,arguments)},wr=p._emscripten_bind_AttributeOctahedronTransform___destroy___0=function(){return(wr=p._emscripten_bind_AttributeOctahedronTransform___destroy___0=p.asm.K).apply(null,arguments)},Or=p._emscripten_bind_PointCloud_PointCloud_0=function(){return(Or=p._emscripten_bind_PointCloud_PointCloud_0=p.asm.L).apply(null,arguments)},Cr=p._emscripten_bind_PointCloud_num_attributes_0=function(){return(Cr=p._emscripten_bind_PointCloud_num_attributes_0=p.asm.M).apply(null,arguments)},Dr=p._emscripten_bind_PointCloud_num_points_0=function(){return(Dr=p._emscripten_bind_PointCloud_num_points_0=p.asm.N).apply(null,arguments)},jr=p._emscripten_bind_PointCloud___destroy___0=function(){return(jr=p._emscripten_bind_PointCloud___destroy___0=p.asm.O).apply(null,arguments)},Pr=p._emscripten_bind_Mesh_Mesh_0=function(){return(Pr=p._emscripten_bind_Mesh_Mesh_0=p.asm.P).apply(null,arguments)},Fr=p._emscripten_bind_Mesh_num_faces_0=function(){return(Fr=p._emscripten_bind_Mesh_num_faces_0=p.asm.Q).apply(null,arguments)},Lr=p._emscripten_bind_Mesh_num_attributes_0=function(){return(Lr=p._emscripten_bind_Mesh_num_attributes_0=p.asm.R).apply(null,arguments)},Ur=p._emscripten_bind_Mesh_num_points_0=function(){return(Ur=p._emscripten_bind_Mesh_num_points_0=p.asm.S).apply(null,arguments)},Br=p._emscripten_bind_Mesh___destroy___0=function(){return(Br=p._emscripten_bind_Mesh___destroy___0=p.asm.T).apply(null,arguments)},Gr=p._emscripten_bind_Metadata_Metadata_0=function(){return(Gr=p._emscripten_bind_Metadata_Metadata_0=p.asm.U).apply(null,arguments)},Vr=p._emscripten_bind_Metadata___destroy___0=function(){return(Vr=p._emscripten_bind_Metadata___destroy___0=p.asm.V).apply(null,arguments)},kr=p._emscripten_bind_Status_code_0=function(){return(kr=p._emscripten_bind_Status_code_0=p.asm.W).apply(null,arguments)},zr=p._emscripten_bind_Status_ok_0=function(){return(zr=p._emscripten_bind_Status_ok_0=p.asm.X).apply(null,arguments)},$r=p._emscripten_bind_Status_error_msg_0=function(){return($r=p._emscripten_bind_Status_error_msg_0=p.asm.Y).apply(null,arguments)},Hr=p._emscripten_bind_Status___destroy___0=function(){return(Hr=p._emscripten_bind_Status___destroy___0=p.asm.Z).apply(null,arguments)},qr=p._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=function(){return(qr=p._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=p.asm._).apply(null,arguments)},Wr=p._emscripten_bind_DracoFloat32Array_GetValue_1=function(){return(Wr=p._emscripten_bind_DracoFloat32Array_GetValue_1=p.asm.$).apply(null,arguments)},Kr=p._emscripten_bind_DracoFloat32Array_size_0=function(){return(Kr=p._emscripten_bind_DracoFloat32Array_size_0=p.asm.aa).apply(null,arguments)},Xr=p._emscripten_bind_DracoFloat32Array___destroy___0=function(){return(Xr=p._emscripten_bind_DracoFloat32Array___destroy___0=p.asm.ba).apply(null,arguments)},Yr=p._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return(Yr=p._emscripten_bind_DracoInt8Array_DracoInt8Array_0=p.asm.ca).apply(null,arguments)},Qr=p._emscripten_bind_DracoInt8Array_GetValue_1=function(){return(Qr=p._emscripten_bind_DracoInt8Array_GetValue_1=p.asm.da).apply(null,arguments)},Jr=p._emscripten_bind_DracoInt8Array_size_0=function(){return(Jr=p._emscripten_bind_DracoInt8Array_size_0=p.asm.ea).apply(null,arguments)},Zr=p._emscripten_bind_DracoInt8Array___destroy___0=function(){return(Zr=p._emscripten_bind_DracoInt8Array___destroy___0=p.asm.fa).apply(null,arguments)},en=p._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=function(){return(en=p._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=p.asm.ga).apply(null,arguments)},tn=p._emscripten_bind_DracoUInt8Array_GetValue_1=function(){return(tn=p._emscripten_bind_DracoUInt8Array_GetValue_1=p.asm.ha).apply(null,arguments)},rn=p._emscripten_bind_DracoUInt8Array_size_0=function(){return(rn=p._emscripten_bind_DracoUInt8Array_size_0=p.asm.ia).apply(null,arguments)},nn=p._emscripten_bind_DracoUInt8Array___destroy___0=function(){return(nn=p._emscripten_bind_DracoUInt8Array___destroy___0=p.asm.ja).apply(null,arguments)},sn=p._emscripten_bind_DracoInt16Array_DracoInt16Array_0=function(){return(sn=p._emscripten_bind_DracoInt16Array_DracoInt16Array_0=p.asm.ka).apply(null,arguments)},on=p._emscripten_bind_DracoInt16Array_GetValue_1=function(){return(on=p._emscripten_bind_DracoInt16Array_GetValue_1=p.asm.la).apply(null,arguments)},an=p._emscripten_bind_DracoInt16Array_size_0=function(){return(an=p._emscripten_bind_DracoInt16Array_size_0=p.asm.ma).apply(null,arguments)},cn=p._emscripten_bind_DracoInt16Array___destroy___0=function(){return(cn=p._emscripten_bind_DracoInt16Array___destroy___0=p.asm.na).apply(null,arguments)},un=p._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=function(){return(un=p._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=p.asm.oa).apply(null,arguments)},pn=p._emscripten_bind_DracoUInt16Array_GetValue_1=function(){return(pn=p._emscripten_bind_DracoUInt16Array_GetValue_1=p.asm.pa).apply(null,arguments)},ln=p._emscripten_bind_DracoUInt16Array_size_0=function(){return(ln=p._emscripten_bind_DracoUInt16Array_size_0=p.asm.qa).apply(null,arguments)},fn=p._emscripten_bind_DracoUInt16Array___destroy___0=function(){return(fn=p._emscripten_bind_DracoUInt16Array___destroy___0=p.asm.ra).apply(null,arguments)},_n=p._emscripten_bind_DracoInt32Array_DracoInt32Array_0=function(){return(_n=p._emscripten_bind_DracoInt32Array_DracoInt32Array_0=p.asm.sa).apply(null,arguments)},dn=p._emscripten_bind_DracoInt32Array_GetValue_1=function(){return(dn=p._emscripten_bind_DracoInt32Array_GetValue_1=p.asm.ta).apply(null,arguments)},hn=p._emscripten_bind_DracoInt32Array_size_0=function(){return(hn=p._emscripten_bind_DracoInt32Array_size_0=p.asm.ua).apply(null,arguments)},yn=p._emscripten_bind_DracoInt32Array___destroy___0=function(){return(yn=p._emscripten_bind_DracoInt32Array___destroy___0=p.asm.va).apply(null,arguments)},gn=p._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=function(){return(gn=p._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=p.asm.wa).apply(null,arguments)},mn=p._emscripten_bind_DracoUInt32Array_GetValue_1=function(){return(mn=p._emscripten_bind_DracoUInt32Array_GetValue_1=p.asm.xa).apply(null,arguments)},Tn=p._emscripten_bind_DracoUInt32Array_size_0=function(){return(Tn=p._emscripten_bind_DracoUInt32Array_size_0=p.asm.ya).apply(null,arguments)},bn=p._emscripten_bind_DracoUInt32Array___destroy___0=function(){return(bn=p._emscripten_bind_DracoUInt32Array___destroy___0=p.asm.za).apply(null,arguments)},En=p._emscripten_bind_MetadataQuerier_MetadataQuerier_0=function(){return(En=p._emscripten_bind_MetadataQuerier_MetadataQuerier_0=p.asm.Aa).apply(null,arguments)},An=p._emscripten_bind_MetadataQuerier_HasEntry_2=function(){return(An=p._emscripten_bind_MetadataQuerier_HasEntry_2=p.asm.Ba).apply(null,arguments)},In=p._emscripten_bind_MetadataQuerier_GetIntEntry_2=function(){return(In=p._emscripten_bind_MetadataQuerier_GetIntEntry_2=p.asm.Ca).apply(null,arguments)},xn=p._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=function(){return(xn=p._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=p.asm.Da).apply(null,arguments)},Rn=p._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=function(){return(Rn=p._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=p.asm.Ea).apply(null,arguments)},Sn=p._emscripten_bind_MetadataQuerier_GetStringEntry_2=function(){return(Sn=p._emscripten_bind_MetadataQuerier_GetStringEntry_2=p.asm.Fa).apply(null,arguments)},Mn=p._emscripten_bind_MetadataQuerier_NumEntries_1=function(){return(Mn=p._emscripten_bind_MetadataQuerier_NumEntries_1=p.asm.Ga).apply(null,arguments)},Nn=p._emscripten_bind_MetadataQuerier_GetEntryName_2=function(){return(Nn=p._emscripten_bind_MetadataQuerier_GetEntryName_2=p.asm.Ha).apply(null,arguments)},vn=p._emscripten_bind_MetadataQuerier___destroy___0=function(){return(vn=p._emscripten_bind_MetadataQuerier___destroy___0=p.asm.Ia).apply(null,arguments)},wn=p._emscripten_bind_Decoder_Decoder_0=function(){return(wn=p._emscripten_bind_Decoder_Decoder_0=p.asm.Ja).apply(null,arguments)},On=p._emscripten_bind_Decoder_DecodeArrayToPointCloud_3=function(){return(On=p._emscripten_bind_Decoder_DecodeArrayToPointCloud_3=p.asm.Ka).apply(null,arguments)},Cn=p._emscripten_bind_Decoder_DecodeArrayToMesh_3=function(){return(Cn=p._emscripten_bind_Decoder_DecodeArrayToMesh_3=p.asm.La).apply(null,arguments)},Dn=p._emscripten_bind_Decoder_GetAttributeId_2=function(){return(Dn=p._emscripten_bind_Decoder_GetAttributeId_2=p.asm.Ma).apply(null,arguments)},jn=p._emscripten_bind_Decoder_GetAttributeIdByName_2=function(){return(jn=p._emscripten_bind_Decoder_GetAttributeIdByName_2=p.asm.Na).apply(null,arguments)},Pn=p._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=function(){return(Pn=p._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=p.asm.Oa).apply(null,arguments)},Fn=p._emscripten_bind_Decoder_GetAttribute_2=function(){return(Fn=p._emscripten_bind_Decoder_GetAttribute_2=p.asm.Pa).apply(null,arguments)},Ln=p._emscripten_bind_Decoder_GetAttributeByUniqueId_2=function(){return(Ln=p._emscripten_bind_Decoder_GetAttributeByUniqueId_2=p.asm.Qa).apply(null,arguments)},Un=p._emscripten_bind_Decoder_GetMetadata_1=function(){return(Un=p._emscripten_bind_Decoder_GetMetadata_1=p.asm.Ra).apply(null,arguments)},dt=p._emscripten_bind_Decoder_GetAttributeMetadata_2=function(){return(dt=p._emscripten_bind_Decoder_GetAttributeMetadata_2=p.asm.Sa).apply(null,arguments)},X=p._emscripten_bind_Decoder_GetFaceFromMesh_3=function(){return(X=p._emscripten_bind_Decoder_GetFaceFromMesh_3=p.asm.Ta).apply(null,arguments)},y=p._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=function(){return(y=p._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=p.asm.Ua).apply(null,arguments)},m=p._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=function(){return(m=p._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=p.asm.Va).apply(null,arguments)},R=p._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=function(){return(R=p._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=p.asm.Wa).apply(null,arguments)},O=p._emscripten_bind_Decoder_GetAttributeFloat_3=function(){return(O=p._emscripten_bind_Decoder_GetAttributeFloat_3=p.asm.Xa).apply(null,arguments)},G=p._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=function(){return(G=p._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=p.asm.Ya).apply(null,arguments)},K=p._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=function(){return(K=p._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=p.asm.Za).apply(null,arguments)},Bn=p._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=function(){return(Bn=p._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=p.asm._a).apply(null,arguments)},Do=p._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=function(){return(Do=p._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=p.asm.$a).apply(null,arguments)},jo=p._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=function(){return(jo=p._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=p.asm.ab).apply(null,arguments)},Po=p._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=function(){return(Po=p._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=p.asm.bb).apply(null,arguments)},Fo=p._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=function(){return(Fo=p._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=p.asm.cb).apply(null,arguments)},Lo=p._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=function(){return(Lo=p._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=p.asm.db).apply(null,arguments)},Uo=p._emscripten_bind_Decoder_GetAttributeDataArrayForAllPoints_5=function(){return(Uo=p._emscripten_bind_Decoder_GetAttributeDataArrayForAllPoints_5=p.asm.eb).apply(null,arguments)},Bo=p._emscripten_bind_Decoder_SkipAttributeTransform_1=function(){return(Bo=p._emscripten_bind_Decoder_SkipAttributeTransform_1=p.asm.fb).apply(null,arguments)},Go=p._emscripten_bind_Decoder_GetEncodedGeometryType_Deprecated_1=function(){return(Go=p._emscripten_bind_Decoder_GetEncodedGeometryType_Deprecated_1=p.asm.gb).apply(null,arguments)},Vo=p._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=function(){return(Vo=p._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=p.asm.hb).apply(null,arguments)},ko=p._emscripten_bind_Decoder_DecodeBufferToMesh_2=function(){return(ko=p._emscripten_bind_Decoder_DecodeBufferToMesh_2=p.asm.ib).apply(null,arguments)},zo=p._emscripten_bind_Decoder___destroy___0=function(){return(zo=p._emscripten_bind_Decoder___destroy___0=p.asm.jb).apply(null,arguments)},$o=p._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=function(){return($o=p._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=p.asm.kb).apply(null,arguments)},Ho=p._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=function(){return(Ho=p._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=p.asm.lb).apply(null,arguments)},qo=p._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=function(){return(qo=p._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=p.asm.mb).apply(null,arguments)},Wo=p._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=function(){return(Wo=p._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=p.asm.nb).apply(null,arguments)},Ko=p._emscripten_enum_draco_GeometryAttribute_Type_INVALID=function(){return(Ko=p._emscripten_enum_draco_GeometryAttribute_Type_INVALID=p.asm.ob).apply(null,arguments)},Xo=p._emscripten_enum_draco_GeometryAttribute_Type_POSITION=function(){return(Xo=p._emscripten_enum_draco_GeometryAttribute_Type_POSITION=p.asm.pb).apply(null,arguments)},Yo=p._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return(Yo=p._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=p.asm.qb).apply(null,arguments)},Qo=p._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return(Qo=p._emscripten_enum_draco_GeometryAttribute_Type_COLOR=p.asm.rb).apply(null,arguments)},Jo=p._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return(Jo=p._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=p.asm.sb).apply(null,arguments)},Zo=p._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return(Zo=p._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=p.asm.tb).apply(null,arguments)},ei=p._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return(ei=p._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=p.asm.ub).apply(null,arguments)},ti=p._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return(ti=p._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=p.asm.vb).apply(null,arguments)},ri=p._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return(ri=p._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=p.asm.wb).apply(null,arguments)},ni=p._emscripten_enum_draco_DataType_DT_INVALID=function(){return(ni=p._emscripten_enum_draco_DataType_DT_INVALID=p.asm.xb).apply(null,arguments)},si=p._emscripten_enum_draco_DataType_DT_INT8=function(){return(si=p._emscripten_enum_draco_DataType_DT_INT8=p.asm.yb).apply(null,arguments)},oi=p._emscripten_enum_draco_DataType_DT_UINT8=function(){return(oi=p._emscripten_enum_draco_DataType_DT_UINT8=p.asm.zb).apply(null,arguments)},ii=p._emscripten_enum_draco_DataType_DT_INT16=function(){return(ii=p._emscripten_enum_draco_DataType_DT_INT16=p.asm.Ab).apply(null,arguments)},ai=p._emscripten_enum_draco_DataType_DT_UINT16=function(){return(ai=p._emscripten_enum_draco_DataType_DT_UINT16=p.asm.Bb).apply(null,arguments)},ci=p._emscripten_enum_draco_DataType_DT_INT32=function(){return(ci=p._emscripten_enum_draco_DataType_DT_INT32=p.asm.Cb).apply(null,arguments)},ui=p._emscripten_enum_draco_DataType_DT_UINT32=function(){return(ui=p._emscripten_enum_draco_DataType_DT_UINT32=p.asm.Db).apply(null,arguments)},pi=p._emscripten_enum_draco_DataType_DT_INT64=function(){return(pi=p._emscripten_enum_draco_DataType_DT_INT64=p.asm.Eb).apply(null,arguments)},li=p._emscripten_enum_draco_DataType_DT_UINT64=function(){return(li=p._emscripten_enum_draco_DataType_DT_UINT64=p.asm.Fb).apply(null,arguments)},fi=p._emscripten_enum_draco_DataType_DT_FLOAT32=function(){return(fi=p._emscripten_enum_draco_DataType_DT_FLOAT32=p.asm.Gb).apply(null,arguments)},_i=p._emscripten_enum_draco_DataType_DT_FLOAT64=function(){return(_i=p._emscripten_enum_draco_DataType_DT_FLOAT64=p.asm.Hb).apply(null,arguments)},di=p._emscripten_enum_draco_DataType_DT_BOOL=function(){return(di=p._emscripten_enum_draco_DataType_DT_BOOL=p.asm.Ib).apply(null,arguments)},hi=p._emscripten_enum_draco_DataType_DT_TYPES_COUNT=function(){return(hi=p._emscripten_enum_draco_DataType_DT_TYPES_COUNT=p.asm.Jb).apply(null,arguments)},yi=p._emscripten_enum_draco_StatusCode_OK=function(){return(yi=p._emscripten_enum_draco_StatusCode_OK=p.asm.Kb).apply(null,arguments)},gi=p._emscripten_enum_draco_StatusCode_DRACO_ERROR=function(){return(gi=p._emscripten_enum_draco_StatusCode_DRACO_ERROR=p.asm.Lb).apply(null,arguments)},mi=p._emscripten_enum_draco_StatusCode_IO_ERROR=function(){return(mi=p._emscripten_enum_draco_StatusCode_IO_ERROR=p.asm.Mb).apply(null,arguments)},Ti=p._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=function(){return(Ti=p._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=p.asm.Nb).apply(null,arguments)},bi=p._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=function(){return(bi=p._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=p.asm.Ob).apply(null,arguments)},Ei=p._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=function(){return(Ei=p._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=p.asm.Pb).apply(null,arguments)};p._malloc=function(){return(p._malloc=p.asm.Qb).apply(null,arguments)},p._free=function(){return(p._free=p.asm.Rb).apply(null,arguments)};var Ai=function(){return(Ai=p.asm.Sb).apply(null,arguments)};p.___start_em_js=11660,p.___stop_em_js=11758;var es;if(nt=function h(){es||b(),es||(nt=h)},p.preInit)for(typeof p.preInit=="function"&&(p.preInit=[p.preInit]);0<p.preInit.length;)p.preInit.pop()();b(),I.prototype=Object.create(I.prototype),I.prototype.constructor=I,I.prototype.__class__=I,I.__cache__={},p.WrapperObject=I,p.getCache=A,p.wrapPointer=T,p.castObject=function(h,E){return T(h.ptr,E)},p.NULL=T(0),p.destroy=function(h){if(!h.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";h.__destroy__(),delete A(h.__class__)[h.ptr]},p.compare=function(h,E){return h.ptr===E.ptr},p.getPointer=function(h){return h.ptr},p.getClass=function(h){return h.__class__};var ee={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(ee.needed){for(var h=0;h<ee.temps.length;h++)p._free(ee.temps[h]);ee.temps.length=0,p._free(ee.buffer),ee.buffer=0,ee.size+=ee.needed,ee.needed=0}ee.buffer||(ee.size+=128,ee.buffer=p._malloc(ee.size),ee.buffer||f(void 0)),ee.pos=0},alloc:function(h,E){return ee.buffer||f(void 0),h=h.length*E.BYTES_PER_ELEMENT,h=h+7&-8,ee.pos+h>=ee.size?(0<h||f(void 0),ee.needed+=h,E=p._malloc(h),ee.temps.push(E)):(E=ee.buffer+ee.pos,ee.pos+=h),E},copy:function(h,E,v){switch(v>>>=0,E.BYTES_PER_ELEMENT){case 2:v>>>=1;break;case 4:v>>>=2;break;case 8:v>>>=3}for(var z=0;z<h.length;z++)E[v+z]=h[z]}};return D.prototype=Object.create(I.prototype),D.prototype.constructor=D,D.prototype.__class__=D,D.__cache__={},p.VoidPtr=D,D.prototype.__destroy__=D.prototype.__destroy__=function(){tr(this.ptr)},M.prototype=Object.create(I.prototype),M.prototype.constructor=M,M.prototype.__class__=M,M.__cache__={},p.DecoderBuffer=M,M.prototype.Init=M.prototype.Init=function(h,E){var v=this.ptr;ee.prepare(),typeof h=="object"&&(h=S(h)),E&&typeof E=="object"&&(E=E.ptr),nr(v,h,E)},M.prototype.__destroy__=M.prototype.__destroy__=function(){sr(this.ptr)},P.prototype=Object.create(I.prototype),P.prototype.constructor=P,P.prototype.__class__=P,P.__cache__={},p.AttributeTransformData=P,P.prototype.transform_type=P.prototype.transform_type=function(){return ir(this.ptr)},P.prototype.__destroy__=P.prototype.__destroy__=function(){ar(this.ptr)},x.prototype=Object.create(I.prototype),x.prototype.constructor=x,x.prototype.__class__=x,x.__cache__={},p.GeometryAttribute=x,x.prototype.__destroy__=x.prototype.__destroy__=function(){ur(this.ptr)},N.prototype=Object.create(I.prototype),N.prototype.constructor=N,N.prototype.__class__=N,N.__cache__={},p.PointAttribute=N,N.prototype.size=N.prototype.size=function(){return lr(this.ptr)},N.prototype.GetAttributeTransformData=N.prototype.GetAttributeTransformData=function(){return T(fr(this.ptr),P)},N.prototype.attribute_type=N.prototype.attribute_type=function(){return _r(this.ptr)},N.prototype.data_type=N.prototype.data_type=function(){return dr(this.ptr)},N.prototype.num_components=N.prototype.num_components=function(){return hr(this.ptr)},N.prototype.normalized=N.prototype.normalized=function(){return!!yr(this.ptr)},N.prototype.byte_stride=N.prototype.byte_stride=function(){return gr(this.ptr)},N.prototype.byte_offset=N.prototype.byte_offset=function(){return mr(this.ptr)},N.prototype.unique_id=N.prototype.unique_id=function(){return Tr(this.ptr)},N.prototype.__destroy__=N.prototype.__destroy__=function(){br(this.ptr)},w.prototype=Object.create(I.prototype),w.prototype.constructor=w,w.prototype.__class__=w,w.__cache__={},p.AttributeQuantizationTransform=w,w.prototype.InitFromAttribute=w.prototype.InitFromAttribute=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),!!Ar(E,h)},w.prototype.quantization_bits=w.prototype.quantization_bits=function(){return Ir(this.ptr)},w.prototype.min_value=w.prototype.min_value=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),xr(E,h)},w.prototype.range=w.prototype.range=function(){return Rr(this.ptr)},w.prototype.__destroy__=w.prototype.__destroy__=function(){Sr(this.ptr)},F.prototype=Object.create(I.prototype),F.prototype.constructor=F,F.prototype.__class__=F,F.__cache__={},p.AttributeOctahedronTransform=F,F.prototype.InitFromAttribute=F.prototype.InitFromAttribute=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),!!Nr(E,h)},F.prototype.quantization_bits=F.prototype.quantization_bits=function(){return vr(this.ptr)},F.prototype.__destroy__=F.prototype.__destroy__=function(){wr(this.ptr)},k.prototype=Object.create(I.prototype),k.prototype.constructor=k,k.prototype.__class__=k,k.__cache__={},p.PointCloud=k,k.prototype.num_attributes=k.prototype.num_attributes=function(){return Cr(this.ptr)},k.prototype.num_points=k.prototype.num_points=function(){return Dr(this.ptr)},k.prototype.__destroy__=k.prototype.__destroy__=function(){jr(this.ptr)},L.prototype=Object.create(I.prototype),L.prototype.constructor=L,L.prototype.__class__=L,L.__cache__={},p.Mesh=L,L.prototype.num_faces=L.prototype.num_faces=function(){return Fr(this.ptr)},L.prototype.num_attributes=L.prototype.num_attributes=function(){return Lr(this.ptr)},L.prototype.num_points=L.prototype.num_points=function(){return Ur(this.ptr)},L.prototype.__destroy__=L.prototype.__destroy__=function(){Br(this.ptr)},B.prototype=Object.create(I.prototype),B.prototype.constructor=B,B.prototype.__class__=B,B.__cache__={},p.Metadata=B,B.prototype.__destroy__=B.prototype.__destroy__=function(){Vr(this.ptr)},U.prototype=Object.create(I.prototype),U.prototype.constructor=U,U.prototype.__class__=U,U.__cache__={},p.Status=U,U.prototype.code=U.prototype.code=function(){return kr(this.ptr)},U.prototype.ok=U.prototype.ok=function(){return!!zr(this.ptr)},U.prototype.error_msg=U.prototype.error_msg=function(){return a($r(this.ptr))},U.prototype.__destroy__=U.prototype.__destroy__=function(){Hr(this.ptr)},V.prototype=Object.create(I.prototype),V.prototype.constructor=V,V.prototype.__class__=V,V.__cache__={},p.DracoFloat32Array=V,V.prototype.GetValue=V.prototype.GetValue=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),Wr(E,h)},V.prototype.size=V.prototype.size=function(){return Kr(this.ptr)},V.prototype.__destroy__=V.prototype.__destroy__=function(){Xr(this.ptr)},$.prototype=Object.create(I.prototype),$.prototype.constructor=$,$.prototype.__class__=$,$.__cache__={},p.DracoInt8Array=$,$.prototype.GetValue=$.prototype.GetValue=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),Qr(E,h)},$.prototype.size=$.prototype.size=function(){return Jr(this.ptr)},$.prototype.__destroy__=$.prototype.__destroy__=function(){Zr(this.ptr)},q.prototype=Object.create(I.prototype),q.prototype.constructor=q,q.prototype.__class__=q,q.__cache__={},p.DracoUInt8Array=q,q.prototype.GetValue=q.prototype.GetValue=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),tn(E,h)},q.prototype.size=q.prototype.size=function(){return rn(this.ptr)},q.prototype.__destroy__=q.prototype.__destroy__=function(){nn(this.ptr)},d.prototype=Object.create(I.prototype),d.prototype.constructor=d,d.prototype.__class__=d,d.__cache__={},p.DracoInt16Array=d,d.prototype.GetValue=d.prototype.GetValue=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),on(E,h)},d.prototype.size=d.prototype.size=function(){return an(this.ptr)},d.prototype.__destroy__=d.prototype.__destroy__=function(){cn(this.ptr)},te.prototype=Object.create(I.prototype),te.prototype.constructor=te,te.prototype.__class__=te,te.__cache__={},p.DracoUInt16Array=te,te.prototype.GetValue=te.prototype.GetValue=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),pn(E,h)},te.prototype.size=te.prototype.size=function(){return ln(this.ptr)},te.prototype.__destroy__=te.prototype.__destroy__=function(){fn(this.ptr)},oe.prototype=Object.create(I.prototype),oe.prototype.constructor=oe,oe.prototype.__class__=oe,oe.__cache__={},p.DracoInt32Array=oe,oe.prototype.GetValue=oe.prototype.GetValue=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),dn(E,h)},oe.prototype.size=oe.prototype.size=function(){return hn(this.ptr)},oe.prototype.__destroy__=oe.prototype.__destroy__=function(){yn(this.ptr)},ae.prototype=Object.create(I.prototype),ae.prototype.constructor=ae,ae.prototype.__class__=ae,ae.__cache__={},p.DracoUInt32Array=ae,ae.prototype.GetValue=ae.prototype.GetValue=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),mn(E,h)},ae.prototype.size=ae.prototype.size=function(){return Tn(this.ptr)},ae.prototype.__destroy__=ae.prototype.__destroy__=function(){bn(this.ptr)},Z.prototype=Object.create(I.prototype),Z.prototype.constructor=Z,Z.prototype.__class__=Z,Z.__cache__={},p.MetadataQuerier=Z,Z.prototype.HasEntry=Z.prototype.HasEntry=function(h,E){var v=this.ptr;return ee.prepare(),h&&typeof h=="object"&&(h=h.ptr),E=E&&typeof E=="object"?E.ptr:j(E),!!An(v,h,E)},Z.prototype.GetIntEntry=Z.prototype.GetIntEntry=function(h,E){var v=this.ptr;return ee.prepare(),h&&typeof h=="object"&&(h=h.ptr),E=E&&typeof E=="object"?E.ptr:j(E),In(v,h,E)},Z.prototype.GetIntEntryArray=Z.prototype.GetIntEntryArray=function(h,E,v){var z=this.ptr;ee.prepare(),h&&typeof h=="object"&&(h=h.ptr),E=E&&typeof E=="object"?E.ptr:j(E),v&&typeof v=="object"&&(v=v.ptr),xn(z,h,E,v)},Z.prototype.GetDoubleEntry=Z.prototype.GetDoubleEntry=function(h,E){var v=this.ptr;return ee.prepare(),h&&typeof h=="object"&&(h=h.ptr),E=E&&typeof E=="object"?E.ptr:j(E),Rn(v,h,E)},Z.prototype.GetStringEntry=Z.prototype.GetStringEntry=function(h,E){var v=this.ptr;return ee.prepare(),h&&typeof h=="object"&&(h=h.ptr),E=E&&typeof E=="object"?E.ptr:j(E),a(Sn(v,h,E))},Z.prototype.NumEntries=Z.prototype.NumEntries=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),Mn(E,h)},Z.prototype.GetEntryName=Z.prototype.GetEntryName=function(h,E){var v=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),a(Nn(v,h,E))},Z.prototype.__destroy__=Z.prototype.__destroy__=function(){vn(this.ptr)},H.prototype=Object.create(I.prototype),H.prototype.constructor=H,H.prototype.__class__=H,H.__cache__={},p.Decoder=H,H.prototype.DecodeArrayToPointCloud=H.prototype.DecodeArrayToPointCloud=function(h,E,v){var z=this.ptr;return ee.prepare(),typeof h=="object"&&(h=S(h)),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),T(On(z,h,E,v),U)},H.prototype.DecodeArrayToMesh=H.prototype.DecodeArrayToMesh=function(h,E,v){var z=this.ptr;return ee.prepare(),typeof h=="object"&&(h=S(h)),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),T(Cn(z,h,E,v),U)},H.prototype.GetAttributeId=H.prototype.GetAttributeId=function(h,E){var v=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),Dn(v,h,E)},H.prototype.GetAttributeIdByName=H.prototype.GetAttributeIdByName=function(h,E){var v=this.ptr;return ee.prepare(),h&&typeof h=="object"&&(h=h.ptr),E=E&&typeof E=="object"?E.ptr:j(E),jn(v,h,E)},H.prototype.GetAttributeIdByMetadataEntry=H.prototype.GetAttributeIdByMetadataEntry=function(h,E,v){var z=this.ptr;return ee.prepare(),h&&typeof h=="object"&&(h=h.ptr),E=E&&typeof E=="object"?E.ptr:j(E),v=v&&typeof v=="object"?v.ptr:j(v),Pn(z,h,E,v)},H.prototype.GetAttribute=H.prototype.GetAttribute=function(h,E){var v=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),T(Fn(v,h,E),N)},H.prototype.GetAttributeByUniqueId=H.prototype.GetAttributeByUniqueId=function(h,E){var v=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),T(Ln(v,h,E),N)},H.prototype.GetMetadata=H.prototype.GetMetadata=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),T(Un(E,h),B)},H.prototype.GetAttributeMetadata=H.prototype.GetAttributeMetadata=function(h,E){var v=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),T(dt(v,h,E),B)},H.prototype.GetFaceFromMesh=H.prototype.GetFaceFromMesh=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!X(z,h,E,v)},H.prototype.GetTriangleStripsFromMesh=H.prototype.GetTriangleStripsFromMesh=function(h,E){var v=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),y(v,h,E)},H.prototype.GetTrianglesUInt16Array=H.prototype.GetTrianglesUInt16Array=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!m(z,h,E,v)},H.prototype.GetTrianglesUInt32Array=H.prototype.GetTrianglesUInt32Array=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!R(z,h,E,v)},H.prototype.GetAttributeFloat=H.prototype.GetAttributeFloat=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!O(z,h,E,v)},H.prototype.GetAttributeFloatForAllPoints=H.prototype.GetAttributeFloatForAllPoints=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!G(z,h,E,v)},H.prototype.GetAttributeIntForAllPoints=H.prototype.GetAttributeIntForAllPoints=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!K(z,h,E,v)},H.prototype.GetAttributeInt8ForAllPoints=H.prototype.GetAttributeInt8ForAllPoints=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!Bn(z,h,E,v)},H.prototype.GetAttributeUInt8ForAllPoints=H.prototype.GetAttributeUInt8ForAllPoints=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!Do(z,h,E,v)},H.prototype.GetAttributeInt16ForAllPoints=H.prototype.GetAttributeInt16ForAllPoints=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!jo(z,h,E,v)},H.prototype.GetAttributeUInt16ForAllPoints=H.prototype.GetAttributeUInt16ForAllPoints=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!Po(z,h,E,v)},H.prototype.GetAttributeInt32ForAllPoints=H.prototype.GetAttributeInt32ForAllPoints=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!Fo(z,h,E,v)},H.prototype.GetAttributeUInt32ForAllPoints=H.prototype.GetAttributeUInt32ForAllPoints=function(h,E,v){var z=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),!!Lo(z,h,E,v)},H.prototype.GetAttributeDataArrayForAllPoints=H.prototype.GetAttributeDataArrayForAllPoints=function(h,E,v,z,J){var ne=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),v&&typeof v=="object"&&(v=v.ptr),z&&typeof z=="object"&&(z=z.ptr),J&&typeof J=="object"&&(J=J.ptr),!!Uo(ne,h,E,v,z,J)},H.prototype.SkipAttributeTransform=H.prototype.SkipAttributeTransform=function(h){var E=this.ptr;h&&typeof h=="object"&&(h=h.ptr),Bo(E,h)},H.prototype.GetEncodedGeometryType_Deprecated=H.prototype.GetEncodedGeometryType_Deprecated=function(h){var E=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),Go(E,h)},H.prototype.DecodeBufferToPointCloud=H.prototype.DecodeBufferToPointCloud=function(h,E){var v=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),T(Vo(v,h,E),U)},H.prototype.DecodeBufferToMesh=H.prototype.DecodeBufferToMesh=function(h,E){var v=this.ptr;return h&&typeof h=="object"&&(h=h.ptr),E&&typeof E=="object"&&(E=E.ptr),T(ko(v,h,E),U)},H.prototype.__destroy__=H.prototype.__destroy__=function(){zo(this.ptr)},function(){function h(){p.ATTRIBUTE_INVALID_TRANSFORM=$o(),p.ATTRIBUTE_NO_TRANSFORM=Ho(),p.ATTRIBUTE_QUANTIZATION_TRANSFORM=qo(),p.ATTRIBUTE_OCTAHEDRON_TRANSFORM=Wo(),p.INVALID=Ko(),p.POSITION=Xo(),p.NORMAL=Yo(),p.COLOR=Qo(),p.TEX_COORD=Jo(),p.GENERIC=Zo(),p.INVALID_GEOMETRY_TYPE=ei(),p.POINT_CLOUD=ti(),p.TRIANGULAR_MESH=ri(),p.DT_INVALID=ni(),p.DT_INT8=si(),p.DT_UINT8=oi(),p.DT_INT16=ii(),p.DT_UINT16=ai(),p.DT_INT32=ci(),p.DT_UINT32=ui(),p.DT_INT64=pi(),p.DT_UINT64=li(),p.DT_FLOAT32=fi(),p.DT_FLOAT64=_i(),p.DT_BOOL=di(),p.DT_TYPES_COUNT=hi(),p.OK=yi(),p.DRACO_ERROR=gi(),p.IO_ERROR=mi(),p.INVALID_PARAMETER=Ti(),p.UNSUPPORTED_VERSION=bi(),p.UNKNOWN_VERSION=Ei()}er?h():ye.unshift(h)}(),typeof p.onModuleParsed=="function"&&p.onModuleParsed(),p.Decoder.prototype.GetEncodedGeometryType=function(h){if(h.__class__&&h.__class__===p.DecoderBuffer)return p.Decoder.prototype.GetEncodedGeometryType_Deprecated(h);if(8>h.byteLength)return p.INVALID_GEOMETRY_TYPE;switch(h[7]){case 0:return p.POINT_CLOUD;case 1:return p.TRIANGULAR_MESH;default:return p.INVALID_GEOMETRY_TYPE}},o.ready}}();r.exports=s}(fs)),fs.exports}var zs,wa;function a_(){if(wa)return zs;wa=1;var r=s_(),e=i_();return zs={createEncoderModule:r,createDecoderModule:e},zs}var Oa=a_();const c_={maxSize:2048,hasJoin:!0,hasPalette:!0,hasFlatten:!0,hasKtx2:!0};async function x_(r,e=c_){const t=new Pu().registerExtensions(wc).registerDependencies({"draco3d.decoder":await Oa.createDecoderModule(),"draco3d.encoder":await Oa.createEncoderModule()});let{maxSize:s=2048,hasJoin:n,hasPalette:o,hasFlatten:i,hasKtx2:a}=e;const c=new Uint8Array(r),f=await t.readBinary(c);if(f.getRoot().listMaterials().some(A=>!!A.getExtension("KHR_materials_pbrSpecularGlossiness"))){await f.transform(Bf()),f.getRoot().listMaterials().forEach(T=>{const j=T.getExtension("KHR_materials_ior");j==null||j.setIOR(1.5)});const A=["KHR_materials_ior","KHR_materials_specular"];for(const T of f.getRoot().listExtensionsUsed())A.includes(T.extensionName)&&T.dispose();f.transform(Dt())}let l=[];l.push(Oo()),o&&l.push(Gf({min:5})),n&&l.push(jf()),i&&l.push(bf()),l.push(Xc()),l.push(Wf()),l.push(Dt()),l.push(Kf({ratio:.2})),l.push(Tf({method:"edgebreaker",quantizePosition:24,quantizeNormal:10,quantizeColor:8,quantizeTexcoord:12,quantizeGeneric:8,quantizationVolume:"mesh"})),await f.transform(...l);let _=!1,g=f.getRoot().listTextures();console.time("transformTexture");for(var b=0;b<g.length;b++){let A=g[b],T=A.getSize();console.time("one texture transformTexture"),T&&s&&(T[0]>s||T[1]>s)&&await Qf(A,{resize:[s,s]});let j=A.getMimeType();if(a&&j!=="image/ktx2"){let S=A.getImage(),D=A.getSize();if(D)if(D[0]*D[1]<6e6){let M=await Qc(S,j,!0);M&&(_=!0,A.setImage(M).setMimeType("image/ktx2").setURI(`${A.getName()}.ktx2`))}else console.warn("texture size limited 6 megapixels")}console.timeEnd("one texture transformTexture"),console.info("----textures compress progress:",`${b+1}/${g.length}`)}return console.timeEnd("transformTexture"),_&&f.createExtension(Mo).setRequired(!0),await t.writeBinary(f)}export{x_ as gltfOptimization,Qc as toKTX2UASTC};
