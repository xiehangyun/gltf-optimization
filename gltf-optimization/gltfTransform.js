import e from"fs";import t from"path";class r{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;return void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t),this}removeEventListener(e,t){const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}return this}dispatchEvent(e){const t=this._listeners[e.type];if(void 0!==t){const r=t.slice(0);for(let t=0,n=r.length;t<n;t++)r[t].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class n{constructor(e,t,r,n={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=r,this._attributes=n,!t.isOnGraph(r))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class s extends r{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const t=new Set;for(const r of this.listParentEdges(e))t.add(r.getParent());return Array.from(t)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const t=new Set;for(const r of this.listChildEdges(e))t.add(r.getChild());return Array.from(t)}disconnectParents(e,t){for(const r of this.listParentEdges(e))t&&!t(r.getParent())||r.dispose();return this}_createEdge(e,t,r,s){const o=new n(e,t,r,s);this._edges.add(o);const i=o.getParent();this._parentEdges.has(i)||this._parentEdges.set(i,new Set),this._parentEdges.get(i).add(o);const a=o.getChild();return this._childEdges.has(a)||this._childEdges.set(a,new Set),this._childEdges.get(a).add(o),o}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o.apply(this,arguments)}class i{constructor(e){if(this.list=[],e)for(const t of e)this.list.push(t)}add(e){this.list.push(e)}remove(e){const t=this.list.indexOf(e);t>=0&&this.list.splice(t,1)}removeChild(e){const t=[];for(const r of this.list)r.getChild()===e&&t.push(r);for(const e of t)this.remove(e);return t}listRefsByChild(e){const t=[];for(const r of this.list)r.getChild()===e&&t.push(r);return t}values(){return this.list}}class a{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const t of e)this.add(t)}add(e){const t=e.getChild();this.removeChild(t),this.set.add(e),this.map.set(t,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const t=this.map.get(e)||null;return t&&this.remove(t),t}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class c{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,t){this.map[e]=t}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const u=Symbol("attributes"),p=Symbol("immutableKeys");class l extends r{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[u]=void 0,this[p]=void 0,this.graph=e,this[p]=new Set,this[u]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const r in e){const n=e[r];if(n instanceof l){const e=this.graph._createEdge(r,this,n);this[p].add(r),t[r]=e}else t[r]=n}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach((e=>e.dispose())),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const r in this[u]){const s=this[u][r];if(s instanceof n){const n=s;n.getChild()===e&&this.setRef(r,t,n.getAttributes())}else if(s instanceof i)for(const n of s.listRefsByChild(e)){const s=n.getAttributes();this.removeRef(r,e),this.addRef(r,t,s)}else if(s instanceof a){const n=s.getRefByChild(e);if(n){const s=n.getAttributes();this.removeRef(r,e),this.addRef(r,t,s)}}else if(s instanceof c)for(const n of s.keys()){const o=s.get(n);o.getChild()===e&&this.setRefMap(r,n,t,o.getAttributes())}}return this}get(e){return this[u][e]}set(e,t){return this[u][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[u][e];return t?t.getChild():null}setRef(e,t,r){if(this[p].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const n=this[u][e];if(n&&n.dispose(),!t)return this;const s=this.graph._createEdge(e,this,t,r);return this[u][e]=s,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map((e=>e.getChild()))}addRef(e,t,r){const n=this.graph._createEdge(e,this,t,r);return this.assertRefList(e).add(n),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){const r=this.assertRefList(e);if(r instanceof i)for(const e of r.listRefsByChild(t))e.dispose();else{const e=r.getRefByChild(t);e&&e.dispose()}return this}assertRefList(e){const t=this[u][e];if(t instanceof i||t instanceof a)return t;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map((e=>e.getChild()))}getRefMap(e,t){const r=this.assertRefMap(e).get(t);return r?r.getChild():null}setRefMap(e,t,r,n){const s=this.assertRefMap(e),i=s.get(t);if(i&&i.dispose(),!r)return this;n=Object.assign(n||{},{key:t});const a=this.graph._createEdge(e,this,r,o({},n,{key:t}));return s.set(t,a),this.dispatchEvent({type:"change",attribute:e,key:t})}assertRefMap(e){const t=this[u][e];if(t instanceof c)return t;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(o({},e,{target:this})),this.graph.dispatchEvent(o({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const t=e.getName();if(this[u][t]===e)this[u][t]=null,this[p].has(t)&&e.getChild().dispose();else if(this[u][t]instanceof i)this[u][t].remove(e);else if(this[u][t]instanceof a)this[u][t].remove(e);else{if(!(this[u][t]instanceof c))return;{const r=this[u][t];for(const t of r.keys())r.get(t)===e&&r.delete(t)}}this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:t})}}const f="v4.2.0",_="@glb.bin";var d,h,y,m,g;!function(e){e.ACCESSOR="Accessor",e.ANIMATION="Animation",e.ANIMATION_CHANNEL="AnimationChannel",e.ANIMATION_SAMPLER="AnimationSampler",e.BUFFER="Buffer",e.CAMERA="Camera",e.MATERIAL="Material",e.MESH="Mesh",e.PRIMITIVE="Primitive",e.PRIMITIVE_TARGET="PrimitiveTarget",e.NODE="Node",e.ROOT="Root",e.SCENE="Scene",e.SKIN="Skin",e.TEXTURE="Texture",e.TEXTURE_INFO="TextureInfo"}(d||(d={})),function(e){e.INTERLEAVED="interleaved",e.SEPARATE="separate"}(h||(h={})),function(e){e.ARRAY_BUFFER="ARRAY_BUFFER",e.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",e.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",e.OTHER="OTHER",e.SPARSE="SPARSE"}(y||(y={})),function(e){e[e.R=4096]="R",e[e.G=256]="G",e[e.B=16]="B",e[e.A=1]="A"}(m||(m={})),function(e){e.GLTF="GLTF",e.GLB="GLB"}(g||(g={}));const b={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var T,E,A,x="undefined"!=typeof Float32Array?Float32Array:Array;function I(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function R(e,t,r){var n=t[0],s=t[1],o=t[2],i=r[3]*n+r[7]*s+r[11]*o+r[15];return i=i||1,e[0]=(r[0]*n+r[4]*s+r[8]*o+r[12])/i,e[1]=(r[1]*n+r[5]*s+r[9]*o+r[13])/i,e[2]=(r[2]*n+r[6]*s+r[10]*o+r[14])/i,e}function S(e,t){const r=N();for(const n of e.listPrimitives()){const e=n.getAttribute("POSITION"),s=n.getIndices();if(!e)continue;let o=[0,0,0],i=[0,0,0];for(let n=0,a=s?s.getCount():e.getCount();n<a;n++){const a=s?s.getScalar(n):n;o=e.getElement(a,o),i=R(i,o,t),M(i,r)}}return r}function M(e,t){for(let r=0;r<3;r++)t.min[r]=Math.min(e[r],t.min[r]),t.max[r]=Math.max(e[r],t.max[r])}function N(){return{min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]}}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),T=new x(3),x!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0);class w{static createBufferFromDataURI(e){if("undefined"==typeof Buffer){const t=atob(e.split(",")[1]),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}{const t=e.split(",")[1],r=e.indexOf("base64")>=0;return Buffer.from(t,r?"base64":"utf8")}}static encodeText(e){return(new TextEncoder).encode(e)}static decodeText(e){return(new TextDecoder).decode(e)}static concat(e){let t=0;for(const r of e)t+=r.byteLength;const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.byteLength;return r}static pad(e,t=0){const r=this.padNumber(e.byteLength);if(r===e.byteLength)return e;const n=new Uint8Array(r);if(n.set(e),0!==t)for(let s=e.byteLength;s<r;s++)n[s]=t;return n}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let r=e.byteLength;for(;r--;)if(e[r]!==t[r])return!1;return!0}static toView(e,t=0,r=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,r))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class v{static hexToFactor(e,t){e=Math.floor(e);const r=t;return r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[r,n,s]=this.convertLinearToSRGB(e,t);return 255*r<<16^255*n<<8^255*s}static convertSRGBToLinear(e,t){const r=e,n=t;for(let e=0;e<3;e++)n[e]=r[e]<.04045?.0773993808*r[e]:Math.pow(.9478672986*r[e]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const r=e,n=t;for(let e=0;e<3;e++)n[e]=r[e]<.0031308?12.92*r[e]:1.055*Math.pow(r[e],.41666)-.055;return t}}class O{match(e){return e.length>=8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return w.decodeText(e.slice(12,16))===O.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}O.PNG_FRIED_CHUNK_NAME="CgBI";class C{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let r=0;const n=this.getSize(e,t);if(!n)return null;for(;n[0]>1||n[1]>1;)r+=n[0]*n[1]*4,n[0]=Math.max(Math.floor(n[0]/2),1),n[1]=Math.max(Math.floor(n[1]/2),1);return r+=4,r}static mimeTypeToExtension(e){return"image/jpeg"===e?"jpg":e.split("/").pop()}static extensionToMimeType(e){return"jpg"===e?"image/jpeg":e?`image/${e}`:""}}function D(e,t){if(t>e.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==e.getUint8(t))throw new TypeError("Invalid JPG, marker table corrupted");return e}C.impls={"image/jpeg":new class{match(e){return e.length>=3&&255===e[0]&&216===e[1]&&255===e[2]}getSize(e){let t,r,n=new DataView(e.buffer,e.byteOffset+4);for(;n.byteLength;){if(t=n.getUint16(0,!1),D(n,t),r=n.getUint8(t+1),192===r||193===r||194===r)return[n.getUint16(t+7,!1),n.getUint16(t+5,!1)];n=new DataView(e.buffer,n.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}},"image/png":new O};class j{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return C.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function P(e){return"[object Object]"===Object.prototype.toString.call(e)}function F(e){if(!1===P(e))return!1;const t=e.constructor;if(void 0===t)return!0;const r=t.prototype;return!1!==P(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}!function(e){e[e.SILENT=4]="SILENT",e[e.ERROR=3]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=1]="INFO",e[e.DEBUG=0]="DEBUG"}(A||(A={}));class U{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=U.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=U.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=U.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=U.Verbosity.ERROR&&console.error(e)}}function L(e,t,r){var n=t[0],s=t[1],o=t[2],i=t[3],a=t[4],c=t[5],u=t[6],p=t[7],l=t[8],f=t[9],_=t[10],d=t[11],h=t[12],y=t[13],m=t[14],g=t[15],b=r[0],T=r[1],E=r[2],A=r[3];return e[0]=b*n+T*a+E*l+A*h,e[1]=b*s+T*c+E*f+A*y,e[2]=b*o+T*u+E*_+A*m,e[3]=b*i+T*p+E*d+A*g,b=r[4],T=r[5],E=r[6],A=r[7],e[4]=b*n+T*a+E*l+A*h,e[5]=b*s+T*c+E*f+A*y,e[6]=b*o+T*u+E*_+A*m,e[7]=b*i+T*p+E*d+A*g,b=r[8],T=r[9],E=r[10],A=r[11],e[8]=b*n+T*a+E*l+A*h,e[9]=b*s+T*c+E*f+A*y,e[10]=b*o+T*u+E*_+A*m,e[11]=b*i+T*p+E*d+A*g,b=r[12],T=r[13],E=r[14],A=r[15],e[12]=b*n+T*a+E*l+A*h,e[13]=b*s+T*c+E*f+A*y,e[14]=b*o+T*u+E*_+A*m,e[15]=b*i+T*p+E*d+A*g,e}function G(e,t){var r=new x(3);!function(e,t){var r=t[0],n=t[1],s=t[2],o=t[4],i=t[5],a=t[6],c=t[8],u=t[9],p=t[10];e[0]=Math.hypot(r,n,s),e[1]=Math.hypot(o,i,a),e[2]=Math.hypot(c,u,p)}(r,t);var n=1/r[0],s=1/r[1],o=1/r[2],i=t[0]*n,a=t[1]*s,c=t[2]*o,u=t[4]*n,p=t[5]*s,l=t[6]*o,f=t[8]*n,_=t[9]*s,d=t[10]*o,h=i+p+d,y=0;return h>0?(y=2*Math.sqrt(h+1),e[3]=.25*y,e[0]=(l-_)/y,e[1]=(f-c)/y,e[2]=(a-u)/y):i>p&&i>d?(y=2*Math.sqrt(1+i-p-d),e[3]=(l-_)/y,e[0]=.25*y,e[1]=(a+u)/y,e[2]=(f+c)/y):p>d?(y=2*Math.sqrt(1+p-i-d),e[3]=(f-c)/y,e[0]=(a+u)/y,e[1]=.25*y,e[2]=(l+_)/y):(y=2*Math.sqrt(1+d-i-p),e[3]=(a-u)/y,e[0]=(f+c)/y,e[1]=(l+_)/y,e[2]=.25*y),e}E=U,U.Verbosity=A,U.DEFAULT_INSTANCE=new E(E.Verbosity.INFO);class B{static identity(e){return e}static eq(e,t,r=1e-5){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>r)return!1;return!0}static clamp(e,t,r){return e<t?t:e>r?r:e}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*B.clamp(e,0,1));case 5121:return Math.round(255*B.clamp(e,0,1));case 5122:return Math.round(32767*B.clamp(e,-1,1));case 5120:return Math.round(127*B.clamp(e,-1,1));default:throw new Error("Invalid component type.")}}static decompose(e,t,r,n){let s=I([e[0],e[1],e[2]]);const o=I([e[4],e[5],e[6]]),i=I([e[8],e[9],e[10]]),a=function(e){var t=e[0],r=e[1],n=e[2],s=e[3],o=e[4],i=e[5],a=e[6],c=e[7],u=e[8],p=e[9],l=e[10],f=e[11],_=e[12],d=e[13],h=e[14],y=e[15];return(t*i-r*o)*(l*y-f*h)-(t*a-n*o)*(p*y-f*d)+(t*c-s*o)*(p*h-l*d)+(r*a-n*i)*(u*y-f*_)-(r*c-s*i)*(u*h-l*_)+(n*c-s*a)*(u*d-p*_)}(e);a<0&&(s=-s),t[0]=e[12],t[1]=e[13],t[2]=e[14];const c=e.slice(),u=1/s,p=1/o,l=1/i;c[0]*=u,c[1]*=u,c[2]*=u,c[4]*=p,c[5]*=p,c[6]*=p,c[8]*=l,c[9]*=l,c[10]*=l,G(r,c),n[0]=s,n[1]=o,n[2]=i}static compose(e,t,r,n){const s=n,o=t[0],i=t[1],a=t[2],c=t[3],u=o+o,p=i+i,l=a+a,f=o*u,_=o*p,d=o*l,h=i*p,y=i*l,m=a*l,g=c*u,b=c*p,T=c*l,E=r[0],A=r[1],x=r[2];return s[0]=(1-(h+m))*E,s[1]=(_+T)*E,s[2]=(d-b)*E,s[3]=0,s[4]=(_-T)*A,s[5]=(1-(f+m))*A,s[6]=(y+g)*A,s[7]=0,s[8]=(d+b)*x,s[9]=(y-g)*x,s[10]=(1-(f+h))*x,s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s}}function V(e,t){if(!!e!=!!t)return!1;const r=e.getChild(),n=t.getChild();return r===n||r.equals(n)}function k(e,t){if(!!e!=!!t)return!1;const r=e.values(),n=t.values();if(r.length!==n.length)return!1;for(let e=0;e<r.length;e++){const t=r[e],s=n[e];if(t.getChild()!==s.getChild()&&!t.getChild().equals(s.getChild()))return!1}return!0}function z(e,t){if(!!e!=!!t)return!1;const r=e.keys(),n=t.keys();if(r.length!==n.length)return!1;for(const n of r){const r=e.get(n),s=t.get(n);if(!!r!=!!s)return!1;const o=r.getChild(),i=s.getChild();if(o!==i&&!o.equals(i))return!1}return!0}function H(e,t){if(e===t)return!0;if(!!e!=!!t||!e||!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function q(e,t){if(e===t)return!0;if(!!e!=!!t)return!1;if(!F(e)||!F(t))return e===t;const r=e,n=t;let s,o=0,i=0;for(s in r)o++;for(s in n)i++;if(o!==i)return!1;for(s in r){const e=r[s],t=n[s];if($(e)&&$(t)){if(!H(e,t))return!1}else if(F(e)&&F(t)){if(!q(e,t))return!1}else if(e!==t)return!1}return!0}function $(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const W="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",X=new Set,Y=function(){let e="";for(let t=0;t<6;t++)e+=W.charAt(Math.floor(42*Math.random()));return e},Q="https://null.example";class K{static dirname(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}static basename(e){return j.basename(new URL(e,Q).pathname)}static extension(e){return j.extension(new URL(e,Q).pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const r=e.split("/"),n=t.split("/");r.pop();for(let e=0;e<n.length;e++)"."!==n[e]&&(".."===n[e]?r.pop():r.push(n[e]));return r.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}K.DEFAULT_INIT={},K.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const J=e=>e,Z=new Set;class ee extends l{constructor(e,t=""){super(e),this[u].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new(0,this.constructor)(this.graph).copy(this,J)}copy(e,t=J){for(const e in this[u]){const t=this[u][e];if(t instanceof n)this[p].has(e)||t.dispose();else if(t instanceof i||t instanceof a)for(const e of t.values())e.dispose();else if(t instanceof c)for(const e of t.values())e.dispose()}for(const r in e[u]){const s=this[u][r],o=e[u][r];if(o instanceof n)if(this[p].has(r)){s.getChild().copy(t(o.getChild()),t)}else this.setRef(r,t(o.getChild()),o.getAttributes());else if(o instanceof a||o instanceof i)for(const e of o.values())this.addRef(r,t(e.getChild()),e.getAttributes());else if(o instanceof c)for(const e of o.keys()){const n=o.get(e);this.setRefMap(r,e,t(n.getChild()),n.getAttributes())}else F(o)?this[u][r]=JSON.parse(JSON.stringify(o)):Array.isArray(o)||o instanceof ArrayBuffer||ArrayBuffer.isView(o)?this[u][r]=o.slice():this[u][r]=o}return this}equals(e,t=Z){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const r in this[u]){if(t.has(r))continue;const s=this[u][r],o=e[u][r];if(s instanceof n||o instanceof n){if(!V(s,o))return!1}else if(s instanceof a||o instanceof a||s instanceof i||o instanceof i){if(!k(s,o))return!1}else if(s instanceof c||o instanceof c){if(!z(s,o))return!1}else if(F(s)||F(o)){if(!q(s,o))return!1}else if($(s)||$(o)){if(!H(s,o))return!1}else if(s!==o)return!1}return!0}detach(){return this.graph.disconnectParents(this,(e=>"Root"!==e.propertyType)),this}listParents(){return this.graph.listParents(this)}}class te extends ee{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new c})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t._validateParent(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class re extends te{init(){this.propertyType=d.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:re.Type.SCALAR,componentType:re.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case re.Type.SCALAR:return 1;case re.Type.VEC2:return 2;case re.Type.VEC3:return 3;case re.Type.VEC4:case re.Type.MAT2:return 4;case re.Type.MAT3:return 9;case re.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case re.ComponentType.BYTE:case re.ComponentType.UNSIGNED_BYTE:return 1;case re.ComponentType.SHORT:case re.ComponentType.UNSIGNED_SHORT:return 2;case re.ComponentType.UNSIGNED_INT:case re.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getNormalized(),r=this.getElementSize(),n=this.getComponentType();if(this.getMin(e),t)for(let t=0;t<r;t++)e[t]=B.decodeNormalizedInt(e[t],n);return e}getMin(e){const t=this.getArray(),r=this.getCount(),n=this.getElementSize();for(let t=0;t<n;t++)e[t]=1/0;for(let s=0;s<r*n;s+=n)for(let r=0;r<n;r++){const n=t[s+r];Number.isFinite(n)&&(e[r]=Math.min(e[r],n))}return e}getMaxNormalized(e){const t=this.getNormalized(),r=this.getElementSize(),n=this.getComponentType();if(this.getMax(e),t)for(let t=0;t<r;t++)e[t]=B.decodeNormalizedInt(e[t],n);return e}getMax(e){const t=this.get("array"),r=this.getCount(),n=this.getElementSize();for(let t=0;t<n;t++)e[t]=-1/0;for(let s=0;s<r*n;s+=n)for(let r=0;r<n;r++){const n=t[s+r];Number.isFinite(n)&&(e[r]=Math.max(e[r],n))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return re.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const t=this.getElementSize(),r=this.getComponentType(),n=this.getArray();return this.getNormalized()?B.decodeNormalizedInt(n[e*t],r):n[e*t]}setScalar(e,t){const r=this.getElementSize(),n=this.getComponentType(),s=this.getArray();return this.getNormalized()?s[e*r]=B.encodeNormalizedInt(t,n):s[e*r]=t,this}getElement(e,t){const r=this.getNormalized(),n=this.getElementSize(),s=this.getComponentType(),o=this.getArray();for(let i=0;i<n;i++)t[i]=r?B.decodeNormalizedInt(o[e*n+i],s):o[e*n+i];return t}setElement(e,t){const r=this.getNormalized(),n=this.getElementSize(),s=this.getComponentType(),o=this.getArray();for(let i=0;i<n;i++)o[e*n+i]=r?B.encodeNormalizedInt(t[i],s):t[i];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(e){switch(e.constructor){case Float32Array:return re.ComponentType.FLOAT;case Uint32Array:return re.ComponentType.UNSIGNED_INT;case Uint16Array:return re.ComponentType.UNSIGNED_SHORT;case Uint8Array:return re.ComponentType.UNSIGNED_BYTE;case Int16Array:return re.ComponentType.SHORT;case Int8Array:return re.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):re.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}re.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},re.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class ne extends te{init(){this.propertyType=d.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new a,samplers:new a})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class se extends te{init(){this.propertyType=d.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}se.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class oe extends te{init(){this.propertyType=d.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:oe.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:y.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:y.OTHER})}}oe.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class ie extends te{init(){this.propertyType=d.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class ae extends te{init(){this.propertyType=d.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:ae.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}ae.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class ce extends ee{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}ce.EXTENSION_NAME=void 0;class ue extends te{init(){this.propertyType=d.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:ue.WrapMode.REPEAT,wrapT:ue.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}ue.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},ue.MagFilter={NEAREST:9728,LINEAR:9729},ue.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:pe,G:le,B:fe,A:_e}=m;class de extends te{init(){this.propertyType=d.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:de.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new ue(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new ue(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new ue(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new ue(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new ue(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:pe|le|fe|_e,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:pe|le|fe,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:pe|le|fe})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:pe})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:le|fe})}}de.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class he extends te{init(){this.propertyType=d.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new a})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class ye extends te{init(){this.propertyType=d.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new a})}copy(e,t=J){if(t===J)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return B.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),r=this.get("rotation").slice(),n=this.get("scale").slice();return B.decompose(e,t,r,n),this.set("translation",t).set("rotation",r).set("scale",n)}getWorldTranslation(){const e=[0,0,0];return B.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return B.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return B.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let t=this;null!=t;t=t.getParentNode())e.push(t);let t;const r=e.pop().getMatrix();for(;t=e.pop();)L(r,r,t.getMatrix());return r}addChild(e){const t=e.getParentNode();t&&t.removeChild(e);for(const t of e.listParents())t.propertyType===d.SCENE&&t.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===d.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class me extends te{init(){this.propertyType=d.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:me.Mode.TRIANGLES,material:null,indices:null,attributes:new c,targets:new a})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:y.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:y.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}me.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class ge extends ee{init(){this.propertyType=d.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new c})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:y.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function be(){return be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},be.apply(null,arguments)}class Te extends te{init(){this.propertyType=d.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new a})}copy(e,t=J){if(t===J)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){const t=e.getParentNode();return t&&t.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class Ee extends te{init(){this.propertyType=d.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new a})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:y.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class Ae extends te{init(){this.propertyType=d.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||C.extensionToMimeType(j.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=C.extensionToMimeType(j.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",w.assertView(e))}getSize(){const e=this.get("image");return e?C.getSize(e,this.getMimeType()):null}}class xe extends te{init(){this.propertyType=d.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${f}`,version:"2.0"},defaultScene:null,accessors:new a,animations:new a,buffers:new a,cameras:new a,materials:new a,meshes:new a,nodes:new a,scenes:new a,skins:new a,textures:new a})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",(e=>{this._addChildOfRoot(e.target)}))}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=J){if(t===J)throw new Error("Root cannot be copied.");this.set("asset",be({},e.get("asset"))),this.setName(e.getName()),this.setExtras(be({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const r of e.listRefMapKeys("extensions")){const n=e.getExtension(r);this.setExtension(r,t(n))}return this}_addChildOfRoot(e){return e instanceof Te?this.addRef("scenes",e):e instanceof ye?this.addRef("nodes",e):e instanceof ae?this.addRef("cameras",e):e instanceof Ee?this.addRef("skins",e):e instanceof he?this.addRef("meshes",e):e instanceof de?this.addRef("materials",e):e instanceof Ae?this.addRef("textures",e):e instanceof ne?this.addRef("animations",e):e instanceof re?this.addRef("accessors",e):e instanceof ie&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter((e=>e.isRequired()))}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Ie{static fromGraph(e){return Ie._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new s,this._root=new xe(this._graph),this._logger=U.DEFAULT_INSTANCE,Ie._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const t=e.map((e=>e.name));for(const r of e)await r(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find((e=>e.extensionName===t))||new e(this)}createScene(e=""){return new Te(this._graph,e)}createNode(e=""){return new ye(this._graph,e)}createCamera(e=""){return new ae(this._graph,e)}createSkin(e=""){return new Ee(this._graph,e)}createMesh(e=""){return new he(this._graph,e)}createPrimitive(){return new me(this._graph)}createPrimitiveTarget(e=""){return new ge(this._graph,e)}createMaterial(e=""){return new de(this._graph,e)}createTexture(e=""){return new Ae(this._graph,e)}createAnimation(e=""){return new ne(this._graph,e)}createAnimationChannel(e=""){return new se(this._graph,e)}createAnimationSampler(e=""){return new oe(this._graph,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new re(this._graph,e).setBuffer(t)}createBuffer(e=""){return new ie(this._graph,e)}}Ie._GRAPH_DOCUMENTS=new WeakMap;class Re{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this._listener=void 0,this.document=e,e.getRoot()._enableExtension(this),this._listener=e=>{const t=e,r=t.target;r instanceof ce&&r.extensionName===this.extensionName&&("node:create"===t.type&&this._addExtensionProperty(r),"node:dispose"===t.type&&this._removeExtensionProperty(r))};const t=e.getGraph();t.addEventListener("node:create",this._listener),t.addEventListener("node:dispose",this._listener)}dispose(){this.document.getRoot()._disableExtension(this);const e=this.document.getGraph();e.removeEventListener("node:create",this._listener),e.removeEventListener("node:dispose",this._listener);for(const e of this.properties)e.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}_addExtensionProperty(e){return this.properties.add(e),this}_removeExtensionProperty(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}Re.EXTENSION_NAME=void 0;class Se{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),void 0!==t.texCoord&&e.setTexCoord(t.texCoord),void 0!==t.extras&&e.setExtras(t.extras);const r=this.jsonDoc.json.textures[t.index];if(void 0===r.sampler)return;const n=this.jsonDoc.json.samplers[r.sampler];void 0!==n.magFilter&&e.setMagFilter(n.magFilter),void 0!==n.minFilter&&e.setMinFilter(n.minFilter),void 0!==n.wrapS&&e.setWrapS(n.wrapS),void 0!==n.wrapT&&e.setWrapT(n.wrapT)}}const Me={logger:U.DEFAULT_INSTANCE,extensions:[],dependencies:{}},Ne=new Set([d.BUFFER,d.TEXTURE,d.MATERIAL,d.MESH,d.PRIMITIVE,d.NODE,d.SCENE]);class we{static read(e,t=Me){const r=be({},Me,t),{json:n}=e,s=(new Ie).setLogger(r.logger);this.validate(e,r);const o=new Se(e),i=n.asset,a=s.getRoot().getAsset();i.copyright&&(a.copyright=i.copyright),i.extras&&(a.extras=i.extras),void 0!==n.extras&&s.getRoot().setExtras(be({},n.extras));const c=n.extensionsUsed||[],u=n.extensionsRequired||[];r.extensions.sort(((e,t)=>e.EXTENSION_NAME>t.EXTENSION_NAME?1:-1));for(const e of r.extensions)if(c.includes(e.EXTENSION_NAME)){const t=s.createExtension(e).setRequired(u.includes(e.EXTENSION_NAME)),n=t.prereadTypes.filter((e=>!Ne.has(e)));n.length&&r.logger.warn(`Preread hooks for some types (${n.join()}), requested by extension ${t.extensionName}, are unsupported. Please file an issue or a PR.`);for(const e of t.readDependencies)t.install(e,r.dependencies[e])}const p=n.buffers||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(d.BUFFER))).forEach((e=>e.preread(o,d.BUFFER))),o.buffers=p.map((e=>{const t=s.createBuffer(e.name);return e.extras&&t.setExtras(e.extras),e.uri&&0!==e.uri.indexOf("__")&&t.setURI(e.uri),t}));const l=n.bufferViews||[];o.bufferViewBuffers=l.map(((t,r)=>{if(!o.bufferViews[r]){const n=e.json.buffers[t.buffer],s=n.uri?e.resources[n.uri]:e.resources[_],i=t.byteOffset||0;o.bufferViews[r]=w.toView(s,i,t.byteLength)}return o.buffers[t.buffer]}));const f=n.accessors||[];o.accessors=f.map((e=>{const t=o.bufferViewBuffers[e.bufferView],r=s.createAccessor(e.name,t).setType(e.type);return e.extras&&r.setExtras(e.extras),void 0!==e.normalized&&r.setNormalized(e.normalized),void 0===e.bufferView||r.setArray(ve(e,o)),r}));const h=n.images||[],y=n.textures||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(d.TEXTURE))).forEach((e=>e.preread(o,d.TEXTURE))),o.textures=h.map((t=>{const r=s.createTexture(t.name);if(t.extras&&r.setExtras(t.extras),void 0!==t.bufferView){const s=n.bufferViews[t.bufferView],o=e.json.buffers[s.buffer],i=o.uri?e.resources[o.uri]:e.resources[_],a=s.byteOffset||0,c=s.byteLength,u=i.slice(a,a+c);r.setImage(u)}else void 0!==t.uri&&(r.setImage(e.resources[t.uri]),0!==t.uri.indexOf("__")&&r.setURI(t.uri));if(void 0!==t.mimeType)r.setMimeType(t.mimeType);else if(t.uri){const e=j.extension(t.uri);r.setMimeType(C.extensionToMimeType(e))}return r})),s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(d.MATERIAL))).forEach((e=>e.preread(o,d.MATERIAL)));const m=n.materials||[];o.materials=m.map((e=>{const t=s.createMaterial(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.alphaMode&&t.setAlphaMode(e.alphaMode),void 0!==e.alphaCutoff&&t.setAlphaCutoff(e.alphaCutoff),void 0!==e.doubleSided&&t.setDoubleSided(e.doubleSided);const r=e.pbrMetallicRoughness||{};if(void 0!==r.baseColorFactor&&t.setBaseColorFactor(r.baseColorFactor),void 0!==e.emissiveFactor&&t.setEmissiveFactor(e.emissiveFactor),void 0!==r.metallicFactor&&t.setMetallicFactor(r.metallicFactor),void 0!==r.roughnessFactor&&t.setRoughnessFactor(r.roughnessFactor),void 0!==r.baseColorTexture){const e=r.baseColorTexture,n=o.textures[y[e.index].source];t.setBaseColorTexture(n),o.setTextureInfo(t.getBaseColorTextureInfo(),e)}if(void 0!==e.emissiveTexture){const r=e.emissiveTexture,n=o.textures[y[r.index].source];t.setEmissiveTexture(n),o.setTextureInfo(t.getEmissiveTextureInfo(),r)}if(void 0!==e.normalTexture){const r=e.normalTexture,n=o.textures[y[r.index].source];t.setNormalTexture(n),o.setTextureInfo(t.getNormalTextureInfo(),r),void 0!==e.normalTexture.scale&&t.setNormalScale(e.normalTexture.scale)}if(void 0!==e.occlusionTexture){const r=e.occlusionTexture,n=o.textures[y[r.index].source];t.setOcclusionTexture(n),o.setTextureInfo(t.getOcclusionTextureInfo(),r),void 0!==e.occlusionTexture.strength&&t.setOcclusionStrength(e.occlusionTexture.strength)}if(void 0!==r.metallicRoughnessTexture){const e=r.metallicRoughnessTexture,n=o.textures[y[e.index].source];t.setMetallicRoughnessTexture(n),o.setTextureInfo(t.getMetallicRoughnessTextureInfo(),e)}return t})),s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(d.MESH))).forEach((e=>e.preread(o,d.MESH)));const g=n.meshes||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(d.PRIMITIVE))).forEach((e=>e.preread(o,d.PRIMITIVE))),o.meshes=g.map((e=>{const t=s.createMesh(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.weights&&t.setWeights(e.weights);return(e.primitives||[]).forEach((r=>{const n=s.createPrimitive();r.extras&&n.setExtras(r.extras),void 0!==r.material&&n.setMaterial(o.materials[r.material]),void 0!==r.mode&&n.setMode(r.mode);for(const[e,t]of Object.entries(r.attributes||{}))n.setAttribute(e,o.accessors[t]);void 0!==r.indices&&n.setIndices(o.accessors[r.indices]);const i=e.extras&&e.extras.targetNames||[];(r.targets||[]).forEach(((e,t)=>{const r=i[t]||t.toString(),a=s.createPrimitiveTarget(r);for(const[t,r]of Object.entries(e))a.setAttribute(t,o.accessors[r]);n.addTarget(a)})),t.addPrimitive(n)})),t}));const T=n.cameras||[];o.cameras=T.map((e=>{const t=s.createCamera(e.name).setType(e.type);if(e.extras&&t.setExtras(e.extras),e.type===ae.Type.PERSPECTIVE){const r=e.perspective;t.setYFov(r.yfov),t.setZNear(r.znear),void 0!==r.zfar&&t.setZFar(r.zfar),void 0!==r.aspectRatio&&t.setAspectRatio(r.aspectRatio)}else{const r=e.orthographic;t.setZNear(r.znear).setZFar(r.zfar).setXMag(r.xmag).setYMag(r.ymag)}return t}));const E=n.nodes||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(d.NODE))).forEach((e=>e.preread(o,d.NODE))),o.nodes=E.map((e=>{const t=s.createNode(e.name);if(e.extras&&t.setExtras(e.extras),void 0!==e.translation&&t.setTranslation(e.translation),void 0!==e.rotation&&t.setRotation(e.rotation),void 0!==e.scale&&t.setScale(e.scale),void 0!==e.matrix){const r=[0,0,0],n=[0,0,0,1],s=[1,1,1];B.decompose(e.matrix,r,n,s),t.setTranslation(r),t.setRotation(n),t.setScale(s)}return void 0!==e.weights&&t.setWeights(e.weights),t}));const A=n.skins||[];o.skins=A.map((e=>{const t=s.createSkin(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.inverseBindMatrices&&t.setInverseBindMatrices(o.accessors[e.inverseBindMatrices]),void 0!==e.skeleton&&t.setSkeleton(o.nodes[e.skeleton]);for(const r of e.joints)t.addJoint(o.nodes[r]);return t})),E.map(((e,t)=>{const r=o.nodes[t];(e.children||[]).forEach((e=>r.addChild(o.nodes[e]))),void 0!==e.mesh&&r.setMesh(o.meshes[e.mesh]),void 0!==e.camera&&r.setCamera(o.cameras[e.camera]),void 0!==e.skin&&r.setSkin(o.skins[e.skin])}));const x=n.animations||[];o.animations=x.map((e=>{const t=s.createAnimation(e.name);e.extras&&t.setExtras(e.extras);const r=(e.samplers||[]).map((e=>{const r=s.createAnimationSampler().setInput(o.accessors[e.input]).setOutput(o.accessors[e.output]).setInterpolation(e.interpolation||oe.Interpolation.LINEAR);return e.extras&&r.setExtras(e.extras),t.addSampler(r),r}));return(e.channels||[]).forEach((e=>{const n=s.createAnimationChannel().setSampler(r[e.sampler]).setTargetPath(e.target.path);void 0!==e.target.node&&n.setTargetNode(o.nodes[e.target.node]),e.extras&&n.setExtras(e.extras),t.addChannel(n)})),t}));const I=n.scenes||[];return s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(d.SCENE))).forEach((e=>e.preread(o,d.SCENE))),o.scenes=I.map((e=>{const t=s.createScene(e.name);e.extras&&t.setExtras(e.extras);return(e.nodes||[]).map((e=>o.nodes[e])).forEach((e=>t.addChild(e))),t})),void 0!==n.scene&&s.getRoot().setDefaultScene(o.scenes[n.scene]),s.getRoot().listExtensionsUsed().forEach((e=>e.read(o))),f.forEach(((e,t)=>{const r=o.accessors[t],n=!!e.sparse,s=!e.bufferView&&!r.getArray();(n||s)&&r.setSparse(!0).setArray(function(e,t){const r=b[e.componentType],n=re.getElementSize(e.type);let s;s=void 0!==e.bufferView?ve(e,t):new r(e.count*n);const o=e.sparse;if(!o)return s;const i=o.count,a=be({},e,o.indices,{count:i,type:"SCALAR"}),c=be({},e,o.values,{count:i}),u=ve(a,t),p=ve(c,t);for(let e=0;e<a.count;e++)for(let t=0;t<n;t++)s[u[e]*n+t]=p[e*n+t];return s}(e,o))})),s}static validate(e,t){const r=e.json;if("2.0"!==r.asset.version)throw new Error(`Unsupported glTF version, "${r.asset.version}".`);if(r.extensionsRequired)for(const e of r.extensionsRequired)if(!t.extensions.find((t=>t.EXTENSION_NAME===e)))throw new Error(`Missing required extension, "${e}".`);if(r.extensionsUsed)for(const e of r.extensionsUsed)t.extensions.find((t=>t.EXTENSION_NAME===e))||t.logger.warn(`Missing optional extension, "${e}".`)}}function ve(e,t){const r=t.jsonDoc,n=t.bufferViews[e.bufferView],s=r.json.bufferViews[e.bufferView],o=b[e.componentType],i=re.getElementSize(e.type),a=o.BYTES_PER_ELEMENT,c=i*a;if(void 0!==s.byteStride&&s.byteStride!==c)return function(e,t){const r=t.jsonDoc,n=t.bufferViews[e.bufferView],s=r.json.bufferViews[e.bufferView],o=b[e.componentType],i=re.getElementSize(e.type),a=o.BYTES_PER_ELEMENT,c=e.byteOffset||0,u=new o(e.count*i),p=new DataView(n.buffer,n.byteOffset,n.byteLength),l=s.byteStride;for(let t=0;t<e.count;t++)for(let r=0;r<i;r++){const n=c+t*l+r*a;let s;switch(e.componentType){case re.ComponentType.FLOAT:s=p.getFloat32(n,!0);break;case re.ComponentType.UNSIGNED_INT:s=p.getUint32(n,!0);break;case re.ComponentType.UNSIGNED_SHORT:s=p.getUint16(n,!0);break;case re.ComponentType.UNSIGNED_BYTE:s=p.getUint8(n);break;case re.ComponentType.SHORT:s=p.getInt16(n,!0);break;case re.ComponentType.BYTE:s=p.getInt8(n);break;default:throw new Error(`Unexpected componentType "${e.componentType}".`)}u[t*i+r]=s}return u}(e,t);const u=n.byteOffset+(e.byteOffset||0),p=e.count*i*a;return new o(n.buffer.slice(u,u+p))}var Oe;!function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Oe||(Oe={}));class Ce{constructor(e,t,r){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=t,this.options=r;const n=e.getRoot(),s=n.listBuffers().length,o=n.listTextures().length;this.bufferURIGenerator=new De(s>1,(()=>r.basename||"buffer")),this.imageURIGenerator=new De(o>1,(t=>function(e,t){const r=e.getGraph().listParentEdges(t).find((t=>t.getParent()!==e.getRoot()));return r?r.getName().replace(/texture$/i,""):""}(e,t)||r.basename||"texture")),this.logger=e.getLogger()}createTextureInfoDef(e,t){const r={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},n=JSON.stringify(r);this.samplerDefIndexMap.has(n)||(this.samplerDefIndexMap.set(n,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(r));const s={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(n)},o=JSON.stringify(s);this.textureDefIndexMap.has(o)||(this.textureDefIndexMap.set(o,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(s));const i={index:this.textureDefIndexMap.get(o)};return 0!==t.getTexCoord()&&(i.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(i.extras=t.getExtras()),this.textureInfoDefMap.set(t,i),i}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount();return this._doc.getGraph().listParentEdges(e).some((e=>"attributes"===e.getName()&&"POSITION"===e.getAttributes().key||"input"===e.getName()))&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,r){if(this.options.format===g.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const n=C.mimeTypeToExtension(r.getMimeType());e.uri=this.imageURIGenerator.createURI(r,n),this.assignResourceURI(e.uri,t,!1)}}assignResourceURI(e,t,r){const n=this.jsonDoc.resources;if(!(e in n))return void(n[e]=t);if(t===n[e])return void this.logger.warn(`Duplicate resource URI, "${e}".`);const s=`Resource URI "${e}" already assigned to different data.`;if(r)throw new Error(s);this.logger.warn(s)}getAccessorUsage(e){const t=this._accessorUsageMap.get(e);if(t)return t;if(e.getSparse())return y.SPARSE;for(const t of this._doc.getGraph().listParentEdges(e)){const{usage:e}=t.getAttributes();if(e)return e;t.getParent().propertyType!==d.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${t.getName()}".`)}return y.OTHER}addAccessorToUsageGroup(e,t){const r=this._accessorUsageMap.get(e);if(r&&r!==t)throw new Error(`Accessor with usage "${r}" cannot be reused as "${t}".`);return this._accessorUsageMap.set(e,t),this}}Ce.BufferViewTarget=Oe,Ce.BufferViewUsage=y,Ce.USAGE_TO_TARGET={[y.ARRAY_BUFFER]:Oe.ARRAY_BUFFER,[y.ELEMENT_ARRAY_BUFFER]:Oe.ELEMENT_ARRAY_BUFFER};class De{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const r=this.basename(e);return this.counter[r]=this.counter[r]||1,`${r}_${this.counter[r]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:je}=Ce,{UNSIGNED_INT:Pe,UNSIGNED_SHORT:Fe,UNSIGNED_BYTE:Ue}=re.ComponentType,Le=new Set([d.ACCESSOR,d.BUFFER,d.MATERIAL,d.MESH]);class Ge{static write(e,t){const r=e.getGraph(),n=e.getRoot(),s={asset:be({generator:`glTF-Transform ${f}`},n.getAsset()),extras:be({},n.getExtras())},o={json:s,resources:{}},i=new Ce(e,o,t),a=t.logger||U.DEFAULT_INSTANCE,c=new Set(t.extensions.map((e=>e.EXTENSION_NAME))),u=e.getRoot().listExtensionsUsed().filter((e=>c.has(e.extensionName))).sort(((e,t)=>e.extensionName>t.extensionName?1:-1)),p=e.getRoot().listExtensionsRequired().filter((e=>c.has(e.extensionName))).sort(((e,t)=>e.extensionName>t.extensionName?1:-1));u.length<e.getRoot().listExtensionsUsed().length&&a.warn("Some extensions were not registered for I/O, and will not be written.");for(const e of u){const r=e.prewriteTypes.filter((e=>!Le.has(e)));r.length&&a.warn(`Prewrite hooks for some types (${r.join()}), requested by extension ${e.extensionName}, are unsupported. Please file an issue or a PR.`);for(const r of e.writeDependencies)e.install(r,t.dependencies[r])}function l(e,t,r,n){const o=[];let a=0;for(const t of e){const e=i.createAccessorDef(t);e.bufferView=s.bufferViews.length;const r=t.getArray(),n=w.pad(w.toView(r));e.byteOffset=a,a+=n.byteLength,o.push(n),i.accessorIndexMap.set(t,s.accessors.length),s.accessors.push(e)}const c={buffer:t,byteOffset:r,byteLength:w.concat(o).byteLength};return n&&(c.target=n),s.bufferViews.push(c),{buffers:o,byteLength:a}}function y(e,t,r){const n=e[0].getCount();let o=0;for(const t of e){const e=i.createAccessorDef(t);e.bufferView=s.bufferViews.length,e.byteOffset=o;const r=t.getElementSize(),n=t.getComponentSize();o+=w.padNumber(r*n),i.accessorIndexMap.set(t,s.accessors.length),s.accessors.push(e)}const a=n*o,c=new ArrayBuffer(a),u=new DataView(c);for(let t=0;t<n;t++){let r=0;for(const n of e){const e=n.getElementSize(),s=n.getComponentSize(),i=n.getComponentType(),a=n.getArray();for(let n=0;n<e;n++){const c=t*o+r+n*s,p=a[t*e+n];switch(i){case re.ComponentType.FLOAT:u.setFloat32(c,p,!0);break;case re.ComponentType.BYTE:u.setInt8(c,p);break;case re.ComponentType.SHORT:u.setInt16(c,p,!0);break;case re.ComponentType.UNSIGNED_BYTE:u.setUint8(c,p);break;case re.ComponentType.UNSIGNED_SHORT:u.setUint16(c,p,!0);break;case re.ComponentType.UNSIGNED_INT:u.setUint32(c,p,!0);break;default:throw new Error("Unexpected component type: "+i)}}r+=w.padNumber(e*s)}}const p={buffer:t,byteOffset:r,byteLength:a,byteStride:o,target:Ce.BufferViewTarget.ARRAY_BUFFER};return s.bufferViews.push(p),{byteLength:a,buffers:[new Uint8Array(c)]}}function m(e,t,r){const n=[];let o=0;const c=new Map;let u=-1/0,p=!1;for(const t of e){const e=i.createAccessorDef(t);s.accessors.push(e),i.accessorIndexMap.set(t,s.accessors.length-1);const r=[],n=[],o=[],a=new Array(t.getElementSize()).fill(0);for(let e=0,s=t.getCount();e<s;e++)if(t.getElement(e,o),!B.eq(o,a,0)){u=Math.max(e,u),r.push(e);for(let e=0;e<o.length;e++)n.push(o[e])}const l=r.length,f={accessorDef:e,count:l};if(c.set(t,f),0===l)continue;l>t.getCount()/2&&(p=!0);const _=b[t.getComponentType()];f.indices=r,f.values=new _(n)}if(!Number.isFinite(u))return{buffers:n,byteLength:o};p&&a.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const l=u<255?Uint8Array:u<65535?Uint16Array:Uint32Array,f=u<255?Ue:u<65535?Fe:Pe,_={buffer:t,byteOffset:r+o,byteLength:0};for(const t of e){const e=c.get(t);if(0===e.count)continue;e.indicesByteOffset=_.byteLength;const r=w.pad(w.toView(new l(e.indices)));n.push(r),o+=r.byteLength,_.byteLength+=r.byteLength}s.bufferViews.push(_);const d=s.bufferViews.length-1,h={buffer:t,byteOffset:r+o,byteLength:0};for(const t of e){const e=c.get(t);if(0===e.count)continue;e.valuesByteOffset=h.byteLength;const r=w.pad(w.toView(e.values));n.push(r),o+=r.byteLength,h.byteLength+=r.byteLength}s.bufferViews.push(h);const y=s.bufferViews.length-1;for(const t of e){const e=c.get(t);0!==e.count&&(e.accessorDef.sparse={count:e.count,indices:{bufferView:d,byteOffset:e.indicesByteOffset,componentType:f},values:{bufferView:y,byteOffset:e.valuesByteOffset}})}return{buffers:n,byteLength:o}}s.accessors=[],s.bufferViews=[],s.samplers=[],s.textures=[],s.images=n.listTextures().map(((e,t)=>{const r=i.createPropertyDef(e);e.getMimeType()&&(r.mimeType=e.getMimeType());const n=e.getImage();return n&&i.createImageData(r,n,e),i.imageIndexMap.set(e,t),r})),u.filter((e=>e.prewriteTypes.includes(d.ACCESSOR))).forEach((e=>e.prewrite(i,d.ACCESSOR))),n.listAccessors().forEach((e=>{const t=i.accessorUsageGroupedByParent,n=i.accessorParents;if(i.accessorIndexMap.has(e))return;const s=i.getAccessorUsage(e);if(i.addAccessorToUsageGroup(e,s),t.has(s)){const t=r.listParents(e).find((e=>e.propertyType!==d.ROOT));n.set(e,t)}})),u.filter((e=>e.prewriteTypes.includes(d.BUFFER))).forEach((e=>e.prewrite(i,d.BUFFER)));if((n.listAccessors().length>0||i.otherBufferViews.size>0||n.listTextures().length>0&&t.format===g.GLB)&&0===n.listBuffers().length)throw new Error("Buffer required for Document resources, but none was found.");s.buffers=[],n.listBuffers().forEach(((e,r)=>{const n=i.createPropertyDef(e),o=i.accessorUsageGroupedByParent,a=e.listParents().filter((e=>e instanceof re)),c=new Set(a.map((e=>i.accessorParents.get(e)))),u=new Map(Array.from(c).map(((e,t)=>[e,t]))),p={};for(const e of a){var f;if(i.accessorIndexMap.has(e))continue;const t=i.getAccessorUsage(e);let r=t;if(o.has(t)){const t=i.accessorParents.get(e);r+=`:${u.get(t)}`}p[f=r]||(p[f]={usage:t,accessors:[]}),p[r].accessors.push(e)}const d=[],b=s.buffers.length;let T=0;for(const{usage:e,accessors:r}of Object.values(p))if(e===je.ARRAY_BUFFER&&t.vertexLayout===h.INTERLEAVED){const e=y(r,b,T);T+=e.byteLength;for(const t of e.buffers)d.push(t)}else if(e===je.ARRAY_BUFFER)for(const e of r){const t=y([e],b,T);T+=t.byteLength;for(const e of t.buffers)d.push(e)}else if(e===je.SPARSE){const e=m(r,b,T);T+=e.byteLength;for(const t of e.buffers)d.push(t)}else if(e===je.ELEMENT_ARRAY_BUFFER){const e=l(r,b,T,Ce.BufferViewTarget.ELEMENT_ARRAY_BUFFER);T+=e.byteLength;for(const t of e.buffers)d.push(t)}else{const e=l(r,b,T);T+=e.byteLength;for(const t of e.buffers)d.push(t)}if(i.imageBufferViews.length&&0===r)for(let e=0;e<i.imageBufferViews.length;e++)if(s.bufferViews[s.images[e].bufferView].byteOffset=T,T+=i.imageBufferViews[e].byteLength,d.push(i.imageBufferViews[e]),T%8){const e=8-T%8;T+=e,d.push(new Uint8Array(e))}if(i.otherBufferViews.has(e))for(const t of i.otherBufferViews.get(e))s.bufferViews.push({buffer:b,byteOffset:T,byteLength:t.byteLength}),i.otherBufferViewsIndexMap.set(t,s.bufferViews.length-1),T+=t.byteLength,d.push(t);if(T){let r;t.format===g.GLB?r=_:(r=i.bufferURIGenerator.createURI(e,"bin"),n.uri=r),n.byteLength=T,i.assignResourceURI(r,w.concat(d),!0)}s.buffers.push(n),i.bufferIndexMap.set(e,r)})),n.listAccessors().find((e=>!e.getBuffer()))&&a.warn("Skipped writing one or more Accessors: no Buffer assigned."),u.filter((e=>e.prewriteTypes.includes(d.MATERIAL))).forEach((e=>e.prewrite(i,d.MATERIAL))),s.materials=n.listMaterials().map(((e,t)=>{const r=i.createPropertyDef(e);if(e.getAlphaMode()!==de.AlphaMode.OPAQUE&&(r.alphaMode=e.getAlphaMode()),e.getAlphaMode()===de.AlphaMode.MASK&&(r.alphaCutoff=e.getAlphaCutoff()),e.getDoubleSided()&&(r.doubleSided=!0),r.pbrMetallicRoughness={},B.eq(e.getBaseColorFactor(),[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=e.getBaseColorFactor()),B.eq(e.getEmissiveFactor(),[0,0,0])||(r.emissiveFactor=e.getEmissiveFactor()),1!==e.getRoughnessFactor()&&(r.pbrMetallicRoughness.roughnessFactor=e.getRoughnessFactor()),1!==e.getMetallicFactor()&&(r.pbrMetallicRoughness.metallicFactor=e.getMetallicFactor()),e.getBaseColorTexture()){const t=e.getBaseColorTexture(),n=e.getBaseColorTextureInfo();r.pbrMetallicRoughness.baseColorTexture=i.createTextureInfoDef(t,n)}if(e.getEmissiveTexture()){const t=e.getEmissiveTexture(),n=e.getEmissiveTextureInfo();r.emissiveTexture=i.createTextureInfoDef(t,n)}if(e.getNormalTexture()){const t=e.getNormalTexture(),n=e.getNormalTextureInfo(),s=i.createTextureInfoDef(t,n);1!==e.getNormalScale()&&(s.scale=e.getNormalScale()),r.normalTexture=s}if(e.getOcclusionTexture()){const t=e.getOcclusionTexture(),n=e.getOcclusionTextureInfo(),s=i.createTextureInfoDef(t,n);1!==e.getOcclusionStrength()&&(s.strength=e.getOcclusionStrength()),r.occlusionTexture=s}if(e.getMetallicRoughnessTexture()){const t=e.getMetallicRoughnessTexture(),n=e.getMetallicRoughnessTextureInfo();r.pbrMetallicRoughness.metallicRoughnessTexture=i.createTextureInfoDef(t,n)}return i.materialIndexMap.set(e,t),r})),u.filter((e=>e.prewriteTypes.includes(d.MESH))).forEach((e=>e.prewrite(i,d.MESH))),s.meshes=n.listMeshes().map(((e,t)=>{const r=i.createPropertyDef(e);let n=null;return r.primitives=e.listPrimitives().map((e=>{const t={attributes:{}};t.mode=e.getMode();const r=e.getMaterial();r&&(t.material=i.materialIndexMap.get(r)),Object.keys(e.getExtras()).length&&(t.extras=e.getExtras());const s=e.getIndices();s&&(t.indices=i.accessorIndexMap.get(s));for(const r of e.listSemantics())t.attributes[r]=i.accessorIndexMap.get(e.getAttribute(r));for(const r of e.listTargets()){const e={};for(const t of r.listSemantics())e[t]=i.accessorIndexMap.get(r.getAttribute(t));t.targets=t.targets||[],t.targets.push(e)}return e.listTargets().length&&!n&&(n=e.listTargets().map((e=>e.getName()))),t})),e.getWeights().length&&(r.weights=e.getWeights()),n&&(r.extras=r.extras||{},r.extras.targetNames=n),i.meshIndexMap.set(e,t),r})),s.cameras=n.listCameras().map(((e,t)=>{const r=i.createPropertyDef(e);if(r.type=e.getType(),r.type===ae.Type.PERSPECTIVE){r.perspective={znear:e.getZNear(),zfar:e.getZFar(),yfov:e.getYFov()};const t=e.getAspectRatio();null!==t&&(r.perspective.aspectRatio=t)}else r.orthographic={znear:e.getZNear(),zfar:e.getZFar(),xmag:e.getXMag(),ymag:e.getYMag()};return i.cameraIndexMap.set(e,t),r})),s.nodes=n.listNodes().map(((e,t)=>{const r=i.createPropertyDef(e);return B.eq(e.getTranslation(),[0,0,0])||(r.translation=e.getTranslation()),B.eq(e.getRotation(),[0,0,0,1])||(r.rotation=e.getRotation()),B.eq(e.getScale(),[1,1,1])||(r.scale=e.getScale()),e.getWeights().length&&(r.weights=e.getWeights()),i.nodeIndexMap.set(e,t),r})),s.skins=n.listSkins().map(((e,t)=>{const r=i.createPropertyDef(e),n=e.getInverseBindMatrices();n&&(r.inverseBindMatrices=i.accessorIndexMap.get(n));const s=e.getSkeleton();return s&&(r.skeleton=i.nodeIndexMap.get(s)),r.joints=e.listJoints().map((e=>i.nodeIndexMap.get(e))),i.skinIndexMap.set(e,t),r})),n.listNodes().forEach(((e,t)=>{const r=s.nodes[t],n=e.getMesh();n&&(r.mesh=i.meshIndexMap.get(n));const o=e.getCamera();o&&(r.camera=i.cameraIndexMap.get(o));const a=e.getSkin();a&&(r.skin=i.skinIndexMap.get(a)),e.listChildren().length>0&&(r.children=e.listChildren().map((e=>i.nodeIndexMap.get(e))))})),s.animations=n.listAnimations().map(((e,t)=>{const r=i.createPropertyDef(e),n=new Map;return r.samplers=e.listSamplers().map(((e,t)=>{const r=i.createPropertyDef(e);return r.input=i.accessorIndexMap.get(e.getInput()),r.output=i.accessorIndexMap.get(e.getOutput()),r.interpolation=e.getInterpolation(),n.set(e,t),r})),r.channels=e.listChannels().map((e=>{const t=i.createPropertyDef(e);return t.sampler=n.get(e.getSampler()),t.target={node:i.nodeIndexMap.get(e.getTargetNode()),path:e.getTargetPath()},t})),i.animationIndexMap.set(e,t),r})),s.scenes=n.listScenes().map(((e,t)=>{const r=i.createPropertyDef(e);return r.nodes=e.listChildren().map((e=>i.nodeIndexMap.get(e))),i.sceneIndexMap.set(e,t),r}));const T=n.getDefaultScene();return T&&(s.scene=n.listScenes().indexOf(T)),s.extensionsUsed=u.map((e=>e.extensionName)),s.extensionsRequired=p.map((e=>e.extensionName)),u.forEach((e=>e.write(i))),function(e){const t=[];for(const r in e){const n=e[r];(Array.isArray(n)&&0===n.length||null===n||""===n||n&&"object"==typeof n&&0===Object.keys(n).length)&&t.push(r)}for(const r of t)delete e[r]}(s),o}}var Be;!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(Be||(Be={}));class Ve{constructor(){this._logger=U.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=h.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const t of e)this._extensions.add(t),t.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const r=ke(t)?this._binaryToJSON(t):{json:JSON.parse(w.decodeText(t)),resources:{}};return await this._readResourcesExternal(r,this.dirname(e)),this._readResourcesInternal(r),r}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),we.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const t=this._binaryToJSON(w.assertView(e));this._readResourcesInternal(t);const r=t.json;if(r.buffers&&r.buffers.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)}(t,e))))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(r.images&&r.images.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)&&void 0===t.bufferView}(t,e))))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(w.assertView(e)))}async writeJSON(e,t={}){if(t.format===g.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return Ge.write(e,{format:t.format||g.GLTF,basename:t.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:be({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:t,resources:r}=await this.writeJSON(e,{format:g.GLB}),n=new Uint32Array([1179937895,2,12]),s=JSON.stringify(t),o=w.pad(w.encodeText(s),32),i=w.toView(new Uint32Array([o.byteLength,1313821514])),a=w.concat([i,o]);n[n.length-1]+=a.byteLength;const c=Object.values(r)[0];if(!c||!c.byteLength)return w.concat([w.toView(n),a]);const u=w.pad(c,0),p=w.toView(new Uint32Array([u.byteLength,5130562])),l=w.concat([p,u]);return n[n.length-1]+=l.byteLength,w.concat([w.toView(n),a,l])}async _readResourcesExternal(e,t){var r=this;const n=[...e.json.images||[],...e.json.buffers||[]].map((async function(n){const s=n.uri;if(!s||s.match(/data:/))return Promise.resolve();e.resources[s]=await r.readURI(r.resolve(t,s),"view"),r.lastReadBytes+=e.resources[s].byteLength}));await Promise.all(n)}_readResourcesInternal(e){function t(t){if(t.uri)if(t.uri in e.resources)w.assertView(e.resources[t.uri]);else if(t.uri.match(/data:/)){const r=`__${function(){for(let e=0;e<999;e++){const e=Y();if(!X.has(e))return X.add(e),e}return""}()}.${j.extension(t.uri)}`;e.resources[r]=w.createBufferFromDataURI(t.uri),t.uri=r}}(e.json.images||[]).forEach((e=>{if(void 0===e.bufferView&&void 0===e.uri)throw new Error("Missing resource URI or buffer view.");t(e)}));(e.json.buffers||[]).forEach(t)}_copyJSON(e){const{images:t,buffers:r}=e.json;return e={json:be({},e.json),resources:be({},e.resources)},t&&(e.json.images=t.map((e=>be({},e)))),r&&(e.json.buffers=r.map((e=>be({},e)))),e}_binaryToJSON(e){if(!ke(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==Be.JSON)throw new Error("Missing required GLB JSON chunk.");const r=t[0],n=w.decodeText(w.toView(e,20,r)),s=JSON.parse(n),o=20+r;if(e.byteLength<=o)return{json:s,resources:{}};const i=new Uint32Array(e.buffer,e.byteOffset+o,2);if(i[1]!==Be.BIN)return{json:s,resources:{}};const a=i[0],c=w.toView(e,o+8,a);return{json:s,resources:{[_]:c}}}}function ke(e){if(e.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const t=new Uint32Array(e.buffer,e.byteOffset,3);return 1179937895===t[0]&&2===t[1]}class ze extends Ve{constructor(e=K.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=e}async readURI(e,t){const r=await fetch(e,this._fetchConfig);switch(t){case"view":return new Uint8Array(await r.arrayBuffer());case"text":return r.text()}}resolve(e,t){return K.resolve(e,t)}dirname(e){return K.dirname(e)}}class He{constructor(e,t,r,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t=0){const r=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,n)}}const qe=[171,75,84,88,32,50,48,187,13,10,26,10];function $e(e){return(new TextDecoder).decode(e)}function We(e){const t=new Uint8Array(e.buffer,e.byteOffset,qe.length);if(t[0]!==qe[0]||t[1]!==qe[1]||t[2]!==qe[2]||t[3]!==qe[3]||t[4]!==qe[4]||t[5]!==qe[5]||t[6]!==qe[6]||t[7]!==qe[7]||t[8]!==qe[8]||t[9]!==qe[9]||t[10]!==qe[10]||t[11]!==qe[11])throw new Error("Missing KTX 2.0 identifier.");const r={vkFormat:0,typeSize:1,pixelWidth:0,pixelHeight:0,pixelDepth:0,layerCount:0,faceCount:1,supercompressionScheme:0,levels:[],dataFormatDescriptor:[{vendorId:0,descriptorType:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],keyValue:{},globalData:null},n=17*Uint32Array.BYTES_PER_ELEMENT,s=new He(e,qe.length,n,!0);r.vkFormat=s._nextUint32(),r.typeSize=s._nextUint32(),r.pixelWidth=s._nextUint32(),r.pixelHeight=s._nextUint32(),r.pixelDepth=s._nextUint32(),r.layerCount=s._nextUint32(),r.faceCount=s._nextUint32();const o=s._nextUint32();r.supercompressionScheme=s._nextUint32();const i=s._nextUint32(),a=s._nextUint32(),c=s._nextUint32(),u=s._nextUint32(),p=s._nextUint64(),l=s._nextUint64(),f=new He(e,qe.length+n,3*o*8,!0);for(let t=0;t<o;t++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+f._nextUint64(),f._nextUint64()),uncompressedByteLength:f._nextUint64()});const _=new He(e,i,a,!0);_._skip(4);const d=_._nextUint16(),h=_._nextUint16(),y=_._nextUint16(),m=_._nextUint16(),g={vendorId:d,descriptorType:h,versionNumber:y,colorModel:_._nextUint8(),colorPrimaries:_._nextUint8(),transferFunction:_._nextUint8(),flags:_._nextUint8(),texelBlockDimension:[_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8()],bytesPlane:[_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8()],samples:[]},b=(m/4-6)/4;for(let e=0;e<b;e++){const t={bitOffset:_._nextUint16(),bitLength:_._nextUint8(),channelType:_._nextUint8(),samplePosition:[_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8()],sampleLower:Number.NEGATIVE_INFINITY,sampleUpper:Number.POSITIVE_INFINITY};64&t.channelType?(t.sampleLower=_._nextInt32(),t.sampleUpper=_._nextInt32()):(t.sampleLower=_._nextUint32(),t.sampleUpper=_._nextUint32()),g.samples[e]=t}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(g);const T=new He(e,c,u,!0);for(;T._offset<u;){const e=T._nextUint32(),t=T._scan(e),n=$e(t);if(r.keyValue[n]=T._nextUint8Array(e-t.byteLength-1),n.match(/^ktx/i)){const e=$e(r.keyValue[n]);r.keyValue[n]=e.substring(0,e.lastIndexOf("\0"))}const s=e%4?4-e%4:0;T._skip(s)}if(l<=0)return r;const E=new He(e,p,l,!0),A=E._nextUint16(),x=E._nextUint16(),I=E._nextUint32(),R=E._nextUint32(),S=E._nextUint32(),M=E._nextUint32(),N=[];for(let e=0;e<o;e++)N.push({imageFlags:E._nextUint32(),rgbSliceByteOffset:E._nextUint32(),rgbSliceByteLength:E._nextUint32(),alphaSliceByteOffset:E._nextUint32(),alphaSliceByteLength:E._nextUint32()});const w=p+E._offset,v=w+I,O=v+R,C=O+S,D=new Uint8Array(e.buffer,e.byteOffset+w,I),j=new Uint8Array(e.buffer,e.byteOffset+v,R),P=new Uint8Array(e.buffer,e.byteOffset+O,S),F=new Uint8Array(e.buffer,e.byteOffset+C,M);return r.globalData={endpointCount:A,selectorCount:x,imageDescs:N,endpointsData:D,selectorsData:j,tablesData:P,extendedData:F},r}const Xe="EXT_mesh_gpu_instancing",Ye="EXT_meshopt_compression",Qe="KHR_draco_mesh_compression",Ke="KHR_lights_punctual",Je="KHR_materials_anisotropy",Ze="KHR_materials_clearcoat",et="KHR_materials_diffuse_transmission",tt="KHR_materials_dispersion",rt="KHR_materials_emissive_strength",nt="KHR_materials_ior",st="KHR_materials_iridescence",ot="KHR_materials_pbrSpecularGlossiness",it="KHR_materials_sheen",at="KHR_materials_specular",ct="KHR_materials_transmission",ut="KHR_materials_unlit",pt="KHR_materials_volume",lt="KHR_materials_variants",ft="KHR_texture_transform",_t="KHR_xmp_json_ld",dt="INSTANCE_ATTRIBUTE";class ht extends ce{init(){this.extensionName=Xe,this.propertyType="InstancedMesh",this.parentTypes=[d.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new c})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:dt})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}ht.EXTENSION_NAME=Xe;const yt=Xe;class mt extends Re{constructor(...e){super(...e),this.extensionName=yt,this.provideTypes=[d.NODE],this.prewriteTypes=[d.ACCESSOR]}createInstancedMesh(){return new ht(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach(((t,r)=>{if(!t.extensions||!t.extensions[yt])return;const n=t.extensions[yt],s=this.createInstancedMesh();for(const t in n.attributes)s.setAttribute(t,e.accessors[n.attributes[t]]);e.nodes[r].setExtension(yt,s)})),this}prewrite(e){e.accessorUsageGroupedByParent.add(dt);for(const t of this.properties)for(const r of t.listAttributes())e.addAccessorToUsageGroup(r,dt);return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach((r=>{const n=r.getExtension(yt);if(n){const s=e.nodeIndexMap.get(r),o=t.json.nodes[s],i={attributes:{}};n.listSemantics().forEach((t=>{const r=n.getAttribute(t);i.attributes[t]=e.accessorIndexMap.get(r)})),o.extensions=o.extensions||{},o.extensions[yt]=i}})),this}}function gt(){return gt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gt.apply(null,arguments)}var bt,Tt,Et;mt.EXTENSION_NAME=yt,function(e){e.QUANTIZE="quantize",e.FILTER="filter"}(bt||(bt={})),function(e){e.ATTRIBUTES="ATTRIBUTES",e.TRIANGLES="TRIANGLES",e.INDICES="INDICES"}(Tt||(Tt={})),function(e){e.NONE="NONE",e.OCTAHEDRAL="OCTAHEDRAL",e.QUATERNION="QUATERNION",e.EXPONENTIAL="EXPONENTIAL"}(Et||(Et={}));const{BYTE:At,SHORT:xt,FLOAT:It}=re.ComponentType,{encodeNormalizedInt:Rt,decodeNormalizedInt:St}=B;function Mt(e,t,r,n){const{filter:s,bits:o}=n,i={array:e.getArray(),byteStride:e.getElementSize()*e.getComponentSize(),componentType:e.getComponentType(),normalized:e.getNormalized()};if(r!==Tt.ATTRIBUTES)return i;if(s!==Et.NONE){let r=e.getNormalized()?function(e){const t=e.getComponentType(),r=e.getArray(),n=new Float32Array(r.length);for(let e=0;e<r.length;e++)n[e]=St(r[e],t);return n}(e):new Float32Array(i.array);switch(s){case Et.EXPONENTIAL:i.byteStride=4*e.getElementSize(),i.componentType=It,i.normalized=!1,i.array=t.encodeFilterExp(r,e.getCount(),i.byteStride,o);break;case Et.OCTAHEDRAL:i.byteStride=o>8?8:4,i.componentType=o>8?xt:At,i.normalized=!0,r=3===e.getElementSize()?function(e){const t=new Float32Array(4*e.length/3);for(let r=0,n=e.length/3;r<n;r++)t[4*r]=e[3*r],t[4*r+1]=e[3*r+1],t[4*r+2]=e[3*r+2];return t}(r):r,i.array=t.encodeFilterOct(r,e.getCount(),i.byteStride,o);break;case Et.QUATERNION:i.byteStride=8,i.componentType=xt,i.normalized=!0,i.array=t.encodeFilterQuat(r,e.getCount(),i.byteStride,o);break;default:throw new Error("Invalid filter.")}i.min=e.getMin([]),i.max=e.getMax([]),e.getNormalized()&&(i.min=i.min.map((t=>St(t,e.getComponentType()))),i.max=i.max.map((t=>St(t,e.getComponentType())))),i.normalized&&(i.min=i.min.map((e=>Rt(e,i.componentType))),i.max=i.max.map((e=>Rt(e,i.componentType))))}else i.byteStride%4&&(i.array=function(e,t){const r=w.padNumber(e.BYTES_PER_ELEMENT*t)/e.BYTES_PER_ELEMENT,n=e.length/t,s=new e.constructor(n*r);for(let n=0;n*t<e.length;n++)for(let o=0;o<t;o++)s[n*r+o]=e[n*t+o];return s}(i.array,e.getElementSize()),i.byteStride=i.array.byteLength/e.getCount());return i}function Nt(e,t){if(t===Ce.BufferViewUsage.ELEMENT_ARRAY_BUFFER){return e.listParents().some((e=>e instanceof me&&e.getMode()===me.Mode.TRIANGLES))?Tt.TRIANGLES:Tt.INDICES}return Tt.ATTRIBUTES}function wt(e,t){const r=t.getGraph().listParentEdges(e).filter((e=>!(e.getParent()instanceof xe)));for(const t of r){const r=t.getName(),n=t.getAttributes().key||"",s=t.getParent().propertyType===d.PRIMITIVE_TARGET;if("indices"===r)return{filter:Et.NONE};if("attributes"===r){if("POSITION"===n)return{filter:Et.NONE};if("TEXCOORD_0"===n)return{filter:Et.NONE};if(n.startsWith("JOINTS_"))return{filter:Et.NONE};if(n.startsWith("WEIGHTS_"))return{filter:Et.NONE};if("NORMAL"===n||"TANGENT"===n)return s?{filter:Et.NONE}:{filter:Et.OCTAHEDRAL,bits:8}}if("output"===r){const t=vt(e);return"rotation"===t?{filter:Et.QUATERNION,bits:16}:"translation"===t||"scale"===t?{filter:Et.EXPONENTIAL,bits:12}:{filter:Et.NONE}}if("input"===r)return{filter:Et.NONE};if("inverseBindMatrices"===r)return{filter:Et.NONE}}return{filter:Et.NONE}}function vt(e){for(const t of e.listParents())if(t instanceof oe)for(const e of t.listParents())if(e instanceof se)return e.getTargetPath();return null}const Ot=Ye,Ct={method:bt.QUANTIZE};class Dt extends Re{constructor(...e){super(...e),this.extensionName=Ot,this.prereadTypes=[d.BUFFER,d.PRIMITIVE],this.prewriteTypes=[d.BUFFER,d.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=Ct,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return"meshopt.decoder"===e&&(this._decoder=t),"meshopt.encoder"===e&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=gt({},Ct,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${Ot}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${Ot}]: Missing WASM support.`)}return t===d.BUFFER?this._prereadBuffers(e):t===d.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(((r,n)=>{if(!r.extensions||!r.extensions[Ot])return;const s=r.extensions[Ot],o=s.byteOffset||0,i=s.byteLength||0,a=s.count,c=s.byteStride,u=new Uint8Array(a*c),p=t.json.buffers[s.buffer],l=p.uri?t.resources[p.uri]:t.resources[_],f=w.toView(l,o,i);this._decoder.decodeGltfBuffer(u,a,c,f,s.mode,s.filter),e.bufferViews[n]=u}))}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((r=>{if(!r.extensions||!r.extensions[Ot])return;const n=r.extensions[Ot],s=e.buffers[n.buffer],o=e.buffers[r.buffer],i=t.json.buffers[r.buffer];var a;(a=i).extensions&&a.extensions[Ye]&&a.extensions[Ye].fallback&&this._decoderFallbackBufferMap.set(o,s)}))}read(e){if(!this.isRequired())return this;for(const[e,t]of this._decoderFallbackBufferMap){for(const r of e.listParents())r instanceof re&&r.swap(e,t);e.dispose()}return this}prewrite(e,t){return t===d.ACCESSOR?this._prewriteAccessors(e):t===d.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,r=this._encoder,n=this._encoderOptions,s=this.document.getGraph(),o=this.document.createBuffer(),i=this.document.getRoot().listBuffers().indexOf(o);let a=1;const c=new Map,u=e=>{for(const t of s.listParents(e)){if(t.propertyType===d.ROOT)continue;let r=c.get(e);return void 0===r&&c.set(e,r=a++),r}return-1};this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const s of this.document.getRoot().listAccessors()){if("weights"===vt(s))continue;if(s.getSparse())continue;const o=e.getAccessorUsage(s),a=e.accessorUsageGroupedByParent.has(o)?u(s):null,c=Nt(s,o),p=n.method===bt.FILTER?wt(s,this.document):{filter:Et.NONE},l=Mt(s,r,c,p),{array:f,byteStride:_}=l,d=s.getBuffer();if(!d)throw new Error(`${Ot}: Missing buffer for accessor.`);const h=this.document.getRoot().listBuffers().indexOf(d),y=[o,a,c,p.filter,_,h].join(":");let m=this._encoderBufferViews[y],g=this._encoderBufferViewData[y],b=this._encoderBufferViewAccessors[y];m&&g||(b=this._encoderBufferViewAccessors[y]=[],g=this._encoderBufferViewData[y]=[],m=this._encoderBufferViews[y]={buffer:i,target:Ce.USAGE_TO_TARGET[o],byteOffset:0,byteLength:0,byteStride:o===Ce.BufferViewUsage.ARRAY_BUFFER?_:void 0,extensions:{[Ot]:{buffer:h,byteOffset:0,byteLength:0,mode:c,filter:p.filter!==Et.NONE?p.filter:void 0,byteStride:_,count:0}}});const T=e.createAccessorDef(s);T.componentType=l.componentType,T.normalized=l.normalized,T.byteOffset=m.byteLength,T.min&&l.min&&(T.min=l.min),T.max&&l.max&&(T.max=l.max),e.accessorIndexMap.set(s,t.accessors.length),t.accessors.push(T),b.push(T),g.push(new Uint8Array(f.buffer,f.byteOffset,f.byteLength)),m.byteLength+=f.byteLength,m.extensions.EXT_meshopt_compression.count+=s.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const r in this._encoderBufferViews){const n=this._encoderBufferViews[r],s=this._encoderBufferViewData[r],o=this.document.getRoot().listBuffers()[n.extensions[Ot].buffer],i=e.otherBufferViews.get(o)||[],{count:a,byteStride:c,mode:u}=n.extensions[Ot],p=w.concat(s),l=t.encodeGltfBuffer(p,a,c,u),f=w.pad(l);n.extensions[Ot].byteLength=l.byteLength,s.length=0,s.push(f),i.push(f),e.otherBufferViews.set(o,i)}}write(e){let t=0;for(const r in this._encoderBufferViews){const n=this._encoderBufferViews[r],s=this._encoderBufferViewData[r][0],o=e.otherBufferViewsIndexMap.get(s),i=this._encoderBufferViewAccessors[r];for(const e of i)e.bufferView=o;const a=e.jsonDoc.json.bufferViews[o],c=a.byteOffset||0;Object.assign(a,n),a.byteOffset=t;a.extensions[Ot].byteOffset=c,t+=w.padNumber(n.byteLength)}const r=this._encoderFallbackBuffer,n=e.bufferIndexMap.get(r),s=e.jsonDoc.json.buffers[n];return s.byteLength=t,s.extensions={[Ot]:{fallback:!0}},r.dispose(),this}}Dt.EXTENSION_NAME=Ot,Dt.EncoderMethod=bt;const jt="EXT_texture_avif";class Pt{match(e){return e.length>=12&&"ftypavif"===w.decodeText(e.slice(4,12))}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=Ut(t,0);if(!r)return null;let n=r.end;for(;r=Ut(t,n);)if("meta"===r.type)n=r.start+4;else if("iprp"===r.type||"ipco"===r.type)n=r.start;else{if("ispe"===r.type)return[t.getUint32(r.start+4),t.getUint32(r.start+8)];if("mdat"===r.type)break;n=r.end}return null}getChannels(e){return 4}}class Ft extends Re{constructor(...e){super(...e),this.extensionName=jt,this.prereadTypes=[d.TEXTURE]}static register(){C.registerFormat("image/avif",new Pt)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[jt]&&(e.source=e.extensions[jt].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/avif"===r.getMimeType()){const n=e.imageIndexMap.get(r);(t.json.textures||[]).forEach((e=>{e.source===n&&(e.extensions=e.extensions||{},e.extensions[jt]={source:e.source},delete e.source)}))}})),this}}function Ut(e,t){if(e.byteLength<4+t)return null;const r=e.getUint32(t);return e.byteLength<r+t||r<8?null:{type:w.decodeText(new Uint8Array(e.buffer,e.byteOffset+t+4,4)),start:t+8,end:t+r}}Ft.EXTENSION_NAME=jt;const Lt="EXT_texture_webp";class Gt{match(e){return e.length>=12&&87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]}getSize(e){const t=w.decodeText(e.slice(0,4)),r=w.decodeText(e.slice(8,12));if("RIFF"!==t||"WEBP"!==r)return null;const n=new DataView(e.buffer,e.byteOffset);let s=12;for(;s<n.byteLength;){const e=w.decodeText(new Uint8Array([n.getUint8(s),n.getUint8(s+1),n.getUint8(s+2),n.getUint8(s+3)])),t=n.getUint32(s+4,!0);if("VP8 "===e){return[16383&n.getInt16(s+14,!0),16383&n.getInt16(s+16,!0)]}if("VP8L"===e){const e=n.getUint8(s+9),t=n.getUint8(s+10),r=n.getUint8(s+11);return[1+((63&t)<<8|e),1+((15&n.getUint8(s+12))<<10|r<<2|(192&t)>>6)]}s+=8+t+t%2}return null}getChannels(e){return 4}}class Bt extends Re{constructor(...e){super(...e),this.extensionName=Lt,this.prereadTypes=[d.TEXTURE]}static register(){C.registerFormat("image/webp",new Gt)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[Lt]&&(e.source=e.extensions[Lt].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/webp"===r.getMimeType()){const n=e.imageIndexMap.get(r);(t.json.textures||[]).forEach((e=>{e.source===n&&(e.extensions=e.extensions||{},e.extensions[Lt]={source:e.source},delete e.source)}))}})),this}}Bt.EXTENSION_NAME=Lt;const Vt=Qe;let kt,zt,Ht,qt;function $t(e,t){const r=new kt.DecoderBuffer;try{r.Init(t,t.length);if(e.GetEncodedGeometryType(r)!==kt.TRIANGULAR_MESH)throw new Error(`[${Vt}] Unknown geometry type.`);const n=new kt.Mesh;if(!e.DecodeBufferToMesh(r,n).ok()||0===n.ptr)throw new Error(`[${Vt}] Decoding failure.`);return n}finally{kt.destroy(r)}}function Wt(e,t){const r=3*t.num_faces();let n,s;if(t.num_points()<=65534){const o=r*Uint16Array.BYTES_PER_ELEMENT;n=kt._malloc(o),e.GetTrianglesUInt16Array(t,o,n),s=new Uint16Array(kt.HEAPU16.buffer,n,r).slice()}else{const o=r*Uint32Array.BYTES_PER_ELEMENT;n=kt._malloc(o),e.GetTrianglesUInt32Array(t,o,n),s=new Uint32Array(kt.HEAPU32.buffer,n,r).slice()}return kt._free(n),s}function Xt(e,t,r,n){const s=Ht[n.componentType],o=zt[n.componentType],i=r.num_components(),a=t.num_points()*i,c=a*o.BYTES_PER_ELEMENT,u=kt._malloc(c);e.GetAttributeDataArrayForAllPoints(t,r,s,c,u);const p=new o(kt.HEAPF32.buffer,u,a).slice();return kt._free(u),p}var Yt,Qt;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(Yt||(Yt={})),function(e){e.POSITION="POSITION",e.NORMAL="NORMAL",e.COLOR="COLOR",e.TEX_COORD="TEX_COORD",e.GENERIC="GENERIC"}(Qt||(Qt={}));const Kt={[Qt.POSITION]:14,[Qt.NORMAL]:10,[Qt.COLOR]:8,[Qt.TEX_COORD]:12,[Qt.GENERIC]:12},Jt={decodeSpeed:5,encodeSpeed:5,method:Yt.EDGEBREAKER,quantizationBits:Kt,quantizationVolume:"mesh"};function Zt(e,t=Jt){const r=gt({},Jt,t);r.quantizationBits=gt({},Kt,t.quantizationBits);const n=new qt.MeshBuilder,s=new qt.Mesh,o=new qt.ExpertEncoder(s),i={},a=new qt.DracoInt8Array,c=e.listTargets().length>0;let u=!1;for(const t of e.listSemantics()){const a=e.getAttribute(t);if(a.getSparse()){u=!0;continue}const c=er(t),p=tr(n,a.getComponentType(),s,qt[c],a.getCount(),a.getElementSize(),a.getArray());if(-1===p)throw new Error(`Error compressing "${t}" attribute.`);if(i[t]=p,"mesh"===r.quantizationVolume||"POSITION"!==t)o.SetAttributeQuantization(p,r.quantizationBits[c]);else{if("object"!=typeof r.quantizationVolume)throw new Error("Invalid quantization volume state.");{const{quantizationVolume:e}=r,t=Math.max(e.max[0]-e.min[0],e.max[1]-e.min[1],e.max[2]-e.min[2]);o.SetAttributeExplicitQuantization(p,r.quantizationBits[c],a.getElementSize(),e.min,t)}}}const p=e.getIndices();if(!p)throw new rr("Primitive must have indices.");n.AddFacesToMesh(s,p.getCount()/3,p.getArray()),o.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),o.SetTrackEncodedProperties(!0),r.method===Yt.SEQUENTIAL||c||u?o.SetEncodingMethod(qt.MESH_SEQUENTIAL_ENCODING):o.SetEncodingMethod(qt.MESH_EDGEBREAKER_ENCODING);const l=o.EncodeToDracoBuffer(!(c||u),a);if(l<=0)throw new rr("Error applying Draco compression.");const f=new Uint8Array(l);for(let e=0;e<l;++e)f[e]=a.GetValue(e);const _=o.GetNumberOfEncodedPoints(),d=3*o.GetNumberOfEncodedFaces();return qt.destroy(a),qt.destroy(s),qt.destroy(n),qt.destroy(o),{numVertices:_,numIndices:d,data:f,attributeIDs:i}}function er(e){return"POSITION"===e?Qt.POSITION:"NORMAL"===e?Qt.NORMAL:e.startsWith("COLOR_")?Qt.COLOR:e.startsWith("TEXCOORD_")?Qt.TEX_COORD:Qt.GENERIC}function tr(e,t,r,n,s,o,i){switch(t){case re.ComponentType.UNSIGNED_BYTE:return e.AddUInt8Attribute(r,n,s,o,i);case re.ComponentType.BYTE:return e.AddInt8Attribute(r,n,s,o,i);case re.ComponentType.UNSIGNED_SHORT:return e.AddUInt16Attribute(r,n,s,o,i);case re.ComponentType.SHORT:return e.AddInt16Attribute(r,n,s,o,i);case re.ComponentType.UNSIGNED_INT:return e.AddUInt32Attribute(r,n,s,o,i);case re.ComponentType.FLOAT:return e.AddFloatAttribute(r,n,s,o,i);default:throw new Error(`Unexpected component type, "${t}".`)}}class rr extends Error{}const nr=Qe;class sr extends Re{constructor(...e){super(...e),this.extensionName=nr,this.prereadTypes=[d.PRIMITIVE],this.prewriteTypes=[d.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){var r,n;return"draco3d.decoder"===e&&(this._decoderModule=t,r=this._decoderModule,kt=r,zt={[re.ComponentType.FLOAT]:Float32Array,[re.ComponentType.UNSIGNED_INT]:Uint32Array,[re.ComponentType.UNSIGNED_SHORT]:Uint16Array,[re.ComponentType.UNSIGNED_BYTE]:Uint8Array,[re.ComponentType.SHORT]:Int16Array,[re.ComponentType.BYTE]:Int8Array},Ht={[re.ComponentType.FLOAT]:kt.DT_FLOAT32,[re.ComponentType.UNSIGNED_INT]:kt.DT_UINT32,[re.ComponentType.UNSIGNED_SHORT]:kt.DT_UINT16,[re.ComponentType.UNSIGNED_BYTE]:kt.DT_UINT8,[re.ComponentType.SHORT]:kt.DT_INT16,[re.ComponentType.BYTE]:kt.DT_INT8}),"draco3d.encoder"===e&&(this._encoderModule=t,n=this._encoderModule,qt=n),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${nr}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),r=e.jsonDoc,n=new Map;try{const s=r.json.meshes||[];for(const o of s)for(const s of o.primitives){if(!s.extensions||!s.extensions[nr])continue;const o=s.extensions[nr];let[i,a]=n.get(o.bufferView)||[];if(!a||!i){const e=r.json.bufferViews[o.bufferView],s=r.json.buffers[e.buffer],c=s.uri?r.resources[s.uri]:r.resources[_],u=e.byteOffset||0,p=e.byteLength,l=w.toView(c,u,p);i=new this._decoderModule.Decoder,a=$t(i,l),n.set(o.bufferView,[i,a]),t.debug(`[${nr}] Decompressed ${l.byteLength} bytes.`)}for(const t in o.attributes){const r=e.jsonDoc.json.accessors[s.attributes[t]],n=i.GetAttributeByUniqueId(a,o.attributes[t]),c=Xt(i,a,n,r);e.accessors[s.attributes[t]].setArray(c)}void 0!==s.indices&&e.accessors[s.indices].setArray(Wt(i,a))}}finally{for(const[e,t]of Array.from(n.values()))this._decoderModule.destroy(e),this._decoderModule.destroy(t)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${nr}] Please install extension dependency, "draco3d.encoder".`);const r=this.document.getLogger();r.debug(`[${nr}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const n=function(e){const t=e.getLogger(),r=new Set,n=new Set;let s=0,o=0;for(const t of e.getRoot().listMeshes())for(const e of t.listPrimitives())e.getIndices()?e.getMode()!==me.Mode.TRIANGLES?(n.add(e),o++):r.add(e):(n.add(e),s++);s>0&&t.warn(`[${nr}] Skipping Draco compression of ${s} non-indexed primitives.`);o>0&&t.warn(`[${nr}] Skipping Draco compression of ${o} non-TRIANGLES primitives.`);const i=e.getRoot().listAccessors(),a=new Map;for(let e=0;e<i.length;e++)a.set(i[e],e);const c=new Map,u=new Set,p=new Map;for(const t of Array.from(r)){let r=or(t,a);if(u.has(r))p.set(t,r);else{if(c.has(t.getIndices())){const r=t.getIndices(),n=r.clone();a.set(n,e.getRoot().listAccessors().length-1),t.swap(r,n)}for(const r of t.listAttributes())if(c.has(r)){const n=r.clone();a.set(n,e.getRoot().listAccessors().length-1),t.swap(r,n)}r=or(t,a),u.add(r),p.set(t,r),c.set(t.getIndices(),r);for(const e of t.listAttributes())c.set(e,r)}}for(const e of Array.from(c.keys())){const t=new Set(e.listParents().map((e=>e.propertyType)));if(2!==t.size||!t.has(d.PRIMITIVE)||!t.has(d.ROOT))throw new Error(`[${nr}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const e of Array.from(r)){const t=p.get(e),r=e.getIndices();if(c.get(r)!==t||e.listAttributes().some((e=>c.get(e)!==t)))throw new Error(`[${nr}] Draco primitives must share all, or no, accessors.`)}for(const e of Array.from(n)){const t=e.getIndices();if(c.has(t)||e.listAttributes().some((e=>c.has(e))))throw new Error(`[${nr}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return p}(this.document),s=new Map;let o="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.document.getRoot().listScenes().length?r.warn(`[${nr}]: quantizationVolume=scene requires exactly 1 scene.`):o=function(e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=e.propertyType===d.NODE?[e]:e.listChildren();for(const e of r)e.traverse((e=>{const r=e.getMesh();if(!r)return;const n=S(r,e.getWorldMatrix());n.min.every(isFinite)&&n.max.every(isFinite)&&(M(n.min,t),M(n.max,t))}));return t}(this.document.getRoot().listScenes().pop()));for(const t of Array.from(n.keys())){const i=n.get(t);if(!i)throw new Error("Unexpected primitive.");if(s.has(i)){s.set(i,s.get(i));continue}const a=t.getIndices(),c=e.jsonDoc.json.accessors;let u;try{u=Zt(t,gt({},this._encoderOptions,{quantizationVolume:o}))}catch(e){if(e instanceof rr){r.warn(`[${nr}]: ${e.message} Skipping primitive compression.`);continue}throw e}s.set(i,u);const p=e.createAccessorDef(a);p.count=u.numIndices,e.accessorIndexMap.set(a,c.length),c.push(p),u.numVertices>65534&&re.getComponentSize(p.componentType)<=2?p.componentType=re.ComponentType.UNSIGNED_INT:u.numVertices>254&&re.getComponentSize(p.componentType)<=1&&(p.componentType=re.ComponentType.UNSIGNED_SHORT);for(const r of t.listSemantics()){const n=t.getAttribute(r);if(void 0===u.attributeIDs[r])continue;const s=e.createAccessorDef(n);s.count=u.numVertices,e.accessorIndexMap.set(n,c.length),c.push(s)}const l=t.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(l)||e.otherBufferViews.set(l,[]),e.otherBufferViews.get(l).push(u.data)}return r.debug(`[${nr}] Compressed ${n.size} primitives.`),e.extensionData[nr]={primitiveHashMap:n,primitiveEncodingMap:s},this}write(e){const t=e.extensionData[nr];for(const r of this.document.getRoot().listMeshes()){const n=e.jsonDoc.json.meshes[e.meshIndexMap.get(r)];for(let s=0;s<r.listPrimitives().length;s++){const o=r.listPrimitives()[s],i=n.primitives[s],a=t.primitiveHashMap.get(o);if(!a)continue;const c=t.primitiveEncodingMap.get(a);c&&(i.extensions=i.extensions||{},i.extensions[nr]={bufferView:e.otherBufferViewsIndexMap.get(c.data),attributes:c.attributeIDs})}}if(!t.primitiveHashMap.size){const t=e.jsonDoc.json;t.extensionsUsed=(t.extensionsUsed||[]).filter((e=>e!==nr)),t.extensionsRequired=(t.extensionsRequired||[]).filter((e=>e!==nr))}return this}}function or(e,t){const r=[],n=e.getIndices();r.push(t.get(n));for(const n of e.listAttributes())r.push(t.get(n));return r.sort().join("|")}sr.EXTENSION_NAME=nr,sr.EncoderMethod=Yt;class ir extends ce{init(){this.extensionName=Ke,this.propertyType="Light",this.parentTypes=[d.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:ir.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}ir.EXTENSION_NAME=Ke,ir.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const ar=Ke;class cr extends Re{constructor(...e){super(...e),this.extensionName=ar}createLight(e=""){return new ir(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[ar])return this;const r=(t.json.extensions[ar].lights||[]).map((e=>{var t,r;const n=this.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&n.setColor(e.color),void 0!==e.intensity&&n.setIntensity(e.intensity),void 0!==e.range&&n.setRange(e.range),void 0!==(null==(t=e.spot)?void 0:t.innerConeAngle)&&n.setInnerConeAngle(e.spot.innerConeAngle),void 0!==(null==(r=e.spot)?void 0:r.outerConeAngle)&&n.setOuterConeAngle(e.spot.outerConeAngle),n}));return t.json.nodes.forEach(((t,n)=>{if(!t.extensions||!t.extensions[ar])return;const s=t.extensions[ar];e.nodes[n].setExtension(ar,r[s.light])})),this}write(e){const t=e.jsonDoc;if(0===this.properties.size)return this;const r=[],n=new Map;for(const e of this.properties){const t=e,s={type:t.getType()};B.eq(t.getColor(),[1,1,1])||(s.color=t.getColor()),1!==t.getIntensity()&&(s.intensity=t.getIntensity()),null!=t.getRange()&&(s.range=t.getRange()),t.getName()&&(s.name=t.getName()),t.getType()===ir.Type.SPOT&&(s.spot={innerConeAngle:t.getInnerConeAngle(),outerConeAngle:t.getOuterConeAngle()}),r.push(s),n.set(t,r.length-1)}return this.document.getRoot().listNodes().forEach((r=>{const s=r.getExtension(ar);if(s){const o=e.nodeIndexMap.get(r),i=t.json.nodes[o];i.extensions=i.extensions||{},i.extensions[ar]={light:n.get(s)}}})),t.json.extensions=t.json.extensions||{},t.json.extensions[ar]={lights:r},this}}cr.EXTENSION_NAME=ar;const{R:ur,G:pr,B:lr}=m;class fr extends ce{init(){this.extensionName=Je,this.propertyType="Anisotropy",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new ue(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:ur|pr|lr})}}fr.EXTENSION_NAME=Je;const _r=Je;class dr extends Re{constructor(...e){super(...e),this.extensionName=_r,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createAnisotropy(){return new fr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[_r]){const s=this.createAnisotropy();e.materials[r].setExtension(_r,s);const o=t.extensions[_r];if(void 0!==o.anisotropyStrength&&s.setAnisotropyStrength(o.anisotropyStrength),void 0!==o.anisotropyRotation&&s.setAnisotropyRotation(o.anisotropyRotation),void 0!==o.anisotropyTexture){const t=o.anisotropyTexture,r=e.textures[n[t.index].source];s.setAnisotropyTexture(r),e.setTextureInfo(s.getAnisotropyTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(_r);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[_r]={};if(n.getAnisotropyStrength()>0&&(i.anisotropyStrength=n.getAnisotropyStrength()),0!==n.getAnisotropyRotation()&&(i.anisotropyRotation=n.getAnisotropyRotation()),n.getAnisotropyTexture()){const t=n.getAnisotropyTexture(),r=n.getAnisotropyTextureInfo();i.anisotropyTexture=e.createTextureInfoDef(t,r)}}})),this}}dr.EXTENSION_NAME=_r;const{R:hr,G:yr,B:mr}=m;class gr extends ce{init(){this.extensionName=Ze,this.propertyType="Clearcoat",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new ue(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new ue(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new ue(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:hr})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:yr})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:hr|yr|mr})}}gr.EXTENSION_NAME=Ze;const br=Ze;class Tr extends Re{constructor(...e){super(...e),this.extensionName=br,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createClearcoat(){return new gr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[br]){const s=this.createClearcoat();e.materials[r].setExtension(br,s);const o=t.extensions[br];if(void 0!==o.clearcoatFactor&&s.setClearcoatFactor(o.clearcoatFactor),void 0!==o.clearcoatRoughnessFactor&&s.setClearcoatRoughnessFactor(o.clearcoatRoughnessFactor),void 0!==o.clearcoatTexture){const t=o.clearcoatTexture,r=e.textures[n[t.index].source];s.setClearcoatTexture(r),e.setTextureInfo(s.getClearcoatTextureInfo(),t)}if(void 0!==o.clearcoatRoughnessTexture){const t=o.clearcoatRoughnessTexture,r=e.textures[n[t.index].source];s.setClearcoatRoughnessTexture(r),e.setTextureInfo(s.getClearcoatRoughnessTextureInfo(),t)}if(void 0!==o.clearcoatNormalTexture){const t=o.clearcoatNormalTexture,r=e.textures[n[t.index].source];s.setClearcoatNormalTexture(r),e.setTextureInfo(s.getClearcoatNormalTextureInfo(),t),void 0!==t.scale&&s.setClearcoatNormalScale(t.scale)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(br);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[br]={clearcoatFactor:n.getClearcoatFactor(),clearcoatRoughnessFactor:n.getClearcoatRoughnessFactor()};if(n.getClearcoatTexture()){const t=n.getClearcoatTexture(),r=n.getClearcoatTextureInfo();i.clearcoatTexture=e.createTextureInfoDef(t,r)}if(n.getClearcoatRoughnessTexture()){const t=n.getClearcoatRoughnessTexture(),r=n.getClearcoatRoughnessTextureInfo();i.clearcoatRoughnessTexture=e.createTextureInfoDef(t,r)}if(n.getClearcoatNormalTexture()){const t=n.getClearcoatNormalTexture(),r=n.getClearcoatNormalTextureInfo();i.clearcoatNormalTexture=e.createTextureInfoDef(t,r),1!==n.getClearcoatNormalScale()&&(i.clearcoatNormalTexture.scale=n.getClearcoatNormalScale())}}})),this}}Tr.EXTENSION_NAME=br;const{R:Er,G:Ar,B:xr,A:Ir}=m;class Rr extends ce{init(){this.extensionName=et,this.propertyType="DiffuseTransmission",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseTransmissionFactor:0,diffuseTransmissionTexture:null,diffuseTransmissionTextureInfo:new ue(this.graph,"diffuseTransmissionTextureInfo"),diffuseTransmissionColorFactor:[1,1,1],diffuseTransmissionColorTexture:null,diffuseTransmissionColorTextureInfo:new ue(this.graph,"diffuseTransmissionColorTextureInfo")})}getDiffuseTransmissionFactor(){return this.get("diffuseTransmissionFactor")}setDiffuseTransmissionFactor(e){return this.set("diffuseTransmissionFactor",e)}getDiffuseTransmissionTexture(){return this.getRef("diffuseTransmissionTexture")}getDiffuseTransmissionTextureInfo(){return this.getRef("diffuseTransmissionTexture")?this.getRef("diffuseTransmissionTextureInfo"):null}setDiffuseTransmissionTexture(e){return this.setRef("diffuseTransmissionTexture",e,{channels:Ir})}getDiffuseTransmissionColorFactor(){return this.get("diffuseTransmissionColorFactor")}setDiffuseTransmissionColorFactor(e){return this.set("diffuseTransmissionColorFactor",e)}getDiffuseTransmissionColorTexture(){return this.getRef("diffuseTransmissionColorTexture")}getDiffuseTransmissionColorTextureInfo(){return this.getRef("diffuseTransmissionColorTexture")?this.getRef("diffuseTransmissionColorTextureInfo"):null}setDiffuseTransmissionColorTexture(e){return this.setRef("diffuseTransmissionColorTexture",e,{channels:Er|Ar|xr})}}Rr.EXTENSION_NAME=et;const Sr=et;class Mr extends Re{constructor(...e){super(...e),this.extensionName=Sr}createDiffuseTransmission(){return new Rr(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[Sr]){const s=this.createDiffuseTransmission();e.materials[r].setExtension(Sr,s);const o=t.extensions[Sr];if(void 0!==o.diffuseTransmissionFactor&&s.setDiffuseTransmissionFactor(o.diffuseTransmissionFactor),void 0!==o.diffuseTransmissionColorFactor&&s.setDiffuseTransmissionColorFactor(o.diffuseTransmissionColorFactor),void 0!==o.diffuseTransmissionTexture){const t=o.diffuseTransmissionTexture,r=e.textures[n[t.index].source];s.setDiffuseTransmissionTexture(r),e.setTextureInfo(s.getDiffuseTransmissionTextureInfo(),t)}if(void 0!==o.diffuseTransmissionColorTexture){const t=o.diffuseTransmissionColorTexture,r=e.textures[n[t.index].source];s.setDiffuseTransmissionColorTexture(r),e.setTextureInfo(s.getDiffuseTransmissionColorTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;for(const r of this.document.getRoot().listMaterials()){const n=r.getExtension(Sr);if(!n)continue;const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[Sr]={diffuseTransmissionFactor:n.getDiffuseTransmissionFactor(),diffuseTransmissionColorFactor:n.getDiffuseTransmissionColorFactor()};if(n.getDiffuseTransmissionTexture()){const t=n.getDiffuseTransmissionTexture(),r=n.getDiffuseTransmissionTextureInfo();i.diffuseTransmissionTexture=e.createTextureInfoDef(t,r)}if(n.getDiffuseTransmissionColorTexture()){const t=n.getDiffuseTransmissionColorTexture(),r=n.getDiffuseTransmissionColorTextureInfo();i.diffuseTransmissionColorTexture=e.createTextureInfoDef(t,r)}}return this}}Mr.EXTENSION_NAME=Sr;class Nr extends ce{init(){this.extensionName=tt,this.propertyType="Dispersion",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{dispersion:0})}getDispersion(){return this.get("dispersion")}setDispersion(e){return this.set("dispersion",e)}}Nr.EXTENSION_NAME=tt;const wr=tt;class vr extends Re{constructor(...e){super(...e),this.extensionName=wr,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createDispersion(){return new Nr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[wr]){const n=this.createDispersion();e.materials[r].setExtension(wr,n);const s=t.extensions[wr];void 0!==s.dispersion&&n.setDispersion(s.dispersion)}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(wr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{},o.extensions[wr]={dispersion:n.getDispersion()}}})),this}}vr.EXTENSION_NAME=wr;class Or extends ce{init(){this.extensionName=rt,this.propertyType="EmissiveStrength",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}Or.EXTENSION_NAME=rt;const Cr=rt;class Dr extends Re{constructor(...e){super(...e),this.extensionName=Cr,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createEmissiveStrength(){return new Or(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[Cr]){const n=this.createEmissiveStrength();e.materials[r].setExtension(Cr,n);const s=t.extensions[Cr];void 0!==s.emissiveStrength&&n.setEmissiveStrength(s.emissiveStrength)}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(Cr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{},o.extensions[Cr]={emissiveStrength:n.getEmissiveStrength()}}})),this}}Dr.EXTENSION_NAME=Cr;class jr extends ce{init(){this.extensionName=nt,this.propertyType="IOR",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}jr.EXTENSION_NAME=nt;const Pr=nt;class Fr extends Re{constructor(...e){super(...e),this.extensionName=Pr,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createIOR(){return new jr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[Pr]){const n=this.createIOR();e.materials[r].setExtension(Pr,n);const s=t.extensions[Pr];void 0!==s.ior&&n.setIOR(s.ior)}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(Pr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{},o.extensions[Pr]={ior:n.getIOR()}}})),this}}Fr.EXTENSION_NAME=Pr;const{R:Ur,G:Lr}=m;class Gr extends ce{init(){this.extensionName=st,this.propertyType="Iridescence",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new ue(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new ue(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Ur})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Lr})}}Gr.EXTENSION_NAME=st;const Br=st;class Vr extends Re{constructor(...e){super(...e),this.extensionName=Br,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createIridescence(){return new Gr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[Br]){const s=this.createIridescence();e.materials[r].setExtension(Br,s);const o=t.extensions[Br];if(void 0!==o.iridescenceFactor&&s.setIridescenceFactor(o.iridescenceFactor),void 0!==o.iridescenceIor&&s.setIridescenceIOR(o.iridescenceIor),void 0!==o.iridescenceThicknessMinimum&&s.setIridescenceThicknessMinimum(o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&s.setIridescenceThicknessMaximum(o.iridescenceThicknessMaximum),void 0!==o.iridescenceTexture){const t=o.iridescenceTexture,r=e.textures[n[t.index].source];s.setIridescenceTexture(r),e.setTextureInfo(s.getIridescenceTextureInfo(),t)}if(void 0!==o.iridescenceThicknessTexture){const t=o.iridescenceThicknessTexture,r=e.textures[n[t.index].source];s.setIridescenceThicknessTexture(r),e.setTextureInfo(s.getIridescenceThicknessTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(Br);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[Br]={};if(n.getIridescenceFactor()>0&&(i.iridescenceFactor=n.getIridescenceFactor()),1.3!==n.getIridescenceIOR()&&(i.iridescenceIor=n.getIridescenceIOR()),100!==n.getIridescenceThicknessMinimum()&&(i.iridescenceThicknessMinimum=n.getIridescenceThicknessMinimum()),400!==n.getIridescenceThicknessMaximum()&&(i.iridescenceThicknessMaximum=n.getIridescenceThicknessMaximum()),n.getIridescenceTexture()){const t=n.getIridescenceTexture(),r=n.getIridescenceTextureInfo();i.iridescenceTexture=e.createTextureInfoDef(t,r)}if(n.getIridescenceThicknessTexture()){const t=n.getIridescenceThicknessTexture(),r=n.getIridescenceThicknessTextureInfo();i.iridescenceThicknessTexture=e.createTextureInfoDef(t,r)}}})),this}}Vr.EXTENSION_NAME=Br;const{R:kr,G:zr,B:Hr,A:qr}=m;class $r extends ce{init(){this.extensionName=ot,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new ue(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new ue(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:kr|zr|Hr|qr,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:kr|zr|Hr|qr})}}$r.EXTENSION_NAME=ot;const Wr=ot;class Xr extends Re{constructor(...e){super(...e),this.extensionName=Wr,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createPBRSpecularGlossiness(){return new $r(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[Wr]){const s=this.createPBRSpecularGlossiness();e.materials[r].setExtension(Wr,s);const o=t.extensions[Wr];if(void 0!==o.diffuseFactor&&s.setDiffuseFactor(o.diffuseFactor),void 0!==o.specularFactor&&s.setSpecularFactor(o.specularFactor),void 0!==o.glossinessFactor&&s.setGlossinessFactor(o.glossinessFactor),void 0!==o.diffuseTexture){const t=o.diffuseTexture,r=e.textures[n[t.index].source];s.setDiffuseTexture(r),e.setTextureInfo(s.getDiffuseTextureInfo(),t)}if(void 0!==o.specularGlossinessTexture){const t=o.specularGlossinessTexture,r=e.textures[n[t.index].source];s.setSpecularGlossinessTexture(r),e.setTextureInfo(s.getSpecularGlossinessTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(Wr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[Wr]={diffuseFactor:n.getDiffuseFactor(),specularFactor:n.getSpecularFactor(),glossinessFactor:n.getGlossinessFactor()};if(n.getDiffuseTexture()){const t=n.getDiffuseTexture(),r=n.getDiffuseTextureInfo();i.diffuseTexture=e.createTextureInfoDef(t,r)}if(n.getSpecularGlossinessTexture()){const t=n.getSpecularGlossinessTexture(),r=n.getSpecularGlossinessTextureInfo();i.specularGlossinessTexture=e.createTextureInfoDef(t,r)}}})),this}}Xr.EXTENSION_NAME=Wr;const{R:Yr,G:Qr,B:Kr,A:Jr}=m;class Zr extends ce{init(){this.extensionName=it,this.propertyType="Sheen",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new ue(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new ue(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Yr|Qr|Kr,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Jr})}}Zr.EXTENSION_NAME=it;const en=it;class tn extends Re{constructor(...e){super(...e),this.extensionName=en,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createSheen(){return new Zr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[en]){const s=this.createSheen();e.materials[r].setExtension(en,s);const o=t.extensions[en];if(void 0!==o.sheenColorFactor&&s.setSheenColorFactor(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&s.setSheenRoughnessFactor(o.sheenRoughnessFactor),void 0!==o.sheenColorTexture){const t=o.sheenColorTexture,r=e.textures[n[t.index].source];s.setSheenColorTexture(r),e.setTextureInfo(s.getSheenColorTextureInfo(),t)}if(void 0!==o.sheenRoughnessTexture){const t=o.sheenRoughnessTexture,r=e.textures[n[t.index].source];s.setSheenRoughnessTexture(r),e.setTextureInfo(s.getSheenRoughnessTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(en);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[en]={sheenColorFactor:n.getSheenColorFactor(),sheenRoughnessFactor:n.getSheenRoughnessFactor()};if(n.getSheenColorTexture()){const t=n.getSheenColorTexture(),r=n.getSheenColorTextureInfo();i.sheenColorTexture=e.createTextureInfoDef(t,r)}if(n.getSheenRoughnessTexture()){const t=n.getSheenRoughnessTexture(),r=n.getSheenRoughnessTextureInfo();i.sheenRoughnessTexture=e.createTextureInfoDef(t,r)}}})),this}}tn.EXTENSION_NAME=en;const{R:rn,G:nn,B:sn,A:on}=m;class an extends ce{init(){this.extensionName=at,this.propertyType="Specular",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new ue(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new ue(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:on})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:rn|nn|sn,isColor:!0})}}an.EXTENSION_NAME=at;const cn=at;class un extends Re{constructor(...e){super(...e),this.extensionName=cn,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createSpecular(){return new an(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[cn]){const s=this.createSpecular();e.materials[r].setExtension(cn,s);const o=t.extensions[cn];if(void 0!==o.specularFactor&&s.setSpecularFactor(o.specularFactor),void 0!==o.specularColorFactor&&s.setSpecularColorFactor(o.specularColorFactor),void 0!==o.specularTexture){const t=o.specularTexture,r=e.textures[n[t.index].source];s.setSpecularTexture(r),e.setTextureInfo(s.getSpecularTextureInfo(),t)}if(void 0!==o.specularColorTexture){const t=o.specularColorTexture,r=e.textures[n[t.index].source];s.setSpecularColorTexture(r),e.setTextureInfo(s.getSpecularColorTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(cn);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[cn]={};if(1!==n.getSpecularFactor()&&(i.specularFactor=n.getSpecularFactor()),B.eq(n.getSpecularColorFactor(),[1,1,1])||(i.specularColorFactor=n.getSpecularColorFactor()),n.getSpecularTexture()){const t=n.getSpecularTexture(),r=n.getSpecularTextureInfo();i.specularTexture=e.createTextureInfoDef(t,r)}if(n.getSpecularColorTexture()){const t=n.getSpecularColorTexture(),r=n.getSpecularColorTextureInfo();i.specularColorTexture=e.createTextureInfoDef(t,r)}}})),this}}un.EXTENSION_NAME=cn;const{R:pn}=m;class ln extends ce{init(){this.extensionName=ct,this.propertyType="Transmission",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new ue(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:pn})}}ln.EXTENSION_NAME=ct;const fn=ct;class _n extends Re{constructor(...e){super(...e),this.extensionName=fn,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createTransmission(){return new ln(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[fn]){const s=this.createTransmission();e.materials[r].setExtension(fn,s);const o=t.extensions[fn];if(void 0!==o.transmissionFactor&&s.setTransmissionFactor(o.transmissionFactor),void 0!==o.transmissionTexture){const t=o.transmissionTexture,r=e.textures[n[t.index].source];s.setTransmissionTexture(r),e.setTextureInfo(s.getTransmissionTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(fn);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[fn]={transmissionFactor:n.getTransmissionFactor()};if(n.getTransmissionTexture()){const t=n.getTransmissionTexture(),r=n.getTransmissionTextureInfo();i.transmissionTexture=e.createTextureInfoDef(t,r)}}})),this}}_n.EXTENSION_NAME=fn;class dn extends ce{init(){this.extensionName=ut,this.propertyType="Unlit",this.parentTypes=[d.MATERIAL]}}dn.EXTENSION_NAME=ut;const hn=ut;class yn extends Re{constructor(...e){super(...e),this.extensionName=hn,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createUnlit(){return new dn(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{t.extensions&&t.extensions[hn]&&e.materials[r].setExtension(hn,this.createUnlit())})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{if(r.getExtension(hn)){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{},s.extensions[hn]={}}})),this}}yn.EXTENSION_NAME=hn;class mn extends ce{init(){this.extensionName=lt,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:new a})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}mn.EXTENSION_NAME=lt;class gn extends ce{init(){this.extensionName=lt,this.propertyType="MappingList",this.parentTypes=[d.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:new a})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}gn.EXTENSION_NAME=lt;class bn extends ce{init(){this.extensionName=lt,this.propertyType="Variant",this.parentTypes=["MappingList"]}}bn.EXTENSION_NAME=lt;const Tn=lt;class En extends Re{constructor(...e){super(...e),this.extensionName=Tn}createMappingList(){return new gn(this.document.getGraph())}createVariant(e=""){return new bn(this.document.getGraph(),e)}createMapping(){return new mn(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter((e=>e instanceof bn))}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[Tn])return this;const r=(t.json.extensions[Tn].variants||[]).map((e=>this.createVariant().setName(e.name||"")));return(t.json.meshes||[]).forEach(((t,n)=>{const s=e.meshes[n];(t.primitives||[]).forEach(((t,n)=>{if(!t.extensions||!t.extensions[Tn])return;const o=this.createMappingList(),i=t.extensions[Tn];for(const t of i.mappings){const n=this.createMapping();void 0!==t.material&&n.setMaterial(e.materials[t.material]);for(const e of t.variants||[])n.addVariant(r[e]);o.addMapping(n)}s.listPrimitives()[n].setExtension(Tn,o)}))})),this}write(e){const t=e.jsonDoc,r=this.listVariants();if(!r.length)return this;const n=[],s=new Map;for(const t of r)s.set(t,n.length),n.push(e.createPropertyDef(t));for(const t of this.document.getRoot().listMeshes()){const r=e.meshIndexMap.get(t);t.listPrimitives().forEach(((t,n)=>{const o=t.getExtension(Tn);if(!o)return;const i=e.jsonDoc.json.meshes[r].primitives[n],a=o.listMappings().map((t=>{const r=e.createPropertyDef(t),n=t.getMaterial();return n&&(r.material=e.materialIndexMap.get(n)),r.variants=t.listVariants().map((e=>s.get(e))),r}));i.extensions=i.extensions||{},i.extensions[Tn]={mappings:a}}))}return t.json.extensions=t.json.extensions||{},t.json.extensions[Tn]={variants:n},this}}En.EXTENSION_NAME=Tn;const{G:An}=m;class xn extends ce{init(){this.extensionName=pt,this.propertyType="Volume",this.parentTypes=[d.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new ue(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:An})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}}xn.EXTENSION_NAME=pt;const In=pt;class Rn extends Re{constructor(...e){super(...e),this.extensionName=In,this.prereadTypes=[d.MESH],this.prewriteTypes=[d.MESH]}createVolume(){return new xn(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[In]){const s=this.createVolume();e.materials[r].setExtension(In,s);const o=t.extensions[In];if(void 0!==o.thicknessFactor&&s.setThicknessFactor(o.thicknessFactor),void 0!==o.attenuationDistance&&s.setAttenuationDistance(o.attenuationDistance),void 0!==o.attenuationColor&&s.setAttenuationColor(o.attenuationColor),void 0!==o.thicknessTexture){const t=o.thicknessTexture,r=e.textures[n[t.index].source];s.setThicknessTexture(r),e.setTextureInfo(s.getThicknessTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(In);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[In]={};if(n.getThicknessFactor()>0&&(i.thicknessFactor=n.getThicknessFactor()),Number.isFinite(n.getAttenuationDistance())&&(i.attenuationDistance=n.getAttenuationDistance()),B.eq(n.getAttenuationColor(),[1,1,1])||(i.attenuationColor=n.getAttenuationColor()),n.getThicknessTexture()){const t=n.getThicknessTexture(),r=n.getThicknessTextureInfo();i.thicknessTexture=e.createTextureInfoDef(t,r)}}})),this}}Rn.EXTENSION_NAME=In;const Sn="KHR_mesh_quantization";class Mn extends Re{constructor(...e){super(...e),this.extensionName=Sn}read(e){return this}write(e){return this}}Mn.EXTENSION_NAME=Sn;const Nn="KHR_texture_basisu";class wn{match(e){return 171===e[0]&&75===e[1]&&84===e[2]&&88===e[3]&&32===e[4]&&50===e[5]&&48===e[6]&&187===e[7]&&13===e[8]&&10===e[9]&&26===e[10]&&10===e[11]}getSize(e){const t=We(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=We(e).dataFormatDescriptor[0];if(163===t.colorModel)return 2!==t.samples.length||15&~t.samples[1].channelType?3:4;if(166===t.colorModel)return 3==(15&t.samples[0].channelType)?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getVRAMByteLength(e){const t=We(e),r=this.getChannels(e)>3;let n=0;for(let e=0;e<t.levels.length;e++){const s=t.levels[e];if(s.uncompressedByteLength)n+=s.uncompressedByteLength;else{n+=Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,e)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,e)))/4)*(r?16:8)}}return n}}class vn extends Re{constructor(...e){super(...e),this.extensionName=Nn,this.prereadTypes=[d.TEXTURE]}static register(){C.registerFormat("image/ktx2",new wn)}preread(e){return e.jsonDoc.json.textures.forEach((e=>{if(e.extensions&&e.extensions[Nn]){const t=e.extensions[Nn];e.source=t.source}})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/ktx2"===r.getMimeType()){const n=e.imageIndexMap.get(r);t.json.textures.forEach((e=>{e.source===n&&(e.extensions=e.extensions||{},e.extensions[Nn]={source:e.source},delete e.source)}))}})),this}}vn.EXTENSION_NAME=Nn;class On extends ce{init(){this.extensionName=ft,this.propertyType="Transform",this.parentTypes=[d.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}On.EXTENSION_NAME=ft;const Cn=ft;class Dn extends Re{constructor(...e){super(...e),this.extensionName=Cn}createTransform(){return new On(this.document.getGraph())}read(e){for(const[t,r]of Array.from(e.textureInfos.entries())){if(!r.extensions||!r.extensions[Cn])continue;const e=this.createTransform(),n=r.extensions[Cn];void 0!==n.offset&&e.setOffset(n.offset),void 0!==n.rotation&&e.setRotation(n.rotation),void 0!==n.scale&&e.setScale(n.scale),void 0!==n.texCoord&&e.setTexCoord(n.texCoord),t.setExtension(Cn,e)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[e,r]of t){const t=e.getExtension(Cn);if(!t)continue;r.extensions=r.extensions||{};const n={},s=B.eq;s(t.getOffset(),[0,0])||(n.offset=t.getOffset()),0!==t.getRotation()&&(n.rotation=t.getRotation()),s(t.getScale(),[1,1])||(n.scale=t.getScale()),null!=t.getTexCoord()&&(n.texCoord=t.getTexCoord()),r.extensions[Cn]=n}return this}}Dn.EXTENSION_NAME=Cn;const jn=[d.ROOT,d.SCENE,d.NODE,d.MESH,d.MATERIAL,d.TEXTURE,d.ANIMATION];class Pn extends ce{init(){this.extensionName=_t,this.propertyType="Packet",this.parentTypes=jn}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",gt({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const r=gt({},this.get("properties"));return t?r[e]=t:delete r[e],this.set("properties",r)}toJSONLD(){return gt({"@context":Fn(this.get("context"))},Fn(this.get("properties")))}fromJSONLD(e){const t=(e=Fn(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${_t}: Missing context for term, "${e}".`)}}function Fn(e){return JSON.parse(JSON.stringify(e))}Pn.EXTENSION_NAME=_t;const Un=_t;class Ln extends Re{constructor(...e){super(...e),this.extensionName=Un}createPacket(){return new Pn(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const r=null==(t=e.jsonDoc.json.extensions)?void 0:t[Un];if(!r||!r.packets)return this;const n=e.jsonDoc.json,s=this.document.getRoot(),o=r.packets.map((e=>this.createPacket().fromJSONLD(e))),i=[[n.asset],n.scenes,n.nodes,n.meshes,n.materials,n.images,n.animations],a=[[s],s.listScenes(),s.listNodes(),s.listMeshes(),s.listMaterials(),s.listTextures(),s.listAnimations()];for(let e=0;e<i.length;e++){const t=i[e]||[];for(let r=0;r<t.length;r++){const n=t[r];if(n.extensions&&n.extensions[Un]){const t=n.extensions[Un];a[e][r].setExtension(Un,o[t.packet])}}}return this}write(e){const{json:t}=e.jsonDoc,r=[];for(const n of this.properties){r.push(n.toJSONLD());for(const s of n.listParents()){let n;switch(s.propertyType){case d.ROOT:n=t.asset;break;case d.SCENE:n=t.scenes[e.sceneIndexMap.get(s)];break;case d.NODE:n=t.nodes[e.nodeIndexMap.get(s)];break;case d.MESH:n=t.meshes[e.meshIndexMap.get(s)];break;case d.MATERIAL:n=t.materials[e.materialIndexMap.get(s)];break;case d.TEXTURE:n=t.images[e.imageIndexMap.get(s)];break;case d.ANIMATION:n=t.animations[e.animationIndexMap.get(s)];break;default:n=null,this.document.getLogger().warn(`[${Un}]: Unsupported parent property, "${s.propertyType}"`)}n&&(n.extensions=n.extensions||{},n.extensions[Un]={packet:r.length-1})}}return r.length>0&&(t.extensions=t.extensions||{},t.extensions[Un]={packets:r}),this}}Ln.EXTENSION_NAME=Un;const Gn=[sr,cr,dr,Tr,Mr,vr,Dr,Fr,Vr,Xr,un,tn,_n,yn,En,Rn,Mn,vn,Dn,Ln];var Bn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Vn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function kn(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}module.exports=function(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=r;return t};var zn=kn(Object.freeze({__proto__:null}));function Hn(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
module.exports=function(e){return null!=e&&(Hn(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Hn(e.slice(0,0))}(e)||!!e._isBuffer)};var qn,$n,Wn=kn(Object.freeze({__proto__:null}));var Xn=function(){if($n)return qn;$n=1;var e=zn,t=Wn,r="undefined"!=typeof Float64Array;function n(e,t){return e[0]-t[0]}function s(){var e,t=this.stride,r=new Array(t.length);for(e=0;e<r.length;++e)r[e]=[Math.abs(t[e]),e];r.sort(n);var s=new Array(r.length);for(e=0;e<s.length;++e)s[e]=r[e][1];return s}function o(t,r){var n=["View",r,"d",t].join("");r<0&&(n="View_Nil"+t);var o="generic"===t;if(-1===r){var a="function "+n+"(a){this.data=a;};\tvar proto="+n+".prototype;\tproto.dtype='"+t+"';\tproto.index=function(){return -1};\tproto.size=0;\tproto.dimension=-1;\tproto.shape=proto.stride=proto.order=[];\tproto.lo=proto.hi=proto.transpose=proto.step=\tfunction(){return new "+n+"(this.data);};\tproto.get=proto.set=function(){};\tproto.pick=function(){return null};\treturn function construct_"+n+"(a){return new "+n+"(a);}";return new Function(a)()}if(0===r){a="function "+n+"(a,d) {\tthis.data = a;\tthis.offset = d\t};\tvar proto="+n+".prototype;\tproto.dtype='"+t+"';\tproto.index=function(){return this.offset};\tproto.dimension=0;\tproto.size=1;\tproto.shape=\tproto.stride=\tproto.order=[];\tproto.lo=\tproto.hi=\tproto.transpose=\tproto.step=function "+n+"_copy() {\treturn new "+n+"(this.data,this.offset)\t};\tproto.pick=function "+n+"_pick(){\treturn TrivialArray(this.data);\t};\tproto.valueOf=proto.get=function "+n+"_get(){\treturn "+(o?"this.data.get(this.offset)":"this.data[this.offset]")+"};\tproto.set=function "+n+"_set(v){\treturn "+(o?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"\t};\treturn function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",a)(i[t][0])}a=["'use strict'"];var c=e(r),u=c.map((function(e){return"i"+e})),p="this.offset+"+c.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),l=c.map((function(e){return"b"+e})).join(","),f=c.map((function(e){return"c"+e})).join(",");a.push("function "+n+"(a,"+l+","+f+",d){this.data=a","this.shape=["+l+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+t+"'","proto.dimension="+r),a.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){\treturn "+c.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===r?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),r<4?(a.push("function "+n+"_order(){"),2===r?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===r&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);\tif(s0>s1){\tif(s1>s2){\treturn [2,1,0];\t}else if(s0>s2){\treturn [1,2,0];\t}else{\treturn [1,0,2];\t}\t}else if(s0>s2){\treturn [2,0,1];\t}else if(s2>s1){\treturn [0,1,2];\t}else{\treturn [0,2,1];\t}}})")):a.push("ORDER})")),a.push("proto.set=function "+n+"_set("+u.join(",")+",v){"),o?a.push("return this.data.set("+p+",v)}"):a.push("return this.data["+p+"]=v}"),a.push("proto.get=function "+n+"_get("+u.join(",")+"){"),o?a.push("return this.data.get("+p+")}"):a.push("return this.data["+p+"]}"),a.push("proto.index=function "+n+"_index(",u.join(),"){return "+p+"}"),a.push("proto.hi=function "+n+"_hi("+u.join(",")+"){return new "+n+"(this.data,"+c.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+c.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var _=c.map((function(e){return"a"+e+"=this.shape["+e+"]"})),d=c.map((function(e){return"c"+e+"=this.stride["+e+"]"}));a.push("proto.lo=function "+n+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+_.join(",")+","+d.join(","));for(var h=0;h<r;++h)a.push("if(typeof i"+h+"==='number'&&i"+h+">=0){\td=i"+h+"|0;\tb+=c"+h+"*d;\ta"+h+"-=d}");a.push("return new "+n+"(this.data,"+c.map((function(e){return"a"+e})).join(",")+","+c.map((function(e){return"c"+e})).join(",")+",b)}"),a.push("proto.step=function "+n+"_step("+u.join(",")+"){var "+c.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+c.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(h=0;h<r;++h)a.push("if(typeof i"+h+"==='number'){\td=i"+h+"|0;\tif(d<0){\tc+=b"+h+"*(a"+h+"-1);\ta"+h+"=ceil(-a"+h+"/d)\t}else{\ta"+h+"=ceil(a"+h+"/d)\t}\tb"+h+"*=d\t}");a.push("return new "+n+"(this.data,"+c.map((function(e){return"a"+e})).join(",")+","+c.map((function(e){return"b"+e})).join(",")+",c)}");var y=new Array(r),m=new Array(r);for(h=0;h<r;++h)y[h]="a[i"+h+"]",m[h]="b[i"+h+"]";a.push("proto.transpose=function "+n+"_transpose("+u+"){"+u.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+y.join(",")+","+m.join(",")+",this.offset)}"),a.push("proto.pick=function "+n+"_pick("+u+"){var a=[],b=[],c=this.offset");for(h=0;h<r;++h)a.push("if(typeof i"+h+"==='number'&&i"+h+">=0){c=(c+this.stride["+h+"]*i"+h+")|0}else{a.push(this.shape["+h+"]);b.push(this.stride["+h+"])}");return a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+c.map((function(e){return"shape["+e+"]"})).join(",")+","+c.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",a.join("\n"))(i[t],s)}var i={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};return qn=function(e,n,s,a){if(void 0===e)return(0,i.array[0])([]);"number"==typeof e&&(e=[e]),void 0===n&&(n=[e.length]);var c=n.length;if(void 0===s){s=new Array(c);for(var u=c-1,p=1;u>=0;--u)s[u]=p,p*=n[u]}if(void 0===a){a=0;for(u=0;u<c;++u)s[u]<0&&(a-=(n[u]-1)*s[u])}for(var l=function(e){if(t(e))return"buffer";if(r)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),f=i[l];f.length<=c+1;)f.push(o(l,f.length-1));return(0,f[c+1])(e,n,s,a)}}(),Yn=Vn(Xn),Qn={},Kn=require("./lib/thunk.js");function Jn(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}module.exports=function(e){var t=new Jn;t.pre=e.pre,t.body=e.body,t.post=e.post;var r=e.args.slice(0);t.argTypes=r;for(var n=0;n<r.length;++n){var s=r[n];if("array"===s||"object"==typeof s&&s.blockIndices){if(t.argTypes[n]="array",t.arrayArgs.push(n),t.arrayBlockIndices.push(s.blockIndices?s.blockIndices:0),t.shimArgs.push("array"+n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array args");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===s)t.scalarArgs.push(n),t.shimArgs.push("scalar"+n);else if("index"===s){if(t.indexArgs.push(n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array index");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array index");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===s){if(t.shapeArgs.push(n),n<t.pre.args.length&&t.pre.args[n].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array shape");if(n<t.post.args.length&&t.post.args[n].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof s||!s.offset)throw new Error("cwise: Unknown argument type "+r[n]);t.argTypes[n]="offset",t.offsetArgs.push({array:s.array,offset:s.offset}),t.offsetArgIndex.push(n)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,Kn(t)};var Zn,es=kn(Object.freeze({__proto__:null}));var ts=(Zn||(Zn=1,function(e){var t=es,r={body:"",args:[],thisVars:[],localVars:[]};function n(e){if(!e)return r;for(var t=0;t<e.args.length;++t){var n=e.args[t];e.args[t]=0===t?{name:n,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:n,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function s(e){for(var r=[],s=0;s<e.args.length;++s)r.push("a"+s);return new Function("P",["return function ",e.funcName,"_ndarrayops(",r.join(","),") {P(",r.join(","),");return a0}"].join(""))(function(e){return t({args:e.args,pre:n(e.pre),body:n(e.body),post:n(e.proc),funcName:e.funcName})}(e))}var o={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var t in o){var r=o[t];e[t]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:t}),e[t+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},funcName:t+"eq"}),e[t+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:t+"s"}),e[t+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},funcName:t+"seq"})}}();var i={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var t in i){var r=i[t];e[t]=s({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:t}),e[t+"eq"]=s({args:["array"],body:{args:["a"],body:"a="+r+"a"},funcName:t+"eq"})}}();var a={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var t in a){var r=a[t];e[t]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:t}),e[t+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:t+"s"}),e[t+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},funcName:t+"eq"}),e[t+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},funcName:t+"seq"})}}();var c=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var t=0;t<c.length;++t){var r=c[t];e[r]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),e[r+"eq"]=s({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},funcName:r+"eq"})}}();var u=["max","min","atan2","pow"];!function(){for(var t=0;t<u.length;++t){var r=u[t];e[r]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),e[r+"s"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),e[r+"eq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},funcName:r+"eq"}),e[r+"seq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},funcName:r+"seq"})}}();var p=["atan2","pow"];!function(){for(var t=0;t<p.length;++t){var r=p[t];e[r+"op"]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),e[r+"ops"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),e[r+"opeq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},funcName:r+"opeq"}),e[r+"opseq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},funcName:r+"opseq"})}}(),e.any=t({args:["array"],pre:r,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),e.all=t({args:["array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),e.sum=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),e.prod=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),e.norm2squared=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),e.norm2=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),e.norminf=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),e.norm1=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),e.sup=t({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.inf=t({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.argmin=t({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.argmax=t({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.random=s({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),e.assign=s({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),e.assigns=s({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),e.equals=t({args:["array","array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}(Qn)),Qn),rs=Vn(ts);function ns(e,t,r=-1){if(4===e.shape.length)return ns(e.pick(r),t,0);if(3===e.shape.length)if(3===e.shape[2])rs.assign(Yn(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),e),rs.assigns(Yn(t,[e.shape[0]*e.shape[1]],[4],3),255);else if(4===e.shape[2])rs.assign(Yn(t,[e.shape[0],e.shape[1],4],[4,4*e.shape[0],1]),e);else{if(1!==e.shape[2])throw new Error("[ndarray-pixels] Incompatible array shape.");rs.assign(Yn(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),Yn(e.data,[e.shape[0],e.shape[1],3],[e.stride[0],e.stride[1],0],e.offset)),rs.assigns(Yn(t,[e.shape[0]*e.shape[1]],[4],3),255)}else{if(2!==e.shape.length)throw new Error("[ndarray-pixels] Incompatible array shape.");rs.assign(Yn(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),Yn(e.data,[e.shape[0],e.shape[1],3],[e.stride[0],e.stride[1],0],e.offset)),rs.assigns(Yn(t,[e.shape[0]*e.shape[1]],[4],3),255)}return t}async function ss(e,t){const r=new OffscreenCanvas(e.shape[0],e.shape[1]),n=r.getContext("2d"),s=n.getImageData(0,0,r.width,r.height);return ns(e,s.data),n.putImageData(s,0,0),async function(e,t){const r=await e.convertToBlob(t),n=await r.arrayBuffer();return new Uint8Array(n)}(r,t)}async function os(e,t){return function(e,t){if(!(e instanceof Uint8Array))throw new Error("[ndarray-pixels] Input must be Uint8Array or Buffer.");const r=new Blob([e],{type:t}),n=URL.createObjectURL(r);return new Promise(((e,t)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=function(){URL.revokeObjectURL(n);const t=new OffscreenCanvas(r.width,r.height).getContext("2d");t.drawImage(r,0,0);const s=t.getImageData(0,0,r.width,r.height);e(Yn(new Uint8Array(s.data),[r.width,r.height,4],[4,4*r.width,1],0))},r.onerror=e=>{URL.revokeObjectURL(n),t(e)},r.src=n}))}(e,t)}async function is(e,t){let r;return r="string"==typeof t?{type:t,quality:void 0}:{type:t.type,quality:t.quality},ss(e,r)}const as=(e,t)=>{if(e<=-t||e>=t)return 0;if(e>-1.1920929e-7&&e<1.1920929e-7)return 1;const r=e*Math.PI;return Math.sin(r)/r*Math.sin(r/t)/(r/t)},cs=(e,t,r,n,s,o,i,a)=>{const c=2**a-1,u=e=>Math.round(e*c),p=s?2:3,l=1/r,f=Math.min(1,r),_=p/f,d=new i((Math.floor(2*(_+1))+2)*t);let h=0;for(let r=0;r<t;r++){const s=(r+.5)*l+n,a=Math.max(0,Math.floor(s-_)),c=Math.min(e-1,Math.ceil(s+_)),y=c-a+1,m=new o(y),g=new i(y);let b=0,T=0;for(let e=a;e<=c;e++){const t=as((e+.5-s)*f,p);b+=t,m[T]=t,T++}let E=0;for(let e=0;e<m.length;e++){const t=m[e]/b;E+=t,g[e]=u(t)}g[t>>1]+=u(1-E);let A=0;for(;A<g.length&&0===g[A];)A++;let x=g.length-1;for(;x>0&&0===g[x];)x--;const I=x-A+1;d[h++]=a+A,d[h++]=I,d.set(g.subarray(A,x+1),h),h+=I}return d},us=(e,t,r,n)=>{const[s,o]=e.shape,[i]=t.shape,a=2**(8*t.data.BYTES_PER_ELEMENT)-1,c=e=>e<0?0:e>a?a:e,u=2**(n-1),p=2*u;for(let n=0;n<o;n++){const s=n;let o=0;for(let a=0;a<i;a++){let i=r[o++],l=0,f=0,_=0,d=0;for(let t=r[o++];t>0;t--){const t=r[o++];l+=t*e.get(i,n,0),f+=t*e.get(i,n,1),_+=t*e.get(i,n,2),d+=t*e.get(i,n,3),i++}t.set(a,s,0,c((l+u)/p)),t.set(a,s,1,c((f+u)/p)),t.set(a,s,2,c((_+u)/p)),t.set(a,s,3,c((d+u)/p))}}};var ps,ls;function fs(e,t,r){if(3!==e.shape.length||3!==t.shape.length)throw new TypeError("Input and output must have exactly 3 dimensions (width, height and colorspace)");const[n,s]=e.shape,[o,i]=t.shape,a=o/n,c=i/s;let u,p;switch(t.dtype){case"uint8_clamped":case"uint8":u=Float32Array,p=Int16Array;break;case"uint16":case"uint32":u=Float64Array,p=Int32Array;break;default:throw TypeError(`Unsupported data type ${t.dtype}`)}const l=7*p.BYTES_PER_ELEMENT,f=cs(n,o,a,0,r===ps.LANCZOS_2,u,p,l),_=cs(s,i,c,0,r===ps.LANCZOS_2,u,p,l),d=Yn(new t.data.constructor(o*s*4),[s,o,4]),h=d.transpose(1,0),y=t.transpose(1,0);us(e,h,f,l),us(d,y,_,l)}function _s(){return _s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_s.apply(null,arguments)}(ls=ps||(ps={}))[ls.LANCZOS_3=3]="LANCZOS_3",ls[ls.LANCZOS_2=2]="LANCZOS_2";const{POINTS:ds,LINES:hs,LINE_STRIP:ys,LINE_LOOP:ms,TRIANGLES:gs,TRIANGLE_STRIP:bs,TRIANGLE_FAN:Ts}=me.Mode;function Es(e,t){return Object.defineProperty(t,"name",{value:e}),t}function As(e,t){const r=_s({},e);for(const e in t)void 0!==t[e]&&(r[e]=t[e]);return r}async function xs(e,t,r){if(!e)return null;const n=e.getImage();if(!n)return null;const s=await os(n,e.getMimeType());for(let e=0;e<s.shape[0];++e)for(let t=0;t<s.shape[1];++t)r(s,e,t);const o=await is(s,"image/png");return t.setImage(o).setMimeType("image/png")}function Is(e){const t=e.getIndices(),r=e.getAttribute("POSITION");switch(e.getMode()){case me.Mode.POINTS:return t?t.getCount():r.getCount();case me.Mode.LINES:return t?t.getCount()/2:r.getCount()/2;case me.Mode.LINE_LOOP:return t?t.getCount():r.getCount();case me.Mode.LINE_STRIP:return t?t.getCount()-1:r.getCount()-1;case me.Mode.TRIANGLES:return t?t.getCount()/3:r.getCount()/3;case me.Mode.TRIANGLE_STRIP:case me.Mode.TRIANGLE_FAN:return t?t.getCount()-2:r.getCount()-2;default:throw new Error("Unexpected mode: "+e.getMode())}}const Rs=new Intl.NumberFormat(void 0,{maximumFractionDigits:0});function Ss(e){return Rs.format(e)}function Ms(e,t){return`${Ss(e)} → ${Ss(t)} (${function(e,t,r=2){return(e>t?"–":"+")+(Math.abs(e-t)/e*100).toFixed(r)+"%"}(e,t)})`}function Ns(e){const t=[];for(const r of e.listAttributes())t.push(r);for(const r of e.listTargets())for(const e of r.listAttributes())t.push(e);return Array.from(new Set(t))}function ws(e,t){if(null==e&&null==t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function vs(e,t){return e.createAccessor(t.getName()).setArray(t.getArray()).setType(t.getType()).setBuffer(t.getBuffer()).setNormalized(t.getNormalized()).setSparse(t.getSparse())}function Os(e,t=e){const r=Cs(e,t);for(let e=0;e<r.length;e++)r[e]=e;return r}function Cs(e,t=e){return t<=65534?new Uint16Array(e):new Uint32Array(e)}function Ds(e){for(const t in e)return!1;return!0}function js(e){const t=Ie.fromGraph(e.getGraph()),r=e.getMaterial();return`${t.getRoot().listMaterials().indexOf(r)}|${Vs[e.getMode()]}|${!!e.getIndices()}|${e.listSemantics().sort().map((t=>{const r=e.getAttribute(t);return`${t}:${r.getElementSize()}:${r.getComponentType()}`})).join("+")}|${e.listTargets().map((t=>t.listSemantics().sort().map((t=>{const r=e.getAttribute(t);return`${t}:${r.getElementSize()}:${r.getComponentType()}`})).join("+"))).join("~")}`}function Ps(e,t){const[r,n]=t,[s,o]=e;if(s<=r&&o<=n)return e;let i=s,a=o;return i>r&&(a=Math.floor(a*(r/i)),i=r),a>n&&(i=Math.floor(i*(n/a)),a=n),[i,a]}function Fs(e,t){if(Us(e[0])&&Us(e[1]))return e;switch(t){case"nearest-pot":return e.map(Ls);case"ceil-pot":return e.map(Bs);case"floor-pot":return e.map(Gs)}}function Us(e){return e<=2||!(e&e-1)&&0!==e}function Ls(e){if(e<=4)return 4;const t=Gs(e),r=Bs(e);return r-e>e-t?t:r}function Gs(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Bs(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}const Vs={[ds]:ds,[hs]:hs,[ys]:hs,[ms]:hs,[gs]:gs,[bs]:gs,[Ts]:gs};function ks(e){const t=function(e){const t=new Set;let r,n=e;for(;r=n.getParentNode();){if(t.has(r))throw new Error("Circular dependency in scene graph.");t.add(r),n=r}return n.listParents().filter((e=>e instanceof Te))}(e),r=e.getParentNode();if(!r)return e;e.setMatrix(e.getWorldMatrix()),r.removeChild(e);for(const r of t)r.addChild(e);return e}var zs="undefined"!=typeof Float32Array?Float32Array:Array;function Hs(e,t){var r=t[0],n=t[1],s=t[2],o=t[3],i=t[4],a=t[5],c=t[6],u=t[7],p=t[8],l=t[9],f=t[10],_=t[11],d=t[12],h=t[13],y=t[14],m=t[15],g=r*a-n*i,b=r*c-s*i,T=r*u-o*i,E=n*c-s*a,A=n*u-o*a,x=s*u-o*c,I=p*h-l*d,R=p*y-f*d,S=p*m-_*d,M=l*y-f*h,N=l*m-_*h,w=f*m-_*y,v=g*w-b*N+T*M+E*S-A*R+x*I;return v?(v=1/v,e[0]=(a*w-c*N+u*M)*v,e[1]=(s*N-n*w-o*M)*v,e[2]=(h*x-y*A+m*E)*v,e[3]=(f*A-l*x-_*E)*v,e[4]=(c*S-i*w-u*R)*v,e[5]=(r*w-s*S+o*R)*v,e[6]=(y*T-d*x-m*b)*v,e[7]=(p*x-f*T+_*b)*v,e[8]=(i*N-a*S+u*I)*v,e[9]=(n*S-r*N-o*I)*v,e[10]=(d*A-h*T+m*g)*v,e[11]=(l*T-p*A-_*g)*v,e[12]=(a*R-i*M-c*I)*v,e[13]=(r*M-n*R+s*I)*v,e[14]=(h*b-d*E-y*g)*v,e[15]=(p*E-l*b+f*g)*v,e):null}function qs(e,t,r){var n=t[0],s=t[1],o=t[2],i=t[3],a=t[4],c=t[5],u=t[6],p=t[7],l=t[8],f=t[9],_=t[10],d=t[11],h=t[12],y=t[13],m=t[14],g=t[15],b=r[0],T=r[1],E=r[2],A=r[3];return e[0]=b*n+T*a+E*l+A*h,e[1]=b*s+T*c+E*f+A*y,e[2]=b*o+T*u+E*_+A*m,e[3]=b*i+T*p+E*d+A*g,b=r[4],T=r[5],E=r[6],A=r[7],e[4]=b*n+T*a+E*l+A*h,e[5]=b*s+T*c+E*f+A*y,e[6]=b*o+T*u+E*_+A*m,e[7]=b*i+T*p+E*d+A*g,b=r[8],T=r[9],E=r[10],A=r[11],e[8]=b*n+T*a+E*l+A*h,e[9]=b*s+T*c+E*f+A*y,e[10]=b*o+T*u+E*_+A*m,e[11]=b*i+T*p+E*d+A*g,b=r[12],T=r[13],E=r[14],A=r[15],e[12]=b*n+T*a+E*l+A*h,e[13]=b*s+T*c+E*f+A*y,e[14]=b*o+T*u+E*_+A*m,e[15]=b*i+T*p+E*d+A*g,e}function $s(){var e=new zs(3);return zs!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ws(e,t){var r=t[0],n=t[1],s=t[2],o=r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Xs(e,t,r){var n=t[0],s=t[1],o=t[2],i=r[3]*n+r[7]*s+r[11]*o+r[15];return i=i||1,e[0]=(r[0]*n+r[4]*s+r[8]*o+r[12])/i,e[1]=(r[1]*n+r[5]*s+r[9]*o+r[13])/i,e[2]=(r[2]*n+r[6]*s+r[10]*o+r[14])/i,e}function Ys(e,t,r){var n=t[0],s=t[1],o=t[2];return e[0]=n*r[0]+s*r[3]+o*r[6],e[1]=n*r[1]+s*r[4]+o*r[7],e[2]=n*r[2]+s*r[5]+o*r[8],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Qs=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e};!function(){var e=$s()}();const Ks="dedup",Js={keepUniqueNames:!1,propertyTypes:[d.ACCESSOR,d.MESH,d.TEXTURE,d.MATERIAL,d.SKIN]};function Zs(e=Js){const t=As(Js,e),r=new Set(t.propertyTypes);for(const e of t.propertyTypes)if(!Js.propertyTypes.includes(e))throw new Error(`${Ks}: Unsupported deduplication on type "${e}".`);return Es(Ks,(e=>{const n=e.getLogger();r.has(d.ACCESSOR)&&function(e){const t=e.getLogger(),r=new Map,n=new Map,s=new Map,o=new Map,i=e.getRoot().listMeshes();i.forEach((e=>{e.listPrimitives().forEach((e=>{e.listAttributes().forEach((e=>a(e,n))),a(e.getIndices(),r)}))}));for(const t of e.getRoot().listAnimations())for(const e of t.listSamplers())a(e.getInput(),s),a(e.getOutput(),o);function a(e,t){if(!e)return;const r=[e.getCount(),e.getType(),e.getComponentType(),e.getNormalized(),e.getSparse()].join(":");let n=t.get(r);n||t.set(r,n=new Set),n.add(e)}function c(e,t){for(let r=0;r<e.length;r++){const n=e[r],s=w.toView(n.getArray());if(!t.has(n))for(let o=r+1;o<e.length;o++){const r=e[o];t.has(r)||w.equals(s,w.toView(r.getArray()))&&t.set(r,n)}}}let u=0;const p=new Map;for(const e of[n,r,s,o])for(const t of e.values())u+=t.size,c(Array.from(t),p);t.debug(`${Ks}: Merged ${p.size} of ${u} accessors.`),i.forEach((e=>{e.listPrimitives().forEach((e=>{e.listAttributes().forEach((t=>{p.has(t)&&e.swap(t,p.get(t))}));const t=e.getIndices();t&&p.has(t)&&e.swap(t,p.get(t))}))}));for(const t of e.getRoot().listAnimations())for(const e of t.listSamplers()){const t=e.getInput(),r=e.getOutput();t&&p.has(t)&&e.swap(t,p.get(t)),r&&p.has(r)&&e.swap(r,p.get(r))}Array.from(p.keys()).forEach((e=>e.dispose()))}(e),r.has(d.TEXTURE)&&function(e,t){const r=e.getLogger(),n=e.getRoot(),s=n.listTextures(),o=new Map;for(let e=0;e<s.length;e++){const r=s[e],n=r.getImage();if(!o.has(r))for(let i=e+1;i<s.length;i++){const e=s[i],a=e.getImage();if(o.has(e))continue;if(r.getMimeType()!==e.getMimeType())continue;if(t.keepUniqueNames&&r.getName()!==e.getName())continue;const c=r.getSize(),u=e.getSize();c&&u&&(c[0]===u[0]&&c[1]===u[1]&&n&&a&&w.equals(n,a)&&o.set(e,r))}}r.debug(`${Ks}: Merged ${o.size} of ${n.listTextures().length} textures.`),Array.from(o.entries()).forEach((([e,t])=>{e.listParents().forEach((r=>{r instanceof xe||r.swap(e,t)})),e.dispose()}))}(e,t),r.has(d.MATERIAL)&&function(e,t){const r=e.getLogger(),n=e.getRoot(),s=n.listMaterials(),o=new Map,i=new Map,a=new Set;t.keepUniqueNames||a.add("name");for(let e=0;e<s.length;e++){const t=s[e];if(!o.has(t)&&!to(t,i))for(let r=e+1;r<s.length;r++){const e=s[r];o.has(e)||(to(e,i)||t.equals(e,a)&&o.set(e,t))}}r.debug(`${Ks}: Merged ${o.size} of ${s.length} materials.`),Array.from(o.entries()).forEach((([e,t])=>{e.listParents().forEach((r=>{r instanceof xe||r.swap(e,t)})),e.dispose()}))}(e,t),r.has(d.MESH)&&function(e,t){const r=e.getLogger(),n=e.getRoot(),s=new Map;n.listAccessors().forEach(((e,t)=>s.set(e,t))),n.listMaterials().forEach(((e,t)=>s.set(e,t)));const o=n.listMeshes().length,i=new Map;for(const e of n.listMeshes()){const r=[];for(const t of e.listPrimitives())r.push(eo(t,s));let n="";if(t.keepUniqueNames&&(n+=e.getName()+";"),n+=r.join(";"),i.has(n)){const t=i.get(n);e.listParents().forEach((r=>{r.propertyType!==d.ROOT&&r.swap(e,t)})),e.dispose()}else i.set(n,e)}r.debug(`${Ks}: Merged ${o-i.size} of ${o} meshes.`)}(e,t),r.has(d.SKIN)&&function(e,t){const r=e.getLogger(),n=e.getRoot(),s=n.listSkins(),o=new Map,i=new Set(["joints"]);t.keepUniqueNames||i.add("name");for(let e=0;e<s.length;e++){const t=s[e];if(!o.has(t))for(let r=e+1;r<s.length;r++){const e=s[r];o.has(e)||t.equals(e,i)&&ws(t.listJoints(),e.listJoints())&&o.set(e,t)}}r.debug(`${Ks}: Merged ${o.size} of ${s.length} skins.`),Array.from(o.entries()).forEach((([e,t])=>{e.listParents().forEach((r=>{r instanceof xe||r.swap(e,t)})),e.dispose()}))}(e,t),n.debug(`${Ks}: Complete.`)}))}function eo(e,t){const r=[];for(const n of e.listSemantics()){const s=e.getAttribute(n);r.push(n+":"+t.get(s))}if(e instanceof me){const n=e.getIndices();n&&r.push("indices:"+t.get(n));const s=e.getMaterial();s&&r.push("material:"+t.get(s)),r.push("mode:"+e.getMode());for(const n of e.listTargets())r.push("target:"+eo(n,t))}return r.join(",")}function to(e,t){if(t.has(e))return t.get(e);const r=e.getGraph(),n=new Set,s=r.listParentEdges(e);for(;s.length>0;){const o=s.pop();if(!0===o.getAttributes().modifyChild)return t.set(e,!0),!0;const i=o.getChild();if(!n.has(i))for(const e of r.listChildEdges(i))s.push(e)}return t.set(e,!1),!1}function ro(){var e=new zs(4);return zs!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}var no=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},so=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},oo=function(e){var t=e[0],r=e[1],n=e[2],s=e[3];return Math.hypot(t,r,n,s)};!function(){var e=ro()}();const io=/color|emissive|diffuse/i;const ao="prune",co=3/255,uo={propertyTypes:[d.NODE,d.SKIN,d.MESH,d.CAMERA,d.PRIMITIVE,d.PRIMITIVE_TARGET,d.ANIMATION,d.MATERIAL,d.TEXTURE,d.ACCESSOR,d.BUFFER],keepLeaves:!1,keepAttributes:!1,keepIndices:!1,keepSolidTextures:!1,keepExtras:!1};function po(e=uo){const t=As(uo,e),r=new Set(t.propertyTypes),n=t.keepExtras;return Es(ao,(async e=>{const s=e.getLogger(),o=e.getRoot(),i=e.getGraph(),a=new lo,c=e=>a.dispose(e.target);if(i.addEventListener("node:dispose",c),r.has(d.MESH))for(const e of o.listMeshes())e.listPrimitives().length>0||e.dispose();if(r.has(d.NODE)){if(!t.keepLeaves)for(const e of o.listScenes())ho(i,e,n);for(const e of o.listNodes())fo(e,n)}if(r.has(d.SKIN))for(const e of o.listSkins())fo(e,n);if(r.has(d.MESH))for(const e of o.listMeshes())fo(e,n);if(r.has(d.CAMERA))for(const e of o.listCameras())fo(e,n);if(r.has(d.PRIMITIVE)&&_o(i,d.PRIMITIVE,n),r.has(d.PRIMITIVE_TARGET)&&_o(i,d.PRIMITIVE_TARGET,n),!t.keepAttributes&&r.has(d.ACCESSOR)){const t=new Map;for(const r of o.listMeshes())for(const n of r.listPrimitives()){const r=n.getMaterial();if(!r)continue;const s=go(n,bo(e,n,r));yo(n,s),n.listTargets().forEach((e=>yo(e,s))),t.has(r)?t.get(r).add(n):t.set(r,new Set([n]))}for(const[e,r]of t)To(e,Array.from(r))}if(!t.keepIndices&&r.has(d.ACCESSOR))for(const e of o.listMeshes())for(const t of e.listPrimitives())mo(t);if(r.has(d.ANIMATION))for(const e of o.listAnimations()){for(const t of e.listChannels())t.getTargetNode()||t.dispose();if(e.listChannels().length)e.listSamplers().forEach((e=>fo(e,n)));else{const t=e.listSamplers();fo(e,n),t.forEach((e=>fo(e,n)))}}if(r.has(d.MATERIAL)&&o.listMaterials().forEach((e=>fo(e,n))),r.has(d.TEXTURE)&&(o.listTextures().forEach((e=>fo(e,n))),t.keepSolidTextures||await async function(e){const t=e.getRoot(),r=e.getGraph(),n=e.getLogger(),s=t.listTextures(),o=s.map((async e=>{var s;const o=await async function(e){const t=await async function(e){try{return await os(e.getImage(),e.getMimeType())}catch(e){return null}}(e);if(!t)return null;const r=[1/0,1/0,1/0,1/0],n=[-1/0,-1/0,-1/0,-1/0],s=[0,0,0,0],[o,i]=t.shape;for(let e=0;e<o;e++){for(let s=0;s<i;s++)for(let o=0;o<4;o++)r[o]=Math.min(r[o],t.get(e,s,o)),n[o]=Math.max(n[o],t.get(e,s,o));if(oo(no(s,n,r))/255>co)return null}return function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}(s,function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}(s,n,r),.5/255)}(e);if(!o)return;"srgb"===function(e){return e.getGraph().listParentEdges(e).some((e=>e.getAttributes().isColor||io.test(e.getName())))?"srgb":null}(e)&&v.convertSRGBToLinear(o,o);const i=e.getName()||e.getURI(),a=null==(s=e.getSize())?void 0:s.join("x"),c=function(e){const t=Ie.fromGraph(e.getGraph()).getRoot(),r=e.getGraph().listParentEdges(e).filter((e=>e.getParent()!==t)).map((e=>e.getName()));return Array.from(new Set(r))}(e);for(const s of r.listParentEdges(e)){const e=s.getParent();e!==t&&Eo(e,o,s.getName(),n)&&s.dispose()}1===e.listParents().length&&(e.dispose(),n.debug(`${ao}: Removed solid-color texture "${i}" (${a}px ${c.join(", ")})`))}));await Promise.all(o)}(e)),r.has(d.ACCESSOR)&&o.listAccessors().forEach((e=>fo(e,n))),r.has(d.BUFFER)&&o.listBuffers().forEach((e=>fo(e,n))),i.removeEventListener("node:dispose",c),a.empty())s.debug(`${ao}: No unused properties found.`);else{const e=a.entries().map((([e,t])=>`${e} (${t})`)).join(", ");s.info(`${ao}: Removed types... ${e}`)}s.debug(`${ao}: Complete.`)}))}class lo{constructor(){this.disposed={}}empty(){for(const e in this.disposed)return!1;return!0}entries(){return Object.entries(this.disposed)}dispose(e){this.disposed[e.propertyType]=this.disposed[e.propertyType]||0,this.disposed[e.propertyType]++}}function fo(e,t){const r=e.listParents().filter((e=>!(e instanceof xe||e instanceof se))),n=t&&!Ds(e.getExtras());r.length||n||e.dispose()}function _o(e,t,r){for(const n of e.listEdges()){const e=n.getParent();e.propertyType===t&&fo(e,r)}}function ho(e,t,r){if(t.listChildren().forEach((t=>ho(e,t,r))),t instanceof Te)return;const n=e.listParentEdges(t).some((e=>{const t=e.getParent().propertyType;return t!==d.ROOT&&t!==d.SCENE&&t!==d.NODE})),s=0===e.listChildren(t).length,o=r&&!Ds(t.getExtras());!s||n||o||t.dispose()}function yo(e,t){for(const r of t)e.setAttribute(r,null)}function mo(e){const t=e.getIndices(),r=t&&t.getArray(),n=e.listAttributes()[0];if(r&&n&&t.getCount()===n.getCount()){for(let e=0,t=r.length;e<t;e++)if(e!==r[e])return;e.setIndices(null)}}function go(e,t){const r=[];for(const n of e.listSemantics())("NORMAL"!==n||t.has(n))&&("TANGENT"!==n||t.has(n))?(n.startsWith("TEXCOORD_")&&!t.has(n)||n.startsWith("COLOR_")&&"COLOR_0"!==n)&&r.push(n):r.push(n);return r}function bo(e,t,r,n=new Set){const s=e.getGraph().listChildEdges(r),o=new Set;for(const e of s)e.getChild()instanceof Ae&&o.add(e.getName());for(const r of s){const s=r.getName(),i=r.getChild();i instanceof ue&&o.has(s.replace(/Info$/,""))&&n.add(`TEXCOORD_${i.getTexCoord()}`),i instanceof Ae&&s.match(/normalTexture/i)&&n.add("TANGENT"),i instanceof ce&&bo(e,t,i,n)}const i=r instanceof de&&!r.getExtension("KHR_materials_unlit"),a=t.getMode()===me.Mode.POINTS;return i&&!a&&n.add("NORMAL"),n}function To(e,t){const r=function(e){const t=e.getGraph(),r=new Set,n=new Set;return function e(s){const o=new Set;for(const e of t.listChildEdges(s))e.getChild()instanceof Ae&&o.add(e.getName()+"Info");for(const i of t.listChildEdges(s)){const t=i.getChild();r.has(t)||(r.add(t),t instanceof ue&&o.has(i.getName())?n.add(t):t instanceof ce&&e(t))}}(e),Array.from(n)}(e),n=new Set(r.map((e=>e.getTexCoord()))),s=Array.from(n).sort(),o=new Map(s.map(((e,t)=>[e,t]))),i=new Map(s.map(((e,t)=>[`TEXCOORD_${e}`,`TEXCOORD_${t}`])));for(const e of r){const t=e.getTexCoord();e.setTexCoord(o.get(t))}for(const e of t){const t=e.listSemantics().filter((e=>e.startsWith("TEXCOORD_"))).sort();a(e,t),e.listTargets().forEach((e=>a(e,t)))}function a(e,t){for(const r of t){const t=e.getAttribute(r);if(!t)continue;const n=i.get(r);n!==r&&(e.setAttribute(n,t),e.setAttribute(r,null))}}}function Eo(e,t,r,n){if(e instanceof de)switch(r){case"baseColorTexture":return e.setBaseColorFactor(so(t,t,e.getBaseColorFactor())),!0;case"emissiveTexture":return e.setEmissiveFactor(Qs([0,0,0],t.slice(0,3),e.getEmissiveFactor())),!0;case"occlusionTexture":return Math.abs(t[0]-1)<=co;case"metallicRoughnessTexture":return e.setRoughnessFactor(t[1]*e.getRoughnessFactor()),e.setMetallicFactor(t[2]*e.getMetallicFactor()),!0;case"normalTexture":return oo(no(ro(),t,[.5,.5,1,1]))<=co}return n.warn(`${ao}: Detected single-color ${r} texture. Pruning ${r} not yet supported.`),!1}const Ao=2**32-1;class xo{constructor(e){this.attributes=[],this.u8=void 0,this.u32=void 0;let t=0;for(const r of Ns(e))t+=this._initAttribute(r);this.u8=new Uint8Array(t),this.u32=new Uint32Array(this.u8.buffer)}_initAttribute(e){const t=e.getArray(),r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=e.getElementSize()*e.getComponentSize(),s=w.padNumber(n);return this.attributes.push({u8:r,byteStride:n,paddedByteStride:s}),s}hash(e){let t=0;for(const{u8:r,byteStride:n,paddedByteStride:s}of this.attributes){for(let o=0;o<s;o++)this.u8[t+o]=o<n?r[e*n+o]:0;t+=s}return function(e,t){const r=1540483477,n=24;for(let s=0,o=t.length;s<o;s++){let o=t[s];o=Math.imul(o,r)>>>0,o=(o^o>>n)>>>0,o=Math.imul(o,r)>>>0,e=((e=Math.imul(e,r)>>>0)^o)>>>0}return e}(0,this.u32)}equal(e,t){for(const{u8:r,byteStride:n}of this.attributes)for(let s=0;s<n;s++)if(r[e*n+s]!==r[t*n+s])return!1;return!0}}function Io(e,t,r,n,s=4294967295){const o=t-1;let i=r.hash(n)&o;for(let t=0;t<=o;t++){const a=e[i];if(a===s||r.equal(a,n))return i;i=i+t+1&o}throw new Error("Hash table full.")}var Ro;function So(e,t){const r=e.getAttribute("POSITION"),n=e.getIndices();switch(t){case Ro.RENDER:return n?n.getCount():r.getCount();case Ro.RENDER_CACHED:return n?new Set(n.getArray()).size:r.getCount();case Ro.UPLOAD_NAIVE:case Ro.UPLOAD:return r.getCount();case Ro.DISTINCT:case Ro.DISTINCT_POSITION:return function(e){throw new Error(`Not implemented: ${e}`)}(t);case Ro.UNUSED:return n?r.getCount()-new Set(n.getArray()).size:0;default:return function(e){throw new Error(`Unexpected value: ${e}`)}(t)}}function Mo(e,t,r){const n=Ie.fromGraph(e.getGraph());t&&r||([t,r]=function(e){const t=So(e,Ro.UPLOAD),r=e.getIndices(),n=r?r.getArray():null;if(!r||!n)return[Os(t,1e6),t];const s=new Uint32Array(t).fill(Ao);let o=0;for(let e=0;e<n.length;e++){const t=n[e];s[t]===Ao&&(s[t]=o++)}return[s,o]}(e));const s=e.getIndices(),o=s?s.getArray():null,i=So(e,Ro.RENDER),a=n.createAccessor(),c=i,u=Cs(c,r);for(let e=0;e<c;e++)u[e]=t[o?o[e]:e];e.setIndices(a.setArray(u));const p=Ns(e);for(const o of e.listAttributes()){const i=vs(n,o);No(o,s,t,i,r),e.swap(o,i)}for(const o of e.listTargets())for(const e of o.listAttributes()){const i=vs(n,e);No(e,s,t,i,r),o.swap(e,i)}s&&1===s.listParents().length&&s.dispose();for(const e of p)1===e.listParents().length&&e.dispose();return e}function No(e,t,r,n,s){const o=e.getElementSize(),i=e.getArray(),a=t?t.getArray():null,c=t?t.getCount():e.getCount(),u=new i.constructor(s*o),p=new Uint8Array(s);for(let e=0;e<c;e++){const t=a?a[e]:e,n=r[t];if(!p[n]){for(let e=0;e<o;e++)u[n*o+e]=i[t*o+e];p[n]=1}}return n.setArray(u)}!function(e){e.RENDER="render",e.RENDER_CACHED="render-cached",e.UPLOAD="upload",e.UPLOAD_NAIVE="upload-naive",e.DISTINCT="distinct",e.DISTINCT_POSITION="distinct-position",e.UNUSED="unused"}(Ro||(Ro={}));const wo="weld",vo={overwrite:!0,cleanup:!0};function Oo(e=vo){const t=As(vo,e);return Es(wo,(async e=>{const r=e.getLogger();for(const r of e.getRoot().listMeshes()){for(const e of r.listPrimitives())Co(e,t),0===So(e,Ro.RENDER)&&e.dispose();0===r.listPrimitives().length&&r.dispose()}t.cleanup&&await e.transform(po({propertyTypes:[d.ACCESSOR,d.NODE],keepAttributes:!0,keepIndices:!0,keepLeaves:!1}),Zs({propertyTypes:[d.ACCESSOR]})),r.debug(`${wo}: Complete.`)}))}function Co(e,t=vo){const r=e.getGraph(),n=Ie.fromGraph(r).getLogger(),s=_s({},vo,t);if(e.getIndices()&&!s.overwrite)return;if(e.getMode()===me.Mode.POINTS)return;const o=e.getAttribute("POSITION").getCount(),i=e.getIndices(),a=null==i?void 0:i.getArray(),c=i?i.getCount():o,u=new xo(e),p=Bs(o+o/4),l=new Uint32Array(p).fill(Ao),f=new Uint32Array(o).fill(Ao);let _=0;for(let e=0;e<c;e++){const t=a?a[e]:e;if(f[t]!==Ao)continue;const r=Io(l,p,u,t,Ao),n=l[r];n===Ao?(l[r]=t,f[t]=_++):f[t]=f[n]}n.debug(`${wo}: ${Ms(o,_)} vertices.`),Mo(e,f,_)}const{FLOAT:Do}=re.ComponentType;function jo(e,t){const r=e.getAttribute("POSITION");r&&Po(t,r);const n=e.getAttribute("NORMAL");n&&Fo(t,n);const s=e.getAttribute("TANGENT");s&&Uo(t,s);for(const r of e.listTargets()){const e=r.getAttribute("POSITION");e&&Po(t,e);const n=r.getAttribute("NORMAL");n&&Fo(t,n);const s=r.getAttribute("TANGENT");s&&Uo(t,s)}(function(e){var t=e[0],r=e[1],n=e[2],s=e[3],o=e[4],i=e[5],a=e[6],c=e[7],u=e[8],p=e[9],l=e[10],f=e[11],_=e[12],d=e[13],h=e[14],y=e[15];return(t*i-r*o)*(l*y-f*h)-(t*a-n*o)*(p*y-f*d)+(t*c-s*o)*(p*h-l*d)+(r*a-n*i)*(u*y-f*_)-(r*c-s*i)*(u*h-l*_)+(n*c-s*a)*(u*d-p*_)})(t)<0&&function(e){if(e.getMode()!==me.Mode.TRIANGLES)return;e.getIndices()||Co(e);const t=e.getIndices();for(let e=0,r=t.getCount();e<r;e+=3){const r=t.getScalar(e),n=t.getScalar(e+2);t.setScalar(e,n),t.setScalar(e+2,r)}}(e)}function Po(e,t){const r=t.getComponentType(),n=t.getNormalized(),s=t.getArray(),o=r===Do?s:new Float32Array(s.length),i=$s();for(let a=0,c=t.getCount();a<c;a++)n?(i[0]=B.decodeNormalizedInt(s[3*a],r),i[1]=B.decodeNormalizedInt(s[3*a+1],r),i[2]=B.decodeNormalizedInt(s[3*a+2],r)):(i[0]=s[3*a],i[1]=s[3*a+1],i[2]=s[3*a+2]),Xs(i,i,e),o[3*a]=i[0],o[3*a+1]=i[1],o[3*a+2]=i[2];t.setArray(o).setNormalized(!1)}function Fo(e,t){const r=t.getArray(),n=t.getNormalized(),s=t.getComponentType(),o=function(){var e=new zs(9);return zs!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}();!function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]}(o,e),function(e,t){var r=t[0],n=t[1],s=t[2],o=t[3],i=t[4],a=t[5],c=t[6],u=t[7],p=t[8],l=p*i-a*u,f=-p*o+a*c,_=u*o-i*c,d=r*l+n*f+s*_;d&&(d=1/d,e[0]=l*d,e[1]=(-p*n+s*u)*d,e[2]=(a*n-s*i)*d,e[3]=f*d,e[4]=(p*r-s*c)*d,e[5]=(-a*r+s*o)*d,e[6]=_*d,e[7]=(-u*r+n*c)*d,e[8]=(i*r-n*o)*d)}(o,o),function(e,t){if(e===t){var r=t[1],n=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(o,o);const i=$s();for(let e=0,a=t.getCount();e<a;e++)n?(i[0]=B.decodeNormalizedInt(r[3*e],s),i[1]=B.decodeNormalizedInt(r[3*e+1],s),i[2]=B.decodeNormalizedInt(r[3*e+2],s)):(i[0]=r[3*e],i[1]=r[3*e+1],i[2]=r[3*e+2]),Ys(i,i,o),Ws(i,i),n?(r[3*e]=B.decodeNormalizedInt(i[0],s),r[3*e+1]=B.decodeNormalizedInt(i[1],s),r[3*e+2]=B.decodeNormalizedInt(i[2],s)):(r[3*e]=i[0],r[3*e+1]=i[1],r[3*e+2]=i[2])}function Uo(e,t){const r=t.getArray(),n=t.getNormalized(),s=t.getComponentType(),o=$s();for(let i=0,a=t.getCount();i<a;i++)n?(o[0]=B.decodeNormalizedInt(r[4*i],s),o[1]=B.decodeNormalizedInt(r[4*i+1],s),o[2]=B.decodeNormalizedInt(r[4*i+2],s)):(o[0]=r[4*i],o[1]=r[4*i+1],o[2]=r[4*i+2]),o[0]=e[0]*o[0]+e[4]*o[1]+e[8]*o[2],o[1]=e[1]*o[0]+e[5]*o[1]+e[9]*o[2],o[2]=e[2]*o[0]+e[6]*o[1]+e[10]*o[2],Ws(o,o),n?(r[4*i]=B.decodeNormalizedInt(o[0],s),r[4*i+1]=B.decodeNormalizedInt(o[1],s),r[4*i+2]=B.decodeNormalizedInt(o[2],s)):(r[4*i]=o[0],r[4*i+1]=o[1],r[4*i+2]=o[2])}const{LINES:Lo,LINE_STRIP:Go,LINE_LOOP:Bo,TRIANGLES:Vo,TRIANGLE_STRIP:ko,TRIANGLE_FAN:zo}=me.Mode;function Ho(e){const t=e.getGraph(),r=Ie.fromGraph(t);e.getIndices()||Co(e);const n=e.getIndices(),s=n.getArray(),o=Is(e),i=new(0,b[n.getComponentType()])(2*o),a=e.getMode();if(a===Go)for(let e=0;e<o;e++)i[2*e]=s[e],i[2*e+1]=s[e+1];else{if(a!==Bo)throw new Error("Only LINE_STRIP and LINE_LOOP may be converted to LINES.");for(let e=0;e<o;e++)e<o-1?(i[2*e]=s[e],i[2*e+1]=s[e+1]):(i[2*e]=s[e],i[2*e+1]=s[0])}e.setMode(Lo);const c=r.getRoot();n.listParents().some((t=>t!==c&&t!==e))?e.setIndices(vs(r,n).setArray(i)):n.setArray(i)}function qo(e){const t=e.getGraph(),r=Ie.fromGraph(t);e.getIndices()||Co(e);const n=e.getIndices(),s=n.getArray(),o=Is(e),i=new(0,b[n.getComponentType()])(3*o),a=e.getMode();if(a===ko)for(let e=0,t=s.length;e<t-2;e++)e%2?(i[3*e]=s[e+1],i[3*e+1]=s[e],i[3*e+2]=s[e+2]):(i[3*e]=s[e],i[3*e+1]=s[e+1],i[3*e+2]=s[e+2]);else{if(a!==zo)throw new Error("Only TRIANGLE_STRIP and TRIANGLE_FAN may be converted to TRIANGLES.");for(let e=0;e<o;e++)i[3*e]=s[0],i[3*e+1]=s[e+1],i[3*e+2]=s[e+2]}e.setMode(Vo);const c=r.getRoot();n.listParents().some((t=>t!==c&&t!==e))?e.setIndices(vs(r,n).setArray(i)):n.setArray(i)}function $o(e){const t=e.getArray();if(!t)return;const r=function(e,t,r){const n=new Float32Array(e.length);for(let s=0,o=e.length;s<o;s++)n[s]=r?B.decodeNormalizedInt(e[s],t):e[s];return n}(t,e.getComponentType(),e.getNormalized());e.setArray(r).setNormalized(!1)}const{TEXTURE_INFO:Wo,ROOT:Xo}=d,Yo={method:"edgebreaker",encodeSpeed:5,decodeSpeed:5,quantizePosition:14,quantizeNormal:10,quantizeColor:8,quantizeTexcoord:12,quantizeGeneric:12,quantizationVolume:"mesh"};const Qo="flatten",Ko={cleanup:!0};const Jo={skipValidation:!1},Zo=2**32-1,{LINE_STRIP:ei,LINE_LOOP:ti,TRIANGLE_STRIP:ri,TRIANGLE_FAN:ni}=me.Mode;function si(e,t={}){const r=As(Jo,t),n=e[0],s=Ie.fromGraph(n.getGraph());if(!r.skipValidation&&new Set(e.map(js)).size>1)throw new Error("Requires >=2 Primitives, sharing the same Material and Mode, with compatible vertex attributes and indices.");for(const t of e)switch(t.getMode()){case ei:case ti:Ho(t);break;case ri:case ni:qo(t)}const o=[],i=new Uint32Array(e.length);let a=0,c=0;for(let t=0;t<e.length;t++){const r=e[t],n=r.getIndices(),s=r.getAttribute("POSITION").getCount(),u=n?n.getArray():null,p=n?n.getCount():s,l=new Uint32Array(s).fill(Zo);for(let e=0;e<p;e++){const r=u?u[e]:e;l[r]===Zo&&(l[r]=a++,i[t]++)}o.push(l),c+=p}const u=s.createPrimitive().setMode(n.getMode()).setMaterial(n.getMaterial());for(const e of n.listSemantics()){const t=n.getAttribute(e),r=b[t.getComponentType()],o=vs(s,t).setArray(new r(a*t.getElementSize()));u.setAttribute(e,o)}const p=n.getIndices(),l=p?vs(s,p).setArray(Cs(c,a)):null;u.setIndices(l);let f=0;for(let t=0;t<o.length;t++){const r=e[t],n=r.getIndices(),s=n?n.getCount():-1,i=o[t];n&&l&&(ii(n,i,l,f),f+=s);for(const e of u.listSemantics()){oi(r.getAttribute(e),n,i,u.getAttribute(e))}}return u}function oi(e,t,r,n){const s=e.getElementSize(),o=t?t.getArray():null,i=e.getCount(),a=e.getArray(),c=n.getArray(),u=new Uint8Array(e.getCount());for(let e=0,n=t?t.getCount():i;e<n;e++){const t=o?o[e]:e,n=r[t];if(!u[n]){for(let e=0;e<s;e++)c[n*s+e]=a[t*s+e];u[n]=1}}}function ii(e,t,r,n){const s=e.getCount(),o=e.getArray(),i=r.getArray();for(let e=0;e<s;e++){const r=t[o[e]];i[n+e]=r}}const ai="join",{ROOT:ci,NODE:ui,MESH:pi,PRIMITIVE:li,ACCESSOR:fi}=d,_i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],di={keepMeshes:!1,keepNamed:!1,cleanup:!0,filter:()=>!0};function hi(e,t,r){const n=e.getLogger(),s={},o=t.listChildren();for(let e=0;e<o.length;e++){const t=o[e];if(!r.filter(t))continue;if(t.listParents().some((e=>e instanceof se)))continue;const n=t.getMesh();if(n&&(!t.getExtension("EXT_mesh_gpu_instancing")&&!t.getSkin()))for(const o of n.listPrimitives()){if(o.listTargets().length>0)continue;const i=o.getMaterial();if(i&&i.getExtension("KHR_materials_volume"))continue;Mo(o),mi(o);let a=js(o);const c=n.getName()||t.getName();(r.keepMeshes||r.keepNamed&&c)&&(a+=`|${e}`),a in s||(s[a]={prims:[],primMeshes:[],primNodes:[],dstNode:t,dstMesh:void 0});const u=s[a];u.prims.push(o),u.primNodes.push(t)}}const i=Object.values(s).filter((({prims:e})=>e.length>1)),a=new Set(i.flatMap((e=>e.primNodes)));for(const e of a){const t=e.getMesh(),r=t.listParents().some((t=>t.propertyType!==ci&&e!==t));r&&e.setMesh(t.clone())}for(const e of i){const{dstNode:t,primNodes:r}=e;e.dstMesh=t.getMesh(),e.primMeshes=r.map((e=>e.getMesh()))}for(const e of i){const{prims:t,primNodes:r,primMeshes:s,dstNode:o,dstMesh:i}=e,a=o.getMatrix();for(let e=0;e<t.length;e++){const n=r[e],i=s[e];let c=t[e];i.removePrimitive(c),c.listParents().some((e=>e.propertyType!==d.ROOT))&&(c=t[e]=yi(t[e])),n!==o&&(qs(_i,Hs(_i,a),n.getMatrix()),jo(c,_i))}const c=si(t),u=c.listAttributes()[0].getCount();i.addPrimitive(c),n.debug(`${ai}: Joined Primitives (${t.length}) containing ${Ss(u)} vertices under Node "${o.getName()}".`)}}function yi(e){const t=e.clone();for(const e of t.listSemantics())t.setAttribute(e,t.getAttribute(e).clone());const r=t.getIndices();return r&&t.setIndices(r.clone()),t}function mi(e){for(const t of["POSITION","NORMAL","TANGENT"]){const r=e.getAttribute(t);r&&$o(r)}}const{TRANSLATION:gi,ROTATION:bi,SCALE:Ti,WEIGHTS:Ei}=se.TargetPath;_s({level:"high"},{pattern:/.*/,quantizationVolume:"mesh",quantizePosition:14,quantizeNormal:10,quantizeTexcoord:12,quantizeColor:8,quantizeWeight:8,quantizeGeneric:12,normalizeWeights:!0,cleanup:!0});const Ai="metalRough";const xi="palette",Ii={blockSize:4,min:5,keepAttributes:!1,cleanup:!0};function Ri(e){const t=Math.round(255*e).toString(16);return 1===t.length?"0"+t:t}function Si(e){return v.convertLinearToSRGB(e,e),e.map(Ri).join("")}function Mi(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Ni(e,t,r,n){for(let s=0;s<n;s++)for(let o=0;o<n;o++)e.set(t*n+s,o,0,255*r[0]),e.set(t*n+s,o,1,255*r[1]),e.set(t*n+s,o,2,255*r[2]),e.set(t*n+s,o,3,255*r[3])}var wi;!function(e){e[e.STEP=0]="STEP",e[e.LERP=1]="LERP",e[e.SLERP=2]="SLERP"}(wi||(wi={}));function vi(e,t,r){for(let n=0,s=r.length;n<s;n++)r[n]=e[t*s+n];return r}function Oi(e,t,r){for(let n=0,s=r.length;n<s;n++)e[t*s+n]=r[n]}function Ci(e,t,r=0){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>r)return!1;return!0}function Di(e,t,r){return e*(1-r)+t*r}function ji(e,t,r,n){for(let s=0;s<t.length;s++)e[s]=Di(t[s],r[s],n);return e}function Pi(e,t,r,n){let s,o,i,a,c,u=t[0],p=t[1],l=t[2],f=t[3],_=r[0],d=r[1],h=r[2],y=r[3];return o=u*_+p*d+l*h+f*y,o<0&&(o=-o,_=-_,d=-d,h=-h,y=-y),1-o>1e-6?(s=Math.acos(o),i=Math.sin(s),a=Math.sin((1-n)*s)/i,c=Math.sin(n*s)/i):(a=1-n,c=n),e[0]=a*u+c*_,e[1]=a*p+c*d,e[2]=a*l+c*h,e[3]=a*f+c*y,e}function Fi(e,t){const r=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}(e,t);return Math.acos(2*r*r-1)}const Ui="resample",Li=new Float32Array(0),Gi={ready:Promise.resolve(),resample:function(e,t,r,n=1e-4){const s=t.length/e.length,o=new Array(s).fill(0),i=new Array(s).fill(0),a=new Array(s).fill(0),c=new Array(s).fill(0),u=e.length-1;let p=1;for(let s=1;s<u;++s){const u=e[p-1],l=e[s],f=e[s+1],_=(l-u)/(f-u);let d=!1;if(l!==f&&(1!==s||l!==e[0]))if(vi(t,p-1,c),vi(t,s,i),vi(t,s+1,a),"slerp"===r){const e=Pi(o,c,a,_),t=Fi(c,i)+Fi(i,a);d=!Ci(i,e,n)||t+Number.EPSILON>=Math.PI}else if("lerp"===r){d=!Ci(i,ji(o,c,a,_),n)}else"step"===r&&(d=!Ci(i,c)||!Ci(i,a));d&&(s!==p&&(e[p]=e[s],Oi(t,p,vi(t,s,o))),p++)}return u>0&&(e[p]=e[u],Oi(t,p,vi(t,u,o)),p++),p},tolerance:1e-4,cleanup:!0};function Bi(e,t,r){if(e instanceof Float32Array)return e.slice();const n=new Float32Array(e);if(!r)return n;for(let e=0;e<n.length;e++)n[e]=B.decodeNormalizedInt(n[e],t);return n}function Vi(e,t,r){if(t===re.ComponentType.FLOAT)return e.slice();const n=new(0,b[t])(e.length);for(let s=0;s<n.length;s++)n[s]=r?B.encodeNormalizedInt(e[s],t):e[s];return n}const{POINTS:ki,LINES:zi,LINE_STRIP:Hi,LINE_LOOP:qi,TRIANGLES:$i,TRIANGLE_STRIP:Wi,TRIANGLE_FAN:Xi}=me.Mode,Yi="sparse",Qi={ratio:1/3};const Ki=["jpeg","png","webp","avif"];var Ji;!function(e){e.LANCZOS3="lanczos3",e.LANCZOS2="lanczos2"}(Ji||(Ji={}));const Zi={resizeFilter:Ji.LANCZOS3,pattern:void 0,formats:void 0,slots:void 0,quality:void 0,effort:void 0,lossless:!1,nearLossless:!1,limitInputPixels:!0};async function ea(e,t){const r=_s({},Zi,t),n=r.encoder,s=e.getURI(),o=function(e){return ta(e.getMimeType())}(e),i=r.targetFormat||o,a=e.getMimeType(),c=`image/${i}`,u=e.getImage(),p=n?await async function(e,t,r,n){const s=n.encoder;let o={};const i=ta(r);switch(i){case"jpeg":o={quality:n.quality};break;case"png":o={quality:n.quality,effort:ra(n.effort,100,10)};break;case"webp":o={quality:n.quality,effort:ra(n.effort,100,6),lossless:n.lossless,nearLossless:n.nearLossless};break;case"avif":o={quality:n.quality,effort:ra(n.effort,100,9),lossless:n.lossless}}const a=n.limitInputPixels,c=s(e,{limitInputPixels:a}).toFormat(i,o);if(n.resize){const r=C.getSize(e,t),s=Array.isArray(n.resize)?Ps(r,n.resize):Fs(r,n.resize);c.resize(s[0],s[1],{fit:"fill",kernel:n.resizeFilter})}return w.toView(await c.toBuffer())}(u,a,c,r):await async function(e,t,r,n){const s=await os(e,t);if(n.resize){const[e,t]=s.shape,o=Array.isArray(n.resize)?Ps([e,t],n.resize):Fs([e,t],n.resize),i=Yn(new Uint8Array(o[0]*o[1]*4),[...o,4]);return n.resizeFilter===Ji.LANCZOS3?function(e,t){fs(e,t,ps.LANCZOS_3)}(s,i):function(e,t){fs(e,t,ps.LANCZOS_2)}(s,i),is(i,r)}return is(s,r)}(u,a,c,r),l=u.byteLength,f=p.byteLength;if(!(a===c&&f>=l)||r.resize)if(a===c)e.setImage(p);else{const t=s?j.extension(s):C.mimeTypeToExtension(a),r=C.mimeTypeToExtension(c),n=e.getURI().replace(new RegExp(`\\.${t}$`),`.${r}`);e.setImage(p).setMimeType(c).setURI(n)}}function ta(e){const t=e.split("/").pop();if(!t||!Ki.includes(t))throw new Error(`Unknown MIME type "${e}".`);return t}function ra(e,t,r){if(null!=e)return Math.round(e/t*r)}var na,sa={exports:{}},oa=sa.exports;function ia(){return na||(na=1,function(r){var n=n||{};n.scope={},n.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},n.arrayIterator=function(e){return{next:n.arrayIteratorImpl(e)}},n.makeIterator=function(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):n.arrayIterator(e)},n.ASSUME_ES5=!1,n.ASSUME_NO_NATIVE_MAP=!1,n.ASSUME_NO_NATIVE_SET=!1,n.SIMPLE_FROUND_POLYFILL=!1,n.ISOLATE_POLYFILLS=!1,n.FORCE_POLYFILL_PROMISE=!1,n.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,n.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Bn&&Bn];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")},n.global=n.getGlobal(oa),n.defineProperty=n.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},n.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),n.TRUST_ES6_POLYFILLS=!n.ISOLATE_POLYFILLS||n.IS_SYMBOL_NATIVE,n.polyfills={},n.propertyToPolyfillSymbol={},n.POLYFILL_PREFIX="$jscp$",n.polyfill=function(e,t,r,s){t&&(n.ISOLATE_POLYFILLS?n.polyfillIsolated(e,t,r,s):n.polyfillUnisolated(e,t,r,s))},n.polyfillUnisolated=function(e,t,r,s){for(r=n.global,e=e.split("."),s=0;s<e.length-1;s++){var o=e[s];if(!(o in r))return;r=r[o]}(t=t(s=r[e=e[e.length-1]]))!=s&&null!=t&&n.defineProperty(r,e,{configurable:!0,writable:!0,value:t})},n.polyfillIsolated=function(e,t,r,s){var o=e.split(".");e=1===o.length,s=o[0],s=!e&&s in n.polyfills?n.polyfills:n.global;for(var i=0;i<o.length-1;i++){var a=o[i];if(!(a in s))return;s=s[a]}o=o[o.length-1],null!=(t=t(r=n.IS_SYMBOL_NATIVE&&"es6"===r?s[o]:null))&&(e?n.defineProperty(n.polyfills,o,{configurable:!0,writable:!0,value:t}):t!==r&&(void 0===n.propertyToPolyfillSymbol[o]&&(r=1e9*Math.random()>>>0,n.propertyToPolyfillSymbol[o]=n.IS_SYMBOL_NATIVE?n.global.Symbol(o):n.POLYFILL_PREFIX+r+"$"+o),n.defineProperty(s,n.propertyToPolyfillSymbol[o],{configurable:!0,writable:!0,value:t})))},n.polyfill("Promise",(function(e){function t(){this.batch_=null}function r(e){return e instanceof o?e:new o((function(t,r){t(e)}))}if(e&&(!(n.FORCE_POLYFILL_PROMISE||n.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&void 0===n.global.PromiseRejectionEvent)||!n.global.Promise||-1===n.global.Promise.toString().indexOf("[native code]")))return e;t.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var t=this;this.asyncExecuteFunction((function(){t.executeBatch_()}))}this.batch_.push(e)};var s=n.global.setTimeout;t.prototype.asyncExecuteFunction=function(e){s(e,0)},t.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},t.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var o=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[],this.isRejectionHandled_=!1;var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};o.prototype.createResolveAndReject_=function(){function e(e){return function(n){r||(r=!0,e.call(t,n))}}var t=this,r=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},o.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof o)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},o.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},o.prototype.reject_=function(e){this.settle_(2,e)},o.prototype.fulfill_=function(e){this.settle_(1,e)},o.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,2===this.state_&&this.scheduleUnhandledRejectionCheck_(),this.executeOnSettledCallbacks_()},o.prototype.scheduleUnhandledRejectionCheck_=function(){var e=this;s((function(){if(e.notifyUnhandledRejection_()){var t=n.global.console;void 0!==t&&t.error(e.result_)}}),1)},o.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var e=n.global.CustomEvent,t=n.global.Event,r=n.global.dispatchEvent;return void 0===r||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=n.global.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.result_,r(e))},o.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)i.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var i=new t;return o.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},o.prototype.settleSameAsThenable_=function(e,t){var r=this.createResolveAndReject_();try{e.call(t,r.resolve,r.reject)}catch(e){r.reject(e)}},o.prototype.then=function(e,t){function r(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(e){s(e)}}:t}var n,s,i=new o((function(e,t){n=e,s=t}));return this.callWhenSettled_(r(e,n),r(t,s)),i},o.prototype.catch=function(e){return this.then(void 0,e)},o.prototype.callWhenSettled_=function(e,t){function r(){switch(n.state_){case 1:e(n.result_);break;case 2:t(n.result_);break;default:throw Error("Unexpected state: "+n.state_)}}var n=this;null==this.onSettledCallbacks_?i.asyncExecute(r):this.onSettledCallbacks_.push(r),this.isRejectionHandled_=!0},o.resolve=r,o.reject=function(e){return new o((function(t,r){r(e)}))},o.race=function(e){return new o((function(t,s){for(var o=n.makeIterator(e),i=o.next();!i.done;i=o.next())r(i.value).callWhenSettled_(t,s)}))},o.all=function(e){var t=n.makeIterator(e),s=t.next();return s.done?r([]):new o((function(e,n){function o(t){return function(r){i[t]=r,0==--a&&e(i)}}var i=[],a=0;do{i.push(void 0),a++,r(s.value).callWhenSettled_(o(i.length-1),n),s=t.next()}while(!s.done)}))},o}),"es6","es3"),n.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.assign=n.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(e,t){for(var r=1;r<arguments.length;r++){var s=arguments[r];if(s)for(var o in s)n.owns(s,o)&&(e[o]=s[o])}return e},n.polyfill("Object.assign",(function(e){return e||n.assign}),"es6","es3"),n.checkStringArgs=function(e,t,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""},n.polyfill("String.prototype.startsWith",(function(e){return e||function(e,t){var r=n.checkStringArgs(this,e,"startsWith");e+="";var s=r.length,o=e.length;t=Math.max(0,Math.min(0|t,r.length));for(var i=0;i<o&&t<s;)if(r[t++]!=e[i++])return!1;return i>=o}}),"es6","es3"),n.polyfill("Array.prototype.copyWithin",(function(e){function t(e){return 1/0===(e=Number(e))||-1/0===e?e:0|e}return e||function(e,r,n){var s=this.length;if(e=t(e),r=t(r),n=void 0===n?s:t(n),e=0>e?Math.max(s+e,0):Math.min(e,s),r=0>r?Math.max(s+r,0):Math.min(r,s),n=0>n?Math.max(s+n,0):Math.min(n,s),e<r)for(;r<n;)r in this?this[e++]=this[r++]:(delete this[e++],r++);else for(e+=(n=Math.min(n,s+r-e))-r;n>r;)--n in this?this[--e]=this[n]:delete this[--e];return this}}),"es6","es3"),n.typedArrayCopyWithin=function(e){return e||Array.prototype.copyWithin},n.polyfill("Int8Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint8Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint8ClampedArray.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Int16Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint16Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Int32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Float32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Float64Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5");var s,o=(s="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(s=s||__filename),function(r){function n(){var e=W.buffer;C.HEAP8=X=new Int8Array(e),C.HEAP16=Q=new Int16Array(e),C.HEAP32=K=new Int32Array(e),C.HEAPU8=Y=new Uint8Array(e),C.HEAPU16=new Uint16Array(e),C.HEAPU32=J=new Uint32Array(e),C.HEAPF32=Z=new Float32Array(e),C.HEAPF64=new Float64Array(e)}function o(e){throw C.onAbort&&C.onAbort(e),$(e="Aborted("+e+")"),te=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),O(e),e}function i(e){try{if(e==ce&&q)return new Uint8Array(q);if(z)return z(e);throw"both async and sync fetching of the wasm failed"}catch(e){o(e)}}function a(e){for(;0<e.length;)e.shift()(C)}function c(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){J[this.ptr+4>>2]=e},this.get_type=function(){return J[this.ptr+4>>2]},this.set_destructor=function(e){J[this.ptr+8>>2]=e},this.get_destructor=function(){return J[this.ptr+8>>2]},this.set_refcount=function(e){K[this.ptr>>2]=e},this.set_caught=function(e){X[this.ptr+12|0]=e?1:0},this.get_caught=function(){return 0!=X[this.ptr+12|0]},this.set_rethrown=function(e){X[this.ptr+13|0]=e?1:0},this.get_rethrown=function(){return 0!=X[this.ptr+13|0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){K[this.ptr>>2]+=1},this.release_ref=function(){var e=K[this.ptr>>2];return K[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){J[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return J[this.ptr+16>>2]},this.get_exception_ptr=function(){if(Jt(this.get_type()))return J[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function u(){function e(){if(!Kt&&(Kt=!0,C.calledRun=!0,!te)){if(oe=!0,a(ne),v(C),C.onRuntimeInitialized&&C.onRuntimeInitialized(),C.postRun)for("function"==typeof C.postRun&&(C.postRun=[C.postRun]);C.postRun.length;)se.unshift(C.postRun.shift());a(se)}}if(!(0<ie)){if(C.preRun)for("function"==typeof C.preRun&&(C.preRun=[C.preRun]);C.preRun.length;)re.unshift(C.preRun.shift());a(re),0<ie||(C.setStatus?(C.setStatus("Running..."),setTimeout((function(){setTimeout((function(){C.setStatus("")}),1),e()}),1)):e())}}function p(){}function l(e){return(e||p).__cache__}function f(e,t){var r=l(t),n=r[e];return n||((n=Object.create((t||p).prototype)).ptr=e,r[e]=n)}function _(e){if("string"==typeof e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);127>=n?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3}if(r=0,0<(n=(t=Array(t+1)).length)){n=r+n-1;for(var s=0;s<e.length;++s){var o=e.charCodeAt(s);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++s)),127>=o){if(r>=n)break;t[r++]=o}else{if(2047>=o){if(r+1>=n)break;t[r++]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;t[r++]=224|o>>12}else{if(r+3>=n)break;t[r++]=240|o>>18,t[r++]=128|o>>12&63}t[r++]=128|o>>6&63}t[r++]=128|63&o}}t[r]=0}return e=Zt.alloc(t,X),Zt.copy(t,X,e),e}return e}function d(e){if("object"==typeof e){var t=Zt.alloc(e,X);return Zt.copy(e,X,t),t}return e}function h(e){if("object"==typeof e){var t=Zt.alloc(e,Q);return Zt.copy(e,Q,t),t}return e}function y(e){if("object"==typeof e){var t=Zt.alloc(e,K);return Zt.copy(e,K,t),t}return e}function m(e){if("object"==typeof e){var t=Zt.alloc(e,Z);return Zt.copy(e,Z,t),t}return e}function g(){throw"cannot construct a VoidPtr, no constructor in IDL"}function b(){this.ptr=le(),l(b)[this.ptr]=this}function T(){this.ptr=_e(),l(T)[this.ptr]=this}function E(){this.ptr=xe(),l(E)[this.ptr]=this}function A(){this.ptr=Me(),l(A)[this.ptr]=this}function x(){this.ptr=De(),l(x)[this.ptr]=this}function I(){this.ptr=Pe(),l(I)[this.ptr]=this}function R(){this.ptr=Ge(),l(R)[this.ptr]=this}function S(){this.ptr=qe(),l(S)[this.ptr]=this}function M(){this.ptr=nt(),l(M)[this.ptr]=this}function N(){this.ptr=bt(),l(N)[this.ptr]=this}function w(e){e&&"object"==typeof e&&(e=e.ptr),this.ptr=vt(e),l(w)[this.ptr]=this}var v,O,C=void 0!==(r=void 0===r?{}:r)?r:{};C.ready=new Promise((function(e,t){v=e,O=t}));var D=!1,j=!1;C.onRuntimeInitialized=function(){D=!0,j&&"function"==typeof C.onModuleLoaded&&C.onModuleLoaded(C)},C.onModuleParsed=function(){j=!0,D&&"function"==typeof C.onModuleLoaded&&C.onModuleLoaded(C)},C.isVersionSupported=function(e){return"string"==typeof e&&!(2>(e=e.split(".")).length||3<e.length)&&(1==e[0]&&0<=e[1]&&5>=e[1]||!(0!=e[0]||10<e[1]))};var P=Object.assign({},C),F="object"==typeof window,U="function"==typeof importScripts,L="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,G="";if(L){var B=e,V=t;G=U?V.dirname(G)+"/":__dirname+"/";var k=function(e,t){return e=e.startsWith("file://")?new URL(e):V.normalize(e),B.readFileSync(e,t?void 0:"utf8")},z=function(e){return(e=k(e,!0)).buffer||(e=new Uint8Array(e)),e},H=function(e,t,r){e=e.startsWith("file://")?new URL(e):V.normalize(e),B.readFile(e,(function(e,n){e?r(e):t(n.buffer)}))};1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),C.inspect=function(){return"[Emscripten Module object]"}}else(F||U)&&(U?G=self.location.href:"undefined"!=typeof document&&document.currentScript&&(G=document.currentScript.src),s&&(G=s),G=0!==G.indexOf("blob:")?G.substr(0,G.replace(/[?#].*/,"").lastIndexOf("/")+1):"",k=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},U&&(z=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),H=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});C.print||console.log.bind(console);var q,$=C.printErr||console.warn.bind(console);Object.assign(C,P),P=null,C.wasmBinary&&(q=C.wasmBinary),"object"!=typeof WebAssembly&&o("no native wasm support detected");var W,X,Y,Q,K,J,Z,ee,te=!1,re=[],ne=[],se=[],oe=!1,ie=0,ae=null,ce="draco_encoder.wasm";ce.startsWith("data:application/octet-stream;base64,")||(ee=ce,ce=C.locateFile?C.locateFile(ee,G):G+ee);var ue={b:function(e,t,r){throw new c(e).init(t,r),e},a:function(){o("")},d:function(e,t,r){Y.copyWithin(e,t,t+r)},c:function(e){var t=Y.length;if(2147483648<(e>>>=0))return!1;for(var r=1;4>=r;r*=2){var s=t*(1+.2/r);s=Math.min(s,e+100663296);var o=Math;s=Math.max(e,s),o=o.min.call(o,2147483648,s+(65536-s%65536)%65536);e:{s=W.buffer;try{W.grow(o-s.byteLength+65535>>>16),n();var i=1;break e}catch(e){}i=void 0}if(i)return!0}return!1}};!function(){function e(e,t){C.asm=e.exports,W=C.asm.e,n(),ne.unshift(C.asm.f),ie--,C.monitorRunDependencies&&C.monitorRunDependencies(ie),0==ie&&ae&&(e=ae,ae=null,e())}function t(t){e(t.instance)}function r(e){return function(){if(!q&&(F||U)){if("function"==typeof fetch&&!ce.startsWith("file://"))return fetch(ce,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ce+"'";return e.arrayBuffer()})).catch((function(){return i(ce)}));if(H)return new Promise((function(e,t){H(ce,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return i(ce)}))}().then((function(e){return WebAssembly.instantiate(e,s)})).then((function(e){return e})).then(e,(function(e){$("failed to asynchronously prepare wasm: "+e),o(e)}))}var s={a:ue};if(ie++,C.monitorRunDependencies&&C.monitorRunDependencies(ie),C.instantiateWasm)try{return C.instantiateWasm(s,e)}catch(e){$("Module.instantiateWasm callback failed with error: "+e),O(e)}(q||"function"!=typeof WebAssembly.instantiateStreaming||ce.startsWith("data:application/octet-stream;base64,")||ce.startsWith("file://")||L||"function"!=typeof fetch?r(t):fetch(ce,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,s).then(t,(function(e){return $("wasm streaming compile failed: "+e),$("falling back to ArrayBuffer instantiation"),r(t)}))}))).catch(O)}();var pe=C._emscripten_bind_VoidPtr___destroy___0=function(){return(pe=C._emscripten_bind_VoidPtr___destroy___0=C.asm.h).apply(null,arguments)},le=C._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return(le=C._emscripten_bind_GeometryAttribute_GeometryAttribute_0=C.asm.i).apply(null,arguments)},fe=C._emscripten_bind_GeometryAttribute___destroy___0=function(){return(fe=C._emscripten_bind_GeometryAttribute___destroy___0=C.asm.j).apply(null,arguments)},_e=C._emscripten_bind_PointAttribute_PointAttribute_0=function(){return(_e=C._emscripten_bind_PointAttribute_PointAttribute_0=C.asm.k).apply(null,arguments)},de=C._emscripten_bind_PointAttribute_size_0=function(){return(de=C._emscripten_bind_PointAttribute_size_0=C.asm.l).apply(null,arguments)},he=C._emscripten_bind_PointAttribute_attribute_type_0=function(){return(he=C._emscripten_bind_PointAttribute_attribute_type_0=C.asm.m).apply(null,arguments)},ye=C._emscripten_bind_PointAttribute_data_type_0=function(){return(ye=C._emscripten_bind_PointAttribute_data_type_0=C.asm.n).apply(null,arguments)},me=C._emscripten_bind_PointAttribute_num_components_0=function(){return(me=C._emscripten_bind_PointAttribute_num_components_0=C.asm.o).apply(null,arguments)},ge=C._emscripten_bind_PointAttribute_normalized_0=function(){return(ge=C._emscripten_bind_PointAttribute_normalized_0=C.asm.p).apply(null,arguments)},be=C._emscripten_bind_PointAttribute_byte_stride_0=function(){return(be=C._emscripten_bind_PointAttribute_byte_stride_0=C.asm.q).apply(null,arguments)},Te=C._emscripten_bind_PointAttribute_byte_offset_0=function(){return(Te=C._emscripten_bind_PointAttribute_byte_offset_0=C.asm.r).apply(null,arguments)},Ee=C._emscripten_bind_PointAttribute_unique_id_0=function(){return(Ee=C._emscripten_bind_PointAttribute_unique_id_0=C.asm.s).apply(null,arguments)},Ae=C._emscripten_bind_PointAttribute___destroy___0=function(){return(Ae=C._emscripten_bind_PointAttribute___destroy___0=C.asm.t).apply(null,arguments)},xe=C._emscripten_bind_PointCloud_PointCloud_0=function(){return(xe=C._emscripten_bind_PointCloud_PointCloud_0=C.asm.u).apply(null,arguments)},Ie=C._emscripten_bind_PointCloud_num_attributes_0=function(){return(Ie=C._emscripten_bind_PointCloud_num_attributes_0=C.asm.v).apply(null,arguments)},Re=C._emscripten_bind_PointCloud_num_points_0=function(){return(Re=C._emscripten_bind_PointCloud_num_points_0=C.asm.w).apply(null,arguments)},Se=C._emscripten_bind_PointCloud___destroy___0=function(){return(Se=C._emscripten_bind_PointCloud___destroy___0=C.asm.x).apply(null,arguments)},Me=C._emscripten_bind_Mesh_Mesh_0=function(){return(Me=C._emscripten_bind_Mesh_Mesh_0=C.asm.y).apply(null,arguments)},Ne=C._emscripten_bind_Mesh_num_faces_0=function(){return(Ne=C._emscripten_bind_Mesh_num_faces_0=C.asm.z).apply(null,arguments)},we=C._emscripten_bind_Mesh_num_attributes_0=function(){return(we=C._emscripten_bind_Mesh_num_attributes_0=C.asm.A).apply(null,arguments)},ve=C._emscripten_bind_Mesh_num_points_0=function(){return(ve=C._emscripten_bind_Mesh_num_points_0=C.asm.B).apply(null,arguments)},Oe=C._emscripten_bind_Mesh_set_num_points_1=function(){return(Oe=C._emscripten_bind_Mesh_set_num_points_1=C.asm.C).apply(null,arguments)},Ce=C._emscripten_bind_Mesh___destroy___0=function(){return(Ce=C._emscripten_bind_Mesh___destroy___0=C.asm.D).apply(null,arguments)},De=C._emscripten_bind_Metadata_Metadata_0=function(){return(De=C._emscripten_bind_Metadata_Metadata_0=C.asm.E).apply(null,arguments)},je=C._emscripten_bind_Metadata___destroy___0=function(){return(je=C._emscripten_bind_Metadata___destroy___0=C.asm.F).apply(null,arguments)},Pe=C._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return(Pe=C._emscripten_bind_DracoInt8Array_DracoInt8Array_0=C.asm.G).apply(null,arguments)},Fe=C._emscripten_bind_DracoInt8Array_GetValue_1=function(){return(Fe=C._emscripten_bind_DracoInt8Array_GetValue_1=C.asm.H).apply(null,arguments)},Ue=C._emscripten_bind_DracoInt8Array_size_0=function(){return(Ue=C._emscripten_bind_DracoInt8Array_size_0=C.asm.I).apply(null,arguments)},Le=C._emscripten_bind_DracoInt8Array___destroy___0=function(){return(Le=C._emscripten_bind_DracoInt8Array___destroy___0=C.asm.J).apply(null,arguments)},Ge=C._emscripten_bind_MetadataBuilder_MetadataBuilder_0=function(){return(Ge=C._emscripten_bind_MetadataBuilder_MetadataBuilder_0=C.asm.K).apply(null,arguments)},Be=C._emscripten_bind_MetadataBuilder_AddStringEntry_3=function(){return(Be=C._emscripten_bind_MetadataBuilder_AddStringEntry_3=C.asm.L).apply(null,arguments)},Ve=C._emscripten_bind_MetadataBuilder_AddIntEntry_3=function(){return(Ve=C._emscripten_bind_MetadataBuilder_AddIntEntry_3=C.asm.M).apply(null,arguments)},ke=C._emscripten_bind_MetadataBuilder_AddIntEntryArray_4=function(){return(ke=C._emscripten_bind_MetadataBuilder_AddIntEntryArray_4=C.asm.N).apply(null,arguments)},ze=C._emscripten_bind_MetadataBuilder_AddDoubleEntry_3=function(){return(ze=C._emscripten_bind_MetadataBuilder_AddDoubleEntry_3=C.asm.O).apply(null,arguments)},He=C._emscripten_bind_MetadataBuilder___destroy___0=function(){return(He=C._emscripten_bind_MetadataBuilder___destroy___0=C.asm.P).apply(null,arguments)},qe=C._emscripten_bind_PointCloudBuilder_PointCloudBuilder_0=function(){return(qe=C._emscripten_bind_PointCloudBuilder_PointCloudBuilder_0=C.asm.Q).apply(null,arguments)},$e=C._emscripten_bind_PointCloudBuilder_AddFloatAttribute_5=function(){return($e=C._emscripten_bind_PointCloudBuilder_AddFloatAttribute_5=C.asm.R).apply(null,arguments)},We=C._emscripten_bind_PointCloudBuilder_AddInt8Attribute_5=function(){return(We=C._emscripten_bind_PointCloudBuilder_AddInt8Attribute_5=C.asm.S).apply(null,arguments)},Xe=C._emscripten_bind_PointCloudBuilder_AddUInt8Attribute_5=function(){return(Xe=C._emscripten_bind_PointCloudBuilder_AddUInt8Attribute_5=C.asm.T).apply(null,arguments)},Ye=C._emscripten_bind_PointCloudBuilder_AddInt16Attribute_5=function(){return(Ye=C._emscripten_bind_PointCloudBuilder_AddInt16Attribute_5=C.asm.U).apply(null,arguments)},Qe=C._emscripten_bind_PointCloudBuilder_AddUInt16Attribute_5=function(){return(Qe=C._emscripten_bind_PointCloudBuilder_AddUInt16Attribute_5=C.asm.V).apply(null,arguments)},Ke=C._emscripten_bind_PointCloudBuilder_AddInt32Attribute_5=function(){return(Ke=C._emscripten_bind_PointCloudBuilder_AddInt32Attribute_5=C.asm.W).apply(null,arguments)},Je=C._emscripten_bind_PointCloudBuilder_AddUInt32Attribute_5=function(){return(Je=C._emscripten_bind_PointCloudBuilder_AddUInt32Attribute_5=C.asm.X).apply(null,arguments)},Ze=C._emscripten_bind_PointCloudBuilder_AddMetadata_2=function(){return(Ze=C._emscripten_bind_PointCloudBuilder_AddMetadata_2=C.asm.Y).apply(null,arguments)},et=C._emscripten_bind_PointCloudBuilder_SetMetadataForAttribute_3=function(){return(et=C._emscripten_bind_PointCloudBuilder_SetMetadataForAttribute_3=C.asm.Z).apply(null,arguments)},tt=C._emscripten_bind_PointCloudBuilder_SetNormalizedFlagForAttribute_3=function(){return(tt=C._emscripten_bind_PointCloudBuilder_SetNormalizedFlagForAttribute_3=C.asm._).apply(null,arguments)},rt=C._emscripten_bind_PointCloudBuilder___destroy___0=function(){return(rt=C._emscripten_bind_PointCloudBuilder___destroy___0=C.asm.$).apply(null,arguments)},nt=C._emscripten_bind_MeshBuilder_MeshBuilder_0=function(){return(nt=C._emscripten_bind_MeshBuilder_MeshBuilder_0=C.asm.aa).apply(null,arguments)},st=C._emscripten_bind_MeshBuilder_AddFacesToMesh_3=function(){return(st=C._emscripten_bind_MeshBuilder_AddFacesToMesh_3=C.asm.ba).apply(null,arguments)},ot=C._emscripten_bind_MeshBuilder_AddFloatAttributeToMesh_5=function(){return(ot=C._emscripten_bind_MeshBuilder_AddFloatAttributeToMesh_5=C.asm.ca).apply(null,arguments)},it=C._emscripten_bind_MeshBuilder_AddInt32AttributeToMesh_5=function(){return(it=C._emscripten_bind_MeshBuilder_AddInt32AttributeToMesh_5=C.asm.da).apply(null,arguments)},at=C._emscripten_bind_MeshBuilder_AddMetadataToMesh_2=function(){return(at=C._emscripten_bind_MeshBuilder_AddMetadataToMesh_2=C.asm.ea).apply(null,arguments)},ct=C._emscripten_bind_MeshBuilder_AddFloatAttribute_5=function(){return(ct=C._emscripten_bind_MeshBuilder_AddFloatAttribute_5=C.asm.fa).apply(null,arguments)},ut=C._emscripten_bind_MeshBuilder_AddInt8Attribute_5=function(){return(ut=C._emscripten_bind_MeshBuilder_AddInt8Attribute_5=C.asm.ga).apply(null,arguments)},pt=C._emscripten_bind_MeshBuilder_AddUInt8Attribute_5=function(){return(pt=C._emscripten_bind_MeshBuilder_AddUInt8Attribute_5=C.asm.ha).apply(null,arguments)},lt=C._emscripten_bind_MeshBuilder_AddInt16Attribute_5=function(){return(lt=C._emscripten_bind_MeshBuilder_AddInt16Attribute_5=C.asm.ia).apply(null,arguments)},ft=C._emscripten_bind_MeshBuilder_AddUInt16Attribute_5=function(){return(ft=C._emscripten_bind_MeshBuilder_AddUInt16Attribute_5=C.asm.ja).apply(null,arguments)},_t=C._emscripten_bind_MeshBuilder_AddInt32Attribute_5=function(){return(_t=C._emscripten_bind_MeshBuilder_AddInt32Attribute_5=C.asm.ka).apply(null,arguments)},dt=C._emscripten_bind_MeshBuilder_AddUInt32Attribute_5=function(){return(dt=C._emscripten_bind_MeshBuilder_AddUInt32Attribute_5=C.asm.la).apply(null,arguments)},ht=C._emscripten_bind_MeshBuilder_AddMetadata_2=function(){return(ht=C._emscripten_bind_MeshBuilder_AddMetadata_2=C.asm.ma).apply(null,arguments)},yt=C._emscripten_bind_MeshBuilder_SetMetadataForAttribute_3=function(){return(yt=C._emscripten_bind_MeshBuilder_SetMetadataForAttribute_3=C.asm.na).apply(null,arguments)},mt=C._emscripten_bind_MeshBuilder_SetNormalizedFlagForAttribute_3=function(){return(mt=C._emscripten_bind_MeshBuilder_SetNormalizedFlagForAttribute_3=C.asm.oa).apply(null,arguments)},gt=C._emscripten_bind_MeshBuilder___destroy___0=function(){return(gt=C._emscripten_bind_MeshBuilder___destroy___0=C.asm.pa).apply(null,arguments)},bt=C._emscripten_bind_Encoder_Encoder_0=function(){return(bt=C._emscripten_bind_Encoder_Encoder_0=C.asm.qa).apply(null,arguments)},Tt=C._emscripten_bind_Encoder_SetEncodingMethod_1=function(){return(Tt=C._emscripten_bind_Encoder_SetEncodingMethod_1=C.asm.ra).apply(null,arguments)},Et=C._emscripten_bind_Encoder_SetAttributeQuantization_2=function(){return(Et=C._emscripten_bind_Encoder_SetAttributeQuantization_2=C.asm.sa).apply(null,arguments)},At=C._emscripten_bind_Encoder_SetAttributeExplicitQuantization_5=function(){return(At=C._emscripten_bind_Encoder_SetAttributeExplicitQuantization_5=C.asm.ta).apply(null,arguments)},xt=C._emscripten_bind_Encoder_SetSpeedOptions_2=function(){return(xt=C._emscripten_bind_Encoder_SetSpeedOptions_2=C.asm.ua).apply(null,arguments)},It=C._emscripten_bind_Encoder_SetTrackEncodedProperties_1=function(){return(It=C._emscripten_bind_Encoder_SetTrackEncodedProperties_1=C.asm.va).apply(null,arguments)},Rt=C._emscripten_bind_Encoder_EncodeMeshToDracoBuffer_2=function(){return(Rt=C._emscripten_bind_Encoder_EncodeMeshToDracoBuffer_2=C.asm.wa).apply(null,arguments)},St=C._emscripten_bind_Encoder_EncodePointCloudToDracoBuffer_3=function(){return(St=C._emscripten_bind_Encoder_EncodePointCloudToDracoBuffer_3=C.asm.xa).apply(null,arguments)},Mt=C._emscripten_bind_Encoder_GetNumberOfEncodedPoints_0=function(){return(Mt=C._emscripten_bind_Encoder_GetNumberOfEncodedPoints_0=C.asm.ya).apply(null,arguments)},Nt=C._emscripten_bind_Encoder_GetNumberOfEncodedFaces_0=function(){return(Nt=C._emscripten_bind_Encoder_GetNumberOfEncodedFaces_0=C.asm.za).apply(null,arguments)},wt=C._emscripten_bind_Encoder___destroy___0=function(){return(wt=C._emscripten_bind_Encoder___destroy___0=C.asm.Aa).apply(null,arguments)},vt=C._emscripten_bind_ExpertEncoder_ExpertEncoder_1=function(){return(vt=C._emscripten_bind_ExpertEncoder_ExpertEncoder_1=C.asm.Ba).apply(null,arguments)},Ot=C._emscripten_bind_ExpertEncoder_SetEncodingMethod_1=function(){return(Ot=C._emscripten_bind_ExpertEncoder_SetEncodingMethod_1=C.asm.Ca).apply(null,arguments)},Ct=C._emscripten_bind_ExpertEncoder_SetAttributeQuantization_2=function(){return(Ct=C._emscripten_bind_ExpertEncoder_SetAttributeQuantization_2=C.asm.Da).apply(null,arguments)},Dt=C._emscripten_bind_ExpertEncoder_SetAttributeExplicitQuantization_5=function(){return(Dt=C._emscripten_bind_ExpertEncoder_SetAttributeExplicitQuantization_5=C.asm.Ea).apply(null,arguments)},jt=C._emscripten_bind_ExpertEncoder_SetSpeedOptions_2=function(){return(jt=C._emscripten_bind_ExpertEncoder_SetSpeedOptions_2=C.asm.Fa).apply(null,arguments)},Pt=C._emscripten_bind_ExpertEncoder_SetTrackEncodedProperties_1=function(){return(Pt=C._emscripten_bind_ExpertEncoder_SetTrackEncodedProperties_1=C.asm.Ga).apply(null,arguments)},Ft=C._emscripten_bind_ExpertEncoder_EncodeToDracoBuffer_2=function(){return(Ft=C._emscripten_bind_ExpertEncoder_EncodeToDracoBuffer_2=C.asm.Ha).apply(null,arguments)},Ut=C._emscripten_bind_ExpertEncoder_GetNumberOfEncodedPoints_0=function(){return(Ut=C._emscripten_bind_ExpertEncoder_GetNumberOfEncodedPoints_0=C.asm.Ia).apply(null,arguments)},Lt=C._emscripten_bind_ExpertEncoder_GetNumberOfEncodedFaces_0=function(){return(Lt=C._emscripten_bind_ExpertEncoder_GetNumberOfEncodedFaces_0=C.asm.Ja).apply(null,arguments)},Gt=C._emscripten_bind_ExpertEncoder___destroy___0=function(){return(Gt=C._emscripten_bind_ExpertEncoder___destroy___0=C.asm.Ka).apply(null,arguments)},Bt=C._emscripten_enum_draco_GeometryAttribute_Type_INVALID=function(){return(Bt=C._emscripten_enum_draco_GeometryAttribute_Type_INVALID=C.asm.La).apply(null,arguments)},Vt=C._emscripten_enum_draco_GeometryAttribute_Type_POSITION=function(){return(Vt=C._emscripten_enum_draco_GeometryAttribute_Type_POSITION=C.asm.Ma).apply(null,arguments)},kt=C._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return(kt=C._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=C.asm.Na).apply(null,arguments)},zt=C._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return(zt=C._emscripten_enum_draco_GeometryAttribute_Type_COLOR=C.asm.Oa).apply(null,arguments)},Ht=C._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return(Ht=C._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=C.asm.Pa).apply(null,arguments)},qt=C._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return(qt=C._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=C.asm.Qa).apply(null,arguments)},$t=C._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return($t=C._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=C.asm.Ra).apply(null,arguments)},Wt=C._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return(Wt=C._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=C.asm.Sa).apply(null,arguments)},Xt=C._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return(Xt=C._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=C.asm.Ta).apply(null,arguments)},Yt=C._emscripten_enum_draco_MeshEncoderMethod_MESH_SEQUENTIAL_ENCODING=function(){return(Yt=C._emscripten_enum_draco_MeshEncoderMethod_MESH_SEQUENTIAL_ENCODING=C.asm.Ua).apply(null,arguments)},Qt=C._emscripten_enum_draco_MeshEncoderMethod_MESH_EDGEBREAKER_ENCODING=function(){return(Qt=C._emscripten_enum_draco_MeshEncoderMethod_MESH_EDGEBREAKER_ENCODING=C.asm.Va).apply(null,arguments)};C._malloc=function(){return(C._malloc=C.asm.Wa).apply(null,arguments)},C._free=function(){return(C._free=C.asm.Xa).apply(null,arguments)};var Kt,Jt=function(){return(Jt=C.asm.Ya).apply(null,arguments)};if(C.___start_em_js=19116,C.___stop_em_js=19214,ae=function e(){Kt||u(),Kt||(ae=e)},C.preInit)for("function"==typeof C.preInit&&(C.preInit=[C.preInit]);0<C.preInit.length;)C.preInit.pop()();u(),p.prototype=Object.create(p.prototype),p.prototype.constructor=p,p.prototype.__class__=p,p.__cache__={},C.WrapperObject=p,C.getCache=l,C.wrapPointer=f,C.castObject=function(e,t){return f(e.ptr,t)},C.NULL=f(0),C.destroy=function(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete l(e.__class__)[e.ptr]},C.compare=function(e,t){return e.ptr===t.ptr},C.getPointer=function(e){return e.ptr},C.getClass=function(e){return e.__class__};var Zt={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(Zt.needed){for(var e=0;e<Zt.temps.length;e++)C._free(Zt.temps[e]);Zt.temps.length=0,C._free(Zt.buffer),Zt.buffer=0,Zt.size+=Zt.needed,Zt.needed=0}Zt.buffer||(Zt.size+=128,Zt.buffer=C._malloc(Zt.size),Zt.buffer||o(void 0)),Zt.pos=0},alloc:function(e,t){return Zt.buffer||o(void 0),e=7+(e=e.length*t.BYTES_PER_ELEMENT)&-8,Zt.pos+e>=Zt.size?(0<e||o(void 0),Zt.needed+=e,t=C._malloc(e),Zt.temps.push(t)):(t=Zt.buffer+Zt.pos,Zt.pos+=e),t},copy:function(e,t,r){switch(r>>>=0,t.BYTES_PER_ELEMENT){case 2:r>>>=1;break;case 4:r>>>=2;break;case 8:r>>>=3}for(var n=0;n<e.length;n++)t[r+n]=e[n]}};return g.prototype=Object.create(p.prototype),g.prototype.constructor=g,g.prototype.__class__=g,g.__cache__={},C.VoidPtr=g,g.prototype.__destroy__=g.prototype.__destroy__=function(){pe(this.ptr)},b.prototype=Object.create(p.prototype),b.prototype.constructor=b,b.prototype.__class__=b,b.__cache__={},C.GeometryAttribute=b,b.prototype.__destroy__=b.prototype.__destroy__=function(){fe(this.ptr)},T.prototype=Object.create(p.prototype),T.prototype.constructor=T,T.prototype.__class__=T,T.__cache__={},C.PointAttribute=T,T.prototype.size=T.prototype.size=function(){return de(this.ptr)},T.prototype.attribute_type=T.prototype.attribute_type=function(){return he(this.ptr)},T.prototype.data_type=T.prototype.data_type=function(){return ye(this.ptr)},T.prototype.num_components=T.prototype.num_components=function(){return me(this.ptr)},T.prototype.normalized=T.prototype.normalized=function(){return!!ge(this.ptr)},T.prototype.byte_stride=T.prototype.byte_stride=function(){return be(this.ptr)},T.prototype.byte_offset=T.prototype.byte_offset=function(){return Te(this.ptr)},T.prototype.unique_id=T.prototype.unique_id=function(){return Ee(this.ptr)},T.prototype.__destroy__=T.prototype.__destroy__=function(){Ae(this.ptr)},E.prototype=Object.create(p.prototype),E.prototype.constructor=E,E.prototype.__class__=E,E.__cache__={},C.PointCloud=E,E.prototype.num_attributes=E.prototype.num_attributes=function(){return Ie(this.ptr)},E.prototype.num_points=E.prototype.num_points=function(){return Re(this.ptr)},E.prototype.__destroy__=E.prototype.__destroy__=function(){Se(this.ptr)},A.prototype=Object.create(p.prototype),A.prototype.constructor=A,A.prototype.__class__=A,A.__cache__={},C.Mesh=A,A.prototype.num_faces=A.prototype.num_faces=function(){return Ne(this.ptr)},A.prototype.num_attributes=A.prototype.num_attributes=function(){return we(this.ptr)},A.prototype.num_points=A.prototype.num_points=function(){return ve(this.ptr)},A.prototype.set_num_points=A.prototype.set_num_points=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Oe(t,e)},A.prototype.__destroy__=A.prototype.__destroy__=function(){Ce(this.ptr)},x.prototype=Object.create(p.prototype),x.prototype.constructor=x,x.prototype.__class__=x,x.__cache__={},C.Metadata=x,x.prototype.__destroy__=x.prototype.__destroy__=function(){je(this.ptr)},I.prototype=Object.create(p.prototype),I.prototype.constructor=I,I.prototype.__class__=I,I.__cache__={},C.DracoInt8Array=I,I.prototype.GetValue=I.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Fe(t,e)},I.prototype.size=I.prototype.size=function(){return Ue(this.ptr)},I.prototype.__destroy__=I.prototype.__destroy__=function(){Le(this.ptr)},R.prototype=Object.create(p.prototype),R.prototype.constructor=R,R.prototype.__class__=R,R.__cache__={},C.MetadataBuilder=R,R.prototype.AddStringEntry=R.prototype.AddStringEntry=function(e,t,r){var n=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:_(t),r=r&&"object"==typeof r?r.ptr:_(r),!!Be(n,e,t,r)},R.prototype.AddIntEntry=R.prototype.AddIntEntry=function(e,t,r){var n=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:_(t),r&&"object"==typeof r&&(r=r.ptr),!!Ve(n,e,t,r)},R.prototype.AddIntEntryArray=R.prototype.AddIntEntryArray=function(e,t,r,n){var s=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:_(t),"object"==typeof r&&(r=y(r)),n&&"object"==typeof n&&(n=n.ptr),!!ke(s,e,t,r,n)},R.prototype.AddDoubleEntry=R.prototype.AddDoubleEntry=function(e,t,r){var n=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:_(t),r&&"object"==typeof r&&(r=r.ptr),!!ze(n,e,t,r)},R.prototype.__destroy__=R.prototype.__destroy__=function(){He(this.ptr)},S.prototype=Object.create(p.prototype),S.prototype.constructor=S,S.prototype.__class__=S,S.__cache__={},C.PointCloudBuilder=S,S.prototype.AddFloatAttribute=S.prototype.AddFloatAttribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=m(s)),$e(o,e,t,r,n,s)},S.prototype.AddInt8Attribute=S.prototype.AddInt8Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=d(s)),We(o,e,t,r,n,s)},S.prototype.AddUInt8Attribute=S.prototype.AddUInt8Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=d(s)),Xe(o,e,t,r,n,s)},S.prototype.AddInt16Attribute=S.prototype.AddInt16Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=h(s)),Ye(o,e,t,r,n,s)},S.prototype.AddUInt16Attribute=S.prototype.AddUInt16Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=h(s)),Qe(o,e,t,r,n,s)},S.prototype.AddInt32Attribute=S.prototype.AddInt32Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=y(s)),Ke(o,e,t,r,n,s)},S.prototype.AddUInt32Attribute=S.prototype.AddUInt32Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=y(s)),Je(o,e,t,r,n,s)},S.prototype.AddMetadata=S.prototype.AddMetadata=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Ze(r,e,t)},S.prototype.SetMetadataForAttribute=S.prototype.SetMetadataForAttribute=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!et(n,e,t,r)},S.prototype.SetNormalizedFlagForAttribute=S.prototype.SetNormalizedFlagForAttribute=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!tt(n,e,t,r)},S.prototype.__destroy__=S.prototype.__destroy__=function(){rt(this.ptr)},M.prototype=Object.create(p.prototype),M.prototype.constructor=M,M.prototype.__class__=M,M.__cache__={},C.MeshBuilder=M,M.prototype.AddFacesToMesh=M.prototype.AddFacesToMesh=function(e,t,r){var n=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),"object"==typeof r&&(r=y(r)),!!st(n,e,t,r)},M.prototype.AddFloatAttributeToMesh=M.prototype.AddFloatAttributeToMesh=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=m(s)),ot(o,e,t,r,n,s)},M.prototype.AddInt32AttributeToMesh=M.prototype.AddInt32AttributeToMesh=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=y(s)),it(o,e,t,r,n,s)},M.prototype.AddMetadataToMesh=M.prototype.AddMetadataToMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!at(r,e,t)},M.prototype.AddFloatAttribute=M.prototype.AddFloatAttribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=m(s)),ct(o,e,t,r,n,s)},M.prototype.AddInt8Attribute=M.prototype.AddInt8Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=d(s)),ut(o,e,t,r,n,s)},M.prototype.AddUInt8Attribute=M.prototype.AddUInt8Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=d(s)),pt(o,e,t,r,n,s)},M.prototype.AddInt16Attribute=M.prototype.AddInt16Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=h(s)),lt(o,e,t,r,n,s)},M.prototype.AddUInt16Attribute=M.prototype.AddUInt16Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=h(s)),ft(o,e,t,r,n,s)},M.prototype.AddInt32Attribute=M.prototype.AddInt32Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=y(s)),_t(o,e,t,r,n,s)},M.prototype.AddUInt32Attribute=M.prototype.AddUInt32Attribute=function(e,t,r,n,s){var o=this.ptr;return Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=y(s)),dt(o,e,t,r,n,s)},M.prototype.AddMetadata=M.prototype.AddMetadata=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!ht(r,e,t)},M.prototype.SetMetadataForAttribute=M.prototype.SetMetadataForAttribute=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!yt(n,e,t,r)},M.prototype.SetNormalizedFlagForAttribute=M.prototype.SetNormalizedFlagForAttribute=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!mt(n,e,t,r)},M.prototype.__destroy__=M.prototype.__destroy__=function(){gt(this.ptr)},N.prototype=Object.create(p.prototype),N.prototype.constructor=N,N.prototype.__class__=N,N.__cache__={},C.Encoder=N,N.prototype.SetEncodingMethod=N.prototype.SetEncodingMethod=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Tt(t,e)},N.prototype.SetAttributeQuantization=N.prototype.SetAttributeQuantization=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Et(r,e,t)},N.prototype.SetAttributeExplicitQuantization=N.prototype.SetAttributeExplicitQuantization=function(e,t,r,n,s){var o=this.ptr;Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),"object"==typeof n&&(n=m(n)),s&&"object"==typeof s&&(s=s.ptr),At(o,e,t,r,n,s)},N.prototype.SetSpeedOptions=N.prototype.SetSpeedOptions=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),xt(r,e,t)},N.prototype.SetTrackEncodedProperties=N.prototype.SetTrackEncodedProperties=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),It(t,e)},N.prototype.EncodeMeshToDracoBuffer=N.prototype.EncodeMeshToDracoBuffer=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Rt(r,e,t)},N.prototype.EncodePointCloudToDracoBuffer=N.prototype.EncodePointCloudToDracoBuffer=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),St(n,e,t,r)},N.prototype.GetNumberOfEncodedPoints=N.prototype.GetNumberOfEncodedPoints=function(){return Mt(this.ptr)},N.prototype.GetNumberOfEncodedFaces=N.prototype.GetNumberOfEncodedFaces=function(){return Nt(this.ptr)},N.prototype.__destroy__=N.prototype.__destroy__=function(){wt(this.ptr)},w.prototype=Object.create(p.prototype),w.prototype.constructor=w,w.prototype.__class__=w,w.__cache__={},C.ExpertEncoder=w,w.prototype.SetEncodingMethod=w.prototype.SetEncodingMethod=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Ot(t,e)},w.prototype.SetAttributeQuantization=w.prototype.SetAttributeQuantization=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Ct(r,e,t)},w.prototype.SetAttributeExplicitQuantization=w.prototype.SetAttributeExplicitQuantization=function(e,t,r,n,s){var o=this.ptr;Zt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),"object"==typeof n&&(n=m(n)),s&&"object"==typeof s&&(s=s.ptr),Dt(o,e,t,r,n,s)},w.prototype.SetSpeedOptions=w.prototype.SetSpeedOptions=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),jt(r,e,t)},w.prototype.SetTrackEncodedProperties=w.prototype.SetTrackEncodedProperties=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Pt(t,e)},w.prototype.EncodeToDracoBuffer=w.prototype.EncodeToDracoBuffer=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Ft(r,e,t)},w.prototype.GetNumberOfEncodedPoints=w.prototype.GetNumberOfEncodedPoints=function(){return Ut(this.ptr)},w.prototype.GetNumberOfEncodedFaces=w.prototype.GetNumberOfEncodedFaces=function(){return Lt(this.ptr)},w.prototype.__destroy__=w.prototype.__destroy__=function(){Gt(this.ptr)},function(){function e(){C.INVALID=Bt(),C.POSITION=Vt(),C.NORMAL=kt(),C.COLOR=zt(),C.TEX_COORD=Ht(),C.GENERIC=qt(),C.INVALID_GEOMETRY_TYPE=$t(),C.POINT_CLOUD=Wt(),C.TRIANGULAR_MESH=Xt(),C.MESH_SEQUENTIAL_ENCODING=Yt(),C.MESH_EDGEBREAKER_ENCODING=Qt()}oe?e():ne.unshift(e)}(),"function"==typeof C.onModuleParsed&&C.onModuleParsed(),r.ready});r.exports=o}(sa)),sa.exports}var aa,ca,ua,pa={exports:{}},la=pa.exports;function fa(){return aa||(aa=1,function(r){var n=n||{};n.scope={},n.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},n.arrayIterator=function(e){return{next:n.arrayIteratorImpl(e)}},n.makeIterator=function(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):n.arrayIterator(e)},n.ASSUME_ES5=!1,n.ASSUME_NO_NATIVE_MAP=!1,n.ASSUME_NO_NATIVE_SET=!1,n.SIMPLE_FROUND_POLYFILL=!1,n.ISOLATE_POLYFILLS=!1,n.FORCE_POLYFILL_PROMISE=!1,n.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,n.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Bn&&Bn];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")},n.global=n.getGlobal(la),n.defineProperty=n.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},n.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),n.TRUST_ES6_POLYFILLS=!n.ISOLATE_POLYFILLS||n.IS_SYMBOL_NATIVE,n.polyfills={},n.propertyToPolyfillSymbol={},n.POLYFILL_PREFIX="$jscp$",n.polyfill=function(e,t,r,s){t&&(n.ISOLATE_POLYFILLS?n.polyfillIsolated(e,t,r,s):n.polyfillUnisolated(e,t,r,s))},n.polyfillUnisolated=function(e,t,r,s){for(r=n.global,e=e.split("."),s=0;s<e.length-1;s++){var o=e[s];if(!(o in r))return;r=r[o]}(t=t(s=r[e=e[e.length-1]]))!=s&&null!=t&&n.defineProperty(r,e,{configurable:!0,writable:!0,value:t})},n.polyfillIsolated=function(e,t,r,s){var o=e.split(".");e=1===o.length,s=o[0],s=!e&&s in n.polyfills?n.polyfills:n.global;for(var i=0;i<o.length-1;i++){var a=o[i];if(!(a in s))return;s=s[a]}o=o[o.length-1],null!=(t=t(r=n.IS_SYMBOL_NATIVE&&"es6"===r?s[o]:null))&&(e?n.defineProperty(n.polyfills,o,{configurable:!0,writable:!0,value:t}):t!==r&&(void 0===n.propertyToPolyfillSymbol[o]&&(r=1e9*Math.random()>>>0,n.propertyToPolyfillSymbol[o]=n.IS_SYMBOL_NATIVE?n.global.Symbol(o):n.POLYFILL_PREFIX+r+"$"+o),n.defineProperty(s,n.propertyToPolyfillSymbol[o],{configurable:!0,writable:!0,value:t})))},n.polyfill("Promise",(function(e){function t(){this.batch_=null}function r(e){return e instanceof o?e:new o((function(t,r){t(e)}))}if(e&&(!(n.FORCE_POLYFILL_PROMISE||n.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&void 0===n.global.PromiseRejectionEvent)||!n.global.Promise||-1===n.global.Promise.toString().indexOf("[native code]")))return e;t.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var t=this;this.asyncExecuteFunction((function(){t.executeBatch_()}))}this.batch_.push(e)};var s=n.global.setTimeout;t.prototype.asyncExecuteFunction=function(e){s(e,0)},t.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},t.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var o=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[],this.isRejectionHandled_=!1;var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};o.prototype.createResolveAndReject_=function(){function e(e){return function(n){r||(r=!0,e.call(t,n))}}var t=this,r=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},o.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof o)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},o.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},o.prototype.reject_=function(e){this.settle_(2,e)},o.prototype.fulfill_=function(e){this.settle_(1,e)},o.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,2===this.state_&&this.scheduleUnhandledRejectionCheck_(),this.executeOnSettledCallbacks_()},o.prototype.scheduleUnhandledRejectionCheck_=function(){var e=this;s((function(){if(e.notifyUnhandledRejection_()){var t=n.global.console;void 0!==t&&t.error(e.result_)}}),1)},o.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var e=n.global.CustomEvent,t=n.global.Event,r=n.global.dispatchEvent;return void 0===r||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=n.global.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.result_,r(e))},o.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)i.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var i=new t;return o.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},o.prototype.settleSameAsThenable_=function(e,t){var r=this.createResolveAndReject_();try{e.call(t,r.resolve,r.reject)}catch(e){r.reject(e)}},o.prototype.then=function(e,t){function r(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(e){s(e)}}:t}var n,s,i=new o((function(e,t){n=e,s=t}));return this.callWhenSettled_(r(e,n),r(t,s)),i},o.prototype.catch=function(e){return this.then(void 0,e)},o.prototype.callWhenSettled_=function(e,t){function r(){switch(n.state_){case 1:e(n.result_);break;case 2:t(n.result_);break;default:throw Error("Unexpected state: "+n.state_)}}var n=this;null==this.onSettledCallbacks_?i.asyncExecute(r):this.onSettledCallbacks_.push(r),this.isRejectionHandled_=!0},o.resolve=r,o.reject=function(e){return new o((function(t,r){r(e)}))},o.race=function(e){return new o((function(t,s){for(var o=n.makeIterator(e),i=o.next();!i.done;i=o.next())r(i.value).callWhenSettled_(t,s)}))},o.all=function(e){var t=n.makeIterator(e),s=t.next();return s.done?r([]):new o((function(e,n){function o(t){return function(r){i[t]=r,0==--a&&e(i)}}var i=[],a=0;do{i.push(void 0),a++,r(s.value).callWhenSettled_(o(i.length-1),n),s=t.next()}while(!s.done)}))},o}),"es6","es3"),n.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.assign=n.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(e,t){for(var r=1;r<arguments.length;r++){var s=arguments[r];if(s)for(var o in s)n.owns(s,o)&&(e[o]=s[o])}return e},n.polyfill("Object.assign",(function(e){return e||n.assign}),"es6","es3"),n.checkStringArgs=function(e,t,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""},n.polyfill("String.prototype.startsWith",(function(e){return e||function(e,t){var r=n.checkStringArgs(this,e,"startsWith");e+="";var s=r.length,o=e.length;t=Math.max(0,Math.min(0|t,r.length));for(var i=0;i<o&&t<s;)if(r[t++]!=e[i++])return!1;return i>=o}}),"es6","es3"),n.polyfill("Array.prototype.copyWithin",(function(e){function t(e){return 1/0===(e=Number(e))||-1/0===e?e:0|e}return e||function(e,r,n){var s=this.length;if(e=t(e),r=t(r),n=void 0===n?s:t(n),e=0>e?Math.max(s+e,0):Math.min(e,s),r=0>r?Math.max(s+r,0):Math.min(r,s),n=0>n?Math.max(s+n,0):Math.min(n,s),e<r)for(;r<n;)r in this?this[e++]=this[r++]:(delete this[e++],r++);else for(e+=(n=Math.min(n,s+r-e))-r;n>r;)--n in this?this[--e]=this[n]:delete this[--e];return this}}),"es6","es3"),n.typedArrayCopyWithin=function(e){return e||Array.prototype.copyWithin},n.polyfill("Int8Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint8Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint8ClampedArray.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Int16Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint16Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Int32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Uint32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Float32Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5"),n.polyfill("Float64Array.prototype.copyWithin",n.typedArrayCopyWithin,"es6","es5");var s,o=(s="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(s=s||__filename),function(r){function n(e,t){if(e){var r=te,n=e+t;for(t=e;r[t]&&!(t>=n);)++t;if(16<t-e&&r.buffer&&oe)r=oe.decode(r.subarray(e,t));else{for(n="";e<t;){var s=r[e++];if(128&s){var o=63&r[e++];if(192==(224&s))n+=String.fromCharCode((31&s)<<6|o);else{var i=63&r[e++];65536>(s=224==(240&s)?(15&s)<<12|o<<6|i:(7&s)<<18|o<<12|i<<6|63&r[e++])?n+=String.fromCharCode(s):(s-=65536,n+=String.fromCharCode(55296|s>>10,56320|1023&s))}}else n+=String.fromCharCode(s)}r=n}}else r="";return r}function o(){var e=Z.buffer;L.HEAP8=ee=new Int8Array(e),L.HEAP16=new Int16Array(e),L.HEAP32=re=new Int32Array(e),L.HEAPU8=te=new Uint8Array(e),L.HEAPU16=new Uint16Array(e),L.HEAPU32=ne=new Uint32Array(e),L.HEAPF32=new Float32Array(e),L.HEAPF64=new Float64Array(e)}function i(e){throw L.onAbort&&L.onAbort(e),J(e="Aborted("+e+")"),se=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),U(e),e}function a(e){try{if(e==fe&&K)return new Uint8Array(K);if(Y)return Y(e);throw"both async and sync fetching of the wasm failed"}catch(e){i(e)}}function c(e){for(;0<e.length;)e.shift()(L)}function u(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){ne[this.ptr+4>>2]=e},this.get_type=function(){return ne[this.ptr+4>>2]},this.set_destructor=function(e){ne[this.ptr+8>>2]=e},this.get_destructor=function(){return ne[this.ptr+8>>2]},this.set_refcount=function(e){re[this.ptr>>2]=e},this.set_caught=function(e){ee[this.ptr+12|0]=e?1:0},this.get_caught=function(){return 0!=ee[this.ptr+12|0]},this.set_rethrown=function(e){ee[this.ptr+13|0]=e?1:0},this.get_rethrown=function(){return 0!=ee[this.ptr+13|0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){re[this.ptr>>2]+=1},this.release_ref=function(){var e=re[this.ptr>>2];return re[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){ne[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return ne[this.ptr+16>>2]},this.get_exception_ptr=function(){if(Qr(this.get_type()))return ne[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function p(){function e(){if(!Yr&&(Yr=!0,L.calledRun=!0,!se)){if(ue=!0,c(ae),F(L),L.onRuntimeInitialized&&L.onRuntimeInitialized(),L.postRun)for("function"==typeof L.postRun&&(L.postRun=[L.postRun]);L.postRun.length;)ce.unshift(L.postRun.shift());c(ce)}}if(!(0<pe)){if(L.preRun)for("function"==typeof L.preRun&&(L.preRun=[L.preRun]);L.preRun.length;)ie.unshift(L.preRun.shift());c(ie),0<pe||(L.setStatus?(L.setStatus("Running..."),setTimeout((function(){setTimeout((function(){L.setStatus("")}),1),e()}),1)):e())}}function l(){}function f(e){return(e||l).__cache__}function _(e,t){var r=f(t),n=r[e];return n||((n=Object.create((t||l).prototype)).ptr=e,r[e]=n)}function d(e){if("string"==typeof e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);127>=n?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3}if(r=0,0<(n=(t=Array(t+1)).length)){n=r+n-1;for(var s=0;s<e.length;++s){var o=e.charCodeAt(s);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++s)),127>=o){if(r>=n)break;t[r++]=o}else{if(2047>=o){if(r+1>=n)break;t[r++]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;t[r++]=224|o>>12}else{if(r+3>=n)break;t[r++]=240|o>>18,t[r++]=128|o>>12&63}t[r++]=128|o>>6&63}t[r++]=128|63&o}}t[r]=0}return e=Kr.alloc(t,ee),Kr.copy(t,ee,e),e}return e}function h(e){if("object"==typeof e){var t=Kr.alloc(e,ee);return Kr.copy(e,ee,t),t}return e}function y(){throw"cannot construct a VoidPtr, no constructor in IDL"}function m(){this.ptr=he(),f(m)[this.ptr]=this}function g(){this.ptr=ge(),f(g)[this.ptr]=this}function b(){this.ptr=Ee(),f(b)[this.ptr]=this}function T(){this.ptr=xe(),f(T)[this.ptr]=this}function E(){this.ptr=je(),f(E)[this.ptr]=this}function A(){this.ptr=Be(),f(A)[this.ptr]=this}function x(){this.ptr=He(),f(x)[this.ptr]=this}function I(){this.ptr=Xe(),f(I)[this.ptr]=this}function R(){this.ptr=Ze(),f(R)[this.ptr]=this}function S(){throw"cannot construct a Status, no constructor in IDL"}function M(){this.ptr=ot(),f(M)[this.ptr]=this}function N(){this.ptr=ut(),f(N)[this.ptr]=this}function w(){this.ptr=_t(),f(w)[this.ptr]=this}function v(){this.ptr=mt(),f(v)[this.ptr]=this}function O(){this.ptr=Et(),f(O)[this.ptr]=this}function C(){this.ptr=Rt(),f(C)[this.ptr]=this}function D(){this.ptr=wt(),f(D)[this.ptr]=this}function j(){this.ptr=Dt(),f(j)[this.ptr]=this}function P(){this.ptr=kt(),f(P)[this.ptr]=this}var F,U,L=void 0!==(r=void 0===r?{}:r)?r:{};L.ready=new Promise((function(e,t){F=e,U=t}));var G=!1,B=!1;L.onRuntimeInitialized=function(){G=!0,B&&"function"==typeof L.onModuleLoaded&&L.onModuleLoaded(L)},L.onModuleParsed=function(){B=!0,G&&"function"==typeof L.onModuleLoaded&&L.onModuleLoaded(L)},L.isVersionSupported=function(e){return"string"==typeof e&&!(2>(e=e.split(".")).length||3<e.length)&&(1==e[0]&&0<=e[1]&&5>=e[1]||!(0!=e[0]||10<e[1]))};var V=Object.assign({},L),k="object"==typeof window,z="function"==typeof importScripts,H="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,q="";if(H){var $=e,W=t;q=z?W.dirname(q)+"/":__dirname+"/";var X=function(e,t){return e=e.startsWith("file://")?new URL(e):W.normalize(e),$.readFileSync(e,t?void 0:"utf8")},Y=function(e){return(e=X(e,!0)).buffer||(e=new Uint8Array(e)),e},Q=function(e,t,r){e=e.startsWith("file://")?new URL(e):W.normalize(e),$.readFile(e,(function(e,n){e?r(e):t(n.buffer)}))};1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),L.inspect=function(){return"[Emscripten Module object]"}}else(k||z)&&(z?q=self.location.href:"undefined"!=typeof document&&document.currentScript&&(q=document.currentScript.src),s&&(q=s),q=0!==q.indexOf("blob:")?q.substr(0,q.replace(/[?#].*/,"").lastIndexOf("/")+1):"",X=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},z&&(Y=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),Q=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});L.print||console.log.bind(console);var K,J=L.printErr||console.warn.bind(console);Object.assign(L,V),V=null,L.wasmBinary&&(K=L.wasmBinary),"object"!=typeof WebAssembly&&i("no native wasm support detected");var Z,ee,te,re,ne,se=!1,oe="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,ie=[],ae=[],ce=[],ue=!1,pe=0,le=null,fe="draco_decoder_gltf.wasm";fe.startsWith("data:application/octet-stream;base64,")||(fe=function(e){return L.locateFile?L.locateFile(e,q):q+e}(fe));var _e={b:function(e,t,r){throw new u(e).init(t,r),e},a:function(){i("")},d:function(e,t,r){te.copyWithin(e,t,t+r)},c:function(e){var t=te.length;if(2147483648<(e>>>=0))return!1;for(var r=1;4>=r;r*=2){var n=t*(1+.2/r);n=Math.min(n,e+100663296);var s=Math;n=Math.max(e,n),s=s.min.call(s,2147483648,n+(65536-n%65536)%65536);e:{n=Z.buffer;try{Z.grow(s-n.byteLength+65535>>>16),o();var i=1;break e}catch(e){}i=void 0}if(i)return!0}return!1}};!function(){function e(e,t){L.asm=e.exports,Z=L.asm.e,o(),ae.unshift(L.asm.f),pe--,L.monitorRunDependencies&&L.monitorRunDependencies(pe),0==pe&&le&&(e=le,le=null,e())}function t(t){e(t.instance)}function r(e){return function(){if(!K&&(k||z)){if("function"==typeof fetch&&!fe.startsWith("file://"))return fetch(fe,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+fe+"'";return e.arrayBuffer()})).catch((function(){return a(fe)}));if(Q)return new Promise((function(e,t){Q(fe,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return a(fe)}))}().then((function(e){return WebAssembly.instantiate(e,n)})).then((function(e){return e})).then(e,(function(e){J("failed to asynchronously prepare wasm: "+e),i(e)}))}var n={a:_e};if(pe++,L.monitorRunDependencies&&L.monitorRunDependencies(pe),L.instantiateWasm)try{return L.instantiateWasm(n,e)}catch(e){J("Module.instantiateWasm callback failed with error: "+e),U(e)}(K||"function"!=typeof WebAssembly.instantiateStreaming||fe.startsWith("data:application/octet-stream;base64,")||fe.startsWith("file://")||H||"function"!=typeof fetch?r(t):fetch(fe,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,n).then(t,(function(e){return J("wasm streaming compile failed: "+e),J("falling back to ArrayBuffer instantiation"),r(t)}))}))).catch(U)}();var de=L._emscripten_bind_VoidPtr___destroy___0=function(){return(de=L._emscripten_bind_VoidPtr___destroy___0=L.asm.h).apply(null,arguments)},he=L._emscripten_bind_DecoderBuffer_DecoderBuffer_0=function(){return(he=L._emscripten_bind_DecoderBuffer_DecoderBuffer_0=L.asm.i).apply(null,arguments)},ye=L._emscripten_bind_DecoderBuffer_Init_2=function(){return(ye=L._emscripten_bind_DecoderBuffer_Init_2=L.asm.j).apply(null,arguments)},me=L._emscripten_bind_DecoderBuffer___destroy___0=function(){return(me=L._emscripten_bind_DecoderBuffer___destroy___0=L.asm.k).apply(null,arguments)},ge=L._emscripten_bind_AttributeTransformData_AttributeTransformData_0=function(){return(ge=L._emscripten_bind_AttributeTransformData_AttributeTransformData_0=L.asm.l).apply(null,arguments)},be=L._emscripten_bind_AttributeTransformData_transform_type_0=function(){return(be=L._emscripten_bind_AttributeTransformData_transform_type_0=L.asm.m).apply(null,arguments)},Te=L._emscripten_bind_AttributeTransformData___destroy___0=function(){return(Te=L._emscripten_bind_AttributeTransformData___destroy___0=L.asm.n).apply(null,arguments)},Ee=L._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return(Ee=L._emscripten_bind_GeometryAttribute_GeometryAttribute_0=L.asm.o).apply(null,arguments)},Ae=L._emscripten_bind_GeometryAttribute___destroy___0=function(){return(Ae=L._emscripten_bind_GeometryAttribute___destroy___0=L.asm.p).apply(null,arguments)},xe=L._emscripten_bind_PointAttribute_PointAttribute_0=function(){return(xe=L._emscripten_bind_PointAttribute_PointAttribute_0=L.asm.q).apply(null,arguments)},Ie=L._emscripten_bind_PointAttribute_size_0=function(){return(Ie=L._emscripten_bind_PointAttribute_size_0=L.asm.r).apply(null,arguments)},Re=L._emscripten_bind_PointAttribute_GetAttributeTransformData_0=function(){return(Re=L._emscripten_bind_PointAttribute_GetAttributeTransformData_0=L.asm.s).apply(null,arguments)},Se=L._emscripten_bind_PointAttribute_attribute_type_0=function(){return(Se=L._emscripten_bind_PointAttribute_attribute_type_0=L.asm.t).apply(null,arguments)},Me=L._emscripten_bind_PointAttribute_data_type_0=function(){return(Me=L._emscripten_bind_PointAttribute_data_type_0=L.asm.u).apply(null,arguments)},Ne=L._emscripten_bind_PointAttribute_num_components_0=function(){return(Ne=L._emscripten_bind_PointAttribute_num_components_0=L.asm.v).apply(null,arguments)},we=L._emscripten_bind_PointAttribute_normalized_0=function(){return(we=L._emscripten_bind_PointAttribute_normalized_0=L.asm.w).apply(null,arguments)},ve=L._emscripten_bind_PointAttribute_byte_stride_0=function(){return(ve=L._emscripten_bind_PointAttribute_byte_stride_0=L.asm.x).apply(null,arguments)},Oe=L._emscripten_bind_PointAttribute_byte_offset_0=function(){return(Oe=L._emscripten_bind_PointAttribute_byte_offset_0=L.asm.y).apply(null,arguments)},Ce=L._emscripten_bind_PointAttribute_unique_id_0=function(){return(Ce=L._emscripten_bind_PointAttribute_unique_id_0=L.asm.z).apply(null,arguments)},De=L._emscripten_bind_PointAttribute___destroy___0=function(){return(De=L._emscripten_bind_PointAttribute___destroy___0=L.asm.A).apply(null,arguments)},je=L._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=function(){return(je=L._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=L.asm.B).apply(null,arguments)},Pe=L._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=function(){return(Pe=L._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=L.asm.C).apply(null,arguments)},Fe=L._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=function(){return(Fe=L._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=L.asm.D).apply(null,arguments)},Ue=L._emscripten_bind_AttributeQuantizationTransform_min_value_1=function(){return(Ue=L._emscripten_bind_AttributeQuantizationTransform_min_value_1=L.asm.E).apply(null,arguments)},Le=L._emscripten_bind_AttributeQuantizationTransform_range_0=function(){return(Le=L._emscripten_bind_AttributeQuantizationTransform_range_0=L.asm.F).apply(null,arguments)},Ge=L._emscripten_bind_AttributeQuantizationTransform___destroy___0=function(){return(Ge=L._emscripten_bind_AttributeQuantizationTransform___destroy___0=L.asm.G).apply(null,arguments)},Be=L._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=function(){return(Be=L._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=L.asm.H).apply(null,arguments)},Ve=L._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=function(){return(Ve=L._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=L.asm.I).apply(null,arguments)},ke=L._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=function(){return(ke=L._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=L.asm.J).apply(null,arguments)},ze=L._emscripten_bind_AttributeOctahedronTransform___destroy___0=function(){return(ze=L._emscripten_bind_AttributeOctahedronTransform___destroy___0=L.asm.K).apply(null,arguments)},He=L._emscripten_bind_PointCloud_PointCloud_0=function(){return(He=L._emscripten_bind_PointCloud_PointCloud_0=L.asm.L).apply(null,arguments)},qe=L._emscripten_bind_PointCloud_num_attributes_0=function(){return(qe=L._emscripten_bind_PointCloud_num_attributes_0=L.asm.M).apply(null,arguments)},$e=L._emscripten_bind_PointCloud_num_points_0=function(){return($e=L._emscripten_bind_PointCloud_num_points_0=L.asm.N).apply(null,arguments)},We=L._emscripten_bind_PointCloud___destroy___0=function(){return(We=L._emscripten_bind_PointCloud___destroy___0=L.asm.O).apply(null,arguments)},Xe=L._emscripten_bind_Mesh_Mesh_0=function(){return(Xe=L._emscripten_bind_Mesh_Mesh_0=L.asm.P).apply(null,arguments)},Ye=L._emscripten_bind_Mesh_num_faces_0=function(){return(Ye=L._emscripten_bind_Mesh_num_faces_0=L.asm.Q).apply(null,arguments)},Qe=L._emscripten_bind_Mesh_num_attributes_0=function(){return(Qe=L._emscripten_bind_Mesh_num_attributes_0=L.asm.R).apply(null,arguments)},Ke=L._emscripten_bind_Mesh_num_points_0=function(){return(Ke=L._emscripten_bind_Mesh_num_points_0=L.asm.S).apply(null,arguments)},Je=L._emscripten_bind_Mesh___destroy___0=function(){return(Je=L._emscripten_bind_Mesh___destroy___0=L.asm.T).apply(null,arguments)},Ze=L._emscripten_bind_Metadata_Metadata_0=function(){return(Ze=L._emscripten_bind_Metadata_Metadata_0=L.asm.U).apply(null,arguments)},et=L._emscripten_bind_Metadata___destroy___0=function(){return(et=L._emscripten_bind_Metadata___destroy___0=L.asm.V).apply(null,arguments)},tt=L._emscripten_bind_Status_code_0=function(){return(tt=L._emscripten_bind_Status_code_0=L.asm.W).apply(null,arguments)},rt=L._emscripten_bind_Status_ok_0=function(){return(rt=L._emscripten_bind_Status_ok_0=L.asm.X).apply(null,arguments)},nt=L._emscripten_bind_Status_error_msg_0=function(){return(nt=L._emscripten_bind_Status_error_msg_0=L.asm.Y).apply(null,arguments)},st=L._emscripten_bind_Status___destroy___0=function(){return(st=L._emscripten_bind_Status___destroy___0=L.asm.Z).apply(null,arguments)},ot=L._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=function(){return(ot=L._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=L.asm._).apply(null,arguments)},it=L._emscripten_bind_DracoFloat32Array_GetValue_1=function(){return(it=L._emscripten_bind_DracoFloat32Array_GetValue_1=L.asm.$).apply(null,arguments)},at=L._emscripten_bind_DracoFloat32Array_size_0=function(){return(at=L._emscripten_bind_DracoFloat32Array_size_0=L.asm.aa).apply(null,arguments)},ct=L._emscripten_bind_DracoFloat32Array___destroy___0=function(){return(ct=L._emscripten_bind_DracoFloat32Array___destroy___0=L.asm.ba).apply(null,arguments)},ut=L._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return(ut=L._emscripten_bind_DracoInt8Array_DracoInt8Array_0=L.asm.ca).apply(null,arguments)},pt=L._emscripten_bind_DracoInt8Array_GetValue_1=function(){return(pt=L._emscripten_bind_DracoInt8Array_GetValue_1=L.asm.da).apply(null,arguments)},lt=L._emscripten_bind_DracoInt8Array_size_0=function(){return(lt=L._emscripten_bind_DracoInt8Array_size_0=L.asm.ea).apply(null,arguments)},ft=L._emscripten_bind_DracoInt8Array___destroy___0=function(){return(ft=L._emscripten_bind_DracoInt8Array___destroy___0=L.asm.fa).apply(null,arguments)},_t=L._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=function(){return(_t=L._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=L.asm.ga).apply(null,arguments)},dt=L._emscripten_bind_DracoUInt8Array_GetValue_1=function(){return(dt=L._emscripten_bind_DracoUInt8Array_GetValue_1=L.asm.ha).apply(null,arguments)},ht=L._emscripten_bind_DracoUInt8Array_size_0=function(){return(ht=L._emscripten_bind_DracoUInt8Array_size_0=L.asm.ia).apply(null,arguments)},yt=L._emscripten_bind_DracoUInt8Array___destroy___0=function(){return(yt=L._emscripten_bind_DracoUInt8Array___destroy___0=L.asm.ja).apply(null,arguments)},mt=L._emscripten_bind_DracoInt16Array_DracoInt16Array_0=function(){return(mt=L._emscripten_bind_DracoInt16Array_DracoInt16Array_0=L.asm.ka).apply(null,arguments)},gt=L._emscripten_bind_DracoInt16Array_GetValue_1=function(){return(gt=L._emscripten_bind_DracoInt16Array_GetValue_1=L.asm.la).apply(null,arguments)},bt=L._emscripten_bind_DracoInt16Array_size_0=function(){return(bt=L._emscripten_bind_DracoInt16Array_size_0=L.asm.ma).apply(null,arguments)},Tt=L._emscripten_bind_DracoInt16Array___destroy___0=function(){return(Tt=L._emscripten_bind_DracoInt16Array___destroy___0=L.asm.na).apply(null,arguments)},Et=L._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=function(){return(Et=L._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=L.asm.oa).apply(null,arguments)},At=L._emscripten_bind_DracoUInt16Array_GetValue_1=function(){return(At=L._emscripten_bind_DracoUInt16Array_GetValue_1=L.asm.pa).apply(null,arguments)},xt=L._emscripten_bind_DracoUInt16Array_size_0=function(){return(xt=L._emscripten_bind_DracoUInt16Array_size_0=L.asm.qa).apply(null,arguments)},It=L._emscripten_bind_DracoUInt16Array___destroy___0=function(){return(It=L._emscripten_bind_DracoUInt16Array___destroy___0=L.asm.ra).apply(null,arguments)},Rt=L._emscripten_bind_DracoInt32Array_DracoInt32Array_0=function(){return(Rt=L._emscripten_bind_DracoInt32Array_DracoInt32Array_0=L.asm.sa).apply(null,arguments)},St=L._emscripten_bind_DracoInt32Array_GetValue_1=function(){return(St=L._emscripten_bind_DracoInt32Array_GetValue_1=L.asm.ta).apply(null,arguments)},Mt=L._emscripten_bind_DracoInt32Array_size_0=function(){return(Mt=L._emscripten_bind_DracoInt32Array_size_0=L.asm.ua).apply(null,arguments)},Nt=L._emscripten_bind_DracoInt32Array___destroy___0=function(){return(Nt=L._emscripten_bind_DracoInt32Array___destroy___0=L.asm.va).apply(null,arguments)},wt=L._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=function(){return(wt=L._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=L.asm.wa).apply(null,arguments)},vt=L._emscripten_bind_DracoUInt32Array_GetValue_1=function(){return(vt=L._emscripten_bind_DracoUInt32Array_GetValue_1=L.asm.xa).apply(null,arguments)},Ot=L._emscripten_bind_DracoUInt32Array_size_0=function(){return(Ot=L._emscripten_bind_DracoUInt32Array_size_0=L.asm.ya).apply(null,arguments)},Ct=L._emscripten_bind_DracoUInt32Array___destroy___0=function(){return(Ct=L._emscripten_bind_DracoUInt32Array___destroy___0=L.asm.za).apply(null,arguments)},Dt=L._emscripten_bind_MetadataQuerier_MetadataQuerier_0=function(){return(Dt=L._emscripten_bind_MetadataQuerier_MetadataQuerier_0=L.asm.Aa).apply(null,arguments)},jt=L._emscripten_bind_MetadataQuerier_HasEntry_2=function(){return(jt=L._emscripten_bind_MetadataQuerier_HasEntry_2=L.asm.Ba).apply(null,arguments)},Pt=L._emscripten_bind_MetadataQuerier_GetIntEntry_2=function(){return(Pt=L._emscripten_bind_MetadataQuerier_GetIntEntry_2=L.asm.Ca).apply(null,arguments)},Ft=L._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=function(){return(Ft=L._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=L.asm.Da).apply(null,arguments)},Ut=L._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=function(){return(Ut=L._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=L.asm.Ea).apply(null,arguments)},Lt=L._emscripten_bind_MetadataQuerier_GetStringEntry_2=function(){return(Lt=L._emscripten_bind_MetadataQuerier_GetStringEntry_2=L.asm.Fa).apply(null,arguments)},Gt=L._emscripten_bind_MetadataQuerier_NumEntries_1=function(){return(Gt=L._emscripten_bind_MetadataQuerier_NumEntries_1=L.asm.Ga).apply(null,arguments)},Bt=L._emscripten_bind_MetadataQuerier_GetEntryName_2=function(){return(Bt=L._emscripten_bind_MetadataQuerier_GetEntryName_2=L.asm.Ha).apply(null,arguments)},Vt=L._emscripten_bind_MetadataQuerier___destroy___0=function(){return(Vt=L._emscripten_bind_MetadataQuerier___destroy___0=L.asm.Ia).apply(null,arguments)},kt=L._emscripten_bind_Decoder_Decoder_0=function(){return(kt=L._emscripten_bind_Decoder_Decoder_0=L.asm.Ja).apply(null,arguments)},zt=L._emscripten_bind_Decoder_DecodeArrayToPointCloud_3=function(){return(zt=L._emscripten_bind_Decoder_DecodeArrayToPointCloud_3=L.asm.Ka).apply(null,arguments)},Ht=L._emscripten_bind_Decoder_DecodeArrayToMesh_3=function(){return(Ht=L._emscripten_bind_Decoder_DecodeArrayToMesh_3=L.asm.La).apply(null,arguments)},qt=L._emscripten_bind_Decoder_GetAttributeId_2=function(){return(qt=L._emscripten_bind_Decoder_GetAttributeId_2=L.asm.Ma).apply(null,arguments)},$t=L._emscripten_bind_Decoder_GetAttributeIdByName_2=function(){return($t=L._emscripten_bind_Decoder_GetAttributeIdByName_2=L.asm.Na).apply(null,arguments)},Wt=L._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=function(){return(Wt=L._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=L.asm.Oa).apply(null,arguments)},Xt=L._emscripten_bind_Decoder_GetAttribute_2=function(){return(Xt=L._emscripten_bind_Decoder_GetAttribute_2=L.asm.Pa).apply(null,arguments)},Yt=L._emscripten_bind_Decoder_GetAttributeByUniqueId_2=function(){return(Yt=L._emscripten_bind_Decoder_GetAttributeByUniqueId_2=L.asm.Qa).apply(null,arguments)},Qt=L._emscripten_bind_Decoder_GetMetadata_1=function(){return(Qt=L._emscripten_bind_Decoder_GetMetadata_1=L.asm.Ra).apply(null,arguments)},Kt=L._emscripten_bind_Decoder_GetAttributeMetadata_2=function(){return(Kt=L._emscripten_bind_Decoder_GetAttributeMetadata_2=L.asm.Sa).apply(null,arguments)},Jt=L._emscripten_bind_Decoder_GetFaceFromMesh_3=function(){return(Jt=L._emscripten_bind_Decoder_GetFaceFromMesh_3=L.asm.Ta).apply(null,arguments)},Zt=L._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=function(){return(Zt=L._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=L.asm.Ua).apply(null,arguments)},er=L._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=function(){return(er=L._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=L.asm.Va).apply(null,arguments)},tr=L._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=function(){return(tr=L._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=L.asm.Wa).apply(null,arguments)},rr=L._emscripten_bind_Decoder_GetAttributeFloat_3=function(){return(rr=L._emscripten_bind_Decoder_GetAttributeFloat_3=L.asm.Xa).apply(null,arguments)},nr=L._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=function(){return(nr=L._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=L.asm.Ya).apply(null,arguments)},sr=L._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=function(){return(sr=L._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=L.asm.Za).apply(null,arguments)},or=L._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=function(){return(or=L._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=L.asm._a).apply(null,arguments)},ir=L._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=function(){return(ir=L._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=L.asm.$a).apply(null,arguments)},ar=L._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=function(){return(ar=L._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=L.asm.ab).apply(null,arguments)},cr=L._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=function(){return(cr=L._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=L.asm.bb).apply(null,arguments)},ur=L._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=function(){return(ur=L._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=L.asm.cb).apply(null,arguments)},pr=L._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=function(){return(pr=L._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=L.asm.db).apply(null,arguments)},lr=L._emscripten_bind_Decoder_GetAttributeDataArrayForAllPoints_5=function(){return(lr=L._emscripten_bind_Decoder_GetAttributeDataArrayForAllPoints_5=L.asm.eb).apply(null,arguments)},fr=L._emscripten_bind_Decoder_SkipAttributeTransform_1=function(){return(fr=L._emscripten_bind_Decoder_SkipAttributeTransform_1=L.asm.fb).apply(null,arguments)},_r=L._emscripten_bind_Decoder_GetEncodedGeometryType_Deprecated_1=function(){return(_r=L._emscripten_bind_Decoder_GetEncodedGeometryType_Deprecated_1=L.asm.gb).apply(null,arguments)},dr=L._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=function(){return(dr=L._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=L.asm.hb).apply(null,arguments)},hr=L._emscripten_bind_Decoder_DecodeBufferToMesh_2=function(){return(hr=L._emscripten_bind_Decoder_DecodeBufferToMesh_2=L.asm.ib).apply(null,arguments)},yr=L._emscripten_bind_Decoder___destroy___0=function(){return(yr=L._emscripten_bind_Decoder___destroy___0=L.asm.jb).apply(null,arguments)},mr=L._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=function(){return(mr=L._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=L.asm.kb).apply(null,arguments)},gr=L._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=function(){return(gr=L._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=L.asm.lb).apply(null,arguments)},br=L._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=function(){return(br=L._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=L.asm.mb).apply(null,arguments)},Tr=L._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=function(){return(Tr=L._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=L.asm.nb).apply(null,arguments)},Er=L._emscripten_enum_draco_GeometryAttribute_Type_INVALID=function(){return(Er=L._emscripten_enum_draco_GeometryAttribute_Type_INVALID=L.asm.ob).apply(null,arguments)},Ar=L._emscripten_enum_draco_GeometryAttribute_Type_POSITION=function(){return(Ar=L._emscripten_enum_draco_GeometryAttribute_Type_POSITION=L.asm.pb).apply(null,arguments)},xr=L._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return(xr=L._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=L.asm.qb).apply(null,arguments)},Ir=L._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return(Ir=L._emscripten_enum_draco_GeometryAttribute_Type_COLOR=L.asm.rb).apply(null,arguments)},Rr=L._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return(Rr=L._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=L.asm.sb).apply(null,arguments)},Sr=L._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return(Sr=L._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=L.asm.tb).apply(null,arguments)},Mr=L._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return(Mr=L._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=L.asm.ub).apply(null,arguments)},Nr=L._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return(Nr=L._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=L.asm.vb).apply(null,arguments)},wr=L._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return(wr=L._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=L.asm.wb).apply(null,arguments)},vr=L._emscripten_enum_draco_DataType_DT_INVALID=function(){return(vr=L._emscripten_enum_draco_DataType_DT_INVALID=L.asm.xb).apply(null,arguments)},Or=L._emscripten_enum_draco_DataType_DT_INT8=function(){return(Or=L._emscripten_enum_draco_DataType_DT_INT8=L.asm.yb).apply(null,arguments)},Cr=L._emscripten_enum_draco_DataType_DT_UINT8=function(){return(Cr=L._emscripten_enum_draco_DataType_DT_UINT8=L.asm.zb).apply(null,arguments)},Dr=L._emscripten_enum_draco_DataType_DT_INT16=function(){return(Dr=L._emscripten_enum_draco_DataType_DT_INT16=L.asm.Ab).apply(null,arguments)},jr=L._emscripten_enum_draco_DataType_DT_UINT16=function(){return(jr=L._emscripten_enum_draco_DataType_DT_UINT16=L.asm.Bb).apply(null,arguments)},Pr=L._emscripten_enum_draco_DataType_DT_INT32=function(){return(Pr=L._emscripten_enum_draco_DataType_DT_INT32=L.asm.Cb).apply(null,arguments)},Fr=L._emscripten_enum_draco_DataType_DT_UINT32=function(){return(Fr=L._emscripten_enum_draco_DataType_DT_UINT32=L.asm.Db).apply(null,arguments)},Ur=L._emscripten_enum_draco_DataType_DT_INT64=function(){return(Ur=L._emscripten_enum_draco_DataType_DT_INT64=L.asm.Eb).apply(null,arguments)},Lr=L._emscripten_enum_draco_DataType_DT_UINT64=function(){return(Lr=L._emscripten_enum_draco_DataType_DT_UINT64=L.asm.Fb).apply(null,arguments)},Gr=L._emscripten_enum_draco_DataType_DT_FLOAT32=function(){return(Gr=L._emscripten_enum_draco_DataType_DT_FLOAT32=L.asm.Gb).apply(null,arguments)},Br=L._emscripten_enum_draco_DataType_DT_FLOAT64=function(){return(Br=L._emscripten_enum_draco_DataType_DT_FLOAT64=L.asm.Hb).apply(null,arguments)},Vr=L._emscripten_enum_draco_DataType_DT_BOOL=function(){return(Vr=L._emscripten_enum_draco_DataType_DT_BOOL=L.asm.Ib).apply(null,arguments)},kr=L._emscripten_enum_draco_DataType_DT_TYPES_COUNT=function(){return(kr=L._emscripten_enum_draco_DataType_DT_TYPES_COUNT=L.asm.Jb).apply(null,arguments)},zr=L._emscripten_enum_draco_StatusCode_OK=function(){return(zr=L._emscripten_enum_draco_StatusCode_OK=L.asm.Kb).apply(null,arguments)},Hr=L._emscripten_enum_draco_StatusCode_DRACO_ERROR=function(){return(Hr=L._emscripten_enum_draco_StatusCode_DRACO_ERROR=L.asm.Lb).apply(null,arguments)},qr=L._emscripten_enum_draco_StatusCode_IO_ERROR=function(){return(qr=L._emscripten_enum_draco_StatusCode_IO_ERROR=L.asm.Mb).apply(null,arguments)},$r=L._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=function(){return($r=L._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=L.asm.Nb).apply(null,arguments)},Wr=L._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=function(){return(Wr=L._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=L.asm.Ob).apply(null,arguments)},Xr=L._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=function(){return(Xr=L._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=L.asm.Pb).apply(null,arguments)};L._malloc=function(){return(L._malloc=L.asm.Qb).apply(null,arguments)},L._free=function(){return(L._free=L.asm.Rb).apply(null,arguments)};var Yr,Qr=function(){return(Qr=L.asm.Sb).apply(null,arguments)};if(L.___start_em_js=11660,L.___stop_em_js=11758,le=function e(){Yr||p(),Yr||(le=e)},L.preInit)for("function"==typeof L.preInit&&(L.preInit=[L.preInit]);0<L.preInit.length;)L.preInit.pop()();p(),l.prototype=Object.create(l.prototype),l.prototype.constructor=l,l.prototype.__class__=l,l.__cache__={},L.WrapperObject=l,L.getCache=f,L.wrapPointer=_,L.castObject=function(e,t){return _(e.ptr,t)},L.NULL=_(0),L.destroy=function(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete f(e.__class__)[e.ptr]},L.compare=function(e,t){return e.ptr===t.ptr},L.getPointer=function(e){return e.ptr},L.getClass=function(e){return e.__class__};var Kr={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(Kr.needed){for(var e=0;e<Kr.temps.length;e++)L._free(Kr.temps[e]);Kr.temps.length=0,L._free(Kr.buffer),Kr.buffer=0,Kr.size+=Kr.needed,Kr.needed=0}Kr.buffer||(Kr.size+=128,Kr.buffer=L._malloc(Kr.size),Kr.buffer||i(void 0)),Kr.pos=0},alloc:function(e,t){return Kr.buffer||i(void 0),e=7+(e=e.length*t.BYTES_PER_ELEMENT)&-8,Kr.pos+e>=Kr.size?(0<e||i(void 0),Kr.needed+=e,t=L._malloc(e),Kr.temps.push(t)):(t=Kr.buffer+Kr.pos,Kr.pos+=e),t},copy:function(e,t,r){switch(r>>>=0,t.BYTES_PER_ELEMENT){case 2:r>>>=1;break;case 4:r>>>=2;break;case 8:r>>>=3}for(var n=0;n<e.length;n++)t[r+n]=e[n]}};return y.prototype=Object.create(l.prototype),y.prototype.constructor=y,y.prototype.__class__=y,y.__cache__={},L.VoidPtr=y,y.prototype.__destroy__=y.prototype.__destroy__=function(){de(this.ptr)},m.prototype=Object.create(l.prototype),m.prototype.constructor=m,m.prototype.__class__=m,m.__cache__={},L.DecoderBuffer=m,m.prototype.Init=m.prototype.Init=function(e,t){var r=this.ptr;Kr.prepare(),"object"==typeof e&&(e=h(e)),t&&"object"==typeof t&&(t=t.ptr),ye(r,e,t)},m.prototype.__destroy__=m.prototype.__destroy__=function(){me(this.ptr)},g.prototype=Object.create(l.prototype),g.prototype.constructor=g,g.prototype.__class__=g,g.__cache__={},L.AttributeTransformData=g,g.prototype.transform_type=g.prototype.transform_type=function(){return be(this.ptr)},g.prototype.__destroy__=g.prototype.__destroy__=function(){Te(this.ptr)},b.prototype=Object.create(l.prototype),b.prototype.constructor=b,b.prototype.__class__=b,b.__cache__={},L.GeometryAttribute=b,b.prototype.__destroy__=b.prototype.__destroy__=function(){Ae(this.ptr)},T.prototype=Object.create(l.prototype),T.prototype.constructor=T,T.prototype.__class__=T,T.__cache__={},L.PointAttribute=T,T.prototype.size=T.prototype.size=function(){return Ie(this.ptr)},T.prototype.GetAttributeTransformData=T.prototype.GetAttributeTransformData=function(){return _(Re(this.ptr),g)},T.prototype.attribute_type=T.prototype.attribute_type=function(){return Se(this.ptr)},T.prototype.data_type=T.prototype.data_type=function(){return Me(this.ptr)},T.prototype.num_components=T.prototype.num_components=function(){return Ne(this.ptr)},T.prototype.normalized=T.prototype.normalized=function(){return!!we(this.ptr)},T.prototype.byte_stride=T.prototype.byte_stride=function(){return ve(this.ptr)},T.prototype.byte_offset=T.prototype.byte_offset=function(){return Oe(this.ptr)},T.prototype.unique_id=T.prototype.unique_id=function(){return Ce(this.ptr)},T.prototype.__destroy__=T.prototype.__destroy__=function(){De(this.ptr)},E.prototype=Object.create(l.prototype),E.prototype.constructor=E,E.prototype.__class__=E,E.__cache__={},L.AttributeQuantizationTransform=E,E.prototype.InitFromAttribute=E.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!Pe(t,e)},E.prototype.quantization_bits=E.prototype.quantization_bits=function(){return Fe(this.ptr)},E.prototype.min_value=E.prototype.min_value=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Ue(t,e)},E.prototype.range=E.prototype.range=function(){return Le(this.ptr)},E.prototype.__destroy__=E.prototype.__destroy__=function(){Ge(this.ptr)},A.prototype=Object.create(l.prototype),A.prototype.constructor=A,A.prototype.__class__=A,A.__cache__={},L.AttributeOctahedronTransform=A,A.prototype.InitFromAttribute=A.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!Ve(t,e)},A.prototype.quantization_bits=A.prototype.quantization_bits=function(){return ke(this.ptr)},A.prototype.__destroy__=A.prototype.__destroy__=function(){ze(this.ptr)},x.prototype=Object.create(l.prototype),x.prototype.constructor=x,x.prototype.__class__=x,x.__cache__={},L.PointCloud=x,x.prototype.num_attributes=x.prototype.num_attributes=function(){return qe(this.ptr)},x.prototype.num_points=x.prototype.num_points=function(){return $e(this.ptr)},x.prototype.__destroy__=x.prototype.__destroy__=function(){We(this.ptr)},I.prototype=Object.create(l.prototype),I.prototype.constructor=I,I.prototype.__class__=I,I.__cache__={},L.Mesh=I,I.prototype.num_faces=I.prototype.num_faces=function(){return Ye(this.ptr)},I.prototype.num_attributes=I.prototype.num_attributes=function(){return Qe(this.ptr)},I.prototype.num_points=I.prototype.num_points=function(){return Ke(this.ptr)},I.prototype.__destroy__=I.prototype.__destroy__=function(){Je(this.ptr)},R.prototype=Object.create(l.prototype),R.prototype.constructor=R,R.prototype.__class__=R,R.__cache__={},L.Metadata=R,R.prototype.__destroy__=R.prototype.__destroy__=function(){et(this.ptr)},S.prototype=Object.create(l.prototype),S.prototype.constructor=S,S.prototype.__class__=S,S.__cache__={},L.Status=S,S.prototype.code=S.prototype.code=function(){return tt(this.ptr)},S.prototype.ok=S.prototype.ok=function(){return!!rt(this.ptr)},S.prototype.error_msg=S.prototype.error_msg=function(){return n(nt(this.ptr))},S.prototype.__destroy__=S.prototype.__destroy__=function(){st(this.ptr)},M.prototype=Object.create(l.prototype),M.prototype.constructor=M,M.prototype.__class__=M,M.__cache__={},L.DracoFloat32Array=M,M.prototype.GetValue=M.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),it(t,e)},M.prototype.size=M.prototype.size=function(){return at(this.ptr)},M.prototype.__destroy__=M.prototype.__destroy__=function(){ct(this.ptr)},N.prototype=Object.create(l.prototype),N.prototype.constructor=N,N.prototype.__class__=N,N.__cache__={},L.DracoInt8Array=N,N.prototype.GetValue=N.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),pt(t,e)},N.prototype.size=N.prototype.size=function(){return lt(this.ptr)},N.prototype.__destroy__=N.prototype.__destroy__=function(){ft(this.ptr)},w.prototype=Object.create(l.prototype),w.prototype.constructor=w,w.prototype.__class__=w,w.__cache__={},L.DracoUInt8Array=w,w.prototype.GetValue=w.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),dt(t,e)},w.prototype.size=w.prototype.size=function(){return ht(this.ptr)},w.prototype.__destroy__=w.prototype.__destroy__=function(){yt(this.ptr)},v.prototype=Object.create(l.prototype),v.prototype.constructor=v,v.prototype.__class__=v,v.__cache__={},L.DracoInt16Array=v,v.prototype.GetValue=v.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),gt(t,e)},v.prototype.size=v.prototype.size=function(){return bt(this.ptr)},v.prototype.__destroy__=v.prototype.__destroy__=function(){Tt(this.ptr)},O.prototype=Object.create(l.prototype),O.prototype.constructor=O,O.prototype.__class__=O,O.__cache__={},L.DracoUInt16Array=O,O.prototype.GetValue=O.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),At(t,e)},O.prototype.size=O.prototype.size=function(){return xt(this.ptr)},O.prototype.__destroy__=O.prototype.__destroy__=function(){It(this.ptr)},C.prototype=Object.create(l.prototype),C.prototype.constructor=C,C.prototype.__class__=C,C.__cache__={},L.DracoInt32Array=C,C.prototype.GetValue=C.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),St(t,e)},C.prototype.size=C.prototype.size=function(){return Mt(this.ptr)},C.prototype.__destroy__=C.prototype.__destroy__=function(){Nt(this.ptr)},D.prototype=Object.create(l.prototype),D.prototype.constructor=D,D.prototype.__class__=D,D.__cache__={},L.DracoUInt32Array=D,D.prototype.GetValue=D.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),vt(t,e)},D.prototype.size=D.prototype.size=function(){return Ot(this.ptr)},D.prototype.__destroy__=D.prototype.__destroy__=function(){Ct(this.ptr)},j.prototype=Object.create(l.prototype),j.prototype.constructor=j,j.prototype.__class__=j,j.__cache__={},L.MetadataQuerier=j,j.prototype.HasEntry=j.prototype.HasEntry=function(e,t){var r=this.ptr;return Kr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),!!jt(r,e,t)},j.prototype.GetIntEntry=j.prototype.GetIntEntry=function(e,t){var r=this.ptr;return Kr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),Pt(r,e,t)},j.prototype.GetIntEntryArray=j.prototype.GetIntEntryArray=function(e,t,r){var n=this.ptr;Kr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),r&&"object"==typeof r&&(r=r.ptr),Ft(n,e,t,r)},j.prototype.GetDoubleEntry=j.prototype.GetDoubleEntry=function(e,t){var r=this.ptr;return Kr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),Ut(r,e,t)},j.prototype.GetStringEntry=j.prototype.GetStringEntry=function(e,t){var r=this.ptr;return Kr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),n(Lt(r,e,t))},j.prototype.NumEntries=j.prototype.NumEntries=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Gt(t,e)},j.prototype.GetEntryName=j.prototype.GetEntryName=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),n(Bt(r,e,t))},j.prototype.__destroy__=j.prototype.__destroy__=function(){Vt(this.ptr)},P.prototype=Object.create(l.prototype),P.prototype.constructor=P,P.prototype.__class__=P,P.__cache__={},L.Decoder=P,P.prototype.DecodeArrayToPointCloud=P.prototype.DecodeArrayToPointCloud=function(e,t,r){var n=this.ptr;return Kr.prepare(),"object"==typeof e&&(e=h(e)),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),_(zt(n,e,t,r),S)},P.prototype.DecodeArrayToMesh=P.prototype.DecodeArrayToMesh=function(e,t,r){var n=this.ptr;return Kr.prepare(),"object"==typeof e&&(e=h(e)),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),_(Ht(n,e,t,r),S)},P.prototype.GetAttributeId=P.prototype.GetAttributeId=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),qt(r,e,t)},P.prototype.GetAttributeIdByName=P.prototype.GetAttributeIdByName=function(e,t){var r=this.ptr;return Kr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),$t(r,e,t)},P.prototype.GetAttributeIdByMetadataEntry=P.prototype.GetAttributeIdByMetadataEntry=function(e,t,r){var n=this.ptr;return Kr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:d(t),r=r&&"object"==typeof r?r.ptr:d(r),Wt(n,e,t,r)},P.prototype.GetAttribute=P.prototype.GetAttribute=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),_(Xt(r,e,t),T)},P.prototype.GetAttributeByUniqueId=P.prototype.GetAttributeByUniqueId=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),_(Yt(r,e,t),T)},P.prototype.GetMetadata=P.prototype.GetMetadata=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),_(Qt(t,e),R)},P.prototype.GetAttributeMetadata=P.prototype.GetAttributeMetadata=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),_(Kt(r,e,t),R)},P.prototype.GetFaceFromMesh=P.prototype.GetFaceFromMesh=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Jt(n,e,t,r)},P.prototype.GetTriangleStripsFromMesh=P.prototype.GetTriangleStripsFromMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Zt(r,e,t)},P.prototype.GetTrianglesUInt16Array=P.prototype.GetTrianglesUInt16Array=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!er(n,e,t,r)},P.prototype.GetTrianglesUInt32Array=P.prototype.GetTrianglesUInt32Array=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!tr(n,e,t,r)},P.prototype.GetAttributeFloat=P.prototype.GetAttributeFloat=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!rr(n,e,t,r)},P.prototype.GetAttributeFloatForAllPoints=P.prototype.GetAttributeFloatForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!nr(n,e,t,r)},P.prototype.GetAttributeIntForAllPoints=P.prototype.GetAttributeIntForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!sr(n,e,t,r)},P.prototype.GetAttributeInt8ForAllPoints=P.prototype.GetAttributeInt8ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!or(n,e,t,r)},P.prototype.GetAttributeUInt8ForAllPoints=P.prototype.GetAttributeUInt8ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ir(n,e,t,r)},P.prototype.GetAttributeInt16ForAllPoints=P.prototype.GetAttributeInt16ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ar(n,e,t,r)},P.prototype.GetAttributeUInt16ForAllPoints=P.prototype.GetAttributeUInt16ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!cr(n,e,t,r)},P.prototype.GetAttributeInt32ForAllPoints=P.prototype.GetAttributeInt32ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ur(n,e,t,r)},P.prototype.GetAttributeUInt32ForAllPoints=P.prototype.GetAttributeUInt32ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!pr(n,e,t,r)},P.prototype.GetAttributeDataArrayForAllPoints=P.prototype.GetAttributeDataArrayForAllPoints=function(e,t,r,n,s){var o=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),s&&"object"==typeof s&&(s=s.ptr),!!lr(o,e,t,r,n,s)},P.prototype.SkipAttributeTransform=P.prototype.SkipAttributeTransform=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),fr(t,e)},P.prototype.GetEncodedGeometryType_Deprecated=P.prototype.GetEncodedGeometryType_Deprecated=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),_r(t,e)},P.prototype.DecodeBufferToPointCloud=P.prototype.DecodeBufferToPointCloud=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),_(dr(r,e,t),S)},P.prototype.DecodeBufferToMesh=P.prototype.DecodeBufferToMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),_(hr(r,e,t),S)},P.prototype.__destroy__=P.prototype.__destroy__=function(){yr(this.ptr)},function(){function e(){L.ATTRIBUTE_INVALID_TRANSFORM=mr(),L.ATTRIBUTE_NO_TRANSFORM=gr(),L.ATTRIBUTE_QUANTIZATION_TRANSFORM=br(),L.ATTRIBUTE_OCTAHEDRON_TRANSFORM=Tr(),L.INVALID=Er(),L.POSITION=Ar(),L.NORMAL=xr(),L.COLOR=Ir(),L.TEX_COORD=Rr(),L.GENERIC=Sr(),L.INVALID_GEOMETRY_TYPE=Mr(),L.POINT_CLOUD=Nr(),L.TRIANGULAR_MESH=wr(),L.DT_INVALID=vr(),L.DT_INT8=Or(),L.DT_UINT8=Cr(),L.DT_INT16=Dr(),L.DT_UINT16=jr(),L.DT_INT32=Pr(),L.DT_UINT32=Fr(),L.DT_INT64=Ur(),L.DT_UINT64=Lr(),L.DT_FLOAT32=Gr(),L.DT_FLOAT64=Br(),L.DT_BOOL=Vr(),L.DT_TYPES_COUNT=kr(),L.OK=zr(),L.DRACO_ERROR=Hr(),L.IO_ERROR=qr(),L.INVALID_PARAMETER=$r(),L.UNSUPPORTED_VERSION=Wr(),L.UNKNOWN_VERSION=Xr()}ue?e():ae.unshift(e)}(),"function"==typeof L.onModuleParsed&&L.onModuleParsed(),L.Decoder.prototype.GetEncodedGeometryType=function(e){if(e.__class__&&e.__class__===L.DecoderBuffer)return L.Decoder.prototype.GetEncodedGeometryType_Deprecated(e);if(8>e.byteLength)return L.INVALID_GEOMETRY_TYPE;switch(e[7]){case 0:return L.POINT_CLOUD;case 1:return L.TRIANGULAR_MESH;default:return L.INVALID_GEOMETRY_TYPE}},r.ready});r.exports=o}(pa)),pa.exports}var _a=function(){if(ua)return ca;ua=1;var e=ia(),t=fa();return ca={createEncoderModule:e,createDecoderModule:t}}();let da=null;async function ha(e,t,r){let n=await new Promise((e=>{if(da)return e(da);const t=document.createElement("script");t.src="/basis/encoder/basis_encoder.js",t.onload=()=>{BASIS({onRuntimeInitialized:()=>{}}).then((t=>{da=t,e(da),t.initializeBasis?(t.initializeBasis(),console.log("module.initializeBasis() called successfully.")):console.error("module.initializeBasis() is not available on the Module object.")}))},t.onerror=()=>{console.error("Failed to load the Basis module.")},document.head.appendChild(t)})),{BasisEncoder:s}=n,o=new s;const i=n.basis_tex_format.cUASTC4x4.value;o.setFormatMode(i),o.setUASTC(!0),o.setCreateKTX2File(!0),o.setKTX2UASTCSupercompression(!0);let a=n.ldr_image_type.cPNGImage.value;"image/jpeg"!==t&&"image/jpg"!==t&&"jfif"!==t||(a=n.ldr_image_type.cJPGImage.value),o.setSliceSourceImage(0,e,0,0,a),o.setPackUASTCFlags(0),o.setKTX2SRGBTransferFunc(r),o.setPerceptual(r),o.setMipGen(!0),o.setMipSRGB(r);const c=new Uint8Array(536870912);try{const e=o.encode(c);return 0===e?null:c.slice(0,e)}catch(e){return null}finally{o.delete()}}const ya={maxSize:2048,hasJoin:!0,hasPalette:!0,hasFlatten:!0,hasKtx2:!0};async function ma(e,t=ya){const r=(new ze).registerExtensions(Gn).registerDependencies({"draco3d.decoder":await _a.createDecoderModule(),"draco3d.encoder":await _a.createEncoderModule()});let{maxSize:n=2048,hasJoin:s,hasPalette:o,hasFlatten:i,hasKtx2:a}=t;const c=new Uint8Array(e),u=await r.readBinary(c);if(u.getRoot().listMaterials().some((e=>!!e.getExtension("KHR_materials_pbrSpecularGlossiness")))){await u.transform(Es(Ai,(async e=>{const t=e.getLogger();if(!e.getRoot().listExtensionsUsed().map((e=>e.extensionName)).includes("KHR_materials_pbrSpecularGlossiness"))return void t.warn(`${Ai}: KHR_materials_pbrSpecularGlossiness not found on document.`);const r=e.createExtension(Fr),n=e.createExtension(un),s=e.createExtension(Xr),o=new Set;for(const t of e.getRoot().listMaterials()){const s=t.getExtension("KHR_materials_pbrSpecularGlossiness");if(!s)continue;const i=n.createSpecular().setSpecularFactor(1).setSpecularColorFactor(s.getSpecularFactor());o.add(s.getSpecularGlossinessTexture()),o.add(t.getBaseColorTexture()),o.add(t.getMetallicRoughnessTexture()),t.setBaseColorFactor(s.getDiffuseFactor()).setMetallicFactor(0).setRoughnessFactor(1).setExtension("KHR_materials_ior",r.createIOR().setIOR(1e3)).setExtension("KHR_materials_specular",i);const a=s.getDiffuseTexture();a&&(t.setBaseColorTexture(a),t.getBaseColorTextureInfo().copy(s.getDiffuseTextureInfo()));const c=s.getSpecularGlossinessTexture();if(c){const r=s.getSpecularGlossinessTextureInfo(),n=e.createTexture();await xs(c,n,((e,t,r)=>{e.set(t,r,3,255)})),i.setSpecularTexture(n),i.setSpecularColorTexture(n),i.getSpecularTextureInfo().copy(r),i.getSpecularColorTextureInfo().copy(r);const o=s.getGlossinessFactor(),a=e.createTexture();await xs(c,a,((e,t,r)=>{const n=255-Math.round(e.get(t,r,3)*o);e.set(t,r,0,0),e.set(t,r,1,n),e.set(t,r,2,0),e.set(t,r,3,255)})),t.setMetallicRoughnessTexture(a),t.getMetallicRoughnessTextureInfo().copy(r)}else i.setSpecularColorFactor(s.getSpecularFactor()),t.setRoughnessFactor(1-s.getGlossinessFactor());t.setExtension("KHR_materials_pbrSpecularGlossiness",null)}s.dispose();for(const e of o)e&&1===e.listParents().length&&e.dispose();t.debug(`${Ai}: Complete.`)}))),u.getRoot().listMaterials().forEach((e=>{const t=e.getExtension("KHR_materials_ior");t?.setIOR(1.5)}));const e=["KHR_materials_ior","KHR_materials_specular"];for(const t of u.getRoot().listExtensionsUsed())e.includes(t.extensionName)&&t.dispose();u.transform(po())}let p=[];p.push(Zs()),o&&p.push(function(e=Ii){const t=As(Ii,e),r=Math.max(t.blockSize,1),n=Math.max(t.min,1);return Es(xi,(async e=>{const s=e.getLogger(),o=e.getRoot();t.keepAttributes||await e.transform(po({propertyTypes:[d.ACCESSOR],keepAttributes:!1,keepIndices:!0,keepLeaves:!0}));const i=new Set,a=new Set;for(const e of o.listMeshes())for(const t of e.listPrimitives()){const e=t.getMaterial();e&&!t.getAttribute("TEXCOORD_0")&&(i.add(t),a.add(e))}const c=new Set,u=new Map,p={baseColor:new Set,emissive:new Set,metallicRoughness:new Set};for(const e of a){const t=Si(e.getBaseColorFactor().slice()),r=Si([...e.getEmissiveFactor(),1]),n=Ri(e.getRoughnessFactor()),s=Ri(e.getMetallicFactor()),o=`baseColor:${t},emissive:${r},metallicRoughness:${s}${n}`;p.baseColor.add(t),p.emissive.add(r),p.metallicRoughness.add(s+"+"+n),c.add(o),u.set(e,o)}const l=c.size;if(l<n)return void s.debug(`${xi}: Found <${n} unique material properties. Exiting.`);const f=Mi(l*r),_=Mi(r),h=f-l*r,y={baseColor:null,emissive:null,metallicRoughness:null},m=new Set(["name","extras"]),g=(...e)=>e.forEach((e=>m.add(e)));let b=null,T=null,E=null;if(p.baseColor.size>=n){const t="PaletteBaseColor";b=e.createTexture(t).setURI(`${t}.png`),y.baseColor=Yn(new Uint8Array(f*_*4),[f,_,4]),g("baseColorFactor","baseColorTexture","baseColorTextureInfo")}if(p.emissive.size>=n){const t="PaletteEmissive";T=e.createTexture(t).setURI(`${t}.png`),y.emissive=Yn(new Uint8Array(f*_*4),[f,_,4]),g("emissiveFactor","emissiveTexture","emissiveTextureInfo")}if(p.metallicRoughness.size>=n){const t="PaletteMetallicRoughness";E=e.createTexture(t).setURI(`${t}.png`),y.metallicRoughness=Yn(new Uint8Array(f*_*4),[f,_,4]),g("metallicFactor","roughnessFactor","metallicRoughnessTexture","metallicRoughnessTextureInfo")}if(!(b||T||E))return void s.debug(`${xi}: No material property has >=${n} unique values. Exiting.`);const A=new Set,x=new Map,I=[];let R=0;for(const e of a){const t=u.get(e);if(A.has(t))continue;const n=R++;if(y.baseColor){const t=y.baseColor,s=[...e.getBaseColorFactor()];v.convertLinearToSRGB(s,s),Ni(t,n,s,r)}if(y.emissive){const t=y.emissive,s=[...e.getEmissiveFactor(),1];v.convertLinearToSRGB(s,s),Ni(t,n,s,r)}if(y.metallicRoughness){const t=y.metallicRoughness,s=e.getMetallicFactor();Ni(t,n,[0,e.getRoughnessFactor(),s,1],r)}A.add(t),x.set(t,n)}const S="image/png";if(b){const e=await is(y.baseColor,S);b.setImage(e).setMimeType(S)}if(T){const e=await is(y.emissive,S);T.setImage(e).setMimeType(S)}if(E){const e=await is(y.metallicRoughness,S);E.setImage(e).setMimeType(S)}let M=1;for(const t of i){const r=t.getMaterial(),n=u.get(r),s=(x.get(n)+.5)/l*(f-h)/f,o=t.getAttribute("POSITION"),i=o.getBuffer(),a=new Float32Array(2*o.getCount()).fill(s),c=e.createAccessor().setType("VEC2").setArray(a).setBuffer(i);let p;for(const e of I)e.equals(r,m)&&(p=e);if(!p){const e=(M++).toString().padStart(3,"0");p=r.clone().setName(`PaletteMaterial${e}`),b&&p.setBaseColorFactor([1,1,1,1]).setBaseColorTexture(b).getBaseColorTextureInfo().setMinFilter(ue.MinFilter.NEAREST).setMagFilter(ue.MagFilter.NEAREST),T&&p.setEmissiveFactor([1,1,1]).setEmissiveTexture(T).getEmissiveTextureInfo().setMinFilter(ue.MinFilter.NEAREST).setMagFilter(ue.MagFilter.NEAREST),E&&p.setMetallicFactor(1).setRoughnessFactor(1).setMetallicRoughnessTexture(E).getMetallicRoughnessTextureInfo().setMinFilter(ue.MinFilter.NEAREST).setMagFilter(ue.MagFilter.NEAREST),I.push(p)}t.setMaterial(p).setAttribute("TEXCOORD_0",c)}t.cleanup&&await e.transform(po({propertyTypes:[d.MATERIAL]})),s.debug(`${xi}: Complete.`)}))}({min:5})),s&&p.push(function(e=di){const t=As(di,e);return Es(ai,(async e=>{const r=e.getRoot(),n=e.getLogger();for(const n of r.listScenes())hi(e,n,t),n.traverse((r=>hi(e,r,t)));t.cleanup&&await e.transform(po({propertyTypes:[ui,pi,li,fi],keepAttributes:!0,keepIndices:!0,keepLeaves:!1})),n.debug(`${ai}: Complete.`)}))}()),i&&p.push(function(e=Ko){const t=As(Ko,e);return Es(Qo,(async e=>{const r=e.getRoot(),n=e.getLogger(),s=new Set;for(const e of r.listSkins())for(const t of e.listJoints())s.add(t);const o=new Set;for(const e of r.listAnimations())for(const t of e.listChannels()){const e=t.getTargetNode();e&&"weights"!==t.getTargetPath()&&o.add(e)}const i=new Set,a=new Set;for(const e of r.listScenes())e.traverse((e=>{const t=e.getParentNode();t&&((s.has(t)||i.has(t))&&i.add(e),(o.has(t)||a.has(t))&&a.add(e))}));for(const e of r.listScenes())e.traverse((e=>{o.has(e)||i.has(e)||a.has(e)||ks(e)}));o.size&&n.debug(`${Qo}: Flattening node hierarchies with TRS animation not yet supported.`),t.cleanup&&await e.transform(po({propertyTypes:[d.NODE],keepLeaves:!1})),n.debug(`${Qo}: Complete.`)}))}()),p.push(Oo()),p.push(function(e=Gi){const t=As(Gi,e);return Es(Ui,(async e=>{const r=new Set,n=e.getRoot().listAccessors().length,s=e.getLogger(),o=t.ready,i=t.resample;await o;for(const n of e.getRoot().listAnimations()){const e=new Map;for(const t of n.listChannels())e.set(t.getSampler(),t.getTargetPath());for(const s of n.listSamplers()){const n=s.getInterpolation();if("STEP"===n||"LINEAR"===n){const o=s.getInput(),a=s.getOutput();r.add(o),r.add(a);const c=Bi(o.getArray(),o.getComponentType(),o.getNormalized()),u=Bi(a.getArray(),a.getComponentType(),a.getNormalized()),p=u.length/c.length,l=c.length;let f;if(f="STEP"===n?i(c,u,"step",t.tolerance):"rotation"===e.get(s)?i(c,u,"slerp",t.tolerance):i(c,u,"lerp",t.tolerance),f<l){const e=o.getArray(),t=a.getArray(),r=Vi(new Float32Array(c.buffer,c.byteOffset,f),o.getComponentType(),o.getNormalized()),n=Vi(new Float32Array(u.buffer,u.byteOffset,f*p),a.getComponentType(),a.getNormalized());o.setArray(Li),a.setArray(Li),s.setInput(o.clone().setArray(r)),s.setOutput(a.clone().setArray(n)),o.setArray(e),a.setArray(t)}}}}for(const e of Array.from(r.values()))e.listParents().some((e=>!(e instanceof xe)))||e.dispose();e.getRoot().listAccessors().length>n&&t.cleanup&&await e.transform(Zs({propertyTypes:[d.ACCESSOR]})),s.debug(`${Ui}: Complete.`)}))}()),p.push(po()),p.push(function(e=Qi){const t=As(Qi,e).ratio;if(t<0||t>1)throw new Error(`${Yi}: Ratio must be between 0 and 1.`);return Es(Yi,(e=>{const r=e.getRoot(),n=e.getLogger();let s=0;for(const e of r.listAccessors()){const r=e.getCount(),n=Array(e.getElementSize()).fill(0),o=Array(e.getElementSize()).fill(0);let i=0;for(let s=0;s<r&&(e.getElement(s,o),B.eq(o,n,0)||i++,!(i/r>=t));s++);const a=i/r<t;a!==e.getSparse()&&(e.setSparse(a),s++)}n.debug(`${Yi}: Updated ${s} accessors.`),n.debug(`${Yi}: Complete.`)}))}({ratio:.2})),p.push(function(e=Yo){const t=As(Yo,e);return Es("draco",(async e=>{await e.transform(Oo()),e.createExtension(sr).setRequired(!0).setEncoderOptions({method:"edgebreaker"===t.method?sr.EncoderMethod.EDGEBREAKER:sr.EncoderMethod.SEQUENTIAL,encodeSpeed:t.encodeSpeed,decodeSpeed:t.decodeSpeed,quantizationBits:{POSITION:t.quantizePosition,NORMAL:t.quantizeNormal,COLOR:t.quantizeColor,TEX_COORD:t.quantizeTexcoord,GENERIC:t.quantizeGeneric},quantizationVolume:t.quantizationVolume})}))}({method:"edgebreaker",quantizePosition:24,quantizeNormal:10,quantizeColor:8,quantizeTexcoord:12,quantizeGeneric:8,quantizationVolume:"mesh"})),await u.transform(...p);let l=!1,f=u.getRoot().listTextures();console.time("transformTexture");for(var _=0;_<f.length;_++){let e=f[_],t=e.getSize();console.time("one texture transformTexture"),t&&n&&(t[0]>n||t[1]>n)&&await ea(e,{resize:[n,n]});let r=e.getMimeType();if(a&&"image/ktx2"!==r){let t=e.getImage(),n=e.getSize();if(n)if(n[0]*n[1]<6e6){let n=await ha(t,r,!0);n&&(l=!0,e.setImage(n).setMimeType("image/ktx2").setURI(`${e.getName()}.ktx2`))}else console.warn("texture size limited 6 megapixels")}console.timeEnd("one texture transformTexture"),console.info("----textures compress progress:",`${_+1}/${f.length}`)}console.timeEnd("transformTexture"),l&&u.createExtension(vn).setRequired(!0);return await r.writeBinary(u)}export{ma as gltfOptimization,ha as toKTX2UASTC};
