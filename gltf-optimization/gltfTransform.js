class e{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;return void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t),this}removeEventListener(e,t){const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}return this}dispatchEvent(e){const t=this._listeners[e.type];if(void 0!==t){const r=t.slice(0);for(let t=0,n=r.length;t<n;t++)r[t].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class t{constructor(e,t,r,n={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=r,this._attributes=n,!t.isOnGraph(r))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class r extends e{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const t=new Set;for(const r of this.listParentEdges(e))t.add(r.getParent());return Array.from(t)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const t=new Set;for(const r of this.listChildEdges(e))t.add(r.getChild());return Array.from(t)}disconnectParents(e,t){for(const r of this.listParentEdges(e))t&&!t(r.getParent())||r.dispose();return this}_createEdge(e,r,n,s){const o=new t(e,r,n,s);this._edges.add(o);const i=o.getParent();this._parentEdges.has(i)||this._parentEdges.set(i,new Set),this._parentEdges.get(i).add(o);const a=o.getChild();return this._childEdges.has(a)||this._childEdges.set(a,new Set),this._childEdges.get(a).add(o),o}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function n(){return n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}class s{constructor(e){if(this.list=[],e)for(const t of e)this.list.push(t)}add(e){this.list.push(e)}remove(e){const t=this.list.indexOf(e);t>=0&&this.list.splice(t,1)}removeChild(e){const t=[];for(const r of this.list)r.getChild()===e&&t.push(r);for(const e of t)this.remove(e);return t}listRefsByChild(e){const t=[];for(const r of this.list)r.getChild()===e&&t.push(r);return t}values(){return this.list}}class o{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const t of e)this.add(t)}add(e){const t=e.getChild();this.removeChild(t),this.set.add(e),this.map.set(t,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const t=this.map.get(e)||null;return t&&this.remove(t),t}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class i{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,t){this.map[e]=t}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const a=Symbol("attributes"),c=Symbol("immutableKeys");class u extends e{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[a]=void 0,this[c]=void 0,this.graph=e,this[c]=new Set,this[a]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const r in e){const n=e[r];if(n instanceof u){const e=this.graph._createEdge(r,this,n);this[c].add(r),t[r]=e}else t[r]=n}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach((e=>e.dispose())),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,r){for(const n in this[a]){const c=this[a][n];if(c instanceof t){const t=c;t.getChild()===e&&this.setRef(n,r,t.getAttributes())}else if(c instanceof s)for(const t of c.listRefsByChild(e)){const s=t.getAttributes();this.removeRef(n,e),this.addRef(n,r,s)}else if(c instanceof o){const t=c.getRefByChild(e);if(t){const s=t.getAttributes();this.removeRef(n,e),this.addRef(n,r,s)}}else if(c instanceof i)for(const t of c.keys()){const s=c.get(t);s.getChild()===e&&this.setRefMap(n,t,r,s.getAttributes())}}return this}get(e){return this[a][e]}set(e,t){return this[a][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[a][e];return t?t.getChild():null}setRef(e,t,r){if(this[c].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const n=this[a][e];if(n&&n.dispose(),!t)return this;const s=this.graph._createEdge(e,this,t,r);return this[a][e]=s,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map((e=>e.getChild()))}addRef(e,t,r){const n=this.graph._createEdge(e,this,t,r);return this.assertRefList(e).add(n),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){const r=this.assertRefList(e);if(r instanceof s)for(const e of r.listRefsByChild(t))e.dispose();else{const e=r.getRefByChild(t);e&&e.dispose()}return this}assertRefList(e){const t=this[a][e];if(t instanceof s||t instanceof o)return t;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map((e=>e.getChild()))}getRefMap(e,t){const r=this.assertRefMap(e).get(t);return r?r.getChild():null}setRefMap(e,t,r,s){const o=this.assertRefMap(e),i=o.get(t);if(i&&i.dispose(),!r)return this;s=Object.assign(s||{},{key:t});const a=this.graph._createEdge(e,this,r,n({},s,{key:t}));return o.set(t,a),this.dispatchEvent({type:"change",attribute:e,key:t})}assertRefMap(e){const t=this[a][e];if(t instanceof i)return t;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(n({},e,{target:this})),this.graph.dispatchEvent(n({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const t=e.getName();if(this[a][t]===e)this[a][t]=null,this[c].has(t)&&e.getChild().dispose();else if(this[a][t]instanceof s)this[a][t].remove(e);else if(this[a][t]instanceof o)this[a][t].remove(e);else{if(!(this[a][t]instanceof i))return;{const r=this[a][t];for(const t of r.keys())r.get(t)===e&&r.delete(t)}}this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:t})}}const p="v4.2.0",l="@glb.bin";var f,_,h,d,y;!function(e){e.ACCESSOR="Accessor",e.ANIMATION="Animation",e.ANIMATION_CHANNEL="AnimationChannel",e.ANIMATION_SAMPLER="AnimationSampler",e.BUFFER="Buffer",e.CAMERA="Camera",e.MATERIAL="Material",e.MESH="Mesh",e.PRIMITIVE="Primitive",e.PRIMITIVE_TARGET="PrimitiveTarget",e.NODE="Node",e.ROOT="Root",e.SCENE="Scene",e.SKIN="Skin",e.TEXTURE="Texture",e.TEXTURE_INFO="TextureInfo"}(f||(f={})),function(e){e.INTERLEAVED="interleaved",e.SEPARATE="separate"}(_||(_={})),function(e){e.ARRAY_BUFFER="ARRAY_BUFFER",e.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",e.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",e.OTHER="OTHER",e.SPARSE="SPARSE"}(h||(h={})),function(e){e[e.R=4096]="R",e[e.G=256]="G",e[e.B=16]="B",e[e.A=1]="A"}(d||(d={})),function(e){e.GLTF="GLTF",e.GLB="GLB"}(y||(y={}));const m={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var g,b,T,A="undefined"!=typeof Float32Array?Float32Array:Array;function E(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function x(e,t,r){var n=t[0],s=t[1],o=t[2],i=r[3]*n+r[7]*s+r[11]*o+r[15];return i=i||1,e[0]=(r[0]*n+r[4]*s+r[8]*o+r[12])/i,e[1]=(r[1]*n+r[5]*s+r[9]*o+r[13])/i,e[2]=(r[2]*n+r[6]*s+r[10]*o+r[14])/i,e}function I(e,t){const r=S();for(const n of e.listPrimitives()){const e=n.getAttribute("POSITION"),s=n.getIndices();if(!e)continue;let o=[0,0,0],i=[0,0,0];for(let n=0,a=s?s.getCount():e.getCount();n<a;n++){const a=s?s.getScalar(n):n;o=e.getElement(a,o),i=x(i,o,t),R(i,r)}}return r}function R(e,t){for(let r=0;r<3;r++)t.min[r]=Math.min(e[r],t.min[r]),t.max[r]=Math.max(e[r],t.max[r])}function S(){return{min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]}}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),g=new A(3),A!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0);class M{static createBufferFromDataURI(e){if("undefined"==typeof Buffer){const t=atob(e.split(",")[1]),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}{const t=e.split(",")[1],r=e.indexOf("base64")>=0;return Buffer.from(t,r?"base64":"utf8")}}static encodeText(e){return(new TextEncoder).encode(e)}static decodeText(e){return(new TextDecoder).decode(e)}static concat(e){let t=0;for(const r of e)t+=r.byteLength;const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.byteLength;return r}static pad(e,t=0){const r=this.padNumber(e.byteLength);if(r===e.byteLength)return e;const n=new Uint8Array(r);if(n.set(e),0!==t)for(let s=e.byteLength;s<r;s++)n[s]=t;return n}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let r=e.byteLength;for(;r--;)if(e[r]!==t[r])return!1;return!0}static toView(e,t=0,r=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,r))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class N{static hexToFactor(e,t){e=Math.floor(e);const r=t;return r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[r,n,s]=this.convertLinearToSRGB(e,t);return 255*r<<16^255*n<<8^255*s}static convertSRGBToLinear(e,t){const r=e,n=t;for(let e=0;e<3;e++)n[e]=r[e]<.04045?.0773993808*r[e]:Math.pow(.9478672986*r[e]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const r=e,n=t;for(let e=0;e<3;e++)n[e]=r[e]<.0031308?12.92*r[e]:1.055*Math.pow(r[e],.41666)-.055;return t}}class w{match(e){return e.length>=8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return M.decodeText(e.slice(12,16))===w.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}w.PNG_FRIED_CHUNK_NAME="CgBI";class v{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let r=0;const n=this.getSize(e,t);if(!n)return null;for(;n[0]>1||n[1]>1;)r+=n[0]*n[1]*4,n[0]=Math.max(Math.floor(n[0]/2),1),n[1]=Math.max(Math.floor(n[1]/2),1);return r+=4,r}static mimeTypeToExtension(e){return"image/jpeg"===e?"jpg":e.split("/").pop()}static extensionToMimeType(e){return"jpg"===e?"image/jpeg":e?`image/${e}`:""}}function O(e,t){if(t>e.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==e.getUint8(t))throw new TypeError("Invalid JPG, marker table corrupted");return e}v.impls={"image/jpeg":new class{match(e){return e.length>=3&&255===e[0]&&216===e[1]&&255===e[2]}getSize(e){let t,r,n=new DataView(e.buffer,e.byteOffset+4);for(;n.byteLength;){if(t=n.getUint16(0,!1),O(n,t),r=n.getUint8(t+1),192===r||193===r||194===r)return[n.getUint16(t+7,!1),n.getUint16(t+5,!1)];n=new DataView(e.buffer,n.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}},"image/png":new w};class C{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return v.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function D(e){return"[object Object]"===Object.prototype.toString.call(e)}function j(e){if(!1===D(e))return!1;const t=e.constructor;if(void 0===t)return!0;const r=t.prototype;return!1!==D(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}!function(e){e[e.SILENT=4]="SILENT",e[e.ERROR=3]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=1]="INFO",e[e.DEBUG=0]="DEBUG"}(T||(T={}));class P{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=P.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=P.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=P.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=P.Verbosity.ERROR&&console.error(e)}}function F(e,t,r){var n=t[0],s=t[1],o=t[2],i=t[3],a=t[4],c=t[5],u=t[6],p=t[7],l=t[8],f=t[9],_=t[10],h=t[11],d=t[12],y=t[13],m=t[14],g=t[15],b=r[0],T=r[1],A=r[2],E=r[3];return e[0]=b*n+T*a+A*l+E*d,e[1]=b*s+T*c+A*f+E*y,e[2]=b*o+T*u+A*_+E*m,e[3]=b*i+T*p+A*h+E*g,b=r[4],T=r[5],A=r[6],E=r[7],e[4]=b*n+T*a+A*l+E*d,e[5]=b*s+T*c+A*f+E*y,e[6]=b*o+T*u+A*_+E*m,e[7]=b*i+T*p+A*h+E*g,b=r[8],T=r[9],A=r[10],E=r[11],e[8]=b*n+T*a+A*l+E*d,e[9]=b*s+T*c+A*f+E*y,e[10]=b*o+T*u+A*_+E*m,e[11]=b*i+T*p+A*h+E*g,b=r[12],T=r[13],A=r[14],E=r[15],e[12]=b*n+T*a+A*l+E*d,e[13]=b*s+T*c+A*f+E*y,e[14]=b*o+T*u+A*_+E*m,e[15]=b*i+T*p+A*h+E*g,e}function U(e,t){var r=new A(3);!function(e,t){var r=t[0],n=t[1],s=t[2],o=t[4],i=t[5],a=t[6],c=t[8],u=t[9],p=t[10];e[0]=Math.hypot(r,n,s),e[1]=Math.hypot(o,i,a),e[2]=Math.hypot(c,u,p)}(r,t);var n=1/r[0],s=1/r[1],o=1/r[2],i=t[0]*n,a=t[1]*s,c=t[2]*o,u=t[4]*n,p=t[5]*s,l=t[6]*o,f=t[8]*n,_=t[9]*s,h=t[10]*o,d=i+p+h,y=0;return d>0?(y=2*Math.sqrt(d+1),e[3]=.25*y,e[0]=(l-_)/y,e[1]=(f-c)/y,e[2]=(a-u)/y):i>p&&i>h?(y=2*Math.sqrt(1+i-p-h),e[3]=(l-_)/y,e[0]=.25*y,e[1]=(a+u)/y,e[2]=(f+c)/y):p>h?(y=2*Math.sqrt(1+p-i-h),e[3]=(f-c)/y,e[0]=(a+u)/y,e[1]=.25*y,e[2]=(l+_)/y):(y=2*Math.sqrt(1+h-i-p),e[3]=(a-u)/y,e[0]=(f+c)/y,e[1]=(l+_)/y,e[2]=.25*y),e}b=P,P.Verbosity=T,P.DEFAULT_INSTANCE=new b(b.Verbosity.INFO);class L{static identity(e){return e}static eq(e,t,r=1e-5){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>r)return!1;return!0}static clamp(e,t,r){return e<t?t:e>r?r:e}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*L.clamp(e,0,1));case 5121:return Math.round(255*L.clamp(e,0,1));case 5122:return Math.round(32767*L.clamp(e,-1,1));case 5120:return Math.round(127*L.clamp(e,-1,1));default:throw new Error("Invalid component type.")}}static decompose(e,t,r,n){let s=E([e[0],e[1],e[2]]);const o=E([e[4],e[5],e[6]]),i=E([e[8],e[9],e[10]]),a=function(e){var t=e[0],r=e[1],n=e[2],s=e[3],o=e[4],i=e[5],a=e[6],c=e[7],u=e[8],p=e[9],l=e[10],f=e[11],_=e[12],h=e[13],d=e[14],y=e[15];return(t*i-r*o)*(l*y-f*d)-(t*a-n*o)*(p*y-f*h)+(t*c-s*o)*(p*d-l*h)+(r*a-n*i)*(u*y-f*_)-(r*c-s*i)*(u*d-l*_)+(n*c-s*a)*(u*h-p*_)}(e);a<0&&(s=-s),t[0]=e[12],t[1]=e[13],t[2]=e[14];const c=e.slice(),u=1/s,p=1/o,l=1/i;c[0]*=u,c[1]*=u,c[2]*=u,c[4]*=p,c[5]*=p,c[6]*=p,c[8]*=l,c[9]*=l,c[10]*=l,U(r,c),n[0]=s,n[1]=o,n[2]=i}static compose(e,t,r,n){const s=n,o=t[0],i=t[1],a=t[2],c=t[3],u=o+o,p=i+i,l=a+a,f=o*u,_=o*p,h=o*l,d=i*p,y=i*l,m=a*l,g=c*u,b=c*p,T=c*l,A=r[0],E=r[1],x=r[2];return s[0]=(1-(d+m))*A,s[1]=(_+T)*A,s[2]=(h-b)*A,s[3]=0,s[4]=(_-T)*E,s[5]=(1-(f+m))*E,s[6]=(y+g)*E,s[7]=0,s[8]=(h+b)*x,s[9]=(y-g)*x,s[10]=(1-(f+d))*x,s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s}}function G(e,t){if(!!e!=!!t)return!1;const r=e.getChild(),n=t.getChild();return r===n||r.equals(n)}function B(e,t){if(!!e!=!!t)return!1;const r=e.values(),n=t.values();if(r.length!==n.length)return!1;for(let e=0;e<r.length;e++){const t=r[e],s=n[e];if(t.getChild()!==s.getChild()&&!t.getChild().equals(s.getChild()))return!1}return!0}function V(e,t){if(!!e!=!!t)return!1;const r=e.keys(),n=t.keys();if(r.length!==n.length)return!1;for(const n of r){const r=e.get(n),s=t.get(n);if(!!r!=!!s)return!1;const o=r.getChild(),i=s.getChild();if(o!==i&&!o.equals(i))return!1}return!0}function k(e,t){if(e===t)return!0;if(!!e!=!!t||!e||!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function z(e,t){if(e===t)return!0;if(!!e!=!!t)return!1;if(!j(e)||!j(t))return e===t;const r=e,n=t;let s,o=0,i=0;for(s in r)o++;for(s in n)i++;if(o!==i)return!1;for(s in r){const e=r[s],t=n[s];if(H(e)&&H(t)){if(!k(e,t))return!1}else if(j(e)&&j(t)){if(!z(e,t))return!1}else if(e!==t)return!1}return!0}function H(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const q="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",$=new Set,W=function(){let e="";for(let t=0;t<6;t++)e+=q.charAt(Math.floor(42*Math.random()));return e},X="https://null.example";class Y{static dirname(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}static basename(e){return C.basename(new URL(e,X).pathname)}static extension(e){return C.extension(new URL(e,X).pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const r=e.split("/"),n=t.split("/");r.pop();for(let e=0;e<n.length;e++)"."!==n[e]&&(".."===n[e]?r.pop():r.push(n[e]));return r.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Y.DEFAULT_INIT={},Y.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Q=e=>e,K=new Set;class J extends u{constructor(e,t=""){super(e),this[a].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new(0,this.constructor)(this.graph).copy(this,Q)}copy(e,r=Q){for(const e in this[a]){const r=this[a][e];if(r instanceof t)this[c].has(e)||r.dispose();else if(r instanceof s||r instanceof o)for(const e of r.values())e.dispose();else if(r instanceof i)for(const e of r.values())e.dispose()}for(const n in e[a]){const u=this[a][n],p=e[a][n];if(p instanceof t)if(this[c].has(n)){u.getChild().copy(r(p.getChild()),r)}else this.setRef(n,r(p.getChild()),p.getAttributes());else if(p instanceof o||p instanceof s)for(const e of p.values())this.addRef(n,r(e.getChild()),e.getAttributes());else if(p instanceof i)for(const e of p.keys()){const t=p.get(e);this.setRefMap(n,e,r(t.getChild()),t.getAttributes())}else j(p)?this[a][n]=JSON.parse(JSON.stringify(p)):Array.isArray(p)||p instanceof ArrayBuffer||ArrayBuffer.isView(p)?this[a][n]=p.slice():this[a][n]=p}return this}equals(e,r=K){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[a]){if(r.has(n))continue;const c=this[a][n],u=e[a][n];if(c instanceof t||u instanceof t){if(!G(c,u))return!1}else if(c instanceof o||u instanceof o||c instanceof s||u instanceof s){if(!B(c,u))return!1}else if(c instanceof i||u instanceof i){if(!V(c,u))return!1}else if(j(c)||j(u)){if(!z(c,u))return!1}else if(H(c)||H(u)){if(!k(c,u))return!1}else if(c!==u)return!1}return!0}detach(){return this.graph.disconnectParents(this,(e=>"Root"!==e.propertyType)),this}listParents(){return this.graph.listParents(this)}}class Z extends J{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new i})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t._validateParent(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class ee extends Z{init(){this.propertyType=f.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:ee.Type.SCALAR,componentType:ee.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case ee.Type.SCALAR:return 1;case ee.Type.VEC2:return 2;case ee.Type.VEC3:return 3;case ee.Type.VEC4:case ee.Type.MAT2:return 4;case ee.Type.MAT3:return 9;case ee.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case ee.ComponentType.BYTE:case ee.ComponentType.UNSIGNED_BYTE:return 1;case ee.ComponentType.SHORT:case ee.ComponentType.UNSIGNED_SHORT:return 2;case ee.ComponentType.UNSIGNED_INT:case ee.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getNormalized(),r=this.getElementSize(),n=this.getComponentType();if(this.getMin(e),t)for(let t=0;t<r;t++)e[t]=L.decodeNormalizedInt(e[t],n);return e}getMin(e){const t=this.getArray(),r=this.getCount(),n=this.getElementSize();for(let t=0;t<n;t++)e[t]=1/0;for(let s=0;s<r*n;s+=n)for(let r=0;r<n;r++){const n=t[s+r];Number.isFinite(n)&&(e[r]=Math.min(e[r],n))}return e}getMaxNormalized(e){const t=this.getNormalized(),r=this.getElementSize(),n=this.getComponentType();if(this.getMax(e),t)for(let t=0;t<r;t++)e[t]=L.decodeNormalizedInt(e[t],n);return e}getMax(e){const t=this.get("array"),r=this.getCount(),n=this.getElementSize();for(let t=0;t<n;t++)e[t]=-1/0;for(let s=0;s<r*n;s+=n)for(let r=0;r<n;r++){const n=t[s+r];Number.isFinite(n)&&(e[r]=Math.max(e[r],n))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return ee.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const t=this.getElementSize(),r=this.getComponentType(),n=this.getArray();return this.getNormalized()?L.decodeNormalizedInt(n[e*t],r):n[e*t]}setScalar(e,t){const r=this.getElementSize(),n=this.getComponentType(),s=this.getArray();return this.getNormalized()?s[e*r]=L.encodeNormalizedInt(t,n):s[e*r]=t,this}getElement(e,t){const r=this.getNormalized(),n=this.getElementSize(),s=this.getComponentType(),o=this.getArray();for(let i=0;i<n;i++)t[i]=r?L.decodeNormalizedInt(o[e*n+i],s):o[e*n+i];return t}setElement(e,t){const r=this.getNormalized(),n=this.getElementSize(),s=this.getComponentType(),o=this.getArray();for(let i=0;i<n;i++)o[e*n+i]=r?L.encodeNormalizedInt(t[i],s):t[i];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(e){switch(e.constructor){case Float32Array:return ee.ComponentType.FLOAT;case Uint32Array:return ee.ComponentType.UNSIGNED_INT;case Uint16Array:return ee.ComponentType.UNSIGNED_SHORT;case Uint8Array:return ee.ComponentType.UNSIGNED_BYTE;case Int16Array:return ee.ComponentType.SHORT;case Int8Array:return ee.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):ee.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}ee.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},ee.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class te extends Z{init(){this.propertyType=f.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new o,samplers:new o})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class re extends Z{init(){this.propertyType=f.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}re.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class ne extends Z{init(){this.propertyType=f.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:ne.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:h.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:h.OTHER})}}ne.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class se extends Z{init(){this.propertyType=f.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class oe extends Z{init(){this.propertyType=f.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:oe.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}oe.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class ie extends J{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}ie.EXTENSION_NAME=void 0;class ae extends Z{init(){this.propertyType=f.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:ae.WrapMode.REPEAT,wrapT:ae.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}ae.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},ae.MagFilter={NEAREST:9728,LINEAR:9729},ae.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:ce,G:ue,B:pe,A:le}=d;class fe extends Z{init(){this.propertyType=f.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:fe.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new ae(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new ae(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new ae(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new ae(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new ae(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:ce|ue|pe|le,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:ce|ue|pe,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:ce|ue|pe})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:ce})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:ue|pe})}}fe.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class _e extends Z{init(){this.propertyType=f.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new o})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class he extends Z{init(){this.propertyType=f.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new o})}copy(e,t=Q){if(t===Q)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return L.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),r=this.get("rotation").slice(),n=this.get("scale").slice();return L.decompose(e,t,r,n),this.set("translation",t).set("rotation",r).set("scale",n)}getWorldTranslation(){const e=[0,0,0];return L.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return L.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return L.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let t=this;null!=t;t=t.getParentNode())e.push(t);let t;const r=e.pop().getMatrix();for(;t=e.pop();)F(r,r,t.getMatrix());return r}addChild(e){const t=e.getParentNode();t&&t.removeChild(e);for(const t of e.listParents())t.propertyType===f.SCENE&&t.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===f.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class de extends Z{init(){this.propertyType=f.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:de.Mode.TRIANGLES,material:null,indices:null,attributes:new i,targets:new o})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:h.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:h.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}de.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class ye extends J{init(){this.propertyType=f.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new i})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:h.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function me(){return me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},me.apply(null,arguments)}class ge extends Z{init(){this.propertyType=f.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new o})}copy(e,t=Q){if(t===Q)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){const t=e.getParentNode();return t&&t.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class be extends Z{init(){this.propertyType=f.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new o})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:h.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class Te extends Z{init(){this.propertyType=f.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||v.extensionToMimeType(C.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=v.extensionToMimeType(C.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",M.assertView(e))}getSize(){const e=this.get("image");return e?v.getSize(e,this.getMimeType()):null}}class Ae extends Z{init(){this.propertyType=f.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${p}`,version:"2.0"},defaultScene:null,accessors:new o,animations:new o,buffers:new o,cameras:new o,materials:new o,meshes:new o,nodes:new o,scenes:new o,skins:new o,textures:new o})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",(e=>{this._addChildOfRoot(e.target)}))}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=Q){if(t===Q)throw new Error("Root cannot be copied.");this.set("asset",me({},e.get("asset"))),this.setName(e.getName()),this.setExtras(me({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const r of e.listRefMapKeys("extensions")){const n=e.getExtension(r);this.setExtension(r,t(n))}return this}_addChildOfRoot(e){return e instanceof ge?this.addRef("scenes",e):e instanceof he?this.addRef("nodes",e):e instanceof oe?this.addRef("cameras",e):e instanceof be?this.addRef("skins",e):e instanceof _e?this.addRef("meshes",e):e instanceof fe?this.addRef("materials",e):e instanceof Te?this.addRef("textures",e):e instanceof te?this.addRef("animations",e):e instanceof ee?this.addRef("accessors",e):e instanceof se&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter((e=>e.isRequired()))}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Ee{static fromGraph(e){return Ee._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new r,this._root=new Ae(this._graph),this._logger=P.DEFAULT_INSTANCE,Ee._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const t=e.map((e=>e.name));for(const r of e)await r(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find((e=>e.extensionName===t))||new e(this)}createScene(e=""){return new ge(this._graph,e)}createNode(e=""){return new he(this._graph,e)}createCamera(e=""){return new oe(this._graph,e)}createSkin(e=""){return new be(this._graph,e)}createMesh(e=""){return new _e(this._graph,e)}createPrimitive(){return new de(this._graph)}createPrimitiveTarget(e=""){return new ye(this._graph,e)}createMaterial(e=""){return new fe(this._graph,e)}createTexture(e=""){return new Te(this._graph,e)}createAnimation(e=""){return new te(this._graph,e)}createAnimationChannel(e=""){return new re(this._graph,e)}createAnimationSampler(e=""){return new ne(this._graph,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new ee(this._graph,e).setBuffer(t)}createBuffer(e=""){return new se(this._graph,e)}}Ee._GRAPH_DOCUMENTS=new WeakMap;class xe{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this._listener=void 0,this.document=e,e.getRoot()._enableExtension(this),this._listener=e=>{const t=e,r=t.target;r instanceof ie&&r.extensionName===this.extensionName&&("node:create"===t.type&&this._addExtensionProperty(r),"node:dispose"===t.type&&this._removeExtensionProperty(r))};const t=e.getGraph();t.addEventListener("node:create",this._listener),t.addEventListener("node:dispose",this._listener)}dispose(){this.document.getRoot()._disableExtension(this);const e=this.document.getGraph();e.removeEventListener("node:create",this._listener),e.removeEventListener("node:dispose",this._listener);for(const e of this.properties)e.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}_addExtensionProperty(e){return this.properties.add(e),this}_removeExtensionProperty(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}xe.EXTENSION_NAME=void 0;class Ie{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),void 0!==t.texCoord&&e.setTexCoord(t.texCoord),void 0!==t.extras&&e.setExtras(t.extras);const r=this.jsonDoc.json.textures[t.index];if(void 0===r.sampler)return;const n=this.jsonDoc.json.samplers[r.sampler];void 0!==n.magFilter&&e.setMagFilter(n.magFilter),void 0!==n.minFilter&&e.setMinFilter(n.minFilter),void 0!==n.wrapS&&e.setWrapS(n.wrapS),void 0!==n.wrapT&&e.setWrapT(n.wrapT)}}const Re={logger:P.DEFAULT_INSTANCE,extensions:[],dependencies:{}},Se=new Set([f.BUFFER,f.TEXTURE,f.MATERIAL,f.MESH,f.PRIMITIVE,f.NODE,f.SCENE]);class Me{static read(e,t=Re){const r=me({},Re,t),{json:n}=e,s=(new Ee).setLogger(r.logger);this.validate(e,r);const o=new Ie(e),i=n.asset,a=s.getRoot().getAsset();i.copyright&&(a.copyright=i.copyright),i.extras&&(a.extras=i.extras),void 0!==n.extras&&s.getRoot().setExtras(me({},n.extras));const c=n.extensionsUsed||[],u=n.extensionsRequired||[];r.extensions.sort(((e,t)=>e.EXTENSION_NAME>t.EXTENSION_NAME?1:-1));for(const e of r.extensions)if(c.includes(e.EXTENSION_NAME)){const t=s.createExtension(e).setRequired(u.includes(e.EXTENSION_NAME)),n=t.prereadTypes.filter((e=>!Se.has(e)));n.length&&r.logger.warn(`Preread hooks for some types (${n.join()}), requested by extension ${t.extensionName}, are unsupported. Please file an issue or a PR.`);for(const e of t.readDependencies)t.install(e,r.dependencies[e])}const p=n.buffers||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(f.BUFFER))).forEach((e=>e.preread(o,f.BUFFER))),o.buffers=p.map((e=>{const t=s.createBuffer(e.name);return e.extras&&t.setExtras(e.extras),e.uri&&0!==e.uri.indexOf("__")&&t.setURI(e.uri),t}));const _=n.bufferViews||[];o.bufferViewBuffers=_.map(((t,r)=>{if(!o.bufferViews[r]){const n=e.json.buffers[t.buffer],s=n.uri?e.resources[n.uri]:e.resources[l],i=t.byteOffset||0;o.bufferViews[r]=M.toView(s,i,t.byteLength)}return o.buffers[t.buffer]}));const h=n.accessors||[];o.accessors=h.map((e=>{const t=o.bufferViewBuffers[e.bufferView],r=s.createAccessor(e.name,t).setType(e.type);return e.extras&&r.setExtras(e.extras),void 0!==e.normalized&&r.setNormalized(e.normalized),void 0===e.bufferView||r.setArray(Ne(e,o)),r}));const d=n.images||[],y=n.textures||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(f.TEXTURE))).forEach((e=>e.preread(o,f.TEXTURE))),o.textures=d.map((t=>{const r=s.createTexture(t.name);if(t.extras&&r.setExtras(t.extras),void 0!==t.bufferView){const s=n.bufferViews[t.bufferView],o=e.json.buffers[s.buffer],i=o.uri?e.resources[o.uri]:e.resources[l],a=s.byteOffset||0,c=s.byteLength,u=i.slice(a,a+c);r.setImage(u)}else void 0!==t.uri&&(r.setImage(e.resources[t.uri]),0!==t.uri.indexOf("__")&&r.setURI(t.uri));if(void 0!==t.mimeType)r.setMimeType(t.mimeType);else if(t.uri){const e=C.extension(t.uri);r.setMimeType(v.extensionToMimeType(e))}return r})),s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(f.MATERIAL))).forEach((e=>e.preread(o,f.MATERIAL)));const g=n.materials||[];o.materials=g.map((e=>{const t=s.createMaterial(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.alphaMode&&t.setAlphaMode(e.alphaMode),void 0!==e.alphaCutoff&&t.setAlphaCutoff(e.alphaCutoff),void 0!==e.doubleSided&&t.setDoubleSided(e.doubleSided);const r=e.pbrMetallicRoughness||{};if(void 0!==r.baseColorFactor&&t.setBaseColorFactor(r.baseColorFactor),void 0!==e.emissiveFactor&&t.setEmissiveFactor(e.emissiveFactor),void 0!==r.metallicFactor&&t.setMetallicFactor(r.metallicFactor),void 0!==r.roughnessFactor&&t.setRoughnessFactor(r.roughnessFactor),void 0!==r.baseColorTexture){const e=r.baseColorTexture,n=o.textures[y[e.index].source];t.setBaseColorTexture(n),o.setTextureInfo(t.getBaseColorTextureInfo(),e)}if(void 0!==e.emissiveTexture){const r=e.emissiveTexture,n=o.textures[y[r.index].source];t.setEmissiveTexture(n),o.setTextureInfo(t.getEmissiveTextureInfo(),r)}if(void 0!==e.normalTexture){const r=e.normalTexture,n=o.textures[y[r.index].source];t.setNormalTexture(n),o.setTextureInfo(t.getNormalTextureInfo(),r),void 0!==e.normalTexture.scale&&t.setNormalScale(e.normalTexture.scale)}if(void 0!==e.occlusionTexture){const r=e.occlusionTexture,n=o.textures[y[r.index].source];t.setOcclusionTexture(n),o.setTextureInfo(t.getOcclusionTextureInfo(),r),void 0!==e.occlusionTexture.strength&&t.setOcclusionStrength(e.occlusionTexture.strength)}if(void 0!==r.metallicRoughnessTexture){const e=r.metallicRoughnessTexture,n=o.textures[y[e.index].source];t.setMetallicRoughnessTexture(n),o.setTextureInfo(t.getMetallicRoughnessTextureInfo(),e)}return t})),s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(f.MESH))).forEach((e=>e.preread(o,f.MESH)));const b=n.meshes||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(f.PRIMITIVE))).forEach((e=>e.preread(o,f.PRIMITIVE))),o.meshes=b.map((e=>{const t=s.createMesh(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.weights&&t.setWeights(e.weights);return(e.primitives||[]).forEach((r=>{const n=s.createPrimitive();r.extras&&n.setExtras(r.extras),void 0!==r.material&&n.setMaterial(o.materials[r.material]),void 0!==r.mode&&n.setMode(r.mode);for(const[e,t]of Object.entries(r.attributes||{}))n.setAttribute(e,o.accessors[t]);void 0!==r.indices&&n.setIndices(o.accessors[r.indices]);const i=e.extras&&e.extras.targetNames||[];(r.targets||[]).forEach(((e,t)=>{const r=i[t]||t.toString(),a=s.createPrimitiveTarget(r);for(const[t,r]of Object.entries(e))a.setAttribute(t,o.accessors[r]);n.addTarget(a)})),t.addPrimitive(n)})),t}));const T=n.cameras||[];o.cameras=T.map((e=>{const t=s.createCamera(e.name).setType(e.type);if(e.extras&&t.setExtras(e.extras),e.type===oe.Type.PERSPECTIVE){const r=e.perspective;t.setYFov(r.yfov),t.setZNear(r.znear),void 0!==r.zfar&&t.setZFar(r.zfar),void 0!==r.aspectRatio&&t.setAspectRatio(r.aspectRatio)}else{const r=e.orthographic;t.setZNear(r.znear).setZFar(r.zfar).setXMag(r.xmag).setYMag(r.ymag)}return t}));const A=n.nodes||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(f.NODE))).forEach((e=>e.preread(o,f.NODE))),o.nodes=A.map((e=>{const t=s.createNode(e.name);if(e.extras&&t.setExtras(e.extras),void 0!==e.translation&&t.setTranslation(e.translation),void 0!==e.rotation&&t.setRotation(e.rotation),void 0!==e.scale&&t.setScale(e.scale),void 0!==e.matrix){const r=[0,0,0],n=[0,0,0,1],s=[1,1,1];L.decompose(e.matrix,r,n,s),t.setTranslation(r),t.setRotation(n),t.setScale(s)}return void 0!==e.weights&&t.setWeights(e.weights),t}));const E=n.skins||[];o.skins=E.map((e=>{const t=s.createSkin(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.inverseBindMatrices&&t.setInverseBindMatrices(o.accessors[e.inverseBindMatrices]),void 0!==e.skeleton&&t.setSkeleton(o.nodes[e.skeleton]);for(const r of e.joints)t.addJoint(o.nodes[r]);return t})),A.map(((e,t)=>{const r=o.nodes[t];(e.children||[]).forEach((e=>r.addChild(o.nodes[e]))),void 0!==e.mesh&&r.setMesh(o.meshes[e.mesh]),void 0!==e.camera&&r.setCamera(o.cameras[e.camera]),void 0!==e.skin&&r.setSkin(o.skins[e.skin])}));const x=n.animations||[];o.animations=x.map((e=>{const t=s.createAnimation(e.name);e.extras&&t.setExtras(e.extras);const r=(e.samplers||[]).map((e=>{const r=s.createAnimationSampler().setInput(o.accessors[e.input]).setOutput(o.accessors[e.output]).setInterpolation(e.interpolation||ne.Interpolation.LINEAR);return e.extras&&r.setExtras(e.extras),t.addSampler(r),r}));return(e.channels||[]).forEach((e=>{const n=s.createAnimationChannel().setSampler(r[e.sampler]).setTargetPath(e.target.path);void 0!==e.target.node&&n.setTargetNode(o.nodes[e.target.node]),e.extras&&n.setExtras(e.extras),t.addChannel(n)})),t}));const I=n.scenes||[];return s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(f.SCENE))).forEach((e=>e.preread(o,f.SCENE))),o.scenes=I.map((e=>{const t=s.createScene(e.name);e.extras&&t.setExtras(e.extras);return(e.nodes||[]).map((e=>o.nodes[e])).forEach((e=>t.addChild(e))),t})),void 0!==n.scene&&s.getRoot().setDefaultScene(o.scenes[n.scene]),s.getRoot().listExtensionsUsed().forEach((e=>e.read(o))),h.forEach(((e,t)=>{const r=o.accessors[t],n=!!e.sparse,s=!e.bufferView&&!r.getArray();(n||s)&&r.setSparse(!0).setArray(function(e,t){const r=m[e.componentType],n=ee.getElementSize(e.type);let s;s=void 0!==e.bufferView?Ne(e,t):new r(e.count*n);const o=e.sparse;if(!o)return s;const i=o.count,a=me({},e,o.indices,{count:i,type:"SCALAR"}),c=me({},e,o.values,{count:i}),u=Ne(a,t),p=Ne(c,t);for(let e=0;e<a.count;e++)for(let t=0;t<n;t++)s[u[e]*n+t]=p[e*n+t];return s}(e,o))})),s}static validate(e,t){const r=e.json;if("2.0"!==r.asset.version)throw new Error(`Unsupported glTF version, "${r.asset.version}".`);if(r.extensionsRequired)for(const e of r.extensionsRequired)if(!t.extensions.find((t=>t.EXTENSION_NAME===e)))throw new Error(`Missing required extension, "${e}".`);if(r.extensionsUsed)for(const e of r.extensionsUsed)t.extensions.find((t=>t.EXTENSION_NAME===e))||t.logger.warn(`Missing optional extension, "${e}".`)}}function Ne(e,t){const r=t.jsonDoc,n=t.bufferViews[e.bufferView],s=r.json.bufferViews[e.bufferView],o=m[e.componentType],i=ee.getElementSize(e.type),a=o.BYTES_PER_ELEMENT,c=i*a;if(void 0!==s.byteStride&&s.byteStride!==c)return function(e,t){const r=t.jsonDoc,n=t.bufferViews[e.bufferView],s=r.json.bufferViews[e.bufferView],o=m[e.componentType],i=ee.getElementSize(e.type),a=o.BYTES_PER_ELEMENT,c=e.byteOffset||0,u=new o(e.count*i),p=new DataView(n.buffer,n.byteOffset,n.byteLength),l=s.byteStride;for(let t=0;t<e.count;t++)for(let r=0;r<i;r++){const n=c+t*l+r*a;let s;switch(e.componentType){case ee.ComponentType.FLOAT:s=p.getFloat32(n,!0);break;case ee.ComponentType.UNSIGNED_INT:s=p.getUint32(n,!0);break;case ee.ComponentType.UNSIGNED_SHORT:s=p.getUint16(n,!0);break;case ee.ComponentType.UNSIGNED_BYTE:s=p.getUint8(n);break;case ee.ComponentType.SHORT:s=p.getInt16(n,!0);break;case ee.ComponentType.BYTE:s=p.getInt8(n);break;default:throw new Error(`Unexpected componentType "${e.componentType}".`)}u[t*i+r]=s}return u}(e,t);const u=n.byteOffset+(e.byteOffset||0),p=e.count*i*a;return new o(n.buffer.slice(u,u+p))}var we;!function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(we||(we={}));class ve{constructor(e,t,r){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=t,this.options=r;const n=e.getRoot(),s=n.listBuffers().length,o=n.listTextures().length;this.bufferURIGenerator=new Oe(s>1,(()=>r.basename||"buffer")),this.imageURIGenerator=new Oe(o>1,(t=>function(e,t){const r=e.getGraph().listParentEdges(t).find((t=>t.getParent()!==e.getRoot()));return r?r.getName().replace(/texture$/i,""):""}(e,t)||r.basename||"texture")),this.logger=e.getLogger()}createTextureInfoDef(e,t){const r={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},n=JSON.stringify(r);this.samplerDefIndexMap.has(n)||(this.samplerDefIndexMap.set(n,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(r));const s={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(n)},o=JSON.stringify(s);this.textureDefIndexMap.has(o)||(this.textureDefIndexMap.set(o,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(s));const i={index:this.textureDefIndexMap.get(o)};return 0!==t.getTexCoord()&&(i.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(i.extras=t.getExtras()),this.textureInfoDefMap.set(t,i),i}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount();return this._doc.getGraph().listParentEdges(e).some((e=>"attributes"===e.getName()&&"POSITION"===e.getAttributes().key||"input"===e.getName()))&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,r){if(this.options.format===y.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const n=v.mimeTypeToExtension(r.getMimeType());e.uri=this.imageURIGenerator.createURI(r,n),this.assignResourceURI(e.uri,t,!1)}}assignResourceURI(e,t,r){const n=this.jsonDoc.resources;if(!(e in n))return void(n[e]=t);if(t===n[e])return void this.logger.warn(`Duplicate resource URI, "${e}".`);const s=`Resource URI "${e}" already assigned to different data.`;if(r)throw new Error(s);this.logger.warn(s)}getAccessorUsage(e){const t=this._accessorUsageMap.get(e);if(t)return t;if(e.getSparse())return h.SPARSE;for(const t of this._doc.getGraph().listParentEdges(e)){const{usage:e}=t.getAttributes();if(e)return e;t.getParent().propertyType!==f.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${t.getName()}".`)}return h.OTHER}addAccessorToUsageGroup(e,t){const r=this._accessorUsageMap.get(e);if(r&&r!==t)throw new Error(`Accessor with usage "${r}" cannot be reused as "${t}".`);return this._accessorUsageMap.set(e,t),this}}ve.BufferViewTarget=we,ve.BufferViewUsage=h,ve.USAGE_TO_TARGET={[h.ARRAY_BUFFER]:we.ARRAY_BUFFER,[h.ELEMENT_ARRAY_BUFFER]:we.ELEMENT_ARRAY_BUFFER};class Oe{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const r=this.basename(e);return this.counter[r]=this.counter[r]||1,`${r}_${this.counter[r]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:Ce}=ve,{UNSIGNED_INT:De,UNSIGNED_SHORT:je,UNSIGNED_BYTE:Pe}=ee.ComponentType,Fe=new Set([f.ACCESSOR,f.BUFFER,f.MATERIAL,f.MESH]);class Ue{static write(e,t){const r=e.getGraph(),n=e.getRoot(),s={asset:me({generator:`glTF-Transform ${p}`},n.getAsset()),extras:me({},n.getExtras())},o={json:s,resources:{}},i=new ve(e,o,t),a=t.logger||P.DEFAULT_INSTANCE,c=new Set(t.extensions.map((e=>e.EXTENSION_NAME))),u=e.getRoot().listExtensionsUsed().filter((e=>c.has(e.extensionName))).sort(((e,t)=>e.extensionName>t.extensionName?1:-1)),h=e.getRoot().listExtensionsRequired().filter((e=>c.has(e.extensionName))).sort(((e,t)=>e.extensionName>t.extensionName?1:-1));u.length<e.getRoot().listExtensionsUsed().length&&a.warn("Some extensions were not registered for I/O, and will not be written.");for(const e of u){const r=e.prewriteTypes.filter((e=>!Fe.has(e)));r.length&&a.warn(`Prewrite hooks for some types (${r.join()}), requested by extension ${e.extensionName}, are unsupported. Please file an issue or a PR.`);for(const r of e.writeDependencies)e.install(r,t.dependencies[r])}function d(e,t,r,n){const o=[];let a=0;for(const t of e){const e=i.createAccessorDef(t);e.bufferView=s.bufferViews.length;const r=t.getArray(),n=M.pad(M.toView(r));e.byteOffset=a,a+=n.byteLength,o.push(n),i.accessorIndexMap.set(t,s.accessors.length),s.accessors.push(e)}const c={buffer:t,byteOffset:r,byteLength:M.concat(o).byteLength};return n&&(c.target=n),s.bufferViews.push(c),{buffers:o,byteLength:a}}function g(e,t,r){const n=e[0].getCount();let o=0;for(const t of e){const e=i.createAccessorDef(t);e.bufferView=s.bufferViews.length,e.byteOffset=o;const r=t.getElementSize(),n=t.getComponentSize();o+=M.padNumber(r*n),i.accessorIndexMap.set(t,s.accessors.length),s.accessors.push(e)}const a=n*o,c=new ArrayBuffer(a),u=new DataView(c);for(let t=0;t<n;t++){let r=0;for(const n of e){const e=n.getElementSize(),s=n.getComponentSize(),i=n.getComponentType(),a=n.getArray();for(let n=0;n<e;n++){const c=t*o+r+n*s,p=a[t*e+n];switch(i){case ee.ComponentType.FLOAT:u.setFloat32(c,p,!0);break;case ee.ComponentType.BYTE:u.setInt8(c,p);break;case ee.ComponentType.SHORT:u.setInt16(c,p,!0);break;case ee.ComponentType.UNSIGNED_BYTE:u.setUint8(c,p);break;case ee.ComponentType.UNSIGNED_SHORT:u.setUint16(c,p,!0);break;case ee.ComponentType.UNSIGNED_INT:u.setUint32(c,p,!0);break;default:throw new Error("Unexpected component type: "+i)}}r+=M.padNumber(e*s)}}const p={buffer:t,byteOffset:r,byteLength:a,byteStride:o,target:ve.BufferViewTarget.ARRAY_BUFFER};return s.bufferViews.push(p),{byteLength:a,buffers:[new Uint8Array(c)]}}function b(e,t,r){const n=[];let o=0;const c=new Map;let u=-1/0,p=!1;for(const t of e){const e=i.createAccessorDef(t);s.accessors.push(e),i.accessorIndexMap.set(t,s.accessors.length-1);const r=[],n=[],o=[],a=new Array(t.getElementSize()).fill(0);for(let e=0,s=t.getCount();e<s;e++)if(t.getElement(e,o),!L.eq(o,a,0)){u=Math.max(e,u),r.push(e);for(let e=0;e<o.length;e++)n.push(o[e])}const l=r.length,f={accessorDef:e,count:l};if(c.set(t,f),0===l)continue;l>t.getCount()/2&&(p=!0);const _=m[t.getComponentType()];f.indices=r,f.values=new _(n)}if(!Number.isFinite(u))return{buffers:n,byteLength:o};p&&a.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const l=u<255?Uint8Array:u<65535?Uint16Array:Uint32Array,f=u<255?Pe:u<65535?je:De,_={buffer:t,byteOffset:r+o,byteLength:0};for(const t of e){const e=c.get(t);if(0===e.count)continue;e.indicesByteOffset=_.byteLength;const r=M.pad(M.toView(new l(e.indices)));n.push(r),o+=r.byteLength,_.byteLength+=r.byteLength}s.bufferViews.push(_);const h=s.bufferViews.length-1,d={buffer:t,byteOffset:r+o,byteLength:0};for(const t of e){const e=c.get(t);if(0===e.count)continue;e.valuesByteOffset=d.byteLength;const r=M.pad(M.toView(e.values));n.push(r),o+=r.byteLength,d.byteLength+=r.byteLength}s.bufferViews.push(d);const y=s.bufferViews.length-1;for(const t of e){const e=c.get(t);0!==e.count&&(e.accessorDef.sparse={count:e.count,indices:{bufferView:h,byteOffset:e.indicesByteOffset,componentType:f},values:{bufferView:y,byteOffset:e.valuesByteOffset}})}return{buffers:n,byteLength:o}}s.accessors=[],s.bufferViews=[],s.samplers=[],s.textures=[],s.images=n.listTextures().map(((e,t)=>{const r=i.createPropertyDef(e);e.getMimeType()&&(r.mimeType=e.getMimeType());const n=e.getImage();return n&&i.createImageData(r,n,e),i.imageIndexMap.set(e,t),r})),u.filter((e=>e.prewriteTypes.includes(f.ACCESSOR))).forEach((e=>e.prewrite(i,f.ACCESSOR))),n.listAccessors().forEach((e=>{const t=i.accessorUsageGroupedByParent,n=i.accessorParents;if(i.accessorIndexMap.has(e))return;const s=i.getAccessorUsage(e);if(i.addAccessorToUsageGroup(e,s),t.has(s)){const t=r.listParents(e).find((e=>e.propertyType!==f.ROOT));n.set(e,t)}})),u.filter((e=>e.prewriteTypes.includes(f.BUFFER))).forEach((e=>e.prewrite(i,f.BUFFER)));if((n.listAccessors().length>0||i.otherBufferViews.size>0||n.listTextures().length>0&&t.format===y.GLB)&&0===n.listBuffers().length)throw new Error("Buffer required for Document resources, but none was found.");s.buffers=[],n.listBuffers().forEach(((e,r)=>{const n=i.createPropertyDef(e),o=i.accessorUsageGroupedByParent,a=e.listParents().filter((e=>e instanceof ee)),c=new Set(a.map((e=>i.accessorParents.get(e)))),u=new Map(Array.from(c).map(((e,t)=>[e,t]))),p={};for(const e of a){var f;if(i.accessorIndexMap.has(e))continue;const t=i.getAccessorUsage(e);let r=t;if(o.has(t)){const t=i.accessorParents.get(e);r+=`:${u.get(t)}`}p[f=r]||(p[f]={usage:t,accessors:[]}),p[r].accessors.push(e)}const h=[],m=s.buffers.length;let T=0;for(const{usage:e,accessors:r}of Object.values(p))if(e===Ce.ARRAY_BUFFER&&t.vertexLayout===_.INTERLEAVED){const e=g(r,m,T);T+=e.byteLength;for(const t of e.buffers)h.push(t)}else if(e===Ce.ARRAY_BUFFER)for(const e of r){const t=g([e],m,T);T+=t.byteLength;for(const e of t.buffers)h.push(e)}else if(e===Ce.SPARSE){const e=b(r,m,T);T+=e.byteLength;for(const t of e.buffers)h.push(t)}else if(e===Ce.ELEMENT_ARRAY_BUFFER){const e=d(r,m,T,ve.BufferViewTarget.ELEMENT_ARRAY_BUFFER);T+=e.byteLength;for(const t of e.buffers)h.push(t)}else{const e=d(r,m,T);T+=e.byteLength;for(const t of e.buffers)h.push(t)}if(i.imageBufferViews.length&&0===r)for(let e=0;e<i.imageBufferViews.length;e++)if(s.bufferViews[s.images[e].bufferView].byteOffset=T,T+=i.imageBufferViews[e].byteLength,h.push(i.imageBufferViews[e]),T%8){const e=8-T%8;T+=e,h.push(new Uint8Array(e))}if(i.otherBufferViews.has(e))for(const t of i.otherBufferViews.get(e))s.bufferViews.push({buffer:m,byteOffset:T,byteLength:t.byteLength}),i.otherBufferViewsIndexMap.set(t,s.bufferViews.length-1),T+=t.byteLength,h.push(t);if(T){let r;t.format===y.GLB?r=l:(r=i.bufferURIGenerator.createURI(e,"bin"),n.uri=r),n.byteLength=T,i.assignResourceURI(r,M.concat(h),!0)}s.buffers.push(n),i.bufferIndexMap.set(e,r)})),n.listAccessors().find((e=>!e.getBuffer()))&&a.warn("Skipped writing one or more Accessors: no Buffer assigned."),u.filter((e=>e.prewriteTypes.includes(f.MATERIAL))).forEach((e=>e.prewrite(i,f.MATERIAL))),s.materials=n.listMaterials().map(((e,t)=>{const r=i.createPropertyDef(e);if(e.getAlphaMode()!==fe.AlphaMode.OPAQUE&&(r.alphaMode=e.getAlphaMode()),e.getAlphaMode()===fe.AlphaMode.MASK&&(r.alphaCutoff=e.getAlphaCutoff()),e.getDoubleSided()&&(r.doubleSided=!0),r.pbrMetallicRoughness={},L.eq(e.getBaseColorFactor(),[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=e.getBaseColorFactor()),L.eq(e.getEmissiveFactor(),[0,0,0])||(r.emissiveFactor=e.getEmissiveFactor()),1!==e.getRoughnessFactor()&&(r.pbrMetallicRoughness.roughnessFactor=e.getRoughnessFactor()),1!==e.getMetallicFactor()&&(r.pbrMetallicRoughness.metallicFactor=e.getMetallicFactor()),e.getBaseColorTexture()){const t=e.getBaseColorTexture(),n=e.getBaseColorTextureInfo();r.pbrMetallicRoughness.baseColorTexture=i.createTextureInfoDef(t,n)}if(e.getEmissiveTexture()){const t=e.getEmissiveTexture(),n=e.getEmissiveTextureInfo();r.emissiveTexture=i.createTextureInfoDef(t,n)}if(e.getNormalTexture()){const t=e.getNormalTexture(),n=e.getNormalTextureInfo(),s=i.createTextureInfoDef(t,n);1!==e.getNormalScale()&&(s.scale=e.getNormalScale()),r.normalTexture=s}if(e.getOcclusionTexture()){const t=e.getOcclusionTexture(),n=e.getOcclusionTextureInfo(),s=i.createTextureInfoDef(t,n);1!==e.getOcclusionStrength()&&(s.strength=e.getOcclusionStrength()),r.occlusionTexture=s}if(e.getMetallicRoughnessTexture()){const t=e.getMetallicRoughnessTexture(),n=e.getMetallicRoughnessTextureInfo();r.pbrMetallicRoughness.metallicRoughnessTexture=i.createTextureInfoDef(t,n)}return i.materialIndexMap.set(e,t),r})),u.filter((e=>e.prewriteTypes.includes(f.MESH))).forEach((e=>e.prewrite(i,f.MESH))),s.meshes=n.listMeshes().map(((e,t)=>{const r=i.createPropertyDef(e);let n=null;return r.primitives=e.listPrimitives().map((e=>{const t={attributes:{}};t.mode=e.getMode();const r=e.getMaterial();r&&(t.material=i.materialIndexMap.get(r)),Object.keys(e.getExtras()).length&&(t.extras=e.getExtras());const s=e.getIndices();s&&(t.indices=i.accessorIndexMap.get(s));for(const r of e.listSemantics())t.attributes[r]=i.accessorIndexMap.get(e.getAttribute(r));for(const r of e.listTargets()){const e={};for(const t of r.listSemantics())e[t]=i.accessorIndexMap.get(r.getAttribute(t));t.targets=t.targets||[],t.targets.push(e)}return e.listTargets().length&&!n&&(n=e.listTargets().map((e=>e.getName()))),t})),e.getWeights().length&&(r.weights=e.getWeights()),n&&(r.extras=r.extras||{},r.extras.targetNames=n),i.meshIndexMap.set(e,t),r})),s.cameras=n.listCameras().map(((e,t)=>{const r=i.createPropertyDef(e);if(r.type=e.getType(),r.type===oe.Type.PERSPECTIVE){r.perspective={znear:e.getZNear(),zfar:e.getZFar(),yfov:e.getYFov()};const t=e.getAspectRatio();null!==t&&(r.perspective.aspectRatio=t)}else r.orthographic={znear:e.getZNear(),zfar:e.getZFar(),xmag:e.getXMag(),ymag:e.getYMag()};return i.cameraIndexMap.set(e,t),r})),s.nodes=n.listNodes().map(((e,t)=>{const r=i.createPropertyDef(e);return L.eq(e.getTranslation(),[0,0,0])||(r.translation=e.getTranslation()),L.eq(e.getRotation(),[0,0,0,1])||(r.rotation=e.getRotation()),L.eq(e.getScale(),[1,1,1])||(r.scale=e.getScale()),e.getWeights().length&&(r.weights=e.getWeights()),i.nodeIndexMap.set(e,t),r})),s.skins=n.listSkins().map(((e,t)=>{const r=i.createPropertyDef(e),n=e.getInverseBindMatrices();n&&(r.inverseBindMatrices=i.accessorIndexMap.get(n));const s=e.getSkeleton();return s&&(r.skeleton=i.nodeIndexMap.get(s)),r.joints=e.listJoints().map((e=>i.nodeIndexMap.get(e))),i.skinIndexMap.set(e,t),r})),n.listNodes().forEach(((e,t)=>{const r=s.nodes[t],n=e.getMesh();n&&(r.mesh=i.meshIndexMap.get(n));const o=e.getCamera();o&&(r.camera=i.cameraIndexMap.get(o));const a=e.getSkin();a&&(r.skin=i.skinIndexMap.get(a)),e.listChildren().length>0&&(r.children=e.listChildren().map((e=>i.nodeIndexMap.get(e))))})),s.animations=n.listAnimations().map(((e,t)=>{const r=i.createPropertyDef(e),n=new Map;return r.samplers=e.listSamplers().map(((e,t)=>{const r=i.createPropertyDef(e);return r.input=i.accessorIndexMap.get(e.getInput()),r.output=i.accessorIndexMap.get(e.getOutput()),r.interpolation=e.getInterpolation(),n.set(e,t),r})),r.channels=e.listChannels().map((e=>{const t=i.createPropertyDef(e);return t.sampler=n.get(e.getSampler()),t.target={node:i.nodeIndexMap.get(e.getTargetNode()),path:e.getTargetPath()},t})),i.animationIndexMap.set(e,t),r})),s.scenes=n.listScenes().map(((e,t)=>{const r=i.createPropertyDef(e);return r.nodes=e.listChildren().map((e=>i.nodeIndexMap.get(e))),i.sceneIndexMap.set(e,t),r}));const T=n.getDefaultScene();return T&&(s.scene=n.listScenes().indexOf(T)),s.extensionsUsed=u.map((e=>e.extensionName)),s.extensionsRequired=h.map((e=>e.extensionName)),u.forEach((e=>e.write(i))),function(e){const t=[];for(const r in e){const n=e[r];(Array.isArray(n)&&0===n.length||null===n||""===n||n&&"object"==typeof n&&0===Object.keys(n).length)&&t.push(r)}for(const r of t)delete e[r]}(s),o}}var Le;!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(Le||(Le={}));class Ge{constructor(){this._logger=P.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=_.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const t of e)this._extensions.add(t),t.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const r=Be(t)?this._binaryToJSON(t):{json:JSON.parse(M.decodeText(t)),resources:{}};return await this._readResourcesExternal(r,this.dirname(e)),this._readResourcesInternal(r),r}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),Me.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const t=this._binaryToJSON(M.assertView(e));this._readResourcesInternal(t);const r=t.json;if(r.buffers&&r.buffers.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)}(t,e))))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(r.images&&r.images.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)&&void 0===t.bufferView}(t,e))))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(M.assertView(e)))}async writeJSON(e,t={}){if(t.format===y.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return Ue.write(e,{format:t.format||y.GLTF,basename:t.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:me({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:t,resources:r}=await this.writeJSON(e,{format:y.GLB}),n=new Uint32Array([1179937895,2,12]),s=JSON.stringify(t),o=M.pad(M.encodeText(s),32),i=M.toView(new Uint32Array([o.byteLength,1313821514])),a=M.concat([i,o]);n[n.length-1]+=a.byteLength;const c=Object.values(r)[0];if(!c||!c.byteLength)return M.concat([M.toView(n),a]);const u=M.pad(c,0),p=M.toView(new Uint32Array([u.byteLength,5130562])),l=M.concat([p,u]);return n[n.length-1]+=l.byteLength,M.concat([M.toView(n),a,l])}async _readResourcesExternal(e,t){var r=this;const n=[...e.json.images||[],...e.json.buffers||[]].map((async function(n){const s=n.uri;if(!s||s.match(/data:/))return Promise.resolve();e.resources[s]=await r.readURI(r.resolve(t,s),"view"),r.lastReadBytes+=e.resources[s].byteLength}));await Promise.all(n)}_readResourcesInternal(e){function t(t){if(t.uri)if(t.uri in e.resources)M.assertView(e.resources[t.uri]);else if(t.uri.match(/data:/)){const r=`__${function(){for(let e=0;e<999;e++){const e=W();if(!$.has(e))return $.add(e),e}return""}()}.${C.extension(t.uri)}`;e.resources[r]=M.createBufferFromDataURI(t.uri),t.uri=r}}(e.json.images||[]).forEach((e=>{if(void 0===e.bufferView&&void 0===e.uri)throw new Error("Missing resource URI or buffer view.");t(e)}));(e.json.buffers||[]).forEach(t)}_copyJSON(e){const{images:t,buffers:r}=e.json;return e={json:me({},e.json),resources:me({},e.resources)},t&&(e.json.images=t.map((e=>me({},e)))),r&&(e.json.buffers=r.map((e=>me({},e)))),e}_binaryToJSON(e){if(!Be(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==Le.JSON)throw new Error("Missing required GLB JSON chunk.");const r=t[0],n=M.decodeText(M.toView(e,20,r)),s=JSON.parse(n),o=20+r;if(e.byteLength<=o)return{json:s,resources:{}};const i=new Uint32Array(e.buffer,e.byteOffset+o,2);if(i[1]!==Le.BIN)return{json:s,resources:{}};const a=i[0],c=M.toView(e,o+8,a);return{json:s,resources:{[l]:c}}}}function Be(e){if(e.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const t=new Uint32Array(e.buffer,e.byteOffset,3);return 1179937895===t[0]&&2===t[1]}class Ve extends Ge{constructor(e=Y.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=e}async readURI(e,t){const r=await fetch(e,this._fetchConfig);switch(t){case"view":return new Uint8Array(await r.arrayBuffer());case"text":return r.text()}}resolve(e,t){return Y.resolve(e,t)}dirname(e){return Y.dirname(e)}}class ke{constructor(e,t,r,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t=0){const r=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,n)}}const ze=[171,75,84,88,32,50,48,187,13,10,26,10];function He(e){return(new TextDecoder).decode(e)}function qe(e){const t=new Uint8Array(e.buffer,e.byteOffset,ze.length);if(t[0]!==ze[0]||t[1]!==ze[1]||t[2]!==ze[2]||t[3]!==ze[3]||t[4]!==ze[4]||t[5]!==ze[5]||t[6]!==ze[6]||t[7]!==ze[7]||t[8]!==ze[8]||t[9]!==ze[9]||t[10]!==ze[10]||t[11]!==ze[11])throw new Error("Missing KTX 2.0 identifier.");const r={vkFormat:0,typeSize:1,pixelWidth:0,pixelHeight:0,pixelDepth:0,layerCount:0,faceCount:1,supercompressionScheme:0,levels:[],dataFormatDescriptor:[{vendorId:0,descriptorType:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],keyValue:{},globalData:null},n=17*Uint32Array.BYTES_PER_ELEMENT,s=new ke(e,ze.length,n,!0);r.vkFormat=s._nextUint32(),r.typeSize=s._nextUint32(),r.pixelWidth=s._nextUint32(),r.pixelHeight=s._nextUint32(),r.pixelDepth=s._nextUint32(),r.layerCount=s._nextUint32(),r.faceCount=s._nextUint32();const o=s._nextUint32();r.supercompressionScheme=s._nextUint32();const i=s._nextUint32(),a=s._nextUint32(),c=s._nextUint32(),u=s._nextUint32(),p=s._nextUint64(),l=s._nextUint64(),f=new ke(e,ze.length+n,3*o*8,!0);for(let t=0;t<o;t++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+f._nextUint64(),f._nextUint64()),uncompressedByteLength:f._nextUint64()});const _=new ke(e,i,a,!0);_._skip(4);const h=_._nextUint16(),d=_._nextUint16(),y=_._nextUint16(),m=_._nextUint16(),g={vendorId:h,descriptorType:d,versionNumber:y,colorModel:_._nextUint8(),colorPrimaries:_._nextUint8(),transferFunction:_._nextUint8(),flags:_._nextUint8(),texelBlockDimension:[_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8()],bytesPlane:[_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8()],samples:[]},b=(m/4-6)/4;for(let e=0;e<b;e++){const t={bitOffset:_._nextUint16(),bitLength:_._nextUint8(),channelType:_._nextUint8(),samplePosition:[_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8()],sampleLower:Number.NEGATIVE_INFINITY,sampleUpper:Number.POSITIVE_INFINITY};64&t.channelType?(t.sampleLower=_._nextInt32(),t.sampleUpper=_._nextInt32()):(t.sampleLower=_._nextUint32(),t.sampleUpper=_._nextUint32()),g.samples[e]=t}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(g);const T=new ke(e,c,u,!0);for(;T._offset<u;){const e=T._nextUint32(),t=T._scan(e),n=He(t);if(r.keyValue[n]=T._nextUint8Array(e-t.byteLength-1),n.match(/^ktx/i)){const e=He(r.keyValue[n]);r.keyValue[n]=e.substring(0,e.lastIndexOf("\0"))}const s=e%4?4-e%4:0;T._skip(s)}if(l<=0)return r;const A=new ke(e,p,l,!0),E=A._nextUint16(),x=A._nextUint16(),I=A._nextUint32(),R=A._nextUint32(),S=A._nextUint32(),M=A._nextUint32(),N=[];for(let e=0;e<o;e++)N.push({imageFlags:A._nextUint32(),rgbSliceByteOffset:A._nextUint32(),rgbSliceByteLength:A._nextUint32(),alphaSliceByteOffset:A._nextUint32(),alphaSliceByteLength:A._nextUint32()});const w=p+A._offset,v=w+I,O=v+R,C=O+S,D=new Uint8Array(e.buffer,e.byteOffset+w,I),j=new Uint8Array(e.buffer,e.byteOffset+v,R),P=new Uint8Array(e.buffer,e.byteOffset+O,S),F=new Uint8Array(e.buffer,e.byteOffset+C,M);return r.globalData={endpointCount:E,selectorCount:x,imageDescs:N,endpointsData:D,selectorsData:j,tablesData:P,extendedData:F},r}const $e="EXT_mesh_gpu_instancing",We="EXT_meshopt_compression",Xe="KHR_draco_mesh_compression",Ye="KHR_lights_punctual",Qe="KHR_materials_anisotropy",Ke="KHR_materials_clearcoat",Je="KHR_materials_diffuse_transmission",Ze="KHR_materials_dispersion",et="KHR_materials_emissive_strength",tt="KHR_materials_ior",rt="KHR_materials_iridescence",nt="KHR_materials_pbrSpecularGlossiness",st="KHR_materials_sheen",ot="KHR_materials_specular",it="KHR_materials_transmission",at="KHR_materials_unlit",ct="KHR_materials_volume",ut="KHR_materials_variants",pt="KHR_texture_transform",lt="KHR_xmp_json_ld",ft="INSTANCE_ATTRIBUTE";class _t extends ie{init(){this.extensionName=$e,this.propertyType="InstancedMesh",this.parentTypes=[f.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new i})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:ft})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}_t.EXTENSION_NAME=$e;const ht=$e;class dt extends xe{constructor(...e){super(...e),this.extensionName=ht,this.provideTypes=[f.NODE],this.prewriteTypes=[f.ACCESSOR]}createInstancedMesh(){return new _t(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach(((t,r)=>{if(!t.extensions||!t.extensions[ht])return;const n=t.extensions[ht],s=this.createInstancedMesh();for(const t in n.attributes)s.setAttribute(t,e.accessors[n.attributes[t]]);e.nodes[r].setExtension(ht,s)})),this}prewrite(e){e.accessorUsageGroupedByParent.add(ft);for(const t of this.properties)for(const r of t.listAttributes())e.addAccessorToUsageGroup(r,ft);return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach((r=>{const n=r.getExtension(ht);if(n){const s=e.nodeIndexMap.get(r),o=t.json.nodes[s],i={attributes:{}};n.listSemantics().forEach((t=>{const r=n.getAttribute(t);i.attributes[t]=e.accessorIndexMap.get(r)})),o.extensions=o.extensions||{},o.extensions[ht]=i}})),this}}function yt(){return yt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yt.apply(null,arguments)}var mt,gt,bt;dt.EXTENSION_NAME=ht,function(e){e.QUANTIZE="quantize",e.FILTER="filter"}(mt||(mt={})),function(e){e.ATTRIBUTES="ATTRIBUTES",e.TRIANGLES="TRIANGLES",e.INDICES="INDICES"}(gt||(gt={})),function(e){e.NONE="NONE",e.OCTAHEDRAL="OCTAHEDRAL",e.QUATERNION="QUATERNION",e.EXPONENTIAL="EXPONENTIAL"}(bt||(bt={}));const{BYTE:Tt,SHORT:At,FLOAT:Et}=ee.ComponentType,{encodeNormalizedInt:xt,decodeNormalizedInt:It}=L;function Rt(e,t,r,n){const{filter:s,bits:o}=n,i={array:e.getArray(),byteStride:e.getElementSize()*e.getComponentSize(),componentType:e.getComponentType(),normalized:e.getNormalized()};if(r!==gt.ATTRIBUTES)return i;if(s!==bt.NONE){let r=e.getNormalized()?function(e){const t=e.getComponentType(),r=e.getArray(),n=new Float32Array(r.length);for(let e=0;e<r.length;e++)n[e]=It(r[e],t);return n}(e):new Float32Array(i.array);switch(s){case bt.EXPONENTIAL:i.byteStride=4*e.getElementSize(),i.componentType=Et,i.normalized=!1,i.array=t.encodeFilterExp(r,e.getCount(),i.byteStride,o);break;case bt.OCTAHEDRAL:i.byteStride=o>8?8:4,i.componentType=o>8?At:Tt,i.normalized=!0,r=3===e.getElementSize()?function(e){const t=new Float32Array(4*e.length/3);for(let r=0,n=e.length/3;r<n;r++)t[4*r]=e[3*r],t[4*r+1]=e[3*r+1],t[4*r+2]=e[3*r+2];return t}(r):r,i.array=t.encodeFilterOct(r,e.getCount(),i.byteStride,o);break;case bt.QUATERNION:i.byteStride=8,i.componentType=At,i.normalized=!0,i.array=t.encodeFilterQuat(r,e.getCount(),i.byteStride,o);break;default:throw new Error("Invalid filter.")}i.min=e.getMin([]),i.max=e.getMax([]),e.getNormalized()&&(i.min=i.min.map((t=>It(t,e.getComponentType()))),i.max=i.max.map((t=>It(t,e.getComponentType())))),i.normalized&&(i.min=i.min.map((e=>xt(e,i.componentType))),i.max=i.max.map((e=>xt(e,i.componentType))))}else i.byteStride%4&&(i.array=function(e,t){const r=M.padNumber(e.BYTES_PER_ELEMENT*t)/e.BYTES_PER_ELEMENT,n=e.length/t,s=new e.constructor(n*r);for(let n=0;n*t<e.length;n++)for(let o=0;o<t;o++)s[n*r+o]=e[n*t+o];return s}(i.array,e.getElementSize()),i.byteStride=i.array.byteLength/e.getCount());return i}function St(e,t){if(t===ve.BufferViewUsage.ELEMENT_ARRAY_BUFFER){return e.listParents().some((e=>e instanceof de&&e.getMode()===de.Mode.TRIANGLES))?gt.TRIANGLES:gt.INDICES}return gt.ATTRIBUTES}function Mt(e,t){const r=t.getGraph().listParentEdges(e).filter((e=>!(e.getParent()instanceof Ae)));for(const t of r){const r=t.getName(),n=t.getAttributes().key||"",s=t.getParent().propertyType===f.PRIMITIVE_TARGET;if("indices"===r)return{filter:bt.NONE};if("attributes"===r){if("POSITION"===n)return{filter:bt.NONE};if("TEXCOORD_0"===n)return{filter:bt.NONE};if(n.startsWith("JOINTS_"))return{filter:bt.NONE};if(n.startsWith("WEIGHTS_"))return{filter:bt.NONE};if("NORMAL"===n||"TANGENT"===n)return s?{filter:bt.NONE}:{filter:bt.OCTAHEDRAL,bits:8}}if("output"===r){const t=Nt(e);return"rotation"===t?{filter:bt.QUATERNION,bits:16}:"translation"===t||"scale"===t?{filter:bt.EXPONENTIAL,bits:12}:{filter:bt.NONE}}if("input"===r)return{filter:bt.NONE};if("inverseBindMatrices"===r)return{filter:bt.NONE}}return{filter:bt.NONE}}function Nt(e){for(const t of e.listParents())if(t instanceof ne)for(const e of t.listParents())if(e instanceof re)return e.getTargetPath();return null}const wt=We,vt={method:mt.QUANTIZE};class Ot extends xe{constructor(...e){super(...e),this.extensionName=wt,this.prereadTypes=[f.BUFFER,f.PRIMITIVE],this.prewriteTypes=[f.BUFFER,f.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=vt,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return"meshopt.decoder"===e&&(this._decoder=t),"meshopt.encoder"===e&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=yt({},vt,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${wt}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${wt}]: Missing WASM support.`)}return t===f.BUFFER?this._prereadBuffers(e):t===f.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(((r,n)=>{if(!r.extensions||!r.extensions[wt])return;const s=r.extensions[wt],o=s.byteOffset||0,i=s.byteLength||0,a=s.count,c=s.byteStride,u=new Uint8Array(a*c),p=t.json.buffers[s.buffer],f=p.uri?t.resources[p.uri]:t.resources[l],_=M.toView(f,o,i);this._decoder.decodeGltfBuffer(u,a,c,_,s.mode,s.filter),e.bufferViews[n]=u}))}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((r=>{if(!r.extensions||!r.extensions[wt])return;const n=r.extensions[wt],s=e.buffers[n.buffer],o=e.buffers[r.buffer],i=t.json.buffers[r.buffer];var a;(a=i).extensions&&a.extensions[We]&&a.extensions[We].fallback&&this._decoderFallbackBufferMap.set(o,s)}))}read(e){if(!this.isRequired())return this;for(const[e,t]of this._decoderFallbackBufferMap){for(const r of e.listParents())r instanceof ee&&r.swap(e,t);e.dispose()}return this}prewrite(e,t){return t===f.ACCESSOR?this._prewriteAccessors(e):t===f.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,r=this._encoder,n=this._encoderOptions,s=this.document.getGraph(),o=this.document.createBuffer(),i=this.document.getRoot().listBuffers().indexOf(o);let a=1;const c=new Map,u=e=>{for(const t of s.listParents(e)){if(t.propertyType===f.ROOT)continue;let r=c.get(e);return void 0===r&&c.set(e,r=a++),r}return-1};this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const s of this.document.getRoot().listAccessors()){if("weights"===Nt(s))continue;if(s.getSparse())continue;const o=e.getAccessorUsage(s),a=e.accessorUsageGroupedByParent.has(o)?u(s):null,c=St(s,o),p=n.method===mt.FILTER?Mt(s,this.document):{filter:bt.NONE},l=Rt(s,r,c,p),{array:f,byteStride:_}=l,h=s.getBuffer();if(!h)throw new Error(`${wt}: Missing buffer for accessor.`);const d=this.document.getRoot().listBuffers().indexOf(h),y=[o,a,c,p.filter,_,d].join(":");let m=this._encoderBufferViews[y],g=this._encoderBufferViewData[y],b=this._encoderBufferViewAccessors[y];m&&g||(b=this._encoderBufferViewAccessors[y]=[],g=this._encoderBufferViewData[y]=[],m=this._encoderBufferViews[y]={buffer:i,target:ve.USAGE_TO_TARGET[o],byteOffset:0,byteLength:0,byteStride:o===ve.BufferViewUsage.ARRAY_BUFFER?_:void 0,extensions:{[wt]:{buffer:d,byteOffset:0,byteLength:0,mode:c,filter:p.filter!==bt.NONE?p.filter:void 0,byteStride:_,count:0}}});const T=e.createAccessorDef(s);T.componentType=l.componentType,T.normalized=l.normalized,T.byteOffset=m.byteLength,T.min&&l.min&&(T.min=l.min),T.max&&l.max&&(T.max=l.max),e.accessorIndexMap.set(s,t.accessors.length),t.accessors.push(T),b.push(T),g.push(new Uint8Array(f.buffer,f.byteOffset,f.byteLength)),m.byteLength+=f.byteLength,m.extensions.EXT_meshopt_compression.count+=s.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const r in this._encoderBufferViews){const n=this._encoderBufferViews[r],s=this._encoderBufferViewData[r],o=this.document.getRoot().listBuffers()[n.extensions[wt].buffer],i=e.otherBufferViews.get(o)||[],{count:a,byteStride:c,mode:u}=n.extensions[wt],p=M.concat(s),l=t.encodeGltfBuffer(p,a,c,u),f=M.pad(l);n.extensions[wt].byteLength=l.byteLength,s.length=0,s.push(f),i.push(f),e.otherBufferViews.set(o,i)}}write(e){let t=0;for(const r in this._encoderBufferViews){const n=this._encoderBufferViews[r],s=this._encoderBufferViewData[r][0],o=e.otherBufferViewsIndexMap.get(s),i=this._encoderBufferViewAccessors[r];for(const e of i)e.bufferView=o;const a=e.jsonDoc.json.bufferViews[o],c=a.byteOffset||0;Object.assign(a,n),a.byteOffset=t;a.extensions[wt].byteOffset=c,t+=M.padNumber(n.byteLength)}const r=this._encoderFallbackBuffer,n=e.bufferIndexMap.get(r),s=e.jsonDoc.json.buffers[n];return s.byteLength=t,s.extensions={[wt]:{fallback:!0}},r.dispose(),this}}Ot.EXTENSION_NAME=wt,Ot.EncoderMethod=mt;const Ct="EXT_texture_avif";class Dt{match(e){return e.length>=12&&"ftypavif"===M.decodeText(e.slice(4,12))}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=Pt(t,0);if(!r)return null;let n=r.end;for(;r=Pt(t,n);)if("meta"===r.type)n=r.start+4;else if("iprp"===r.type||"ipco"===r.type)n=r.start;else{if("ispe"===r.type)return[t.getUint32(r.start+4),t.getUint32(r.start+8)];if("mdat"===r.type)break;n=r.end}return null}getChannels(e){return 4}}class jt extends xe{constructor(...e){super(...e),this.extensionName=Ct,this.prereadTypes=[f.TEXTURE]}static register(){v.registerFormat("image/avif",new Dt)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[Ct]&&(e.source=e.extensions[Ct].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/avif"===r.getMimeType()){const n=e.imageIndexMap.get(r);(t.json.textures||[]).forEach((e=>{e.source===n&&(e.extensions=e.extensions||{},e.extensions[Ct]={source:e.source},delete e.source)}))}})),this}}function Pt(e,t){if(e.byteLength<4+t)return null;const r=e.getUint32(t);return e.byteLength<r+t||r<8?null:{type:M.decodeText(new Uint8Array(e.buffer,e.byteOffset+t+4,4)),start:t+8,end:t+r}}jt.EXTENSION_NAME=Ct;const Ft="EXT_texture_webp";class Ut{match(e){return e.length>=12&&87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]}getSize(e){const t=M.decodeText(e.slice(0,4)),r=M.decodeText(e.slice(8,12));if("RIFF"!==t||"WEBP"!==r)return null;const n=new DataView(e.buffer,e.byteOffset);let s=12;for(;s<n.byteLength;){const e=M.decodeText(new Uint8Array([n.getUint8(s),n.getUint8(s+1),n.getUint8(s+2),n.getUint8(s+3)])),t=n.getUint32(s+4,!0);if("VP8 "===e){return[16383&n.getInt16(s+14,!0),16383&n.getInt16(s+16,!0)]}if("VP8L"===e){const e=n.getUint8(s+9),t=n.getUint8(s+10),r=n.getUint8(s+11);return[1+((63&t)<<8|e),1+((15&n.getUint8(s+12))<<10|r<<2|(192&t)>>6)]}s+=8+t+t%2}return null}getChannels(e){return 4}}class Lt extends xe{constructor(...e){super(...e),this.extensionName=Ft,this.prereadTypes=[f.TEXTURE]}static register(){v.registerFormat("image/webp",new Ut)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[Ft]&&(e.source=e.extensions[Ft].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/webp"===r.getMimeType()){const n=e.imageIndexMap.get(r);(t.json.textures||[]).forEach((e=>{e.source===n&&(e.extensions=e.extensions||{},e.extensions[Ft]={source:e.source},delete e.source)}))}})),this}}Lt.EXTENSION_NAME=Ft;const Gt=Xe;let Bt,Vt,kt,zt;function Ht(e,t){const r=new Bt.DecoderBuffer;try{r.Init(t,t.length);if(e.GetEncodedGeometryType(r)!==Bt.TRIANGULAR_MESH)throw new Error(`[${Gt}] Unknown geometry type.`);const n=new Bt.Mesh;if(!e.DecodeBufferToMesh(r,n).ok()||0===n.ptr)throw new Error(`[${Gt}] Decoding failure.`);return n}finally{Bt.destroy(r)}}function qt(e,t){const r=3*t.num_faces();let n,s;if(t.num_points()<=65534){const o=r*Uint16Array.BYTES_PER_ELEMENT;n=Bt._malloc(o),e.GetTrianglesUInt16Array(t,o,n),s=new Uint16Array(Bt.HEAPU16.buffer,n,r).slice()}else{const o=r*Uint32Array.BYTES_PER_ELEMENT;n=Bt._malloc(o),e.GetTrianglesUInt32Array(t,o,n),s=new Uint32Array(Bt.HEAPU32.buffer,n,r).slice()}return Bt._free(n),s}function $t(e,t,r,n){const s=kt[n.componentType],o=Vt[n.componentType],i=r.num_components(),a=t.num_points()*i,c=a*o.BYTES_PER_ELEMENT,u=Bt._malloc(c);e.GetAttributeDataArrayForAllPoints(t,r,s,c,u);const p=new o(Bt.HEAPF32.buffer,u,a).slice();return Bt._free(u),p}var Wt,Xt;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(Wt||(Wt={})),function(e){e.POSITION="POSITION",e.NORMAL="NORMAL",e.COLOR="COLOR",e.TEX_COORD="TEX_COORD",e.GENERIC="GENERIC"}(Xt||(Xt={}));const Yt={[Xt.POSITION]:14,[Xt.NORMAL]:10,[Xt.COLOR]:8,[Xt.TEX_COORD]:12,[Xt.GENERIC]:12},Qt={decodeSpeed:5,encodeSpeed:5,method:Wt.EDGEBREAKER,quantizationBits:Yt,quantizationVolume:"mesh"};function Kt(e,t=Qt){const r=yt({},Qt,t);r.quantizationBits=yt({},Yt,t.quantizationBits);const n=new zt.MeshBuilder,s=new zt.Mesh,o=new zt.ExpertEncoder(s),i={},a=new zt.DracoInt8Array,c=e.listTargets().length>0;let u=!1;for(const t of e.listSemantics()){const a=e.getAttribute(t);if(a.getSparse()){u=!0;continue}const c=Jt(t),p=Zt(n,a.getComponentType(),s,zt[c],a.getCount(),a.getElementSize(),a.getArray());if(-1===p)throw new Error(`Error compressing "${t}" attribute.`);if(i[t]=p,"mesh"===r.quantizationVolume||"POSITION"!==t)o.SetAttributeQuantization(p,r.quantizationBits[c]);else{if("object"!=typeof r.quantizationVolume)throw new Error("Invalid quantization volume state.");{const{quantizationVolume:e}=r,t=Math.max(e.max[0]-e.min[0],e.max[1]-e.min[1],e.max[2]-e.min[2]);o.SetAttributeExplicitQuantization(p,r.quantizationBits[c],a.getElementSize(),e.min,t)}}}const p=e.getIndices();if(!p)throw new er("Primitive must have indices.");n.AddFacesToMesh(s,p.getCount()/3,p.getArray()),o.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),o.SetTrackEncodedProperties(!0),r.method===Wt.SEQUENTIAL||c||u?o.SetEncodingMethod(zt.MESH_SEQUENTIAL_ENCODING):o.SetEncodingMethod(zt.MESH_EDGEBREAKER_ENCODING);const l=o.EncodeToDracoBuffer(!(c||u),a);if(l<=0)throw new er("Error applying Draco compression.");const f=new Uint8Array(l);for(let e=0;e<l;++e)f[e]=a.GetValue(e);const _=o.GetNumberOfEncodedPoints(),h=3*o.GetNumberOfEncodedFaces();return zt.destroy(a),zt.destroy(s),zt.destroy(n),zt.destroy(o),{numVertices:_,numIndices:h,data:f,attributeIDs:i}}function Jt(e){return"POSITION"===e?Xt.POSITION:"NORMAL"===e?Xt.NORMAL:e.startsWith("COLOR_")?Xt.COLOR:e.startsWith("TEXCOORD_")?Xt.TEX_COORD:Xt.GENERIC}function Zt(e,t,r,n,s,o,i){switch(t){case ee.ComponentType.UNSIGNED_BYTE:return e.AddUInt8Attribute(r,n,s,o,i);case ee.ComponentType.BYTE:return e.AddInt8Attribute(r,n,s,o,i);case ee.ComponentType.UNSIGNED_SHORT:return e.AddUInt16Attribute(r,n,s,o,i);case ee.ComponentType.SHORT:return e.AddInt16Attribute(r,n,s,o,i);case ee.ComponentType.UNSIGNED_INT:return e.AddUInt32Attribute(r,n,s,o,i);case ee.ComponentType.FLOAT:return e.AddFloatAttribute(r,n,s,o,i);default:throw new Error(`Unexpected component type, "${t}".`)}}class er extends Error{}const tr=Xe;class rr extends xe{constructor(...e){super(...e),this.extensionName=tr,this.prereadTypes=[f.PRIMITIVE],this.prewriteTypes=[f.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){var r,n;return"draco3d.decoder"===e&&(this._decoderModule=t,r=this._decoderModule,Bt=r,Vt={[ee.ComponentType.FLOAT]:Float32Array,[ee.ComponentType.UNSIGNED_INT]:Uint32Array,[ee.ComponentType.UNSIGNED_SHORT]:Uint16Array,[ee.ComponentType.UNSIGNED_BYTE]:Uint8Array,[ee.ComponentType.SHORT]:Int16Array,[ee.ComponentType.BYTE]:Int8Array},kt={[ee.ComponentType.FLOAT]:Bt.DT_FLOAT32,[ee.ComponentType.UNSIGNED_INT]:Bt.DT_UINT32,[ee.ComponentType.UNSIGNED_SHORT]:Bt.DT_UINT16,[ee.ComponentType.UNSIGNED_BYTE]:Bt.DT_UINT8,[ee.ComponentType.SHORT]:Bt.DT_INT16,[ee.ComponentType.BYTE]:Bt.DT_INT8}),"draco3d.encoder"===e&&(this._encoderModule=t,n=this._encoderModule,zt=n),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${tr}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),r=e.jsonDoc,n=new Map;try{const s=r.json.meshes||[];for(const o of s)for(const s of o.primitives){if(!s.extensions||!s.extensions[tr])continue;const o=s.extensions[tr];let[i,a]=n.get(o.bufferView)||[];if(!a||!i){const e=r.json.bufferViews[o.bufferView],s=r.json.buffers[e.buffer],c=s.uri?r.resources[s.uri]:r.resources[l],u=e.byteOffset||0,p=e.byteLength,f=M.toView(c,u,p);i=new this._decoderModule.Decoder,a=Ht(i,f),n.set(o.bufferView,[i,a]),t.debug(`[${tr}] Decompressed ${f.byteLength} bytes.`)}for(const t in o.attributes){const r=e.jsonDoc.json.accessors[s.attributes[t]],n=i.GetAttributeByUniqueId(a,o.attributes[t]),c=$t(i,a,n,r);e.accessors[s.attributes[t]].setArray(c)}void 0!==s.indices&&e.accessors[s.indices].setArray(qt(i,a))}}finally{for(const[e,t]of Array.from(n.values()))this._decoderModule.destroy(e),this._decoderModule.destroy(t)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${tr}] Please install extension dependency, "draco3d.encoder".`);const r=this.document.getLogger();r.debug(`[${tr}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const n=function(e){const t=e.getLogger(),r=new Set,n=new Set;let s=0,o=0;for(const t of e.getRoot().listMeshes())for(const e of t.listPrimitives())e.getIndices()?e.getMode()!==de.Mode.TRIANGLES?(n.add(e),o++):r.add(e):(n.add(e),s++);s>0&&t.warn(`[${tr}] Skipping Draco compression of ${s} non-indexed primitives.`);o>0&&t.warn(`[${tr}] Skipping Draco compression of ${o} non-TRIANGLES primitives.`);const i=e.getRoot().listAccessors(),a=new Map;for(let e=0;e<i.length;e++)a.set(i[e],e);const c=new Map,u=new Set,p=new Map;for(const t of Array.from(r)){let r=nr(t,a);if(u.has(r))p.set(t,r);else{if(c.has(t.getIndices())){const r=t.getIndices(),n=r.clone();a.set(n,e.getRoot().listAccessors().length-1),t.swap(r,n)}for(const r of t.listAttributes())if(c.has(r)){const n=r.clone();a.set(n,e.getRoot().listAccessors().length-1),t.swap(r,n)}r=nr(t,a),u.add(r),p.set(t,r),c.set(t.getIndices(),r);for(const e of t.listAttributes())c.set(e,r)}}for(const e of Array.from(c.keys())){const t=new Set(e.listParents().map((e=>e.propertyType)));if(2!==t.size||!t.has(f.PRIMITIVE)||!t.has(f.ROOT))throw new Error(`[${tr}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const e of Array.from(r)){const t=p.get(e),r=e.getIndices();if(c.get(r)!==t||e.listAttributes().some((e=>c.get(e)!==t)))throw new Error(`[${tr}] Draco primitives must share all, or no, accessors.`)}for(const e of Array.from(n)){const t=e.getIndices();if(c.has(t)||e.listAttributes().some((e=>c.has(e))))throw new Error(`[${tr}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return p}(this.document),s=new Map;let o="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.document.getRoot().listScenes().length?r.warn(`[${tr}]: quantizationVolume=scene requires exactly 1 scene.`):o=function(e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=e.propertyType===f.NODE?[e]:e.listChildren();for(const e of r)e.traverse((e=>{const r=e.getMesh();if(!r)return;const n=I(r,e.getWorldMatrix());n.min.every(isFinite)&&n.max.every(isFinite)&&(R(n.min,t),R(n.max,t))}));return t}(this.document.getRoot().listScenes().pop()));for(const t of Array.from(n.keys())){const i=n.get(t);if(!i)throw new Error("Unexpected primitive.");if(s.has(i)){s.set(i,s.get(i));continue}const a=t.getIndices(),c=e.jsonDoc.json.accessors;let u;try{u=Kt(t,yt({},this._encoderOptions,{quantizationVolume:o}))}catch(e){if(e instanceof er){r.warn(`[${tr}]: ${e.message} Skipping primitive compression.`);continue}throw e}s.set(i,u);const p=e.createAccessorDef(a);p.count=u.numIndices,e.accessorIndexMap.set(a,c.length),c.push(p),u.numVertices>65534&&ee.getComponentSize(p.componentType)<=2?p.componentType=ee.ComponentType.UNSIGNED_INT:u.numVertices>254&&ee.getComponentSize(p.componentType)<=1&&(p.componentType=ee.ComponentType.UNSIGNED_SHORT);for(const r of t.listSemantics()){const n=t.getAttribute(r);if(void 0===u.attributeIDs[r])continue;const s=e.createAccessorDef(n);s.count=u.numVertices,e.accessorIndexMap.set(n,c.length),c.push(s)}const l=t.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(l)||e.otherBufferViews.set(l,[]),e.otherBufferViews.get(l).push(u.data)}return r.debug(`[${tr}] Compressed ${n.size} primitives.`),e.extensionData[tr]={primitiveHashMap:n,primitiveEncodingMap:s},this}write(e){const t=e.extensionData[tr];for(const r of this.document.getRoot().listMeshes()){const n=e.jsonDoc.json.meshes[e.meshIndexMap.get(r)];for(let s=0;s<r.listPrimitives().length;s++){const o=r.listPrimitives()[s],i=n.primitives[s],a=t.primitiveHashMap.get(o);if(!a)continue;const c=t.primitiveEncodingMap.get(a);c&&(i.extensions=i.extensions||{},i.extensions[tr]={bufferView:e.otherBufferViewsIndexMap.get(c.data),attributes:c.attributeIDs})}}if(!t.primitiveHashMap.size){const t=e.jsonDoc.json;t.extensionsUsed=(t.extensionsUsed||[]).filter((e=>e!==tr)),t.extensionsRequired=(t.extensionsRequired||[]).filter((e=>e!==tr))}return this}}function nr(e,t){const r=[],n=e.getIndices();r.push(t.get(n));for(const n of e.listAttributes())r.push(t.get(n));return r.sort().join("|")}rr.EXTENSION_NAME=tr,rr.EncoderMethod=Wt;class sr extends ie{init(){this.extensionName=Ye,this.propertyType="Light",this.parentTypes=[f.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:sr.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}sr.EXTENSION_NAME=Ye,sr.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const or=Ye;class ir extends xe{constructor(...e){super(...e),this.extensionName=or}createLight(e=""){return new sr(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[or])return this;const r=(t.json.extensions[or].lights||[]).map((e=>{var t,r;const n=this.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&n.setColor(e.color),void 0!==e.intensity&&n.setIntensity(e.intensity),void 0!==e.range&&n.setRange(e.range),void 0!==(null==(t=e.spot)?void 0:t.innerConeAngle)&&n.setInnerConeAngle(e.spot.innerConeAngle),void 0!==(null==(r=e.spot)?void 0:r.outerConeAngle)&&n.setOuterConeAngle(e.spot.outerConeAngle),n}));return t.json.nodes.forEach(((t,n)=>{if(!t.extensions||!t.extensions[or])return;const s=t.extensions[or];e.nodes[n].setExtension(or,r[s.light])})),this}write(e){const t=e.jsonDoc;if(0===this.properties.size)return this;const r=[],n=new Map;for(const e of this.properties){const t=e,s={type:t.getType()};L.eq(t.getColor(),[1,1,1])||(s.color=t.getColor()),1!==t.getIntensity()&&(s.intensity=t.getIntensity()),null!=t.getRange()&&(s.range=t.getRange()),t.getName()&&(s.name=t.getName()),t.getType()===sr.Type.SPOT&&(s.spot={innerConeAngle:t.getInnerConeAngle(),outerConeAngle:t.getOuterConeAngle()}),r.push(s),n.set(t,r.length-1)}return this.document.getRoot().listNodes().forEach((r=>{const s=r.getExtension(or);if(s){const o=e.nodeIndexMap.get(r),i=t.json.nodes[o];i.extensions=i.extensions||{},i.extensions[or]={light:n.get(s)}}})),t.json.extensions=t.json.extensions||{},t.json.extensions[or]={lights:r},this}}ir.EXTENSION_NAME=or;const{R:ar,G:cr,B:ur}=d;class pr extends ie{init(){this.extensionName=Qe,this.propertyType="Anisotropy",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new ae(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:ar|cr|ur})}}pr.EXTENSION_NAME=Qe;const lr=Qe;class fr extends xe{constructor(...e){super(...e),this.extensionName=lr,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createAnisotropy(){return new pr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[lr]){const s=this.createAnisotropy();e.materials[r].setExtension(lr,s);const o=t.extensions[lr];if(void 0!==o.anisotropyStrength&&s.setAnisotropyStrength(o.anisotropyStrength),void 0!==o.anisotropyRotation&&s.setAnisotropyRotation(o.anisotropyRotation),void 0!==o.anisotropyTexture){const t=o.anisotropyTexture,r=e.textures[n[t.index].source];s.setAnisotropyTexture(r),e.setTextureInfo(s.getAnisotropyTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(lr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[lr]={};if(n.getAnisotropyStrength()>0&&(i.anisotropyStrength=n.getAnisotropyStrength()),0!==n.getAnisotropyRotation()&&(i.anisotropyRotation=n.getAnisotropyRotation()),n.getAnisotropyTexture()){const t=n.getAnisotropyTexture(),r=n.getAnisotropyTextureInfo();i.anisotropyTexture=e.createTextureInfoDef(t,r)}}})),this}}fr.EXTENSION_NAME=lr;const{R:_r,G:hr,B:dr}=d;class yr extends ie{init(){this.extensionName=Ke,this.propertyType="Clearcoat",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new ae(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new ae(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new ae(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:_r})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:hr})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:_r|hr|dr})}}yr.EXTENSION_NAME=Ke;const mr=Ke;class gr extends xe{constructor(...e){super(...e),this.extensionName=mr,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createClearcoat(){return new yr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[mr]){const s=this.createClearcoat();e.materials[r].setExtension(mr,s);const o=t.extensions[mr];if(void 0!==o.clearcoatFactor&&s.setClearcoatFactor(o.clearcoatFactor),void 0!==o.clearcoatRoughnessFactor&&s.setClearcoatRoughnessFactor(o.clearcoatRoughnessFactor),void 0!==o.clearcoatTexture){const t=o.clearcoatTexture,r=e.textures[n[t.index].source];s.setClearcoatTexture(r),e.setTextureInfo(s.getClearcoatTextureInfo(),t)}if(void 0!==o.clearcoatRoughnessTexture){const t=o.clearcoatRoughnessTexture,r=e.textures[n[t.index].source];s.setClearcoatRoughnessTexture(r),e.setTextureInfo(s.getClearcoatRoughnessTextureInfo(),t)}if(void 0!==o.clearcoatNormalTexture){const t=o.clearcoatNormalTexture,r=e.textures[n[t.index].source];s.setClearcoatNormalTexture(r),e.setTextureInfo(s.getClearcoatNormalTextureInfo(),t),void 0!==t.scale&&s.setClearcoatNormalScale(t.scale)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(mr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[mr]={clearcoatFactor:n.getClearcoatFactor(),clearcoatRoughnessFactor:n.getClearcoatRoughnessFactor()};if(n.getClearcoatTexture()){const t=n.getClearcoatTexture(),r=n.getClearcoatTextureInfo();i.clearcoatTexture=e.createTextureInfoDef(t,r)}if(n.getClearcoatRoughnessTexture()){const t=n.getClearcoatRoughnessTexture(),r=n.getClearcoatRoughnessTextureInfo();i.clearcoatRoughnessTexture=e.createTextureInfoDef(t,r)}if(n.getClearcoatNormalTexture()){const t=n.getClearcoatNormalTexture(),r=n.getClearcoatNormalTextureInfo();i.clearcoatNormalTexture=e.createTextureInfoDef(t,r),1!==n.getClearcoatNormalScale()&&(i.clearcoatNormalTexture.scale=n.getClearcoatNormalScale())}}})),this}}gr.EXTENSION_NAME=mr;const{R:br,G:Tr,B:Ar,A:Er}=d;class xr extends ie{init(){this.extensionName=Je,this.propertyType="DiffuseTransmission",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseTransmissionFactor:0,diffuseTransmissionTexture:null,diffuseTransmissionTextureInfo:new ae(this.graph,"diffuseTransmissionTextureInfo"),diffuseTransmissionColorFactor:[1,1,1],diffuseTransmissionColorTexture:null,diffuseTransmissionColorTextureInfo:new ae(this.graph,"diffuseTransmissionColorTextureInfo")})}getDiffuseTransmissionFactor(){return this.get("diffuseTransmissionFactor")}setDiffuseTransmissionFactor(e){return this.set("diffuseTransmissionFactor",e)}getDiffuseTransmissionTexture(){return this.getRef("diffuseTransmissionTexture")}getDiffuseTransmissionTextureInfo(){return this.getRef("diffuseTransmissionTexture")?this.getRef("diffuseTransmissionTextureInfo"):null}setDiffuseTransmissionTexture(e){return this.setRef("diffuseTransmissionTexture",e,{channels:Er})}getDiffuseTransmissionColorFactor(){return this.get("diffuseTransmissionColorFactor")}setDiffuseTransmissionColorFactor(e){return this.set("diffuseTransmissionColorFactor",e)}getDiffuseTransmissionColorTexture(){return this.getRef("diffuseTransmissionColorTexture")}getDiffuseTransmissionColorTextureInfo(){return this.getRef("diffuseTransmissionColorTexture")?this.getRef("diffuseTransmissionColorTextureInfo"):null}setDiffuseTransmissionColorTexture(e){return this.setRef("diffuseTransmissionColorTexture",e,{channels:br|Tr|Ar})}}xr.EXTENSION_NAME=Je;const Ir=Je;class Rr extends xe{constructor(...e){super(...e),this.extensionName=Ir}createDiffuseTransmission(){return new xr(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[Ir]){const s=this.createDiffuseTransmission();e.materials[r].setExtension(Ir,s);const o=t.extensions[Ir];if(void 0!==o.diffuseTransmissionFactor&&s.setDiffuseTransmissionFactor(o.diffuseTransmissionFactor),void 0!==o.diffuseTransmissionColorFactor&&s.setDiffuseTransmissionColorFactor(o.diffuseTransmissionColorFactor),void 0!==o.diffuseTransmissionTexture){const t=o.diffuseTransmissionTexture,r=e.textures[n[t.index].source];s.setDiffuseTransmissionTexture(r),e.setTextureInfo(s.getDiffuseTransmissionTextureInfo(),t)}if(void 0!==o.diffuseTransmissionColorTexture){const t=o.diffuseTransmissionColorTexture,r=e.textures[n[t.index].source];s.setDiffuseTransmissionColorTexture(r),e.setTextureInfo(s.getDiffuseTransmissionColorTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;for(const r of this.document.getRoot().listMaterials()){const n=r.getExtension(Ir);if(!n)continue;const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[Ir]={diffuseTransmissionFactor:n.getDiffuseTransmissionFactor(),diffuseTransmissionColorFactor:n.getDiffuseTransmissionColorFactor()};if(n.getDiffuseTransmissionTexture()){const t=n.getDiffuseTransmissionTexture(),r=n.getDiffuseTransmissionTextureInfo();i.diffuseTransmissionTexture=e.createTextureInfoDef(t,r)}if(n.getDiffuseTransmissionColorTexture()){const t=n.getDiffuseTransmissionColorTexture(),r=n.getDiffuseTransmissionColorTextureInfo();i.diffuseTransmissionColorTexture=e.createTextureInfoDef(t,r)}}return this}}Rr.EXTENSION_NAME=Ir;class Sr extends ie{init(){this.extensionName=Ze,this.propertyType="Dispersion",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{dispersion:0})}getDispersion(){return this.get("dispersion")}setDispersion(e){return this.set("dispersion",e)}}Sr.EXTENSION_NAME=Ze;const Mr=Ze;class Nr extends xe{constructor(...e){super(...e),this.extensionName=Mr,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createDispersion(){return new Sr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[Mr]){const n=this.createDispersion();e.materials[r].setExtension(Mr,n);const s=t.extensions[Mr];void 0!==s.dispersion&&n.setDispersion(s.dispersion)}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(Mr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{},o.extensions[Mr]={dispersion:n.getDispersion()}}})),this}}Nr.EXTENSION_NAME=Mr;class wr extends ie{init(){this.extensionName=et,this.propertyType="EmissiveStrength",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}wr.EXTENSION_NAME=et;const vr=et;class Or extends xe{constructor(...e){super(...e),this.extensionName=vr,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createEmissiveStrength(){return new wr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[vr]){const n=this.createEmissiveStrength();e.materials[r].setExtension(vr,n);const s=t.extensions[vr];void 0!==s.emissiveStrength&&n.setEmissiveStrength(s.emissiveStrength)}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(vr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{},o.extensions[vr]={emissiveStrength:n.getEmissiveStrength()}}})),this}}Or.EXTENSION_NAME=vr;class Cr extends ie{init(){this.extensionName=tt,this.propertyType="IOR",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}Cr.EXTENSION_NAME=tt;const Dr=tt;class jr extends xe{constructor(...e){super(...e),this.extensionName=Dr,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createIOR(){return new Cr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[Dr]){const n=this.createIOR();e.materials[r].setExtension(Dr,n);const s=t.extensions[Dr];void 0!==s.ior&&n.setIOR(s.ior)}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(Dr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{},o.extensions[Dr]={ior:n.getIOR()}}})),this}}jr.EXTENSION_NAME=Dr;const{R:Pr,G:Fr}=d;class Ur extends ie{init(){this.extensionName=rt,this.propertyType="Iridescence",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new ae(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new ae(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Pr})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Fr})}}Ur.EXTENSION_NAME=rt;const Lr=rt;class Gr extends xe{constructor(...e){super(...e),this.extensionName=Lr,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createIridescence(){return new Ur(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[Lr]){const s=this.createIridescence();e.materials[r].setExtension(Lr,s);const o=t.extensions[Lr];if(void 0!==o.iridescenceFactor&&s.setIridescenceFactor(o.iridescenceFactor),void 0!==o.iridescenceIor&&s.setIridescenceIOR(o.iridescenceIor),void 0!==o.iridescenceThicknessMinimum&&s.setIridescenceThicknessMinimum(o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&s.setIridescenceThicknessMaximum(o.iridescenceThicknessMaximum),void 0!==o.iridescenceTexture){const t=o.iridescenceTexture,r=e.textures[n[t.index].source];s.setIridescenceTexture(r),e.setTextureInfo(s.getIridescenceTextureInfo(),t)}if(void 0!==o.iridescenceThicknessTexture){const t=o.iridescenceThicknessTexture,r=e.textures[n[t.index].source];s.setIridescenceThicknessTexture(r),e.setTextureInfo(s.getIridescenceThicknessTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(Lr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[Lr]={};if(n.getIridescenceFactor()>0&&(i.iridescenceFactor=n.getIridescenceFactor()),1.3!==n.getIridescenceIOR()&&(i.iridescenceIor=n.getIridescenceIOR()),100!==n.getIridescenceThicknessMinimum()&&(i.iridescenceThicknessMinimum=n.getIridescenceThicknessMinimum()),400!==n.getIridescenceThicknessMaximum()&&(i.iridescenceThicknessMaximum=n.getIridescenceThicknessMaximum()),n.getIridescenceTexture()){const t=n.getIridescenceTexture(),r=n.getIridescenceTextureInfo();i.iridescenceTexture=e.createTextureInfoDef(t,r)}if(n.getIridescenceThicknessTexture()){const t=n.getIridescenceThicknessTexture(),r=n.getIridescenceThicknessTextureInfo();i.iridescenceThicknessTexture=e.createTextureInfoDef(t,r)}}})),this}}Gr.EXTENSION_NAME=Lr;const{R:Br,G:Vr,B:kr,A:zr}=d;class Hr extends ie{init(){this.extensionName=nt,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new ae(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new ae(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:Br|Vr|kr|zr,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:Br|Vr|kr|zr})}}Hr.EXTENSION_NAME=nt;const qr=nt;class $r extends xe{constructor(...e){super(...e),this.extensionName=qr,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createPBRSpecularGlossiness(){return new Hr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[qr]){const s=this.createPBRSpecularGlossiness();e.materials[r].setExtension(qr,s);const o=t.extensions[qr];if(void 0!==o.diffuseFactor&&s.setDiffuseFactor(o.diffuseFactor),void 0!==o.specularFactor&&s.setSpecularFactor(o.specularFactor),void 0!==o.glossinessFactor&&s.setGlossinessFactor(o.glossinessFactor),void 0!==o.diffuseTexture){const t=o.diffuseTexture,r=e.textures[n[t.index].source];s.setDiffuseTexture(r),e.setTextureInfo(s.getDiffuseTextureInfo(),t)}if(void 0!==o.specularGlossinessTexture){const t=o.specularGlossinessTexture,r=e.textures[n[t.index].source];s.setSpecularGlossinessTexture(r),e.setTextureInfo(s.getSpecularGlossinessTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(qr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[qr]={diffuseFactor:n.getDiffuseFactor(),specularFactor:n.getSpecularFactor(),glossinessFactor:n.getGlossinessFactor()};if(n.getDiffuseTexture()){const t=n.getDiffuseTexture(),r=n.getDiffuseTextureInfo();i.diffuseTexture=e.createTextureInfoDef(t,r)}if(n.getSpecularGlossinessTexture()){const t=n.getSpecularGlossinessTexture(),r=n.getSpecularGlossinessTextureInfo();i.specularGlossinessTexture=e.createTextureInfoDef(t,r)}}})),this}}$r.EXTENSION_NAME=qr;const{R:Wr,G:Xr,B:Yr,A:Qr}=d;class Kr extends ie{init(){this.extensionName=st,this.propertyType="Sheen",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new ae(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new ae(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Wr|Xr|Yr,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Qr})}}Kr.EXTENSION_NAME=st;const Jr=st;class Zr extends xe{constructor(...e){super(...e),this.extensionName=Jr,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createSheen(){return new Kr(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[Jr]){const s=this.createSheen();e.materials[r].setExtension(Jr,s);const o=t.extensions[Jr];if(void 0!==o.sheenColorFactor&&s.setSheenColorFactor(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&s.setSheenRoughnessFactor(o.sheenRoughnessFactor),void 0!==o.sheenColorTexture){const t=o.sheenColorTexture,r=e.textures[n[t.index].source];s.setSheenColorTexture(r),e.setTextureInfo(s.getSheenColorTextureInfo(),t)}if(void 0!==o.sheenRoughnessTexture){const t=o.sheenRoughnessTexture,r=e.textures[n[t.index].source];s.setSheenRoughnessTexture(r),e.setTextureInfo(s.getSheenRoughnessTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(Jr);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[Jr]={sheenColorFactor:n.getSheenColorFactor(),sheenRoughnessFactor:n.getSheenRoughnessFactor()};if(n.getSheenColorTexture()){const t=n.getSheenColorTexture(),r=n.getSheenColorTextureInfo();i.sheenColorTexture=e.createTextureInfoDef(t,r)}if(n.getSheenRoughnessTexture()){const t=n.getSheenRoughnessTexture(),r=n.getSheenRoughnessTextureInfo();i.sheenRoughnessTexture=e.createTextureInfoDef(t,r)}}})),this}}Zr.EXTENSION_NAME=Jr;const{R:en,G:tn,B:rn,A:nn}=d;class sn extends ie{init(){this.extensionName=ot,this.propertyType="Specular",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new ae(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new ae(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:nn})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:en|tn|rn,isColor:!0})}}sn.EXTENSION_NAME=ot;const on=ot;class an extends xe{constructor(...e){super(...e),this.extensionName=on,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createSpecular(){return new sn(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[on]){const s=this.createSpecular();e.materials[r].setExtension(on,s);const o=t.extensions[on];if(void 0!==o.specularFactor&&s.setSpecularFactor(o.specularFactor),void 0!==o.specularColorFactor&&s.setSpecularColorFactor(o.specularColorFactor),void 0!==o.specularTexture){const t=o.specularTexture,r=e.textures[n[t.index].source];s.setSpecularTexture(r),e.setTextureInfo(s.getSpecularTextureInfo(),t)}if(void 0!==o.specularColorTexture){const t=o.specularColorTexture,r=e.textures[n[t.index].source];s.setSpecularColorTexture(r),e.setTextureInfo(s.getSpecularColorTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(on);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[on]={};if(1!==n.getSpecularFactor()&&(i.specularFactor=n.getSpecularFactor()),L.eq(n.getSpecularColorFactor(),[1,1,1])||(i.specularColorFactor=n.getSpecularColorFactor()),n.getSpecularTexture()){const t=n.getSpecularTexture(),r=n.getSpecularTextureInfo();i.specularTexture=e.createTextureInfoDef(t,r)}if(n.getSpecularColorTexture()){const t=n.getSpecularColorTexture(),r=n.getSpecularColorTextureInfo();i.specularColorTexture=e.createTextureInfoDef(t,r)}}})),this}}an.EXTENSION_NAME=on;const{R:cn}=d;class un extends ie{init(){this.extensionName=it,this.propertyType="Transmission",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new ae(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:cn})}}un.EXTENSION_NAME=it;const pn=it;class ln extends xe{constructor(...e){super(...e),this.extensionName=pn,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createTransmission(){return new un(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[pn]){const s=this.createTransmission();e.materials[r].setExtension(pn,s);const o=t.extensions[pn];if(void 0!==o.transmissionFactor&&s.setTransmissionFactor(o.transmissionFactor),void 0!==o.transmissionTexture){const t=o.transmissionTexture,r=e.textures[n[t.index].source];s.setTransmissionTexture(r),e.setTextureInfo(s.getTransmissionTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(pn);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[pn]={transmissionFactor:n.getTransmissionFactor()};if(n.getTransmissionTexture()){const t=n.getTransmissionTexture(),r=n.getTransmissionTextureInfo();i.transmissionTexture=e.createTextureInfoDef(t,r)}}})),this}}ln.EXTENSION_NAME=pn;class fn extends ie{init(){this.extensionName=at,this.propertyType="Unlit",this.parentTypes=[f.MATERIAL]}}fn.EXTENSION_NAME=at;const _n=at;class hn extends xe{constructor(...e){super(...e),this.extensionName=_n,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createUnlit(){return new fn(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{t.extensions&&t.extensions[_n]&&e.materials[r].setExtension(_n,this.createUnlit())})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{if(r.getExtension(_n)){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{},s.extensions[_n]={}}})),this}}hn.EXTENSION_NAME=_n;class dn extends ie{init(){this.extensionName=ut,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:new o})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}dn.EXTENSION_NAME=ut;class yn extends ie{init(){this.extensionName=ut,this.propertyType="MappingList",this.parentTypes=[f.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:new o})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}yn.EXTENSION_NAME=ut;class mn extends ie{init(){this.extensionName=ut,this.propertyType="Variant",this.parentTypes=["MappingList"]}}mn.EXTENSION_NAME=ut;const gn=ut;class bn extends xe{constructor(...e){super(...e),this.extensionName=gn}createMappingList(){return new yn(this.document.getGraph())}createVariant(e=""){return new mn(this.document.getGraph(),e)}createMapping(){return new dn(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter((e=>e instanceof mn))}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[gn])return this;const r=(t.json.extensions[gn].variants||[]).map((e=>this.createVariant().setName(e.name||"")));return(t.json.meshes||[]).forEach(((t,n)=>{const s=e.meshes[n];(t.primitives||[]).forEach(((t,n)=>{if(!t.extensions||!t.extensions[gn])return;const o=this.createMappingList(),i=t.extensions[gn];for(const t of i.mappings){const n=this.createMapping();void 0!==t.material&&n.setMaterial(e.materials[t.material]);for(const e of t.variants||[])n.addVariant(r[e]);o.addMapping(n)}s.listPrimitives()[n].setExtension(gn,o)}))})),this}write(e){const t=e.jsonDoc,r=this.listVariants();if(!r.length)return this;const n=[],s=new Map;for(const t of r)s.set(t,n.length),n.push(e.createPropertyDef(t));for(const t of this.document.getRoot().listMeshes()){const r=e.meshIndexMap.get(t);t.listPrimitives().forEach(((t,n)=>{const o=t.getExtension(gn);if(!o)return;const i=e.jsonDoc.json.meshes[r].primitives[n],a=o.listMappings().map((t=>{const r=e.createPropertyDef(t),n=t.getMaterial();return n&&(r.material=e.materialIndexMap.get(n)),r.variants=t.listVariants().map((e=>s.get(e))),r}));i.extensions=i.extensions||{},i.extensions[gn]={mappings:a}}))}return t.json.extensions=t.json.extensions||{},t.json.extensions[gn]={variants:n},this}}bn.EXTENSION_NAME=gn;const{G:Tn}=d;class An extends ie{init(){this.extensionName=ct,this.propertyType="Volume",this.parentTypes=[f.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new ae(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Tn})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}}An.EXTENSION_NAME=ct;const En=ct;class xn extends xe{constructor(...e){super(...e),this.extensionName=En,this.prereadTypes=[f.MESH],this.prewriteTypes=[f.MESH]}createVolume(){return new An(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,r=t.json.materials||[],n=t.json.textures||[];return r.forEach(((t,r)=>{if(t.extensions&&t.extensions[En]){const s=this.createVolume();e.materials[r].setExtension(En,s);const o=t.extensions[En];if(void 0!==o.thicknessFactor&&s.setThicknessFactor(o.thicknessFactor),void 0!==o.attenuationDistance&&s.setAttenuationDistance(o.attenuationDistance),void 0!==o.attenuationColor&&s.setAttenuationColor(o.attenuationColor),void 0!==o.thicknessTexture){const t=o.thicknessTexture,r=e.textures[n[t.index].source];s.setThicknessTexture(r),e.setTextureInfo(s.getThicknessTextureInfo(),t)}}})),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(En);if(n){const s=e.materialIndexMap.get(r),o=t.json.materials[s];o.extensions=o.extensions||{};const i=o.extensions[En]={};if(n.getThicknessFactor()>0&&(i.thicknessFactor=n.getThicknessFactor()),Number.isFinite(n.getAttenuationDistance())&&(i.attenuationDistance=n.getAttenuationDistance()),L.eq(n.getAttenuationColor(),[1,1,1])||(i.attenuationColor=n.getAttenuationColor()),n.getThicknessTexture()){const t=n.getThicknessTexture(),r=n.getThicknessTextureInfo();i.thicknessTexture=e.createTextureInfoDef(t,r)}}})),this}}xn.EXTENSION_NAME=En;const In="KHR_mesh_quantization";class Rn extends xe{constructor(...e){super(...e),this.extensionName=In}read(e){return this}write(e){return this}}Rn.EXTENSION_NAME=In;const Sn="KHR_texture_basisu";class Mn{match(e){return 171===e[0]&&75===e[1]&&84===e[2]&&88===e[3]&&32===e[4]&&50===e[5]&&48===e[6]&&187===e[7]&&13===e[8]&&10===e[9]&&26===e[10]&&10===e[11]}getSize(e){const t=qe(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=qe(e).dataFormatDescriptor[0];if(163===t.colorModel)return 2!==t.samples.length||15&~t.samples[1].channelType?3:4;if(166===t.colorModel)return 3==(15&t.samples[0].channelType)?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getVRAMByteLength(e){const t=qe(e),r=this.getChannels(e)>3;let n=0;for(let e=0;e<t.levels.length;e++){const s=t.levels[e];if(s.uncompressedByteLength)n+=s.uncompressedByteLength;else{n+=Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,e)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,e)))/4)*(r?16:8)}}return n}}class Nn extends xe{constructor(...e){super(...e),this.extensionName=Sn,this.prereadTypes=[f.TEXTURE]}static register(){v.registerFormat("image/ktx2",new Mn)}preread(e){return e.jsonDoc.json.textures.forEach((e=>{if(e.extensions&&e.extensions[Sn]){const t=e.extensions[Sn];e.source=t.source}})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/ktx2"===r.getMimeType()){const n=e.imageIndexMap.get(r);t.json.textures.forEach((e=>{e.source===n&&(e.extensions=e.extensions||{},e.extensions[Sn]={source:e.source},delete e.source)}))}})),this}}Nn.EXTENSION_NAME=Sn;class wn extends ie{init(){this.extensionName=pt,this.propertyType="Transform",this.parentTypes=[f.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}wn.EXTENSION_NAME=pt;const vn=pt;class On extends xe{constructor(...e){super(...e),this.extensionName=vn}createTransform(){return new wn(this.document.getGraph())}read(e){for(const[t,r]of Array.from(e.textureInfos.entries())){if(!r.extensions||!r.extensions[vn])continue;const e=this.createTransform(),n=r.extensions[vn];void 0!==n.offset&&e.setOffset(n.offset),void 0!==n.rotation&&e.setRotation(n.rotation),void 0!==n.scale&&e.setScale(n.scale),void 0!==n.texCoord&&e.setTexCoord(n.texCoord),t.setExtension(vn,e)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[e,r]of t){const t=e.getExtension(vn);if(!t)continue;r.extensions=r.extensions||{};const n={},s=L.eq;s(t.getOffset(),[0,0])||(n.offset=t.getOffset()),0!==t.getRotation()&&(n.rotation=t.getRotation()),s(t.getScale(),[1,1])||(n.scale=t.getScale()),null!=t.getTexCoord()&&(n.texCoord=t.getTexCoord()),r.extensions[vn]=n}return this}}On.EXTENSION_NAME=vn;const Cn=[f.ROOT,f.SCENE,f.NODE,f.MESH,f.MATERIAL,f.TEXTURE,f.ANIMATION];class Dn extends ie{init(){this.extensionName=lt,this.propertyType="Packet",this.parentTypes=Cn}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",yt({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const r=yt({},this.get("properties"));return t?r[e]=t:delete r[e],this.set("properties",r)}toJSONLD(){return yt({"@context":jn(this.get("context"))},jn(this.get("properties")))}fromJSONLD(e){const t=(e=jn(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${lt}: Missing context for term, "${e}".`)}}function jn(e){return JSON.parse(JSON.stringify(e))}Dn.EXTENSION_NAME=lt;const Pn=lt;class Fn extends xe{constructor(...e){super(...e),this.extensionName=Pn}createPacket(){return new Dn(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const r=null==(t=e.jsonDoc.json.extensions)?void 0:t[Pn];if(!r||!r.packets)return this;const n=e.jsonDoc.json,s=this.document.getRoot(),o=r.packets.map((e=>this.createPacket().fromJSONLD(e))),i=[[n.asset],n.scenes,n.nodes,n.meshes,n.materials,n.images,n.animations],a=[[s],s.listScenes(),s.listNodes(),s.listMeshes(),s.listMaterials(),s.listTextures(),s.listAnimations()];for(let e=0;e<i.length;e++){const t=i[e]||[];for(let r=0;r<t.length;r++){const n=t[r];if(n.extensions&&n.extensions[Pn]){const t=n.extensions[Pn];a[e][r].setExtension(Pn,o[t.packet])}}}return this}write(e){const{json:t}=e.jsonDoc,r=[];for(const n of this.properties){r.push(n.toJSONLD());for(const s of n.listParents()){let n;switch(s.propertyType){case f.ROOT:n=t.asset;break;case f.SCENE:n=t.scenes[e.sceneIndexMap.get(s)];break;case f.NODE:n=t.nodes[e.nodeIndexMap.get(s)];break;case f.MESH:n=t.meshes[e.meshIndexMap.get(s)];break;case f.MATERIAL:n=t.materials[e.materialIndexMap.get(s)];break;case f.TEXTURE:n=t.images[e.imageIndexMap.get(s)];break;case f.ANIMATION:n=t.animations[e.animationIndexMap.get(s)];break;default:n=null,this.document.getLogger().warn(`[${Pn}]: Unsupported parent property, "${s.propertyType}"`)}n&&(n.extensions=n.extensions||{},n.extensions[Pn]={packet:r.length-1})}}return r.length>0&&(t.extensions=t.extensions||{},t.extensions[Pn]={packets:r}),this}}Fn.EXTENSION_NAME=Pn;const Un=[rr,ir,fr,gr,Rr,Nr,Or,jr,Gr,$r,an,Zr,ln,hn,bn,xn,Rn,Nn,On,Fn];var Ln,Gn,Bn,Vn,kn,zn,Hn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function qn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function $n(){if(Vn)return Bn;function e(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}return Vn=1,Bn=function(t){return null!=t&&(e(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&e(t.slice(0,0))}(t)||!!t._isBuffer)}}var Wn,Xn,Yn,Qn,Kn,Jn,Zn,es,ts,rs=function(){if(zn)return kn;zn=1;var e=(Gn||(Gn=1,Ln=function(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=r;return t}),Ln),t=$n(),r="undefined"!=typeof Float64Array;function n(e,t){return e[0]-t[0]}function s(){var e,t=this.stride,r=new Array(t.length);for(e=0;e<r.length;++e)r[e]=[Math.abs(t[e]),e];r.sort(n);var s=new Array(r.length);for(e=0;e<s.length;++e)s[e]=r[e][1];return s}function o(t,r){var n=["View",r,"d",t].join("");r<0&&(n="View_Nil"+t);var o="generic"===t;if(-1===r){var a="function "+n+"(a){this.data=a;};\tvar proto="+n+".prototype;\tproto.dtype='"+t+"';\tproto.index=function(){return -1};\tproto.size=0;\tproto.dimension=-1;\tproto.shape=proto.stride=proto.order=[];\tproto.lo=proto.hi=proto.transpose=proto.step=\tfunction(){return new "+n+"(this.data);};\tproto.get=proto.set=function(){};\tproto.pick=function(){return null};\treturn function construct_"+n+"(a){return new "+n+"(a);}";return new Function(a)()}if(0===r){a="function "+n+"(a,d) {\tthis.data = a;\tthis.offset = d\t};\tvar proto="+n+".prototype;\tproto.dtype='"+t+"';\tproto.index=function(){return this.offset};\tproto.dimension=0;\tproto.size=1;\tproto.shape=\tproto.stride=\tproto.order=[];\tproto.lo=\tproto.hi=\tproto.transpose=\tproto.step=function "+n+"_copy() {\treturn new "+n+"(this.data,this.offset)\t};\tproto.pick=function "+n+"_pick(){\treturn TrivialArray(this.data);\t};\tproto.valueOf=proto.get=function "+n+"_get(){\treturn "+(o?"this.data.get(this.offset)":"this.data[this.offset]")+"};\tproto.set=function "+n+"_set(v){\treturn "+(o?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"\t};\treturn function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",a)(i[t][0])}a=["'use strict'"];var c=e(r),u=c.map((function(e){return"i"+e})),p="this.offset+"+c.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),l=c.map((function(e){return"b"+e})).join(","),f=c.map((function(e){return"c"+e})).join(",");a.push("function "+n+"(a,"+l+","+f+",d){this.data=a","this.shape=["+l+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+t+"'","proto.dimension="+r),a.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){\treturn "+c.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===r?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),r<4?(a.push("function "+n+"_order(){"),2===r?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===r&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);\tif(s0>s1){\tif(s1>s2){\treturn [2,1,0];\t}else if(s0>s2){\treturn [1,2,0];\t}else{\treturn [1,0,2];\t}\t}else if(s0>s2){\treturn [2,0,1];\t}else if(s2>s1){\treturn [0,1,2];\t}else{\treturn [0,2,1];\t}}})")):a.push("ORDER})")),a.push("proto.set=function "+n+"_set("+u.join(",")+",v){"),o?a.push("return this.data.set("+p+",v)}"):a.push("return this.data["+p+"]=v}"),a.push("proto.get=function "+n+"_get("+u.join(",")+"){"),o?a.push("return this.data.get("+p+")}"):a.push("return this.data["+p+"]}"),a.push("proto.index=function "+n+"_index(",u.join(),"){return "+p+"}"),a.push("proto.hi=function "+n+"_hi("+u.join(",")+"){return new "+n+"(this.data,"+c.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+c.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var _=c.map((function(e){return"a"+e+"=this.shape["+e+"]"})),h=c.map((function(e){return"c"+e+"=this.stride["+e+"]"}));a.push("proto.lo=function "+n+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+_.join(",")+","+h.join(","));for(var d=0;d<r;++d)a.push("if(typeof i"+d+"==='number'&&i"+d+">=0){\td=i"+d+"|0;\tb+=c"+d+"*d;\ta"+d+"-=d}");a.push("return new "+n+"(this.data,"+c.map((function(e){return"a"+e})).join(",")+","+c.map((function(e){return"c"+e})).join(",")+",b)}"),a.push("proto.step=function "+n+"_step("+u.join(",")+"){var "+c.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+c.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(d=0;d<r;++d)a.push("if(typeof i"+d+"==='number'){\td=i"+d+"|0;\tif(d<0){\tc+=b"+d+"*(a"+d+"-1);\ta"+d+"=ceil(-a"+d+"/d)\t}else{\ta"+d+"=ceil(a"+d+"/d)\t}\tb"+d+"*=d\t}");a.push("return new "+n+"(this.data,"+c.map((function(e){return"a"+e})).join(",")+","+c.map((function(e){return"b"+e})).join(",")+",c)}");var y=new Array(r),m=new Array(r);for(d=0;d<r;++d)y[d]="a[i"+d+"]",m[d]="b[i"+d+"]";a.push("proto.transpose=function "+n+"_transpose("+u+"){"+u.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+y.join(",")+","+m.join(",")+",this.offset)}"),a.push("proto.pick=function "+n+"_pick("+u+"){var a=[],b=[],c=this.offset");for(d=0;d<r;++d)a.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this.stride["+d+"]*i"+d+")|0}else{a.push(this.shape["+d+"]);b.push(this.stride["+d+"])}");return a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+c.map((function(e){return"shape["+e+"]"})).join(",")+","+c.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",a.join("\n"))(i[t],s)}var i={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};return kn=function(e,n,s,a){if(void 0===e)return(0,i.array[0])([]);"number"==typeof e&&(e=[e]),void 0===n&&(n=[e.length]);var c=n.length;if(void 0===s){s=new Array(c);for(var u=c-1,p=1;u>=0;--u)s[u]=p,p*=n[u]}if(void 0===a){a=0;for(u=0;u<c;++u)s[u]<0&&(a-=(n[u]-1)*s[u])}for(var l=function(e){if(t(e))return"buffer";if(r)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),f=i[l];f.length<=c+1;)f.push(o(l,f.length-1));return(0,f[c+1])(e,n,s,a)}}(),ns=qn(rs),ss={};function os(){if(Xn)return Wn;return Xn=1,Wn=function(e,t,r){return 0===e.length?e:t?(r||e.sort(t),function(e,t){for(var r=1,n=e.length,s=e[0],o=e[0],i=1;i<n;++i)if(o=s,t(s=e[i],o)){if(i===r){r++;continue}e[r++]=s}return e.length=r,e}(e,t)):(r||e.sort(),function(e){for(var t=1,r=e.length,n=e[0],s=e[0],o=1;o<r;++o,s=n)if(s=n,(n=e[o])!==s){if(o===t){t++;continue}e[t++]=n}return e.length=t,e}(e))},Wn}function is(){if(Qn)return Yn;Qn=1;var e=os();function t(e,t,r){var n,s,o=e.length,i=t.arrayArgs.length,a=t.indexArgs.length>0,c=[],u=[],p=0,l=0;for(n=0;n<o;++n)u.push(["i",n,"=0"].join(""));for(s=0;s<i;++s)for(n=0;n<o;++n)l=p,p=e[n],0===n?u.push(["d",s,"s",n,"=t",s,"p",p].join("")):u.push(["d",s,"s",n,"=(t",s,"p",p,"-s",l,"*t",s,"p",l,")"].join(""));for(u.length>0&&c.push("var "+u.join(",")),n=o-1;n>=0;--n)p=e[n],c.push(["for(i",n,"=0;i",n,"<s",p,";++i",n,"){"].join(""));for(c.push(r),n=0;n<o;++n){for(l=p,p=e[n],s=0;s<i;++s)c.push(["p",s,"+=d",s,"s",n].join(""));a&&(n>0&&c.push(["index[",l,"]-=s",l].join("")),c.push(["++index[",p,"]"].join(""))),c.push("}")}return c.join("\n")}function r(e,t,r){for(var n=e.body,s=[],o=[],i=0;i<e.args.length;++i){var a=e.args[i];if(!(a.count<=0)){var c=new RegExp(a.name,"g"),u="",p=t.arrayArgs.indexOf(i);switch(t.argTypes[i]){case"offset":var l=t.offsetArgIndex.indexOf(i);p=t.offsetArgs[l].array,u="+q"+l;case"array":u="p"+p+u;var f="l"+i,_="a"+p;if(0===t.arrayBlockIndices[p])1===a.count?"generic"===r[p]?a.lvalue?(s.push(["var ",f,"=",_,".get(",u,")"].join("")),n=n.replace(c,f),o.push([_,".set(",u,",",f,")"].join(""))):n=n.replace(c,[_,".get(",u,")"].join("")):n=n.replace(c,[_,"[",u,"]"].join("")):"generic"===r[p]?(s.push(["var ",f,"=",_,".get(",u,")"].join("")),n=n.replace(c,f),a.lvalue&&o.push([_,".set(",u,",",f,")"].join(""))):(s.push(["var ",f,"=",_,"[",u,"]"].join("")),n=n.replace(c,f),a.lvalue&&o.push([_,"[",u,"]=",f].join("")));else{for(var h=[a.name],d=[u],y=0;y<Math.abs(t.arrayBlockIndices[p]);y++)h.push("\\s*\\[([^\\]]+)\\]"),d.push("$"+(y+1)+"*t"+p+"b"+y);if(c=new RegExp(h.join(""),"g"),u=d.join("+"),"generic"===r[p])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(c,[_,"[",u,"]"].join(""))}break;case"scalar":n=n.replace(c,"Y"+t.scalarArgs.indexOf(i));break;case"index":n=n.replace(c,"index");break;case"shape":n=n.replace(c,"shape")}}}return[s.join("\n"),n,o.join("\n")].join("\n").trim()}function n(e){for(var t=new Array(e.length),r=!0,n=0;n<e.length;++n){var s=e[n],o=s.match(/\d+/);o=o?o[0]:"",0===s.charAt(0)?t[n]="u"+s.charAt(1)+o:t[n]=s.charAt(0)+o,n>0&&(r=r&&t[n]===t[n-1])}return r?t[0]:t.join("")}return Yn=function(s,o){for(var i=o[1].length-Math.abs(s.arrayBlockIndices[0])|0,a=new Array(s.arrayArgs.length),c=new Array(s.arrayArgs.length),u=0;u<s.arrayArgs.length;++u)c[u]=o[2*u],a[u]=o[2*u+1];var p=[],l=[],f=[],_=[],h=[];for(u=0;u<s.arrayArgs.length;++u){s.arrayBlockIndices[u]<0?(f.push(0),_.push(i),p.push(i),l.push(i+s.arrayBlockIndices[u])):(f.push(s.arrayBlockIndices[u]),_.push(s.arrayBlockIndices[u]+i),p.push(0),l.push(s.arrayBlockIndices[u]));for(var d=[],y=0;y<a[u].length;y++)f[u]<=a[u][y]&&a[u][y]<_[u]&&d.push(a[u][y]-f[u]);h.push(d)}var m=["SS"],g=["'use strict'"],b=[];for(y=0;y<i;++y)b.push(["s",y,"=SS[",y,"]"].join(""));for(u=0;u<s.arrayArgs.length;++u){m.push("a"+u),m.push("t"+u),m.push("p"+u);for(y=0;y<i;++y)b.push(["t",u,"p",y,"=t",u,"[",f[u]+y,"]"].join(""));for(y=0;y<Math.abs(s.arrayBlockIndices[u]);++y)b.push(["t",u,"b",y,"=t",u,"[",p[u]+y,"]"].join(""))}for(u=0;u<s.scalarArgs.length;++u)m.push("Y"+u);if(s.shapeArgs.length>0&&b.push("shape=SS.slice(0)"),s.indexArgs.length>0){var T=new Array(i);for(u=0;u<i;++u)T[u]="0";b.push(["index=[",T.join(","),"]"].join(""))}for(u=0;u<s.offsetArgs.length;++u){var A=s.offsetArgs[u],E=[];for(y=0;y<A.offset.length;++y)0!==A.offset[y]&&(1===A.offset[y]?E.push(["t",A.array,"p",y].join("")):E.push([A.offset[y],"*t",A.array,"p",y].join("")));0===E.length?b.push("q"+u+"=0"):b.push(["q",u,"=",E.join("+")].join(""))}var x=e([].concat(s.pre.thisVars).concat(s.body.thisVars).concat(s.post.thisVars));for((b=b.concat(x)).length>0&&g.push("var "+b.join(",")),u=0;u<s.arrayArgs.length;++u)g.push("p"+u+"|=0");s.pre.body.length>3&&g.push(r(s.pre,s,c));var I=r(s.body,s,c),R=function(e){for(var t=0,r=e[0].length;t<r;){for(var n=1;n<e.length;++n)if(e[n][t]!==e[0][t])return t;++t}return t}(h);R<i?g.push(function(e,r,n,s){for(var o=r.length,i=n.arrayArgs.length,a=n.blockSize,c=n.indexArgs.length>0,u=[],p=0;p<i;++p)u.push(["var offset",p,"=p",p].join(""));for(p=e;p<o;++p)u.push(["for(var j"+p+"=SS[",r[p],"]|0;j",p,">0;){"].join("")),u.push(["if(j",p,"<",a,"){"].join("")),u.push(["s",r[p],"=j",p].join("")),u.push(["j",p,"=0"].join("")),u.push(["}else{s",r[p],"=",a].join("")),u.push(["j",p,"-=",a,"}"].join("")),c&&u.push(["index[",r[p],"]=j",p].join(""));for(p=0;p<i;++p){for(var l=["offset"+p],f=e;f<o;++f)l.push(["j",f,"*t",p,"p",r[f]].join(""));u.push(["p",p,"=(",l.join("+"),")"].join(""))}for(u.push(t(r,n,s)),p=e;p<o;++p)u.push("}");return u.join("\n")}(R,h[0],s,I)):g.push(t(h[0],s,I)),s.post.body.length>3&&g.push(r(s.post,s,c)),s.debug&&console.log("-----Generated cwise routine for ",o,":\n"+g.join("\n")+"\n----------");var S=[s.funcName||"unnamed","_cwise_loop_",a[0].join("s"),"m",R,n(c)].join("");return new Function(["function ",S,"(",m.join(","),"){",g.join("\n"),"} return ",S].join(""))()}}function as(){if(es)return Zn;es=1;var e=function(){if(Jn)return Kn;Jn=1;var e=is();return Kn=function(t){var r=["'use strict'","var CACHED={}"],n=[],s=t.funcName+"_cwise_thunk";r.push(["return function ",s,"(",t.shimArgs.join(","),"){"].join(""));for(var o=[],i=[],a=[["array",t.arrayArgs[0],".shape.slice(",Math.max(0,t.arrayBlockIndices[0]),t.arrayBlockIndices[0]<0?","+t.arrayBlockIndices[0]+")":")"].join("")],c=[],u=[],p=0;p<t.arrayArgs.length;++p){var l=t.arrayArgs[p];n.push(["t",l,"=array",l,".dtype,","r",l,"=array",l,".order"].join("")),o.push("t"+l),o.push("r"+l),i.push("t"+l),i.push("r"+l+".join()"),a.push("array"+l+".data"),a.push("array"+l+".stride"),a.push("array"+l+".offset|0"),p>0&&(c.push("array"+t.arrayArgs[0]+".shape.length===array"+l+".shape.length+"+(Math.abs(t.arrayBlockIndices[0])-Math.abs(t.arrayBlockIndices[p]))),u.push("array"+t.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[0])+"]===array"+l+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[p])+"]"))}for(t.arrayArgs.length>1&&(r.push("if (!("+c.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),r.push("for(var shapeIndex=array"+t.arrayArgs[0]+".shape.length-"+Math.abs(t.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),r.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),r.push("}")),p=0;p<t.scalarArgs.length;++p)a.push("scalar"+t.scalarArgs[p]);return n.push(["type=[",i.join(","),"].join()"].join("")),n.push("proc=CACHED[type]"),r.push("var "+n.join(",")),r.push(["if(!proc){","CACHED[type]=proc=compile([",o.join(","),"])}","return proc(",a.join(","),")}"].join("")),t.debug&&console.log("-----Generated thunk:\n"+r.join("\n")+"\n----------"),new Function("compile",r.join("\n"))(e.bind(void 0,t))}}();function t(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}return Zn=function(r){var n=new t;n.pre=r.pre,n.body=r.body,n.post=r.post;var s=r.args.slice(0);n.argTypes=s;for(var o=0;o<s.length;++o){var i=s[o];if("array"===i||"object"==typeof i&&i.blockIndices){if(n.argTypes[o]="array",n.arrayArgs.push(o),n.arrayBlockIndices.push(i.blockIndices?i.blockIndices:0),n.shimArgs.push("array"+o),o<n.pre.args.length&&n.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<n.post.args.length&&n.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)n.scalarArgs.push(o),n.shimArgs.push("scalar"+o);else if("index"===i){if(n.indexArgs.push(o),o<n.pre.args.length&&n.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<n.body.args.length&&n.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<n.post.args.length&&n.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(n.shapeArgs.push(o),o<n.pre.args.length&&n.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<n.body.args.length&&n.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<n.post.args.length&&n.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof i||!i.offset)throw new Error("cwise: Unknown argument type "+s[o]);n.argTypes[o]="offset",n.offsetArgs.push({array:i.array,offset:i.offset}),n.offsetArgIndex.push(o)}}if(n.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(n.pre.args.length>s.length)throw new Error("cwise: Too many arguments in pre() block");if(n.body.args.length>s.length)throw new Error("cwise: Too many arguments in body() block");if(n.post.args.length>s.length)throw new Error("cwise: Too many arguments in post() block");return n.debug=!!r.printCode||!!r.debug,n.funcName=r.funcName||"cwise",n.blockSize=r.blockSize||64,e(n)}}var cs=(ts||(ts=1,function(e){var t=as(),r={body:"",args:[],thisVars:[],localVars:[]};function n(e){if(!e)return r;for(var t=0;t<e.args.length;++t){var n=e.args[t];e.args[t]=0===t?{name:n,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:n,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function s(e){for(var r=[],s=0;s<e.args.length;++s)r.push("a"+s);return new Function("P",["return function ",e.funcName,"_ndarrayops(",r.join(","),") {P(",r.join(","),");return a0}"].join(""))(function(e){return t({args:e.args,pre:n(e.pre),body:n(e.body),post:n(e.proc),funcName:e.funcName})}(e))}var o={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var t in o){var r=o[t];e[t]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:t}),e[t+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},funcName:t+"eq"}),e[t+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:t+"s"}),e[t+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},funcName:t+"seq"})}}();var i={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var t in i){var r=i[t];e[t]=s({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:t}),e[t+"eq"]=s({args:["array"],body:{args:["a"],body:"a="+r+"a"},funcName:t+"eq"})}}();var a={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var t in a){var r=a[t];e[t]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:t}),e[t+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:t+"s"}),e[t+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},funcName:t+"eq"}),e[t+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},funcName:t+"seq"})}}();var c=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var t=0;t<c.length;++t){var r=c[t];e[r]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),e[r+"eq"]=s({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},funcName:r+"eq"})}}();var u=["max","min","atan2","pow"];!function(){for(var t=0;t<u.length;++t){var r=u[t];e[r]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),e[r+"s"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),e[r+"eq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},funcName:r+"eq"}),e[r+"seq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},funcName:r+"seq"})}}();var p=["atan2","pow"];!function(){for(var t=0;t<p.length;++t){var r=p[t];e[r+"op"]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),e[r+"ops"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),e[r+"opeq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},funcName:r+"opeq"}),e[r+"opseq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},funcName:r+"opseq"})}}(),e.any=t({args:["array"],pre:r,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),e.all=t({args:["array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),e.sum=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),e.prod=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),e.norm2squared=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),e.norm2=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),e.norminf=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),e.norm1=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),e.sup=t({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.inf=t({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.argmin=t({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.argmax=t({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.random=s({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),e.assign=s({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),e.assigns=s({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),e.equals=t({args:["array","array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}(ss)),ss),us=qn(cs);function ps(e,t,r=-1){if(4===e.shape.length)return ps(e.pick(r),t,0);if(3===e.shape.length)if(3===e.shape[2])us.assign(ns(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),e),us.assigns(ns(t,[e.shape[0]*e.shape[1]],[4],3),255);else if(4===e.shape[2])us.assign(ns(t,[e.shape[0],e.shape[1],4],[4,4*e.shape[0],1]),e);else{if(1!==e.shape[2])throw new Error("[ndarray-pixels] Incompatible array shape.");us.assign(ns(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),ns(e.data,[e.shape[0],e.shape[1],3],[e.stride[0],e.stride[1],0],e.offset)),us.assigns(ns(t,[e.shape[0]*e.shape[1]],[4],3),255)}else{if(2!==e.shape.length)throw new Error("[ndarray-pixels] Incompatible array shape.");us.assign(ns(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),ns(e.data,[e.shape[0],e.shape[1],3],[e.stride[0],e.stride[1],0],e.offset)),us.assigns(ns(t,[e.shape[0]*e.shape[1]],[4],3),255)}return t}async function ls(e,t){const r=new OffscreenCanvas(e.shape[0],e.shape[1]),n=r.getContext("2d"),s=n.getImageData(0,0,r.width,r.height);return ps(e,s.data),n.putImageData(s,0,0),async function(e,t){const r=await e.convertToBlob(t),n=await r.arrayBuffer();return new Uint8Array(n)}(r,t)}async function fs(e,t){return function(e,t){if(!(e instanceof Uint8Array))throw new Error("[ndarray-pixels] Input must be Uint8Array or Buffer.");const r=new Blob([e],{type:t}),n=URL.createObjectURL(r);return new Promise(((e,t)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=function(){URL.revokeObjectURL(n);const t=new OffscreenCanvas(r.width,r.height).getContext("2d");t.drawImage(r,0,0);const s=t.getImageData(0,0,r.width,r.height);e(ns(new Uint8Array(s.data),[r.width,r.height,4],[4,4*r.width,1],0))},r.onerror=e=>{URL.revokeObjectURL(n),t(e)},r.src=n}))}(e,t)}async function _s(e,t){let r;return r="string"==typeof t?{type:t,quality:void 0}:{type:t.type,quality:t.quality},ls(e,r)}const hs=(e,t)=>{if(e<=-t||e>=t)return 0;if(e>-1.1920929e-7&&e<1.1920929e-7)return 1;const r=e*Math.PI;return Math.sin(r)/r*Math.sin(r/t)/(r/t)},ds=(e,t,r,n,s,o,i,a)=>{const c=2**a-1,u=e=>Math.round(e*c),p=s?2:3,l=1/r,f=Math.min(1,r),_=p/f,h=new i((Math.floor(2*(_+1))+2)*t);let d=0;for(let r=0;r<t;r++){const s=(r+.5)*l+n,a=Math.max(0,Math.floor(s-_)),c=Math.min(e-1,Math.ceil(s+_)),y=c-a+1,m=new o(y),g=new i(y);let b=0,T=0;for(let e=a;e<=c;e++){const t=hs((e+.5-s)*f,p);b+=t,m[T]=t,T++}let A=0;for(let e=0;e<m.length;e++){const t=m[e]/b;A+=t,g[e]=u(t)}g[t>>1]+=u(1-A);let E=0;for(;E<g.length&&0===g[E];)E++;let x=g.length-1;for(;x>0&&0===g[x];)x--;const I=x-E+1;h[d++]=a+E,h[d++]=I,h.set(g.subarray(E,x+1),d),d+=I}return h},ys=(e,t,r,n)=>{const[s,o]=e.shape,[i]=t.shape,a=2**(8*t.data.BYTES_PER_ELEMENT)-1,c=e=>e<0?0:e>a?a:e,u=2**(n-1),p=2*u;for(let n=0;n<o;n++){const s=n;let o=0;for(let a=0;a<i;a++){let i=r[o++],l=0,f=0,_=0,h=0;for(let t=r[o++];t>0;t--){const t=r[o++];l+=t*e.get(i,n,0),f+=t*e.get(i,n,1),_+=t*e.get(i,n,2),h+=t*e.get(i,n,3),i++}t.set(a,s,0,c((l+u)/p)),t.set(a,s,1,c((f+u)/p)),t.set(a,s,2,c((_+u)/p)),t.set(a,s,3,c((h+u)/p))}}};var ms,gs;function bs(e,t,r){if(3!==e.shape.length||3!==t.shape.length)throw new TypeError("Input and output must have exactly 3 dimensions (width, height and colorspace)");const[n,s]=e.shape,[o,i]=t.shape,a=o/n,c=i/s;let u,p;switch(t.dtype){case"uint8_clamped":case"uint8":u=Float32Array,p=Int16Array;break;case"uint16":case"uint32":u=Float64Array,p=Int32Array;break;default:throw TypeError(`Unsupported data type ${t.dtype}`)}const l=7*p.BYTES_PER_ELEMENT,f=ds(n,o,a,0,r===ms.LANCZOS_2,u,p,l),_=ds(s,i,c,0,r===ms.LANCZOS_2,u,p,l),h=ns(new t.data.constructor(o*s*4),[s,o,4]),d=h.transpose(1,0),y=t.transpose(1,0);ys(e,d,f,l),ys(h,y,_,l)}function Ts(){return Ts=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ts.apply(null,arguments)}(gs=ms||(ms={}))[gs.LANCZOS_3=3]="LANCZOS_3",gs[gs.LANCZOS_2=2]="LANCZOS_2";const{POINTS:As,LINES:Es,LINE_STRIP:xs,LINE_LOOP:Is,TRIANGLES:Rs,TRIANGLE_STRIP:Ss,TRIANGLE_FAN:Ms}=de.Mode;function Ns(e,t){return Object.defineProperty(t,"name",{value:e}),t}function ws(e,t){const r=Ts({},e);for(const e in t)void 0!==t[e]&&(r[e]=t[e]);return r}async function vs(e,t,r){if(!e)return null;const n=e.getImage();if(!n)return null;const s=await fs(n,e.getMimeType());for(let e=0;e<s.shape[0];++e)for(let t=0;t<s.shape[1];++t)r(s,e,t);const o=await _s(s,"image/png");return t.setImage(o).setMimeType("image/png")}function Os(e){const t=e.getIndices(),r=e.getAttribute("POSITION");switch(e.getMode()){case de.Mode.POINTS:return t?t.getCount():r.getCount();case de.Mode.LINES:return t?t.getCount()/2:r.getCount()/2;case de.Mode.LINE_LOOP:return t?t.getCount():r.getCount();case de.Mode.LINE_STRIP:return t?t.getCount()-1:r.getCount()-1;case de.Mode.TRIANGLES:return t?t.getCount()/3:r.getCount()/3;case de.Mode.TRIANGLE_STRIP:case de.Mode.TRIANGLE_FAN:return t?t.getCount()-2:r.getCount()-2;default:throw new Error("Unexpected mode: "+e.getMode())}}const Cs=new Intl.NumberFormat(void 0,{maximumFractionDigits:0});function Ds(e){return Cs.format(e)}function js(e,t){return`${Ds(e)} → ${Ds(t)} (${function(e,t,r=2){return(e>t?"–":"+")+(Math.abs(e-t)/e*100).toFixed(r)+"%"}(e,t)})`}function Ps(e){const t=[];for(const r of e.listAttributes())t.push(r);for(const r of e.listTargets())for(const e of r.listAttributes())t.push(e);return Array.from(new Set(t))}function Fs(e,t){if(null==e&&null==t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Us(e,t){return e.createAccessor(t.getName()).setArray(t.getArray()).setType(t.getType()).setBuffer(t.getBuffer()).setNormalized(t.getNormalized()).setSparse(t.getSparse())}function Ls(e,t=e){const r=Gs(e,t);for(let e=0;e<r.length;e++)r[e]=e;return r}function Gs(e,t=e){return t<=65534?new Uint16Array(e):new Uint32Array(e)}function Bs(e){for(const t in e)return!1;return!0}function Vs(e){const t=Ee.fromGraph(e.getGraph()),r=e.getMaterial();return`${t.getRoot().listMaterials().indexOf(r)}|${Xs[e.getMode()]}|${!!e.getIndices()}|${e.listSemantics().sort().map((t=>{const r=e.getAttribute(t);return`${t}:${r.getElementSize()}:${r.getComponentType()}`})).join("+")}|${e.listTargets().map((t=>t.listSemantics().sort().map((t=>{const r=e.getAttribute(t);return`${t}:${r.getElementSize()}:${r.getComponentType()}`})).join("+"))).join("~")}`}function ks(e,t){const[r,n]=t,[s,o]=e;if(s<=r&&o<=n)return e;let i=s,a=o;return i>r&&(a=Math.floor(a*(r/i)),i=r),a>n&&(i=Math.floor(i*(n/a)),a=n),[i,a]}function zs(e,t){if(Hs(e[0])&&Hs(e[1]))return e;switch(t){case"nearest-pot":return e.map(qs);case"ceil-pot":return e.map(Ws);case"floor-pot":return e.map($s)}}function Hs(e){return e<=2||!(e&e-1)&&0!==e}function qs(e){if(e<=4)return 4;const t=$s(e),r=Ws(e);return r-e>e-t?t:r}function $s(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Ws(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}const Xs={[As]:As,[Es]:Es,[xs]:Es,[Is]:Es,[Rs]:Rs,[Ss]:Rs,[Ms]:Rs};function Ys(e){const t=function(e){const t=new Set;let r,n=e;for(;r=n.getParentNode();){if(t.has(r))throw new Error("Circular dependency in scene graph.");t.add(r),n=r}return n.listParents().filter((e=>e instanceof ge))}(e),r=e.getParentNode();if(!r)return e;e.setMatrix(e.getWorldMatrix()),r.removeChild(e);for(const r of t)r.addChild(e);return e}var Qs="undefined"!=typeof Float32Array?Float32Array:Array;function Ks(e,t){var r=t[0],n=t[1],s=t[2],o=t[3],i=t[4],a=t[5],c=t[6],u=t[7],p=t[8],l=t[9],f=t[10],_=t[11],h=t[12],d=t[13],y=t[14],m=t[15],g=r*a-n*i,b=r*c-s*i,T=r*u-o*i,A=n*c-s*a,E=n*u-o*a,x=s*u-o*c,I=p*d-l*h,R=p*y-f*h,S=p*m-_*h,M=l*y-f*d,N=l*m-_*d,w=f*m-_*y,v=g*w-b*N+T*M+A*S-E*R+x*I;return v?(v=1/v,e[0]=(a*w-c*N+u*M)*v,e[1]=(s*N-n*w-o*M)*v,e[2]=(d*x-y*E+m*A)*v,e[3]=(f*E-l*x-_*A)*v,e[4]=(c*S-i*w-u*R)*v,e[5]=(r*w-s*S+o*R)*v,e[6]=(y*T-h*x-m*b)*v,e[7]=(p*x-f*T+_*b)*v,e[8]=(i*N-a*S+u*I)*v,e[9]=(n*S-r*N-o*I)*v,e[10]=(h*E-d*T+m*g)*v,e[11]=(l*T-p*E-_*g)*v,e[12]=(a*R-i*M-c*I)*v,e[13]=(r*M-n*R+s*I)*v,e[14]=(d*b-h*A-y*g)*v,e[15]=(p*A-l*b+f*g)*v,e):null}function Js(e,t,r){var n=t[0],s=t[1],o=t[2],i=t[3],a=t[4],c=t[5],u=t[6],p=t[7],l=t[8],f=t[9],_=t[10],h=t[11],d=t[12],y=t[13],m=t[14],g=t[15],b=r[0],T=r[1],A=r[2],E=r[3];return e[0]=b*n+T*a+A*l+E*d,e[1]=b*s+T*c+A*f+E*y,e[2]=b*o+T*u+A*_+E*m,e[3]=b*i+T*p+A*h+E*g,b=r[4],T=r[5],A=r[6],E=r[7],e[4]=b*n+T*a+A*l+E*d,e[5]=b*s+T*c+A*f+E*y,e[6]=b*o+T*u+A*_+E*m,e[7]=b*i+T*p+A*h+E*g,b=r[8],T=r[9],A=r[10],E=r[11],e[8]=b*n+T*a+A*l+E*d,e[9]=b*s+T*c+A*f+E*y,e[10]=b*o+T*u+A*_+E*m,e[11]=b*i+T*p+A*h+E*g,b=r[12],T=r[13],A=r[14],E=r[15],e[12]=b*n+T*a+A*l+E*d,e[13]=b*s+T*c+A*f+E*y,e[14]=b*o+T*u+A*_+E*m,e[15]=b*i+T*p+A*h+E*g,e}function Zs(){var e=new Qs(3);return Qs!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function eo(e,t){var r=t[0],n=t[1],s=t[2],o=r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function to(e,t,r){var n=t[0],s=t[1],o=t[2],i=r[3]*n+r[7]*s+r[11]*o+r[15];return i=i||1,e[0]=(r[0]*n+r[4]*s+r[8]*o+r[12])/i,e[1]=(r[1]*n+r[5]*s+r[9]*o+r[13])/i,e[2]=(r[2]*n+r[6]*s+r[10]*o+r[14])/i,e}function ro(e,t,r){var n=t[0],s=t[1],o=t[2];return e[0]=n*r[0]+s*r[3]+o*r[6],e[1]=n*r[1]+s*r[4]+o*r[7],e[2]=n*r[2]+s*r[5]+o*r[8],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var no=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e};!function(){var e=Zs()}();const so="dedup",oo={keepUniqueNames:!1,propertyTypes:[f.ACCESSOR,f.MESH,f.TEXTURE,f.MATERIAL,f.SKIN]};function io(e=oo){const t=ws(oo,e),r=new Set(t.propertyTypes);for(const e of t.propertyTypes)if(!oo.propertyTypes.includes(e))throw new Error(`${so}: Unsupported deduplication on type "${e}".`);return Ns(so,(e=>{const n=e.getLogger();r.has(f.ACCESSOR)&&function(e){const t=e.getLogger(),r=new Map,n=new Map,s=new Map,o=new Map,i=e.getRoot().listMeshes();i.forEach((e=>{e.listPrimitives().forEach((e=>{e.listAttributes().forEach((e=>a(e,n))),a(e.getIndices(),r)}))}));for(const t of e.getRoot().listAnimations())for(const e of t.listSamplers())a(e.getInput(),s),a(e.getOutput(),o);function a(e,t){if(!e)return;const r=[e.getCount(),e.getType(),e.getComponentType(),e.getNormalized(),e.getSparse()].join(":");let n=t.get(r);n||t.set(r,n=new Set),n.add(e)}function c(e,t){for(let r=0;r<e.length;r++){const n=e[r],s=M.toView(n.getArray());if(!t.has(n))for(let o=r+1;o<e.length;o++){const r=e[o];t.has(r)||M.equals(s,M.toView(r.getArray()))&&t.set(r,n)}}}let u=0;const p=new Map;for(const e of[n,r,s,o])for(const t of e.values())u+=t.size,c(Array.from(t),p);t.debug(`${so}: Merged ${p.size} of ${u} accessors.`),i.forEach((e=>{e.listPrimitives().forEach((e=>{e.listAttributes().forEach((t=>{p.has(t)&&e.swap(t,p.get(t))}));const t=e.getIndices();t&&p.has(t)&&e.swap(t,p.get(t))}))}));for(const t of e.getRoot().listAnimations())for(const e of t.listSamplers()){const t=e.getInput(),r=e.getOutput();t&&p.has(t)&&e.swap(t,p.get(t)),r&&p.has(r)&&e.swap(r,p.get(r))}Array.from(p.keys()).forEach((e=>e.dispose()))}(e),r.has(f.TEXTURE)&&function(e,t){const r=e.getLogger(),n=e.getRoot(),s=n.listTextures(),o=new Map;for(let e=0;e<s.length;e++){const r=s[e],n=r.getImage();if(!o.has(r))for(let i=e+1;i<s.length;i++){const e=s[i],a=e.getImage();if(o.has(e))continue;if(r.getMimeType()!==e.getMimeType())continue;if(t.keepUniqueNames&&r.getName()!==e.getName())continue;const c=r.getSize(),u=e.getSize();c&&u&&(c[0]===u[0]&&c[1]===u[1]&&n&&a&&M.equals(n,a)&&o.set(e,r))}}r.debug(`${so}: Merged ${o.size} of ${n.listTextures().length} textures.`),Array.from(o.entries()).forEach((([e,t])=>{e.listParents().forEach((r=>{r instanceof Ae||r.swap(e,t)})),e.dispose()}))}(e,t),r.has(f.MATERIAL)&&function(e,t){const r=e.getLogger(),n=e.getRoot(),s=n.listMaterials(),o=new Map,i=new Map,a=new Set;t.keepUniqueNames||a.add("name");for(let e=0;e<s.length;e++){const t=s[e];if(!o.has(t)&&!co(t,i))for(let r=e+1;r<s.length;r++){const e=s[r];o.has(e)||(co(e,i)||t.equals(e,a)&&o.set(e,t))}}r.debug(`${so}: Merged ${o.size} of ${s.length} materials.`),Array.from(o.entries()).forEach((([e,t])=>{e.listParents().forEach((r=>{r instanceof Ae||r.swap(e,t)})),e.dispose()}))}(e,t),r.has(f.MESH)&&function(e,t){const r=e.getLogger(),n=e.getRoot(),s=new Map;n.listAccessors().forEach(((e,t)=>s.set(e,t))),n.listMaterials().forEach(((e,t)=>s.set(e,t)));const o=n.listMeshes().length,i=new Map;for(const e of n.listMeshes()){const r=[];for(const t of e.listPrimitives())r.push(ao(t,s));let n="";if(t.keepUniqueNames&&(n+=e.getName()+";"),n+=r.join(";"),i.has(n)){const t=i.get(n);e.listParents().forEach((r=>{r.propertyType!==f.ROOT&&r.swap(e,t)})),e.dispose()}else i.set(n,e)}r.debug(`${so}: Merged ${o-i.size} of ${o} meshes.`)}(e,t),r.has(f.SKIN)&&function(e,t){const r=e.getLogger(),n=e.getRoot(),s=n.listSkins(),o=new Map,i=new Set(["joints"]);t.keepUniqueNames||i.add("name");for(let e=0;e<s.length;e++){const t=s[e];if(!o.has(t))for(let r=e+1;r<s.length;r++){const e=s[r];o.has(e)||t.equals(e,i)&&Fs(t.listJoints(),e.listJoints())&&o.set(e,t)}}r.debug(`${so}: Merged ${o.size} of ${s.length} skins.`),Array.from(o.entries()).forEach((([e,t])=>{e.listParents().forEach((r=>{r instanceof Ae||r.swap(e,t)})),e.dispose()}))}(e,t),n.debug(`${so}: Complete.`)}))}function ao(e,t){const r=[];for(const n of e.listSemantics()){const s=e.getAttribute(n);r.push(n+":"+t.get(s))}if(e instanceof de){const n=e.getIndices();n&&r.push("indices:"+t.get(n));const s=e.getMaterial();s&&r.push("material:"+t.get(s)),r.push("mode:"+e.getMode());for(const n of e.listTargets())r.push("target:"+ao(n,t))}return r.join(",")}function co(e,t){if(t.has(e))return t.get(e);const r=e.getGraph(),n=new Set,s=r.listParentEdges(e);for(;s.length>0;){const o=s.pop();if(!0===o.getAttributes().modifyChild)return t.set(e,!0),!0;const i=o.getChild();if(!n.has(i))for(const e of r.listChildEdges(i))s.push(e)}return t.set(e,!1),!1}function uo(){var e=new Qs(4);return Qs!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}var po=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},lo=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},fo=function(e){var t=e[0],r=e[1],n=e[2],s=e[3];return Math.hypot(t,r,n,s)};!function(){var e=uo()}();const _o=/color|emissive|diffuse/i;const ho="prune",yo=3/255,mo={propertyTypes:[f.NODE,f.SKIN,f.MESH,f.CAMERA,f.PRIMITIVE,f.PRIMITIVE_TARGET,f.ANIMATION,f.MATERIAL,f.TEXTURE,f.ACCESSOR,f.BUFFER],keepLeaves:!1,keepAttributes:!1,keepIndices:!1,keepSolidTextures:!1,keepExtras:!1};function go(e=mo){const t=ws(mo,e),r=new Set(t.propertyTypes),n=t.keepExtras;return Ns(ho,(async e=>{const s=e.getLogger(),o=e.getRoot(),i=e.getGraph(),a=new bo,c=e=>a.dispose(e.target);if(i.addEventListener("node:dispose",c),r.has(f.MESH))for(const e of o.listMeshes())e.listPrimitives().length>0||e.dispose();if(r.has(f.NODE)){if(!t.keepLeaves)for(const e of o.listScenes())Eo(i,e,n);for(const e of o.listNodes())To(e,n)}if(r.has(f.SKIN))for(const e of o.listSkins())To(e,n);if(r.has(f.MESH))for(const e of o.listMeshes())To(e,n);if(r.has(f.CAMERA))for(const e of o.listCameras())To(e,n);if(r.has(f.PRIMITIVE)&&Ao(i,f.PRIMITIVE,n),r.has(f.PRIMITIVE_TARGET)&&Ao(i,f.PRIMITIVE_TARGET,n),!t.keepAttributes&&r.has(f.ACCESSOR)){const t=new Map;for(const r of o.listMeshes())for(const n of r.listPrimitives()){const r=n.getMaterial();if(!r)continue;const s=Ro(n,So(e,n,r));xo(n,s),n.listTargets().forEach((e=>xo(e,s))),t.has(r)?t.get(r).add(n):t.set(r,new Set([n]))}for(const[e,r]of t)Mo(e,Array.from(r))}if(!t.keepIndices&&r.has(f.ACCESSOR))for(const e of o.listMeshes())for(const t of e.listPrimitives())Io(t);if(r.has(f.ANIMATION))for(const e of o.listAnimations()){for(const t of e.listChannels())t.getTargetNode()||t.dispose();if(e.listChannels().length)e.listSamplers().forEach((e=>To(e,n)));else{const t=e.listSamplers();To(e,n),t.forEach((e=>To(e,n)))}}if(r.has(f.MATERIAL)&&o.listMaterials().forEach((e=>To(e,n))),r.has(f.TEXTURE)&&(o.listTextures().forEach((e=>To(e,n))),t.keepSolidTextures||await async function(e){const t=e.getRoot(),r=e.getGraph(),n=e.getLogger(),s=t.listTextures(),o=s.map((async e=>{var s;const o=await async function(e){const t=await async function(e){try{return await fs(e.getImage(),e.getMimeType())}catch(e){return null}}(e);if(!t)return null;const r=[1/0,1/0,1/0,1/0],n=[-1/0,-1/0,-1/0,-1/0],s=[0,0,0,0],[o,i]=t.shape;for(let e=0;e<o;e++){for(let s=0;s<i;s++)for(let o=0;o<4;o++)r[o]=Math.min(r[o],t.get(e,s,o)),n[o]=Math.max(n[o],t.get(e,s,o));if(fo(po(s,n,r))/255>yo)return null}return function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}(s,function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}(s,n,r),.5/255)}(e);if(!o)return;"srgb"===function(e){return e.getGraph().listParentEdges(e).some((e=>e.getAttributes().isColor||_o.test(e.getName())))?"srgb":null}(e)&&N.convertSRGBToLinear(o,o);const i=e.getName()||e.getURI(),a=null==(s=e.getSize())?void 0:s.join("x"),c=function(e){const t=Ee.fromGraph(e.getGraph()).getRoot(),r=e.getGraph().listParentEdges(e).filter((e=>e.getParent()!==t)).map((e=>e.getName()));return Array.from(new Set(r))}(e);for(const s of r.listParentEdges(e)){const e=s.getParent();e!==t&&No(e,o,s.getName(),n)&&s.dispose()}1===e.listParents().length&&(e.dispose(),n.debug(`${ho}: Removed solid-color texture "${i}" (${a}px ${c.join(", ")})`))}));await Promise.all(o)}(e)),r.has(f.ACCESSOR)&&o.listAccessors().forEach((e=>To(e,n))),r.has(f.BUFFER)&&o.listBuffers().forEach((e=>To(e,n))),i.removeEventListener("node:dispose",c),a.empty())s.debug(`${ho}: No unused properties found.`);else{const e=a.entries().map((([e,t])=>`${e} (${t})`)).join(", ");s.info(`${ho}: Removed types... ${e}`)}s.debug(`${ho}: Complete.`)}))}class bo{constructor(){this.disposed={}}empty(){for(const e in this.disposed)return!1;return!0}entries(){return Object.entries(this.disposed)}dispose(e){this.disposed[e.propertyType]=this.disposed[e.propertyType]||0,this.disposed[e.propertyType]++}}function To(e,t){const r=e.listParents().filter((e=>!(e instanceof Ae||e instanceof re))),n=t&&!Bs(e.getExtras());r.length||n||e.dispose()}function Ao(e,t,r){for(const n of e.listEdges()){const e=n.getParent();e.propertyType===t&&To(e,r)}}function Eo(e,t,r){if(t.listChildren().forEach((t=>Eo(e,t,r))),t instanceof ge)return;const n=e.listParentEdges(t).some((e=>{const t=e.getParent().propertyType;return t!==f.ROOT&&t!==f.SCENE&&t!==f.NODE})),s=0===e.listChildren(t).length,o=r&&!Bs(t.getExtras());!s||n||o||t.dispose()}function xo(e,t){for(const r of t)e.setAttribute(r,null)}function Io(e){const t=e.getIndices(),r=t&&t.getArray(),n=e.listAttributes()[0];if(r&&n&&t.getCount()===n.getCount()){for(let e=0,t=r.length;e<t;e++)if(e!==r[e])return;e.setIndices(null)}}function Ro(e,t){const r=[];for(const n of e.listSemantics())("NORMAL"!==n||t.has(n))&&("TANGENT"!==n||t.has(n))?(n.startsWith("TEXCOORD_")&&!t.has(n)||n.startsWith("COLOR_")&&"COLOR_0"!==n)&&r.push(n):r.push(n);return r}function So(e,t,r,n=new Set){const s=e.getGraph().listChildEdges(r),o=new Set;for(const e of s)e.getChild()instanceof Te&&o.add(e.getName());for(const r of s){const s=r.getName(),i=r.getChild();i instanceof ae&&o.has(s.replace(/Info$/,""))&&n.add(`TEXCOORD_${i.getTexCoord()}`),i instanceof Te&&s.match(/normalTexture/i)&&n.add("TANGENT"),i instanceof ie&&So(e,t,i,n)}const i=r instanceof fe&&!r.getExtension("KHR_materials_unlit"),a=t.getMode()===de.Mode.POINTS;return i&&!a&&n.add("NORMAL"),n}function Mo(e,t){const r=function(e){const t=e.getGraph(),r=new Set,n=new Set;return function e(s){const o=new Set;for(const e of t.listChildEdges(s))e.getChild()instanceof Te&&o.add(e.getName()+"Info");for(const i of t.listChildEdges(s)){const t=i.getChild();r.has(t)||(r.add(t),t instanceof ae&&o.has(i.getName())?n.add(t):t instanceof ie&&e(t))}}(e),Array.from(n)}(e),n=new Set(r.map((e=>e.getTexCoord()))),s=Array.from(n).sort(),o=new Map(s.map(((e,t)=>[e,t]))),i=new Map(s.map(((e,t)=>[`TEXCOORD_${e}`,`TEXCOORD_${t}`])));for(const e of r){const t=e.getTexCoord();e.setTexCoord(o.get(t))}for(const e of t){const t=e.listSemantics().filter((e=>e.startsWith("TEXCOORD_"))).sort();a(e,t),e.listTargets().forEach((e=>a(e,t)))}function a(e,t){for(const r of t){const t=e.getAttribute(r);if(!t)continue;const n=i.get(r);n!==r&&(e.setAttribute(n,t),e.setAttribute(r,null))}}}function No(e,t,r,n){if(e instanceof fe)switch(r){case"baseColorTexture":return e.setBaseColorFactor(lo(t,t,e.getBaseColorFactor())),!0;case"emissiveTexture":return e.setEmissiveFactor(no([0,0,0],t.slice(0,3),e.getEmissiveFactor())),!0;case"occlusionTexture":return Math.abs(t[0]-1)<=yo;case"metallicRoughnessTexture":return e.setRoughnessFactor(t[1]*e.getRoughnessFactor()),e.setMetallicFactor(t[2]*e.getMetallicFactor()),!0;case"normalTexture":return fo(po(uo(),t,[.5,.5,1,1]))<=yo}return n.warn(`${ho}: Detected single-color ${r} texture. Pruning ${r} not yet supported.`),!1}const wo=2**32-1;class vo{constructor(e){this.attributes=[],this.u8=void 0,this.u32=void 0;let t=0;for(const r of Ps(e))t+=this._initAttribute(r);this.u8=new Uint8Array(t),this.u32=new Uint32Array(this.u8.buffer)}_initAttribute(e){const t=e.getArray(),r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=e.getElementSize()*e.getComponentSize(),s=M.padNumber(n);return this.attributes.push({u8:r,byteStride:n,paddedByteStride:s}),s}hash(e){let t=0;for(const{u8:r,byteStride:n,paddedByteStride:s}of this.attributes){for(let o=0;o<s;o++)this.u8[t+o]=o<n?r[e*n+o]:0;t+=s}return function(e,t){const r=1540483477,n=24;for(let s=0,o=t.length;s<o;s++){let o=t[s];o=Math.imul(o,r)>>>0,o=(o^o>>n)>>>0,o=Math.imul(o,r)>>>0,e=((e=Math.imul(e,r)>>>0)^o)>>>0}return e}(0,this.u32)}equal(e,t){for(const{u8:r,byteStride:n}of this.attributes)for(let s=0;s<n;s++)if(r[e*n+s]!==r[t*n+s])return!1;return!0}}function Oo(e,t,r,n,s=4294967295){const o=t-1;let i=r.hash(n)&o;for(let t=0;t<=o;t++){const a=e[i];if(a===s||r.equal(a,n))return i;i=i+t+1&o}throw new Error("Hash table full.")}var Co;function Do(e,t){const r=e.getAttribute("POSITION"),n=e.getIndices();switch(t){case Co.RENDER:return n?n.getCount():r.getCount();case Co.RENDER_CACHED:return n?new Set(n.getArray()).size:r.getCount();case Co.UPLOAD_NAIVE:case Co.UPLOAD:return r.getCount();case Co.DISTINCT:case Co.DISTINCT_POSITION:return function(e){throw new Error(`Not implemented: ${e}`)}(t);case Co.UNUSED:return n?r.getCount()-new Set(n.getArray()).size:0;default:return function(e){throw new Error(`Unexpected value: ${e}`)}(t)}}function jo(e,t,r){const n=Ee.fromGraph(e.getGraph());t&&r||([t,r]=function(e){const t=Do(e,Co.UPLOAD),r=e.getIndices(),n=r?r.getArray():null;if(!r||!n)return[Ls(t,1e6),t];const s=new Uint32Array(t).fill(wo);let o=0;for(let e=0;e<n.length;e++){const t=n[e];s[t]===wo&&(s[t]=o++)}return[s,o]}(e));const s=e.getIndices(),o=s?s.getArray():null,i=Do(e,Co.RENDER),a=n.createAccessor(),c=i,u=Gs(c,r);for(let e=0;e<c;e++)u[e]=t[o?o[e]:e];e.setIndices(a.setArray(u));const p=Ps(e);for(const o of e.listAttributes()){const i=Us(n,o);Po(o,s,t,i,r),e.swap(o,i)}for(const o of e.listTargets())for(const e of o.listAttributes()){const i=Us(n,e);Po(e,s,t,i,r),o.swap(e,i)}s&&1===s.listParents().length&&s.dispose();for(const e of p)1===e.listParents().length&&e.dispose();return e}function Po(e,t,r,n,s){const o=e.getElementSize(),i=e.getArray(),a=t?t.getArray():null,c=t?t.getCount():e.getCount(),u=new i.constructor(s*o),p=new Uint8Array(s);for(let e=0;e<c;e++){const t=a?a[e]:e,n=r[t];if(!p[n]){for(let e=0;e<o;e++)u[n*o+e]=i[t*o+e];p[n]=1}}return n.setArray(u)}!function(e){e.RENDER="render",e.RENDER_CACHED="render-cached",e.UPLOAD="upload",e.UPLOAD_NAIVE="upload-naive",e.DISTINCT="distinct",e.DISTINCT_POSITION="distinct-position",e.UNUSED="unused"}(Co||(Co={}));const Fo="weld",Uo={overwrite:!0,cleanup:!0};function Lo(e=Uo){const t=ws(Uo,e);return Ns(Fo,(async e=>{const r=e.getLogger();for(const r of e.getRoot().listMeshes()){for(const e of r.listPrimitives())Go(e,t),0===Do(e,Co.RENDER)&&e.dispose();0===r.listPrimitives().length&&r.dispose()}t.cleanup&&await e.transform(go({propertyTypes:[f.ACCESSOR,f.NODE],keepAttributes:!0,keepIndices:!0,keepLeaves:!1}),io({propertyTypes:[f.ACCESSOR]})),r.debug(`${Fo}: Complete.`)}))}function Go(e,t=Uo){const r=e.getGraph(),n=Ee.fromGraph(r).getLogger(),s=Ts({},Uo,t);if(e.getIndices()&&!s.overwrite)return;if(e.getMode()===de.Mode.POINTS)return;const o=e.getAttribute("POSITION").getCount(),i=e.getIndices(),a=null==i?void 0:i.getArray(),c=i?i.getCount():o,u=new vo(e),p=Ws(o+o/4),l=new Uint32Array(p).fill(wo),f=new Uint32Array(o).fill(wo);let _=0;for(let e=0;e<c;e++){const t=a?a[e]:e;if(f[t]!==wo)continue;const r=Oo(l,p,u,t,wo),n=l[r];n===wo?(l[r]=t,f[t]=_++):f[t]=f[n]}n.debug(`${Fo}: ${js(o,_)} vertices.`),jo(e,f,_)}const{FLOAT:Bo}=ee.ComponentType;function Vo(e,t){const r=e.getAttribute("POSITION");r&&ko(t,r);const n=e.getAttribute("NORMAL");n&&zo(t,n);const s=e.getAttribute("TANGENT");s&&Ho(t,s);for(const r of e.listTargets()){const e=r.getAttribute("POSITION");e&&ko(t,e);const n=r.getAttribute("NORMAL");n&&zo(t,n);const s=r.getAttribute("TANGENT");s&&Ho(t,s)}(function(e){var t=e[0],r=e[1],n=e[2],s=e[3],o=e[4],i=e[5],a=e[6],c=e[7],u=e[8],p=e[9],l=e[10],f=e[11],_=e[12],h=e[13],d=e[14],y=e[15];return(t*i-r*o)*(l*y-f*d)-(t*a-n*o)*(p*y-f*h)+(t*c-s*o)*(p*d-l*h)+(r*a-n*i)*(u*y-f*_)-(r*c-s*i)*(u*d-l*_)+(n*c-s*a)*(u*h-p*_)})(t)<0&&function(e){if(e.getMode()!==de.Mode.TRIANGLES)return;e.getIndices()||Go(e);const t=e.getIndices();for(let e=0,r=t.getCount();e<r;e+=3){const r=t.getScalar(e),n=t.getScalar(e+2);t.setScalar(e,n),t.setScalar(e+2,r)}}(e)}function ko(e,t){const r=t.getComponentType(),n=t.getNormalized(),s=t.getArray(),o=r===Bo?s:new Float32Array(s.length),i=Zs();for(let a=0,c=t.getCount();a<c;a++)n?(i[0]=L.decodeNormalizedInt(s[3*a],r),i[1]=L.decodeNormalizedInt(s[3*a+1],r),i[2]=L.decodeNormalizedInt(s[3*a+2],r)):(i[0]=s[3*a],i[1]=s[3*a+1],i[2]=s[3*a+2]),to(i,i,e),o[3*a]=i[0],o[3*a+1]=i[1],o[3*a+2]=i[2];t.setArray(o).setNormalized(!1)}function zo(e,t){const r=t.getArray(),n=t.getNormalized(),s=t.getComponentType(),o=function(){var e=new Qs(9);return Qs!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}();!function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]}(o,e),function(e,t){var r=t[0],n=t[1],s=t[2],o=t[3],i=t[4],a=t[5],c=t[6],u=t[7],p=t[8],l=p*i-a*u,f=-p*o+a*c,_=u*o-i*c,h=r*l+n*f+s*_;h&&(h=1/h,e[0]=l*h,e[1]=(-p*n+s*u)*h,e[2]=(a*n-s*i)*h,e[3]=f*h,e[4]=(p*r-s*c)*h,e[5]=(-a*r+s*o)*h,e[6]=_*h,e[7]=(-u*r+n*c)*h,e[8]=(i*r-n*o)*h)}(o,o),function(e,t){if(e===t){var r=t[1],n=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(o,o);const i=Zs();for(let e=0,a=t.getCount();e<a;e++)n?(i[0]=L.decodeNormalizedInt(r[3*e],s),i[1]=L.decodeNormalizedInt(r[3*e+1],s),i[2]=L.decodeNormalizedInt(r[3*e+2],s)):(i[0]=r[3*e],i[1]=r[3*e+1],i[2]=r[3*e+2]),ro(i,i,o),eo(i,i),n?(r[3*e]=L.decodeNormalizedInt(i[0],s),r[3*e+1]=L.decodeNormalizedInt(i[1],s),r[3*e+2]=L.decodeNormalizedInt(i[2],s)):(r[3*e]=i[0],r[3*e+1]=i[1],r[3*e+2]=i[2])}function Ho(e,t){const r=t.getArray(),n=t.getNormalized(),s=t.getComponentType(),o=Zs();for(let i=0,a=t.getCount();i<a;i++)n?(o[0]=L.decodeNormalizedInt(r[4*i],s),o[1]=L.decodeNormalizedInt(r[4*i+1],s),o[2]=L.decodeNormalizedInt(r[4*i+2],s)):(o[0]=r[4*i],o[1]=r[4*i+1],o[2]=r[4*i+2]),o[0]=e[0]*o[0]+e[4]*o[1]+e[8]*o[2],o[1]=e[1]*o[0]+e[5]*o[1]+e[9]*o[2],o[2]=e[2]*o[0]+e[6]*o[1]+e[10]*o[2],eo(o,o),n?(r[4*i]=L.decodeNormalizedInt(o[0],s),r[4*i+1]=L.decodeNormalizedInt(o[1],s),r[4*i+2]=L.decodeNormalizedInt(o[2],s)):(r[4*i]=o[0],r[4*i+1]=o[1],r[4*i+2]=o[2])}const{LINES:qo,LINE_STRIP:$o,LINE_LOOP:Wo,TRIANGLES:Xo,TRIANGLE_STRIP:Yo,TRIANGLE_FAN:Qo}=de.Mode;function Ko(e){const t=e.getGraph(),r=Ee.fromGraph(t);e.getIndices()||Go(e);const n=e.getIndices(),s=n.getArray(),o=Os(e),i=new(0,m[n.getComponentType()])(2*o),a=e.getMode();if(a===$o)for(let e=0;e<o;e++)i[2*e]=s[e],i[2*e+1]=s[e+1];else{if(a!==Wo)throw new Error("Only LINE_STRIP and LINE_LOOP may be converted to LINES.");for(let e=0;e<o;e++)e<o-1?(i[2*e]=s[e],i[2*e+1]=s[e+1]):(i[2*e]=s[e],i[2*e+1]=s[0])}e.setMode(qo);const c=r.getRoot();n.listParents().some((t=>t!==c&&t!==e))?e.setIndices(Us(r,n).setArray(i)):n.setArray(i)}function Jo(e){const t=e.getGraph(),r=Ee.fromGraph(t);e.getIndices()||Go(e);const n=e.getIndices(),s=n.getArray(),o=Os(e),i=new(0,m[n.getComponentType()])(3*o),a=e.getMode();if(a===Yo)for(let e=0,t=s.length;e<t-2;e++)e%2?(i[3*e]=s[e+1],i[3*e+1]=s[e],i[3*e+2]=s[e+2]):(i[3*e]=s[e],i[3*e+1]=s[e+1],i[3*e+2]=s[e+2]);else{if(a!==Qo)throw new Error("Only TRIANGLE_STRIP and TRIANGLE_FAN may be converted to TRIANGLES.");for(let e=0;e<o;e++)i[3*e]=s[0],i[3*e+1]=s[e+1],i[3*e+2]=s[e+2]}e.setMode(Xo);const c=r.getRoot();n.listParents().some((t=>t!==c&&t!==e))?e.setIndices(Us(r,n).setArray(i)):n.setArray(i)}function Zo(e){const t=e.getArray();if(!t)return;const r=function(e,t,r){const n=new Float32Array(e.length);for(let s=0,o=e.length;s<o;s++)n[s]=r?L.decodeNormalizedInt(e[s],t):e[s];return n}(t,e.getComponentType(),e.getNormalized());e.setArray(r).setNormalized(!1)}const{TEXTURE_INFO:ei,ROOT:ti}=f,ri={method:"edgebreaker",encodeSpeed:5,decodeSpeed:5,quantizePosition:14,quantizeNormal:10,quantizeColor:8,quantizeTexcoord:12,quantizeGeneric:12,quantizationVolume:"mesh"};const ni="flatten",si={cleanup:!0};const oi={skipValidation:!1},ii=2**32-1,{LINE_STRIP:ai,LINE_LOOP:ci,TRIANGLE_STRIP:ui,TRIANGLE_FAN:pi}=de.Mode;function li(e,t={}){const r=ws(oi,t),n=e[0],s=Ee.fromGraph(n.getGraph());if(!r.skipValidation&&new Set(e.map(Vs)).size>1)throw new Error("Requires >=2 Primitives, sharing the same Material and Mode, with compatible vertex attributes and indices.");for(const t of e)switch(t.getMode()){case ai:case ci:Ko(t);break;case ui:case pi:Jo(t)}const o=[],i=new Uint32Array(e.length);let a=0,c=0;for(let t=0;t<e.length;t++){const r=e[t],n=r.getIndices(),s=r.getAttribute("POSITION").getCount(),u=n?n.getArray():null,p=n?n.getCount():s,l=new Uint32Array(s).fill(ii);for(let e=0;e<p;e++){const r=u?u[e]:e;l[r]===ii&&(l[r]=a++,i[t]++)}o.push(l),c+=p}const u=s.createPrimitive().setMode(n.getMode()).setMaterial(n.getMaterial());for(const e of n.listSemantics()){const t=n.getAttribute(e),r=m[t.getComponentType()],o=Us(s,t).setArray(new r(a*t.getElementSize()));u.setAttribute(e,o)}const p=n.getIndices(),l=p?Us(s,p).setArray(Gs(c,a)):null;u.setIndices(l);let f=0;for(let t=0;t<o.length;t++){const r=e[t],n=r.getIndices(),s=n?n.getCount():-1,i=o[t];n&&l&&(_i(n,i,l,f),f+=s);for(const e of u.listSemantics()){fi(r.getAttribute(e),n,i,u.getAttribute(e))}}return u}function fi(e,t,r,n){const s=e.getElementSize(),o=t?t.getArray():null,i=e.getCount(),a=e.getArray(),c=n.getArray(),u=new Uint8Array(e.getCount());for(let e=0,n=t?t.getCount():i;e<n;e++){const t=o?o[e]:e,n=r[t];if(!u[n]){for(let e=0;e<s;e++)c[n*s+e]=a[t*s+e];u[n]=1}}}function _i(e,t,r,n){const s=e.getCount(),o=e.getArray(),i=r.getArray();for(let e=0;e<s;e++){const r=t[o[e]];i[n+e]=r}}const hi="join",{ROOT:di,NODE:yi,MESH:mi,PRIMITIVE:gi,ACCESSOR:bi}=f,Ti=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ai={keepMeshes:!1,keepNamed:!1,cleanup:!0,filter:()=>!0};function Ei(e,t,r){const n=e.getLogger(),s={},o=t.listChildren();for(let e=0;e<o.length;e++){const t=o[e];if(!r.filter(t))continue;if(t.listParents().some((e=>e instanceof re)))continue;const n=t.getMesh();if(n&&(!t.getExtension("EXT_mesh_gpu_instancing")&&!t.getSkin()))for(const o of n.listPrimitives()){if(o.listTargets().length>0)continue;const i=o.getMaterial();if(i&&i.getExtension("KHR_materials_volume"))continue;jo(o),Ii(o);let a=Vs(o);const c=n.getName()||t.getName();(r.keepMeshes||r.keepNamed&&c)&&(a+=`|${e}`),a in s||(s[a]={prims:[],primMeshes:[],primNodes:[],dstNode:t,dstMesh:void 0});const u=s[a];u.prims.push(o),u.primNodes.push(t)}}const i=Object.values(s).filter((({prims:e})=>e.length>1)),a=new Set(i.flatMap((e=>e.primNodes)));for(const e of a){const t=e.getMesh(),r=t.listParents().some((t=>t.propertyType!==di&&e!==t));r&&e.setMesh(t.clone())}for(const e of i){const{dstNode:t,primNodes:r}=e;e.dstMesh=t.getMesh(),e.primMeshes=r.map((e=>e.getMesh()))}for(const e of i){const{prims:t,primNodes:r,primMeshes:s,dstNode:o,dstMesh:i}=e,a=o.getMatrix();for(let e=0;e<t.length;e++){const n=r[e],i=s[e];let c=t[e];i.removePrimitive(c),c.listParents().some((e=>e.propertyType!==f.ROOT))&&(c=t[e]=xi(t[e])),n!==o&&(Js(Ti,Ks(Ti,a),n.getMatrix()),Vo(c,Ti))}const c=li(t),u=c.listAttributes()[0].getCount();i.addPrimitive(c),n.debug(`${hi}: Joined Primitives (${t.length}) containing ${Ds(u)} vertices under Node "${o.getName()}".`)}}function xi(e){const t=e.clone();for(const e of t.listSemantics())t.setAttribute(e,t.getAttribute(e).clone());const r=t.getIndices();return r&&t.setIndices(r.clone()),t}function Ii(e){for(const t of["POSITION","NORMAL","TANGENT"]){const r=e.getAttribute(t);r&&Zo(r)}}const{TRANSLATION:Ri,ROTATION:Si,SCALE:Mi,WEIGHTS:Ni}=re.TargetPath;Ts({level:"high"},{pattern:/.*/,quantizationVolume:"mesh",quantizePosition:14,quantizeNormal:10,quantizeTexcoord:12,quantizeColor:8,quantizeWeight:8,quantizeGeneric:12,normalizeWeights:!0,cleanup:!0});const wi="metalRough";const vi="palette",Oi={blockSize:4,min:5,keepAttributes:!1,cleanup:!0};function Ci(e){const t=Math.round(255*e).toString(16);return 1===t.length?"0"+t:t}function Di(e){return N.convertLinearToSRGB(e,e),e.map(Ci).join("")}function ji(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Pi(e,t,r,n){for(let s=0;s<n;s++)for(let o=0;o<n;o++)e.set(t*n+s,o,0,255*r[0]),e.set(t*n+s,o,1,255*r[1]),e.set(t*n+s,o,2,255*r[2]),e.set(t*n+s,o,3,255*r[3])}var Fi;!function(e){e[e.STEP=0]="STEP",e[e.LERP=1]="LERP",e[e.SLERP=2]="SLERP"}(Fi||(Fi={}));function Ui(e,t,r){for(let n=0,s=r.length;n<s;n++)r[n]=e[t*s+n];return r}function Li(e,t,r){for(let n=0,s=r.length;n<s;n++)e[t*s+n]=r[n]}function Gi(e,t,r=0){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>r)return!1;return!0}function Bi(e,t,r){return e*(1-r)+t*r}function Vi(e,t,r,n){for(let s=0;s<t.length;s++)e[s]=Bi(t[s],r[s],n);return e}function ki(e,t,r,n){let s,o,i,a,c,u=t[0],p=t[1],l=t[2],f=t[3],_=r[0],h=r[1],d=r[2],y=r[3];return o=u*_+p*h+l*d+f*y,o<0&&(o=-o,_=-_,h=-h,d=-d,y=-y),1-o>1e-6?(s=Math.acos(o),i=Math.sin(s),a=Math.sin((1-n)*s)/i,c=Math.sin(n*s)/i):(a=1-n,c=n),e[0]=a*u+c*_,e[1]=a*p+c*h,e[2]=a*l+c*d,e[3]=a*f+c*y,e}function zi(e,t){const r=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}(e,t);return Math.acos(2*r*r-1)}const Hi="resample",qi=new Float32Array(0),$i={ready:Promise.resolve(),resample:function(e,t,r,n=1e-4){const s=t.length/e.length,o=new Array(s).fill(0),i=new Array(s).fill(0),a=new Array(s).fill(0),c=new Array(s).fill(0),u=e.length-1;let p=1;for(let s=1;s<u;++s){const u=e[p-1],l=e[s],f=e[s+1],_=(l-u)/(f-u);let h=!1;if(l!==f&&(1!==s||l!==e[0]))if(Ui(t,p-1,c),Ui(t,s,i),Ui(t,s+1,a),"slerp"===r){const e=ki(o,c,a,_),t=zi(c,i)+zi(i,a);h=!Gi(i,e,n)||t+Number.EPSILON>=Math.PI}else if("lerp"===r){h=!Gi(i,Vi(o,c,a,_),n)}else"step"===r&&(h=!Gi(i,c)||!Gi(i,a));h&&(s!==p&&(e[p]=e[s],Li(t,p,Ui(t,s,o))),p++)}return u>0&&(e[p]=e[u],Li(t,p,Ui(t,u,o)),p++),p},tolerance:1e-4,cleanup:!0};function Wi(e,t,r){if(e instanceof Float32Array)return e.slice();const n=new Float32Array(e);if(!r)return n;for(let e=0;e<n.length;e++)n[e]=L.decodeNormalizedInt(n[e],t);return n}function Xi(e,t,r){if(t===ee.ComponentType.FLOAT)return e.slice();const n=new(0,m[t])(e.length);for(let s=0;s<n.length;s++)n[s]=r?L.encodeNormalizedInt(e[s],t):e[s];return n}const{POINTS:Yi,LINES:Qi,LINE_STRIP:Ki,LINE_LOOP:Ji,TRIANGLES:Zi,TRIANGLE_STRIP:ea,TRIANGLE_FAN:ta}=de.Mode,ra="sparse",na={ratio:1/3};const sa=["jpeg","png","webp","avif"];var oa;!function(e){e.LANCZOS3="lanczos3",e.LANCZOS2="lanczos2"}(oa||(oa={}));const ia={resizeFilter:oa.LANCZOS3,pattern:void 0,formats:void 0,slots:void 0,quality:void 0,effort:void 0,lossless:!1,nearLossless:!1,limitInputPixels:!0};async function aa(e,t){const r=Ts({},ia,t),n=r.encoder,s=e.getURI(),o=function(e){return ca(e.getMimeType())}(e),i=r.targetFormat||o,a=e.getMimeType(),c=`image/${i}`,u=e.getImage(),p=n?await async function(e,t,r,n){const s=n.encoder;let o={};const i=ca(r);switch(i){case"jpeg":o={quality:n.quality};break;case"png":o={quality:n.quality,effort:ua(n.effort,100,10)};break;case"webp":o={quality:n.quality,effort:ua(n.effort,100,6),lossless:n.lossless,nearLossless:n.nearLossless};break;case"avif":o={quality:n.quality,effort:ua(n.effort,100,9),lossless:n.lossless}}const a=n.limitInputPixels,c=s(e,{limitInputPixels:a}).toFormat(i,o);if(n.resize){const r=v.getSize(e,t),s=Array.isArray(n.resize)?ks(r,n.resize):zs(r,n.resize);c.resize(s[0],s[1],{fit:"fill",kernel:n.resizeFilter})}return M.toView(await c.toBuffer())}(u,a,c,r):await async function(e,t,r,n){const s=await fs(e,t);if(n.resize){const[e,t]=s.shape,o=Array.isArray(n.resize)?ks([e,t],n.resize):zs([e,t],n.resize),i=ns(new Uint8Array(o[0]*o[1]*4),[...o,4]);return n.resizeFilter===oa.LANCZOS3?function(e,t){bs(e,t,ms.LANCZOS_3)}(s,i):function(e,t){bs(e,t,ms.LANCZOS_2)}(s,i),_s(i,r)}return _s(s,r)}(u,a,c,r),l=u.byteLength,f=p.byteLength;if(!(a===c&&f>=l)||r.resize)if(a===c)e.setImage(p);else{const t=s?C.extension(s):v.mimeTypeToExtension(a),r=v.mimeTypeToExtension(c),n=e.getURI().replace(new RegExp(`\\.${t}$`),`.${r}`);e.setImage(p).setMimeType(c).setURI(n)}}function ca(e){const t=e.split("/").pop();if(!t||!sa.includes(t))throw new Error(`Unknown MIME type "${e}".`);return t}function ua(e,t,r){if(null!=e)return Math.round(e/t*r)}var pa,la={exports:{}},fa=la.exports;function _a(){return pa||(pa=1,function(e){var t=t||{};t.scope={},t.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},t.arrayIterator=function(e){return{next:t.arrayIteratorImpl(e)}},t.makeIterator=function(e){var r="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return r?r.call(e):t.arrayIterator(e)},t.ASSUME_ES5=!1,t.ASSUME_NO_NATIVE_MAP=!1,t.ASSUME_NO_NATIVE_SET=!1,t.SIMPLE_FROUND_POLYFILL=!1,t.ISOLATE_POLYFILLS=!1,t.FORCE_POLYFILL_PROMISE=!1,t.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,t.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Hn&&Hn];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")},t.global=t.getGlobal(fa),t.defineProperty=t.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},t.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),t.TRUST_ES6_POLYFILLS=!t.ISOLATE_POLYFILLS||t.IS_SYMBOL_NATIVE,t.polyfills={},t.propertyToPolyfillSymbol={},t.POLYFILL_PREFIX="$jscp$",t.polyfill=function(e,r,n,s){r&&(t.ISOLATE_POLYFILLS?t.polyfillIsolated(e,r,n,s):t.polyfillUnisolated(e,r,n,s))},t.polyfillUnisolated=function(e,r,n,s){for(n=t.global,e=e.split("."),s=0;s<e.length-1;s++){var o=e[s];if(!(o in n))return;n=n[o]}(r=r(s=n[e=e[e.length-1]]))!=s&&null!=r&&t.defineProperty(n,e,{configurable:!0,writable:!0,value:r})},t.polyfillIsolated=function(e,r,n,s){var o=e.split(".");e=1===o.length,s=o[0],s=!e&&s in t.polyfills?t.polyfills:t.global;for(var i=0;i<o.length-1;i++){var a=o[i];if(!(a in s))return;s=s[a]}o=o[o.length-1],null!=(r=r(n=t.IS_SYMBOL_NATIVE&&"es6"===n?s[o]:null))&&(e?t.defineProperty(t.polyfills,o,{configurable:!0,writable:!0,value:r}):r!==n&&(void 0===t.propertyToPolyfillSymbol[o]&&(n=1e9*Math.random()>>>0,t.propertyToPolyfillSymbol[o]=t.IS_SYMBOL_NATIVE?t.global.Symbol(o):t.POLYFILL_PREFIX+n+"$"+o),t.defineProperty(s,t.propertyToPolyfillSymbol[o],{configurable:!0,writable:!0,value:r})))},t.polyfill("Promise",(function(e){function r(){this.batch_=null}function n(e){return e instanceof o?e:new o((function(t,r){t(e)}))}if(e&&(!(t.FORCE_POLYFILL_PROMISE||t.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&void 0===t.global.PromiseRejectionEvent)||!t.global.Promise||-1===t.global.Promise.toString().indexOf("[native code]")))return e;r.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var t=this;this.asyncExecuteFunction((function(){t.executeBatch_()}))}this.batch_.push(e)};var s=t.global.setTimeout;r.prototype.asyncExecuteFunction=function(e){s(e,0)},r.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},r.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var o=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[],this.isRejectionHandled_=!1;var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};o.prototype.createResolveAndReject_=function(){function e(e){return function(n){r||(r=!0,e.call(t,n))}}var t=this,r=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},o.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof o)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},o.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},o.prototype.reject_=function(e){this.settle_(2,e)},o.prototype.fulfill_=function(e){this.settle_(1,e)},o.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,2===this.state_&&this.scheduleUnhandledRejectionCheck_(),this.executeOnSettledCallbacks_()},o.prototype.scheduleUnhandledRejectionCheck_=function(){var e=this;s((function(){if(e.notifyUnhandledRejection_()){var r=t.global.console;void 0!==r&&r.error(e.result_)}}),1)},o.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var e=t.global.CustomEvent,r=t.global.Event,n=t.global.dispatchEvent;return void 0===n||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof r?e=new r("unhandledrejection",{cancelable:!0}):(e=t.global.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.result_,n(e))},o.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)i.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var i=new r;return o.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},o.prototype.settleSameAsThenable_=function(e,t){var r=this.createResolveAndReject_();try{e.call(t,r.resolve,r.reject)}catch(e){r.reject(e)}},o.prototype.then=function(e,t){function r(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(e){s(e)}}:t}var n,s,i=new o((function(e,t){n=e,s=t}));return this.callWhenSettled_(r(e,n),r(t,s)),i},o.prototype.catch=function(e){return this.then(void 0,e)},o.prototype.callWhenSettled_=function(e,t){function r(){switch(n.state_){case 1:e(n.result_);break;case 2:t(n.result_);break;default:throw Error("Unexpected state: "+n.state_)}}var n=this;null==this.onSettledCallbacks_?i.asyncExecute(r):this.onSettledCallbacks_.push(r),this.isRejectionHandled_=!0},o.resolve=n,o.reject=function(e){return new o((function(t,r){r(e)}))},o.race=function(e){return new o((function(r,s){for(var o=t.makeIterator(e),i=o.next();!i.done;i=o.next())n(i.value).callWhenSettled_(r,s)}))},o.all=function(e){var r=t.makeIterator(e),s=r.next();return s.done?n([]):new o((function(e,t){function o(t){return function(r){i[t]=r,0==--a&&e(i)}}var i=[],a=0;do{i.push(void 0),a++,n(s.value).callWhenSettled_(o(i.length-1),t),s=r.next()}while(!s.done)}))},o}),"es6","es3"),t.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.assign=t.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(e,r){for(var n=1;n<arguments.length;n++){var s=arguments[n];if(s)for(var o in s)t.owns(s,o)&&(e[o]=s[o])}return e},t.polyfill("Object.assign",(function(e){return e||t.assign}),"es6","es3"),t.checkStringArgs=function(e,t,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""},t.polyfill("String.prototype.startsWith",(function(e){return e||function(e,r){var n=t.checkStringArgs(this,e,"startsWith");e+="";var s=n.length,o=e.length;r=Math.max(0,Math.min(0|r,n.length));for(var i=0;i<o&&r<s;)if(n[r++]!=e[i++])return!1;return i>=o}}),"es6","es3"),t.polyfill("Array.prototype.copyWithin",(function(e){function t(e){return 1/0===(e=Number(e))||-1/0===e?e:0|e}return e||function(e,r,n){var s=this.length;if(e=t(e),r=t(r),n=void 0===n?s:t(n),e=0>e?Math.max(s+e,0):Math.min(e,s),r=0>r?Math.max(s+r,0):Math.min(r,s),n=0>n?Math.max(s+n,0):Math.min(n,s),e<r)for(;r<n;)r in this?this[e++]=this[r++]:(delete this[e++],r++);else for(e+=(n=Math.min(n,s+r-e))-r;n>r;)--n in this?this[--e]=this[n]:delete this[--e];return this}}),"es6","es3"),t.typedArrayCopyWithin=function(e){return e||Array.prototype.copyWithin},t.polyfill("Int8Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint8Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint8ClampedArray.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Int16Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint16Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Int32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Float32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Float64Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5");var r,n=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(r=r||__filename),function(e){function t(){var e=q.buffer;v.HEAP8=$=new Int8Array(e),v.HEAP16=X=new Int16Array(e),v.HEAP32=Y=new Int32Array(e),v.HEAPU8=W=new Uint8Array(e),v.HEAPU16=new Uint16Array(e),v.HEAPU32=Q=new Uint32Array(e),v.HEAPF32=K=new Float32Array(e),v.HEAPF64=new Float64Array(e)}function n(e){throw v.onAbort&&v.onAbort(e),H(e="Aborted("+e+")"),Z=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),w(e),e}function s(e){try{if(e==ie&&z)return new Uint8Array(z);if(V)return V(e);throw"both async and sync fetching of the wasm failed"}catch(e){n(e)}}function o(e){for(;0<e.length;)e.shift()(v)}function i(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){Q[this.ptr+4>>2]=e},this.get_type=function(){return Q[this.ptr+4>>2]},this.set_destructor=function(e){Q[this.ptr+8>>2]=e},this.get_destructor=function(){return Q[this.ptr+8>>2]},this.set_refcount=function(e){Y[this.ptr>>2]=e},this.set_caught=function(e){$[this.ptr+12|0]=e?1:0},this.get_caught=function(){return 0!=$[this.ptr+12|0]},this.set_rethrown=function(e){$[this.ptr+13|0]=e?1:0},this.get_rethrown=function(){return 0!=$[this.ptr+13|0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){Y[this.ptr>>2]+=1},this.release_ref=function(){var e=Y[this.ptr>>2];return Y[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){Q[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return Q[this.ptr+16>>2]},this.get_exception_ptr=function(){if(Qt(this.get_type()))return Q[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function a(){function e(){if(!Yt&&(Yt=!0,v.calledRun=!0,!Z)){if(ne=!0,o(te),N(v),v.onRuntimeInitialized&&v.onRuntimeInitialized(),v.postRun)for("function"==typeof v.postRun&&(v.postRun=[v.postRun]);v.postRun.length;)re.unshift(v.postRun.shift());o(re)}}if(!(0<se)){if(v.preRun)for("function"==typeof v.preRun&&(v.preRun=[v.preRun]);v.preRun.length;)ee.unshift(v.preRun.shift());o(ee),0<se||(v.setStatus?(v.setStatus("Running..."),setTimeout((function(){setTimeout((function(){v.setStatus("")}),1),e()}),1)):e())}}function c(){}function u(e){return(e||c).__cache__}function p(e,t){var r=u(t),n=r[e];return n||((n=Object.create((t||c).prototype)).ptr=e,r[e]=n)}function l(e){if("string"==typeof e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);127>=n?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3}if(r=0,0<(n=(t=Array(t+1)).length)){n=r+n-1;for(var s=0;s<e.length;++s){var o=e.charCodeAt(s);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++s)),127>=o){if(r>=n)break;t[r++]=o}else{if(2047>=o){if(r+1>=n)break;t[r++]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;t[r++]=224|o>>12}else{if(r+3>=n)break;t[r++]=240|o>>18,t[r++]=128|o>>12&63}t[r++]=128|o>>6&63}t[r++]=128|63&o}}t[r]=0}return e=Kt.alloc(t,$),Kt.copy(t,$,e),e}return e}function f(e){if("object"==typeof e){var t=Kt.alloc(e,$);return Kt.copy(e,$,t),t}return e}function _(e){if("object"==typeof e){var t=Kt.alloc(e,X);return Kt.copy(e,X,t),t}return e}function h(e){if("object"==typeof e){var t=Kt.alloc(e,Y);return Kt.copy(e,Y,t),t}return e}function d(e){if("object"==typeof e){var t=Kt.alloc(e,K);return Kt.copy(e,K,t),t}return e}function y(){throw"cannot construct a VoidPtr, no constructor in IDL"}function m(){this.ptr=ue(),u(m)[this.ptr]=this}function g(){this.ptr=le(),u(g)[this.ptr]=this}function b(){this.ptr=Ae(),u(b)[this.ptr]=this}function T(){this.ptr=Re(),u(T)[this.ptr]=this}function A(){this.ptr=Oe(),u(A)[this.ptr]=this}function E(){this.ptr=De(),u(E)[this.ptr]=this}function x(){this.ptr=Ue(),u(x)[this.ptr]=this}function I(){this.ptr=ze(),u(I)[this.ptr]=this}function R(){this.ptr=tt(),u(R)[this.ptr]=this}function S(){this.ptr=mt(),u(S)[this.ptr]=this}function M(e){e&&"object"==typeof e&&(e=e.ptr),this.ptr=Nt(e),u(M)[this.ptr]=this}var N,w,v=void 0!==(e=void 0===e?{}:e)?e:{};v.ready=new Promise((function(e,t){N=e,w=t}));var O=!1,C=!1;v.onRuntimeInitialized=function(){O=!0,C&&"function"==typeof v.onModuleLoaded&&v.onModuleLoaded(v)},v.onModuleParsed=function(){C=!0,O&&"function"==typeof v.onModuleLoaded&&v.onModuleLoaded(v)},v.isVersionSupported=function(e){return"string"==typeof e&&!(2>(e=e.split(".")).length||3<e.length)&&(1==e[0]&&0<=e[1]&&5>=e[1]||!(0!=e[0]||10<e[1]))};var D=Object.assign({},v),j="object"==typeof window,P="function"==typeof importScripts,F="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,U="";if(F){var L=require("fs"),G=require("path");U=P?G.dirname(U)+"/":__dirname+"/";var B=function(e,t){return e=e.startsWith("file://")?new URL(e):G.normalize(e),L.readFileSync(e,t?void 0:"utf8")},V=function(e){return(e=B(e,!0)).buffer||(e=new Uint8Array(e)),e},k=function(e,t,r){e=e.startsWith("file://")?new URL(e):G.normalize(e),L.readFile(e,(function(e,n){e?r(e):t(n.buffer)}))};1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),v.inspect=function(){return"[Emscripten Module object]"}}else(j||P)&&(P?U=self.location.href:"undefined"!=typeof document&&document.currentScript&&(U=document.currentScript.src),r&&(U=r),U=0!==U.indexOf("blob:")?U.substr(0,U.replace(/[?#].*/,"").lastIndexOf("/")+1):"",B=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},P&&(V=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),k=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});v.print||console.log.bind(console);var z,H=v.printErr||console.warn.bind(console);Object.assign(v,D),D=null,v.wasmBinary&&(z=v.wasmBinary),"object"!=typeof WebAssembly&&n("no native wasm support detected");var q,$,W,X,Y,Q,K,J,Z=!1,ee=[],te=[],re=[],ne=!1,se=0,oe=null,ie="draco_encoder.wasm";ie.startsWith("data:application/octet-stream;base64,")||(J=ie,ie=v.locateFile?v.locateFile(J,U):U+J);var ae={b:function(e,t,r){throw new i(e).init(t,r),e},a:function(){n("")},d:function(e,t,r){W.copyWithin(e,t,t+r)},c:function(e){var r=W.length;if(2147483648<(e>>>=0))return!1;for(var n=1;4>=n;n*=2){var s=r*(1+.2/n);s=Math.min(s,e+100663296);var o=Math;s=Math.max(e,s),o=o.min.call(o,2147483648,s+(65536-s%65536)%65536);e:{s=q.buffer;try{q.grow(o-s.byteLength+65535>>>16),t();var i=1;break e}catch(e){}i=void 0}if(i)return!0}return!1}};!function(){function e(e,r){v.asm=e.exports,q=v.asm.e,t(),te.unshift(v.asm.f),se--,v.monitorRunDependencies&&v.monitorRunDependencies(se),0==se&&oe&&(e=oe,oe=null,e())}function r(t){e(t.instance)}function o(e){return function(){if(!z&&(j||P)){if("function"==typeof fetch&&!ie.startsWith("file://"))return fetch(ie,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ie+"'";return e.arrayBuffer()})).catch((function(){return s(ie)}));if(k)return new Promise((function(e,t){k(ie,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return s(ie)}))}().then((function(e){return WebAssembly.instantiate(e,i)})).then((function(e){return e})).then(e,(function(e){H("failed to asynchronously prepare wasm: "+e),n(e)}))}var i={a:ae};if(se++,v.monitorRunDependencies&&v.monitorRunDependencies(se),v.instantiateWasm)try{return v.instantiateWasm(i,e)}catch(e){H("Module.instantiateWasm callback failed with error: "+e),w(e)}(z||"function"!=typeof WebAssembly.instantiateStreaming||ie.startsWith("data:application/octet-stream;base64,")||ie.startsWith("file://")||F||"function"!=typeof fetch?o(r):fetch(ie,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,i).then(r,(function(e){return H("wasm streaming compile failed: "+e),H("falling back to ArrayBuffer instantiation"),o(r)}))}))).catch(w)}();var ce=v._emscripten_bind_VoidPtr___destroy___0=function(){return(ce=v._emscripten_bind_VoidPtr___destroy___0=v.asm.h).apply(null,arguments)},ue=v._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return(ue=v._emscripten_bind_GeometryAttribute_GeometryAttribute_0=v.asm.i).apply(null,arguments)},pe=v._emscripten_bind_GeometryAttribute___destroy___0=function(){return(pe=v._emscripten_bind_GeometryAttribute___destroy___0=v.asm.j).apply(null,arguments)},le=v._emscripten_bind_PointAttribute_PointAttribute_0=function(){return(le=v._emscripten_bind_PointAttribute_PointAttribute_0=v.asm.k).apply(null,arguments)},fe=v._emscripten_bind_PointAttribute_size_0=function(){return(fe=v._emscripten_bind_PointAttribute_size_0=v.asm.l).apply(null,arguments)},_e=v._emscripten_bind_PointAttribute_attribute_type_0=function(){return(_e=v._emscripten_bind_PointAttribute_attribute_type_0=v.asm.m).apply(null,arguments)},he=v._emscripten_bind_PointAttribute_data_type_0=function(){return(he=v._emscripten_bind_PointAttribute_data_type_0=v.asm.n).apply(null,arguments)},de=v._emscripten_bind_PointAttribute_num_components_0=function(){return(de=v._emscripten_bind_PointAttribute_num_components_0=v.asm.o).apply(null,arguments)},ye=v._emscripten_bind_PointAttribute_normalized_0=function(){return(ye=v._emscripten_bind_PointAttribute_normalized_0=v.asm.p).apply(null,arguments)},me=v._emscripten_bind_PointAttribute_byte_stride_0=function(){return(me=v._emscripten_bind_PointAttribute_byte_stride_0=v.asm.q).apply(null,arguments)},ge=v._emscripten_bind_PointAttribute_byte_offset_0=function(){return(ge=v._emscripten_bind_PointAttribute_byte_offset_0=v.asm.r).apply(null,arguments)},be=v._emscripten_bind_PointAttribute_unique_id_0=function(){return(be=v._emscripten_bind_PointAttribute_unique_id_0=v.asm.s).apply(null,arguments)},Te=v._emscripten_bind_PointAttribute___destroy___0=function(){return(Te=v._emscripten_bind_PointAttribute___destroy___0=v.asm.t).apply(null,arguments)},Ae=v._emscripten_bind_PointCloud_PointCloud_0=function(){return(Ae=v._emscripten_bind_PointCloud_PointCloud_0=v.asm.u).apply(null,arguments)},Ee=v._emscripten_bind_PointCloud_num_attributes_0=function(){return(Ee=v._emscripten_bind_PointCloud_num_attributes_0=v.asm.v).apply(null,arguments)},xe=v._emscripten_bind_PointCloud_num_points_0=function(){return(xe=v._emscripten_bind_PointCloud_num_points_0=v.asm.w).apply(null,arguments)},Ie=v._emscripten_bind_PointCloud___destroy___0=function(){return(Ie=v._emscripten_bind_PointCloud___destroy___0=v.asm.x).apply(null,arguments)},Re=v._emscripten_bind_Mesh_Mesh_0=function(){return(Re=v._emscripten_bind_Mesh_Mesh_0=v.asm.y).apply(null,arguments)},Se=v._emscripten_bind_Mesh_num_faces_0=function(){return(Se=v._emscripten_bind_Mesh_num_faces_0=v.asm.z).apply(null,arguments)},Me=v._emscripten_bind_Mesh_num_attributes_0=function(){return(Me=v._emscripten_bind_Mesh_num_attributes_0=v.asm.A).apply(null,arguments)},Ne=v._emscripten_bind_Mesh_num_points_0=function(){return(Ne=v._emscripten_bind_Mesh_num_points_0=v.asm.B).apply(null,arguments)},we=v._emscripten_bind_Mesh_set_num_points_1=function(){return(we=v._emscripten_bind_Mesh_set_num_points_1=v.asm.C).apply(null,arguments)},ve=v._emscripten_bind_Mesh___destroy___0=function(){return(ve=v._emscripten_bind_Mesh___destroy___0=v.asm.D).apply(null,arguments)},Oe=v._emscripten_bind_Metadata_Metadata_0=function(){return(Oe=v._emscripten_bind_Metadata_Metadata_0=v.asm.E).apply(null,arguments)},Ce=v._emscripten_bind_Metadata___destroy___0=function(){return(Ce=v._emscripten_bind_Metadata___destroy___0=v.asm.F).apply(null,arguments)},De=v._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return(De=v._emscripten_bind_DracoInt8Array_DracoInt8Array_0=v.asm.G).apply(null,arguments)},je=v._emscripten_bind_DracoInt8Array_GetValue_1=function(){return(je=v._emscripten_bind_DracoInt8Array_GetValue_1=v.asm.H).apply(null,arguments)},Pe=v._emscripten_bind_DracoInt8Array_size_0=function(){return(Pe=v._emscripten_bind_DracoInt8Array_size_0=v.asm.I).apply(null,arguments)},Fe=v._emscripten_bind_DracoInt8Array___destroy___0=function(){return(Fe=v._emscripten_bind_DracoInt8Array___destroy___0=v.asm.J).apply(null,arguments)},Ue=v._emscripten_bind_MetadataBuilder_MetadataBuilder_0=function(){return(Ue=v._emscripten_bind_MetadataBuilder_MetadataBuilder_0=v.asm.K).apply(null,arguments)},Le=v._emscripten_bind_MetadataBuilder_AddStringEntry_3=function(){return(Le=v._emscripten_bind_MetadataBuilder_AddStringEntry_3=v.asm.L).apply(null,arguments)},Ge=v._emscripten_bind_MetadataBuilder_AddIntEntry_3=function(){return(Ge=v._emscripten_bind_MetadataBuilder_AddIntEntry_3=v.asm.M).apply(null,arguments)},Be=v._emscripten_bind_MetadataBuilder_AddIntEntryArray_4=function(){return(Be=v._emscripten_bind_MetadataBuilder_AddIntEntryArray_4=v.asm.N).apply(null,arguments)},Ve=v._emscripten_bind_MetadataBuilder_AddDoubleEntry_3=function(){return(Ve=v._emscripten_bind_MetadataBuilder_AddDoubleEntry_3=v.asm.O).apply(null,arguments)},ke=v._emscripten_bind_MetadataBuilder___destroy___0=function(){return(ke=v._emscripten_bind_MetadataBuilder___destroy___0=v.asm.P).apply(null,arguments)},ze=v._emscripten_bind_PointCloudBuilder_PointCloudBuilder_0=function(){return(ze=v._emscripten_bind_PointCloudBuilder_PointCloudBuilder_0=v.asm.Q).apply(null,arguments)},He=v._emscripten_bind_PointCloudBuilder_AddFloatAttribute_5=function(){return(He=v._emscripten_bind_PointCloudBuilder_AddFloatAttribute_5=v.asm.R).apply(null,arguments)},qe=v._emscripten_bind_PointCloudBuilder_AddInt8Attribute_5=function(){return(qe=v._emscripten_bind_PointCloudBuilder_AddInt8Attribute_5=v.asm.S).apply(null,arguments)},$e=v._emscripten_bind_PointCloudBuilder_AddUInt8Attribute_5=function(){return($e=v._emscripten_bind_PointCloudBuilder_AddUInt8Attribute_5=v.asm.T).apply(null,arguments)},We=v._emscripten_bind_PointCloudBuilder_AddInt16Attribute_5=function(){return(We=v._emscripten_bind_PointCloudBuilder_AddInt16Attribute_5=v.asm.U).apply(null,arguments)},Xe=v._emscripten_bind_PointCloudBuilder_AddUInt16Attribute_5=function(){return(Xe=v._emscripten_bind_PointCloudBuilder_AddUInt16Attribute_5=v.asm.V).apply(null,arguments)},Ye=v._emscripten_bind_PointCloudBuilder_AddInt32Attribute_5=function(){return(Ye=v._emscripten_bind_PointCloudBuilder_AddInt32Attribute_5=v.asm.W).apply(null,arguments)},Qe=v._emscripten_bind_PointCloudBuilder_AddUInt32Attribute_5=function(){return(Qe=v._emscripten_bind_PointCloudBuilder_AddUInt32Attribute_5=v.asm.X).apply(null,arguments)},Ke=v._emscripten_bind_PointCloudBuilder_AddMetadata_2=function(){return(Ke=v._emscripten_bind_PointCloudBuilder_AddMetadata_2=v.asm.Y).apply(null,arguments)},Je=v._emscripten_bind_PointCloudBuilder_SetMetadataForAttribute_3=function(){return(Je=v._emscripten_bind_PointCloudBuilder_SetMetadataForAttribute_3=v.asm.Z).apply(null,arguments)},Ze=v._emscripten_bind_PointCloudBuilder_SetNormalizedFlagForAttribute_3=function(){return(Ze=v._emscripten_bind_PointCloudBuilder_SetNormalizedFlagForAttribute_3=v.asm._).apply(null,arguments)},et=v._emscripten_bind_PointCloudBuilder___destroy___0=function(){return(et=v._emscripten_bind_PointCloudBuilder___destroy___0=v.asm.$).apply(null,arguments)},tt=v._emscripten_bind_MeshBuilder_MeshBuilder_0=function(){return(tt=v._emscripten_bind_MeshBuilder_MeshBuilder_0=v.asm.aa).apply(null,arguments)},rt=v._emscripten_bind_MeshBuilder_AddFacesToMesh_3=function(){return(rt=v._emscripten_bind_MeshBuilder_AddFacesToMesh_3=v.asm.ba).apply(null,arguments)},nt=v._emscripten_bind_MeshBuilder_AddFloatAttributeToMesh_5=function(){return(nt=v._emscripten_bind_MeshBuilder_AddFloatAttributeToMesh_5=v.asm.ca).apply(null,arguments)},st=v._emscripten_bind_MeshBuilder_AddInt32AttributeToMesh_5=function(){return(st=v._emscripten_bind_MeshBuilder_AddInt32AttributeToMesh_5=v.asm.da).apply(null,arguments)},ot=v._emscripten_bind_MeshBuilder_AddMetadataToMesh_2=function(){return(ot=v._emscripten_bind_MeshBuilder_AddMetadataToMesh_2=v.asm.ea).apply(null,arguments)},it=v._emscripten_bind_MeshBuilder_AddFloatAttribute_5=function(){return(it=v._emscripten_bind_MeshBuilder_AddFloatAttribute_5=v.asm.fa).apply(null,arguments)},at=v._emscripten_bind_MeshBuilder_AddInt8Attribute_5=function(){return(at=v._emscripten_bind_MeshBuilder_AddInt8Attribute_5=v.asm.ga).apply(null,arguments)},ct=v._emscripten_bind_MeshBuilder_AddUInt8Attribute_5=function(){return(ct=v._emscripten_bind_MeshBuilder_AddUInt8Attribute_5=v.asm.ha).apply(null,arguments)},ut=v._emscripten_bind_MeshBuilder_AddInt16Attribute_5=function(){return(ut=v._emscripten_bind_MeshBuilder_AddInt16Attribute_5=v.asm.ia).apply(null,arguments)},pt=v._emscripten_bind_MeshBuilder_AddUInt16Attribute_5=function(){return(pt=v._emscripten_bind_MeshBuilder_AddUInt16Attribute_5=v.asm.ja).apply(null,arguments)},lt=v._emscripten_bind_MeshBuilder_AddInt32Attribute_5=function(){return(lt=v._emscripten_bind_MeshBuilder_AddInt32Attribute_5=v.asm.ka).apply(null,arguments)},ft=v._emscripten_bind_MeshBuilder_AddUInt32Attribute_5=function(){return(ft=v._emscripten_bind_MeshBuilder_AddUInt32Attribute_5=v.asm.la).apply(null,arguments)},_t=v._emscripten_bind_MeshBuilder_AddMetadata_2=function(){return(_t=v._emscripten_bind_MeshBuilder_AddMetadata_2=v.asm.ma).apply(null,arguments)},ht=v._emscripten_bind_MeshBuilder_SetMetadataForAttribute_3=function(){return(ht=v._emscripten_bind_MeshBuilder_SetMetadataForAttribute_3=v.asm.na).apply(null,arguments)},dt=v._emscripten_bind_MeshBuilder_SetNormalizedFlagForAttribute_3=function(){return(dt=v._emscripten_bind_MeshBuilder_SetNormalizedFlagForAttribute_3=v.asm.oa).apply(null,arguments)},yt=v._emscripten_bind_MeshBuilder___destroy___0=function(){return(yt=v._emscripten_bind_MeshBuilder___destroy___0=v.asm.pa).apply(null,arguments)},mt=v._emscripten_bind_Encoder_Encoder_0=function(){return(mt=v._emscripten_bind_Encoder_Encoder_0=v.asm.qa).apply(null,arguments)},gt=v._emscripten_bind_Encoder_SetEncodingMethod_1=function(){return(gt=v._emscripten_bind_Encoder_SetEncodingMethod_1=v.asm.ra).apply(null,arguments)},bt=v._emscripten_bind_Encoder_SetAttributeQuantization_2=function(){return(bt=v._emscripten_bind_Encoder_SetAttributeQuantization_2=v.asm.sa).apply(null,arguments)},Tt=v._emscripten_bind_Encoder_SetAttributeExplicitQuantization_5=function(){return(Tt=v._emscripten_bind_Encoder_SetAttributeExplicitQuantization_5=v.asm.ta).apply(null,arguments)},At=v._emscripten_bind_Encoder_SetSpeedOptions_2=function(){return(At=v._emscripten_bind_Encoder_SetSpeedOptions_2=v.asm.ua).apply(null,arguments)},Et=v._emscripten_bind_Encoder_SetTrackEncodedProperties_1=function(){return(Et=v._emscripten_bind_Encoder_SetTrackEncodedProperties_1=v.asm.va).apply(null,arguments)},xt=v._emscripten_bind_Encoder_EncodeMeshToDracoBuffer_2=function(){return(xt=v._emscripten_bind_Encoder_EncodeMeshToDracoBuffer_2=v.asm.wa).apply(null,arguments)},It=v._emscripten_bind_Encoder_EncodePointCloudToDracoBuffer_3=function(){return(It=v._emscripten_bind_Encoder_EncodePointCloudToDracoBuffer_3=v.asm.xa).apply(null,arguments)},Rt=v._emscripten_bind_Encoder_GetNumberOfEncodedPoints_0=function(){return(Rt=v._emscripten_bind_Encoder_GetNumberOfEncodedPoints_0=v.asm.ya).apply(null,arguments)},St=v._emscripten_bind_Encoder_GetNumberOfEncodedFaces_0=function(){return(St=v._emscripten_bind_Encoder_GetNumberOfEncodedFaces_0=v.asm.za).apply(null,arguments)},Mt=v._emscripten_bind_Encoder___destroy___0=function(){return(Mt=v._emscripten_bind_Encoder___destroy___0=v.asm.Aa).apply(null,arguments)},Nt=v._emscripten_bind_ExpertEncoder_ExpertEncoder_1=function(){return(Nt=v._emscripten_bind_ExpertEncoder_ExpertEncoder_1=v.asm.Ba).apply(null,arguments)},wt=v._emscripten_bind_ExpertEncoder_SetEncodingMethod_1=function(){return(wt=v._emscripten_bind_ExpertEncoder_SetEncodingMethod_1=v.asm.Ca).apply(null,arguments)},vt=v._emscripten_bind_ExpertEncoder_SetAttributeQuantization_2=function(){return(vt=v._emscripten_bind_ExpertEncoder_SetAttributeQuantization_2=v.asm.Da).apply(null,arguments)},Ot=v._emscripten_bind_ExpertEncoder_SetAttributeExplicitQuantization_5=function(){return(Ot=v._emscripten_bind_ExpertEncoder_SetAttributeExplicitQuantization_5=v.asm.Ea).apply(null,arguments)},Ct=v._emscripten_bind_ExpertEncoder_SetSpeedOptions_2=function(){return(Ct=v._emscripten_bind_ExpertEncoder_SetSpeedOptions_2=v.asm.Fa).apply(null,arguments)},Dt=v._emscripten_bind_ExpertEncoder_SetTrackEncodedProperties_1=function(){return(Dt=v._emscripten_bind_ExpertEncoder_SetTrackEncodedProperties_1=v.asm.Ga).apply(null,arguments)},jt=v._emscripten_bind_ExpertEncoder_EncodeToDracoBuffer_2=function(){return(jt=v._emscripten_bind_ExpertEncoder_EncodeToDracoBuffer_2=v.asm.Ha).apply(null,arguments)},Pt=v._emscripten_bind_ExpertEncoder_GetNumberOfEncodedPoints_0=function(){return(Pt=v._emscripten_bind_ExpertEncoder_GetNumberOfEncodedPoints_0=v.asm.Ia).apply(null,arguments)},Ft=v._emscripten_bind_ExpertEncoder_GetNumberOfEncodedFaces_0=function(){return(Ft=v._emscripten_bind_ExpertEncoder_GetNumberOfEncodedFaces_0=v.asm.Ja).apply(null,arguments)},Ut=v._emscripten_bind_ExpertEncoder___destroy___0=function(){return(Ut=v._emscripten_bind_ExpertEncoder___destroy___0=v.asm.Ka).apply(null,arguments)},Lt=v._emscripten_enum_draco_GeometryAttribute_Type_INVALID=function(){return(Lt=v._emscripten_enum_draco_GeometryAttribute_Type_INVALID=v.asm.La).apply(null,arguments)},Gt=v._emscripten_enum_draco_GeometryAttribute_Type_POSITION=function(){return(Gt=v._emscripten_enum_draco_GeometryAttribute_Type_POSITION=v.asm.Ma).apply(null,arguments)},Bt=v._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return(Bt=v._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=v.asm.Na).apply(null,arguments)},Vt=v._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return(Vt=v._emscripten_enum_draco_GeometryAttribute_Type_COLOR=v.asm.Oa).apply(null,arguments)},kt=v._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return(kt=v._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=v.asm.Pa).apply(null,arguments)},zt=v._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return(zt=v._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=v.asm.Qa).apply(null,arguments)},Ht=v._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return(Ht=v._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=v.asm.Ra).apply(null,arguments)},qt=v._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return(qt=v._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=v.asm.Sa).apply(null,arguments)},$t=v._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return($t=v._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=v.asm.Ta).apply(null,arguments)},Wt=v._emscripten_enum_draco_MeshEncoderMethod_MESH_SEQUENTIAL_ENCODING=function(){return(Wt=v._emscripten_enum_draco_MeshEncoderMethod_MESH_SEQUENTIAL_ENCODING=v.asm.Ua).apply(null,arguments)},Xt=v._emscripten_enum_draco_MeshEncoderMethod_MESH_EDGEBREAKER_ENCODING=function(){return(Xt=v._emscripten_enum_draco_MeshEncoderMethod_MESH_EDGEBREAKER_ENCODING=v.asm.Va).apply(null,arguments)};v._malloc=function(){return(v._malloc=v.asm.Wa).apply(null,arguments)},v._free=function(){return(v._free=v.asm.Xa).apply(null,arguments)};var Yt,Qt=function(){return(Qt=v.asm.Ya).apply(null,arguments)};if(v.___start_em_js=19116,v.___stop_em_js=19214,oe=function e(){Yt||a(),Yt||(oe=e)},v.preInit)for("function"==typeof v.preInit&&(v.preInit=[v.preInit]);0<v.preInit.length;)v.preInit.pop()();a(),c.prototype=Object.create(c.prototype),c.prototype.constructor=c,c.prototype.__class__=c,c.__cache__={},v.WrapperObject=c,v.getCache=u,v.wrapPointer=p,v.castObject=function(e,t){return p(e.ptr,t)},v.NULL=p(0),v.destroy=function(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete u(e.__class__)[e.ptr]},v.compare=function(e,t){return e.ptr===t.ptr},v.getPointer=function(e){return e.ptr},v.getClass=function(e){return e.__class__};var Kt={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(Kt.needed){for(var e=0;e<Kt.temps.length;e++)v._free(Kt.temps[e]);Kt.temps.length=0,v._free(Kt.buffer),Kt.buffer=0,Kt.size+=Kt.needed,Kt.needed=0}Kt.buffer||(Kt.size+=128,Kt.buffer=v._malloc(Kt.size),Kt.buffer||n(void 0)),Kt.pos=0},alloc:function(e,t){return Kt.buffer||n(void 0),e=7+(e=e.length*t.BYTES_PER_ELEMENT)&-8,Kt.pos+e>=Kt.size?(0<e||n(void 0),Kt.needed+=e,t=v._malloc(e),Kt.temps.push(t)):(t=Kt.buffer+Kt.pos,Kt.pos+=e),t},copy:function(e,t,r){switch(r>>>=0,t.BYTES_PER_ELEMENT){case 2:r>>>=1;break;case 4:r>>>=2;break;case 8:r>>>=3}for(var n=0;n<e.length;n++)t[r+n]=e[n]}};return y.prototype=Object.create(c.prototype),y.prototype.constructor=y,y.prototype.__class__=y,y.__cache__={},v.VoidPtr=y,y.prototype.__destroy__=y.prototype.__destroy__=function(){ce(this.ptr)},m.prototype=Object.create(c.prototype),m.prototype.constructor=m,m.prototype.__class__=m,m.__cache__={},v.GeometryAttribute=m,m.prototype.__destroy__=m.prototype.__destroy__=function(){pe(this.ptr)},g.prototype=Object.create(c.prototype),g.prototype.constructor=g,g.prototype.__class__=g,g.__cache__={},v.PointAttribute=g,g.prototype.size=g.prototype.size=function(){return fe(this.ptr)},g.prototype.attribute_type=g.prototype.attribute_type=function(){return _e(this.ptr)},g.prototype.data_type=g.prototype.data_type=function(){return he(this.ptr)},g.prototype.num_components=g.prototype.num_components=function(){return de(this.ptr)},g.prototype.normalized=g.prototype.normalized=function(){return!!ye(this.ptr)},g.prototype.byte_stride=g.prototype.byte_stride=function(){return me(this.ptr)},g.prototype.byte_offset=g.prototype.byte_offset=function(){return ge(this.ptr)},g.prototype.unique_id=g.prototype.unique_id=function(){return be(this.ptr)},g.prototype.__destroy__=g.prototype.__destroy__=function(){Te(this.ptr)},b.prototype=Object.create(c.prototype),b.prototype.constructor=b,b.prototype.__class__=b,b.__cache__={},v.PointCloud=b,b.prototype.num_attributes=b.prototype.num_attributes=function(){return Ee(this.ptr)},b.prototype.num_points=b.prototype.num_points=function(){return xe(this.ptr)},b.prototype.__destroy__=b.prototype.__destroy__=function(){Ie(this.ptr)},T.prototype=Object.create(c.prototype),T.prototype.constructor=T,T.prototype.__class__=T,T.__cache__={},v.Mesh=T,T.prototype.num_faces=T.prototype.num_faces=function(){return Se(this.ptr)},T.prototype.num_attributes=T.prototype.num_attributes=function(){return Me(this.ptr)},T.prototype.num_points=T.prototype.num_points=function(){return Ne(this.ptr)},T.prototype.set_num_points=T.prototype.set_num_points=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),we(t,e)},T.prototype.__destroy__=T.prototype.__destroy__=function(){ve(this.ptr)},A.prototype=Object.create(c.prototype),A.prototype.constructor=A,A.prototype.__class__=A,A.__cache__={},v.Metadata=A,A.prototype.__destroy__=A.prototype.__destroy__=function(){Ce(this.ptr)},E.prototype=Object.create(c.prototype),E.prototype.constructor=E,E.prototype.__class__=E,E.__cache__={},v.DracoInt8Array=E,E.prototype.GetValue=E.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),je(t,e)},E.prototype.size=E.prototype.size=function(){return Pe(this.ptr)},E.prototype.__destroy__=E.prototype.__destroy__=function(){Fe(this.ptr)},x.prototype=Object.create(c.prototype),x.prototype.constructor=x,x.prototype.__class__=x,x.__cache__={},v.MetadataBuilder=x,x.prototype.AddStringEntry=x.prototype.AddStringEntry=function(e,t,r){var n=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:l(t),r=r&&"object"==typeof r?r.ptr:l(r),!!Le(n,e,t,r)},x.prototype.AddIntEntry=x.prototype.AddIntEntry=function(e,t,r){var n=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:l(t),r&&"object"==typeof r&&(r=r.ptr),!!Ge(n,e,t,r)},x.prototype.AddIntEntryArray=x.prototype.AddIntEntryArray=function(e,t,r,n){var s=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:l(t),"object"==typeof r&&(r=h(r)),n&&"object"==typeof n&&(n=n.ptr),!!Be(s,e,t,r,n)},x.prototype.AddDoubleEntry=x.prototype.AddDoubleEntry=function(e,t,r){var n=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:l(t),r&&"object"==typeof r&&(r=r.ptr),!!Ve(n,e,t,r)},x.prototype.__destroy__=x.prototype.__destroy__=function(){ke(this.ptr)},I.prototype=Object.create(c.prototype),I.prototype.constructor=I,I.prototype.__class__=I,I.__cache__={},v.PointCloudBuilder=I,I.prototype.AddFloatAttribute=I.prototype.AddFloatAttribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=d(s)),He(o,e,t,r,n,s)},I.prototype.AddInt8Attribute=I.prototype.AddInt8Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=f(s)),qe(o,e,t,r,n,s)},I.prototype.AddUInt8Attribute=I.prototype.AddUInt8Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=f(s)),$e(o,e,t,r,n,s)},I.prototype.AddInt16Attribute=I.prototype.AddInt16Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=_(s)),We(o,e,t,r,n,s)},I.prototype.AddUInt16Attribute=I.prototype.AddUInt16Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=_(s)),Xe(o,e,t,r,n,s)},I.prototype.AddInt32Attribute=I.prototype.AddInt32Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=h(s)),Ye(o,e,t,r,n,s)},I.prototype.AddUInt32Attribute=I.prototype.AddUInt32Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=h(s)),Qe(o,e,t,r,n,s)},I.prototype.AddMetadata=I.prototype.AddMetadata=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Ke(r,e,t)},I.prototype.SetMetadataForAttribute=I.prototype.SetMetadataForAttribute=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Je(n,e,t,r)},I.prototype.SetNormalizedFlagForAttribute=I.prototype.SetNormalizedFlagForAttribute=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Ze(n,e,t,r)},I.prototype.__destroy__=I.prototype.__destroy__=function(){et(this.ptr)},R.prototype=Object.create(c.prototype),R.prototype.constructor=R,R.prototype.__class__=R,R.__cache__={},v.MeshBuilder=R,R.prototype.AddFacesToMesh=R.prototype.AddFacesToMesh=function(e,t,r){var n=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),"object"==typeof r&&(r=h(r)),!!rt(n,e,t,r)},R.prototype.AddFloatAttributeToMesh=R.prototype.AddFloatAttributeToMesh=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=d(s)),nt(o,e,t,r,n,s)},R.prototype.AddInt32AttributeToMesh=R.prototype.AddInt32AttributeToMesh=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=h(s)),st(o,e,t,r,n,s)},R.prototype.AddMetadataToMesh=R.prototype.AddMetadataToMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!ot(r,e,t)},R.prototype.AddFloatAttribute=R.prototype.AddFloatAttribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=d(s)),it(o,e,t,r,n,s)},R.prototype.AddInt8Attribute=R.prototype.AddInt8Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=f(s)),at(o,e,t,r,n,s)},R.prototype.AddUInt8Attribute=R.prototype.AddUInt8Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=f(s)),ct(o,e,t,r,n,s)},R.prototype.AddInt16Attribute=R.prototype.AddInt16Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=_(s)),ut(o,e,t,r,n,s)},R.prototype.AddUInt16Attribute=R.prototype.AddUInt16Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=_(s)),pt(o,e,t,r,n,s)},R.prototype.AddInt32Attribute=R.prototype.AddInt32Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=h(s)),lt(o,e,t,r,n,s)},R.prototype.AddUInt32Attribute=R.prototype.AddUInt32Attribute=function(e,t,r,n,s){var o=this.ptr;return Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),"object"==typeof s&&(s=h(s)),ft(o,e,t,r,n,s)},R.prototype.AddMetadata=R.prototype.AddMetadata=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!_t(r,e,t)},R.prototype.SetMetadataForAttribute=R.prototype.SetMetadataForAttribute=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ht(n,e,t,r)},R.prototype.SetNormalizedFlagForAttribute=R.prototype.SetNormalizedFlagForAttribute=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!dt(n,e,t,r)},R.prototype.__destroy__=R.prototype.__destroy__=function(){yt(this.ptr)},S.prototype=Object.create(c.prototype),S.prototype.constructor=S,S.prototype.__class__=S,S.__cache__={},v.Encoder=S,S.prototype.SetEncodingMethod=S.prototype.SetEncodingMethod=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),gt(t,e)},S.prototype.SetAttributeQuantization=S.prototype.SetAttributeQuantization=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),bt(r,e,t)},S.prototype.SetAttributeExplicitQuantization=S.prototype.SetAttributeExplicitQuantization=function(e,t,r,n,s){var o=this.ptr;Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),"object"==typeof n&&(n=d(n)),s&&"object"==typeof s&&(s=s.ptr),Tt(o,e,t,r,n,s)},S.prototype.SetSpeedOptions=S.prototype.SetSpeedOptions=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),At(r,e,t)},S.prototype.SetTrackEncodedProperties=S.prototype.SetTrackEncodedProperties=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Et(t,e)},S.prototype.EncodeMeshToDracoBuffer=S.prototype.EncodeMeshToDracoBuffer=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),xt(r,e,t)},S.prototype.EncodePointCloudToDracoBuffer=S.prototype.EncodePointCloudToDracoBuffer=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),It(n,e,t,r)},S.prototype.GetNumberOfEncodedPoints=S.prototype.GetNumberOfEncodedPoints=function(){return Rt(this.ptr)},S.prototype.GetNumberOfEncodedFaces=S.prototype.GetNumberOfEncodedFaces=function(){return St(this.ptr)},S.prototype.__destroy__=S.prototype.__destroy__=function(){Mt(this.ptr)},M.prototype=Object.create(c.prototype),M.prototype.constructor=M,M.prototype.__class__=M,M.__cache__={},v.ExpertEncoder=M,M.prototype.SetEncodingMethod=M.prototype.SetEncodingMethod=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),wt(t,e)},M.prototype.SetAttributeQuantization=M.prototype.SetAttributeQuantization=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),vt(r,e,t)},M.prototype.SetAttributeExplicitQuantization=M.prototype.SetAttributeExplicitQuantization=function(e,t,r,n,s){var o=this.ptr;Kt.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),"object"==typeof n&&(n=d(n)),s&&"object"==typeof s&&(s=s.ptr),Ot(o,e,t,r,n,s)},M.prototype.SetSpeedOptions=M.prototype.SetSpeedOptions=function(e,t){var r=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Ct(r,e,t)},M.prototype.SetTrackEncodedProperties=M.prototype.SetTrackEncodedProperties=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Dt(t,e)},M.prototype.EncodeToDracoBuffer=M.prototype.EncodeToDracoBuffer=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),jt(r,e,t)},M.prototype.GetNumberOfEncodedPoints=M.prototype.GetNumberOfEncodedPoints=function(){return Pt(this.ptr)},M.prototype.GetNumberOfEncodedFaces=M.prototype.GetNumberOfEncodedFaces=function(){return Ft(this.ptr)},M.prototype.__destroy__=M.prototype.__destroy__=function(){Ut(this.ptr)},function(){function e(){v.INVALID=Lt(),v.POSITION=Gt(),v.NORMAL=Bt(),v.COLOR=Vt(),v.TEX_COORD=kt(),v.GENERIC=zt(),v.INVALID_GEOMETRY_TYPE=Ht(),v.POINT_CLOUD=qt(),v.TRIANGULAR_MESH=$t(),v.MESH_SEQUENTIAL_ENCODING=Wt(),v.MESH_EDGEBREAKER_ENCODING=Xt()}ne?e():te.unshift(e)}(),"function"==typeof v.onModuleParsed&&v.onModuleParsed(),e.ready});e.exports=n}(la)),la.exports}var ha,da,ya,ma={exports:{}},ga=ma.exports;function ba(){return ha||(ha=1,function(e){var t=t||{};t.scope={},t.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},t.arrayIterator=function(e){return{next:t.arrayIteratorImpl(e)}},t.makeIterator=function(e){var r="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return r?r.call(e):t.arrayIterator(e)},t.ASSUME_ES5=!1,t.ASSUME_NO_NATIVE_MAP=!1,t.ASSUME_NO_NATIVE_SET=!1,t.SIMPLE_FROUND_POLYFILL=!1,t.ISOLATE_POLYFILLS=!1,t.FORCE_POLYFILL_PROMISE=!1,t.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,t.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Hn&&Hn];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")},t.global=t.getGlobal(ga),t.defineProperty=t.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},t.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),t.TRUST_ES6_POLYFILLS=!t.ISOLATE_POLYFILLS||t.IS_SYMBOL_NATIVE,t.polyfills={},t.propertyToPolyfillSymbol={},t.POLYFILL_PREFIX="$jscp$",t.polyfill=function(e,r,n,s){r&&(t.ISOLATE_POLYFILLS?t.polyfillIsolated(e,r,n,s):t.polyfillUnisolated(e,r,n,s))},t.polyfillUnisolated=function(e,r,n,s){for(n=t.global,e=e.split("."),s=0;s<e.length-1;s++){var o=e[s];if(!(o in n))return;n=n[o]}(r=r(s=n[e=e[e.length-1]]))!=s&&null!=r&&t.defineProperty(n,e,{configurable:!0,writable:!0,value:r})},t.polyfillIsolated=function(e,r,n,s){var o=e.split(".");e=1===o.length,s=o[0],s=!e&&s in t.polyfills?t.polyfills:t.global;for(var i=0;i<o.length-1;i++){var a=o[i];if(!(a in s))return;s=s[a]}o=o[o.length-1],null!=(r=r(n=t.IS_SYMBOL_NATIVE&&"es6"===n?s[o]:null))&&(e?t.defineProperty(t.polyfills,o,{configurable:!0,writable:!0,value:r}):r!==n&&(void 0===t.propertyToPolyfillSymbol[o]&&(n=1e9*Math.random()>>>0,t.propertyToPolyfillSymbol[o]=t.IS_SYMBOL_NATIVE?t.global.Symbol(o):t.POLYFILL_PREFIX+n+"$"+o),t.defineProperty(s,t.propertyToPolyfillSymbol[o],{configurable:!0,writable:!0,value:r})))},t.polyfill("Promise",(function(e){function r(){this.batch_=null}function n(e){return e instanceof o?e:new o((function(t,r){t(e)}))}if(e&&(!(t.FORCE_POLYFILL_PROMISE||t.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&void 0===t.global.PromiseRejectionEvent)||!t.global.Promise||-1===t.global.Promise.toString().indexOf("[native code]")))return e;r.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var t=this;this.asyncExecuteFunction((function(){t.executeBatch_()}))}this.batch_.push(e)};var s=t.global.setTimeout;r.prototype.asyncExecuteFunction=function(e){s(e,0)},r.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},r.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var o=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[],this.isRejectionHandled_=!1;var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};o.prototype.createResolveAndReject_=function(){function e(e){return function(n){r||(r=!0,e.call(t,n))}}var t=this,r=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},o.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof o)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},o.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},o.prototype.reject_=function(e){this.settle_(2,e)},o.prototype.fulfill_=function(e){this.settle_(1,e)},o.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,2===this.state_&&this.scheduleUnhandledRejectionCheck_(),this.executeOnSettledCallbacks_()},o.prototype.scheduleUnhandledRejectionCheck_=function(){var e=this;s((function(){if(e.notifyUnhandledRejection_()){var r=t.global.console;void 0!==r&&r.error(e.result_)}}),1)},o.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var e=t.global.CustomEvent,r=t.global.Event,n=t.global.dispatchEvent;return void 0===n||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof r?e=new r("unhandledrejection",{cancelable:!0}):(e=t.global.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.result_,n(e))},o.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)i.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var i=new r;return o.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},o.prototype.settleSameAsThenable_=function(e,t){var r=this.createResolveAndReject_();try{e.call(t,r.resolve,r.reject)}catch(e){r.reject(e)}},o.prototype.then=function(e,t){function r(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(e){s(e)}}:t}var n,s,i=new o((function(e,t){n=e,s=t}));return this.callWhenSettled_(r(e,n),r(t,s)),i},o.prototype.catch=function(e){return this.then(void 0,e)},o.prototype.callWhenSettled_=function(e,t){function r(){switch(n.state_){case 1:e(n.result_);break;case 2:t(n.result_);break;default:throw Error("Unexpected state: "+n.state_)}}var n=this;null==this.onSettledCallbacks_?i.asyncExecute(r):this.onSettledCallbacks_.push(r),this.isRejectionHandled_=!0},o.resolve=n,o.reject=function(e){return new o((function(t,r){r(e)}))},o.race=function(e){return new o((function(r,s){for(var o=t.makeIterator(e),i=o.next();!i.done;i=o.next())n(i.value).callWhenSettled_(r,s)}))},o.all=function(e){var r=t.makeIterator(e),s=r.next();return s.done?n([]):new o((function(e,t){function o(t){return function(r){i[t]=r,0==--a&&e(i)}}var i=[],a=0;do{i.push(void 0),a++,n(s.value).callWhenSettled_(o(i.length-1),t),s=r.next()}while(!s.done)}))},o}),"es6","es3"),t.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.assign=t.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(e,r){for(var n=1;n<arguments.length;n++){var s=arguments[n];if(s)for(var o in s)t.owns(s,o)&&(e[o]=s[o])}return e},t.polyfill("Object.assign",(function(e){return e||t.assign}),"es6","es3"),t.checkStringArgs=function(e,t,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""},t.polyfill("String.prototype.startsWith",(function(e){return e||function(e,r){var n=t.checkStringArgs(this,e,"startsWith");e+="";var s=n.length,o=e.length;r=Math.max(0,Math.min(0|r,n.length));for(var i=0;i<o&&r<s;)if(n[r++]!=e[i++])return!1;return i>=o}}),"es6","es3"),t.polyfill("Array.prototype.copyWithin",(function(e){function t(e){return 1/0===(e=Number(e))||-1/0===e?e:0|e}return e||function(e,r,n){var s=this.length;if(e=t(e),r=t(r),n=void 0===n?s:t(n),e=0>e?Math.max(s+e,0):Math.min(e,s),r=0>r?Math.max(s+r,0):Math.min(r,s),n=0>n?Math.max(s+n,0):Math.min(n,s),e<r)for(;r<n;)r in this?this[e++]=this[r++]:(delete this[e++],r++);else for(e+=(n=Math.min(n,s+r-e))-r;n>r;)--n in this?this[--e]=this[n]:delete this[--e];return this}}),"es6","es3"),t.typedArrayCopyWithin=function(e){return e||Array.prototype.copyWithin},t.polyfill("Int8Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint8Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint8ClampedArray.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Int16Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint16Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Int32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Uint32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Float32Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5"),t.polyfill("Float64Array.prototype.copyWithin",t.typedArrayCopyWithin,"es6","es5");var r,n=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(r=r||__filename),function(e){function t(e,t){if(e){var r=Z,n=e+t;for(t=e;r[t]&&!(t>=n);)++t;if(16<t-e&&r.buffer&&ne)r=ne.decode(r.subarray(e,t));else{for(n="";e<t;){var s=r[e++];if(128&s){var o=63&r[e++];if(192==(224&s))n+=String.fromCharCode((31&s)<<6|o);else{var i=63&r[e++];65536>(s=224==(240&s)?(15&s)<<12|o<<6|i:(7&s)<<18|o<<12|i<<6|63&r[e++])?n+=String.fromCharCode(s):(s-=65536,n+=String.fromCharCode(55296|s>>10,56320|1023&s))}}else n+=String.fromCharCode(s)}r=n}}else r="";return r}function n(){var e=K.buffer;F.HEAP8=J=new Int8Array(e),F.HEAP16=new Int16Array(e),F.HEAP32=ee=new Int32Array(e),F.HEAPU8=Z=new Uint8Array(e),F.HEAPU16=new Uint16Array(e),F.HEAPU32=te=new Uint32Array(e),F.HEAPF32=new Float32Array(e),F.HEAPF64=new Float64Array(e)}function s(e){throw F.onAbort&&F.onAbort(e),Q(e="Aborted("+e+")"),re=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),P(e),e}function o(e){try{if(e==pe&&Y)return new Uint8Array(Y);if(W)return W(e);throw"both async and sync fetching of the wasm failed"}catch(e){s(e)}}function i(e){for(;0<e.length;)e.shift()(F)}function a(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){te[this.ptr+4>>2]=e},this.get_type=function(){return te[this.ptr+4>>2]},this.set_destructor=function(e){te[this.ptr+8>>2]=e},this.get_destructor=function(){return te[this.ptr+8>>2]},this.set_refcount=function(e){ee[this.ptr>>2]=e},this.set_caught=function(e){J[this.ptr+12|0]=e?1:0},this.get_caught=function(){return 0!=J[this.ptr+12|0]},this.set_rethrown=function(e){J[this.ptr+13|0]=e?1:0},this.get_rethrown=function(){return 0!=J[this.ptr+13|0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){ee[this.ptr>>2]+=1},this.release_ref=function(){var e=ee[this.ptr>>2];return ee[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){te[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return te[this.ptr+16>>2]},this.get_exception_ptr=function(){if(Xr(this.get_type()))return te[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function c(){function e(){if(!Wr&&(Wr=!0,F.calledRun=!0,!re)){if(ae=!0,i(oe),j(F),F.onRuntimeInitialized&&F.onRuntimeInitialized(),F.postRun)for("function"==typeof F.postRun&&(F.postRun=[F.postRun]);F.postRun.length;)ie.unshift(F.postRun.shift());i(ie)}}if(!(0<ce)){if(F.preRun)for("function"==typeof F.preRun&&(F.preRun=[F.preRun]);F.preRun.length;)se.unshift(F.preRun.shift());i(se),0<ce||(F.setStatus?(F.setStatus("Running..."),setTimeout((function(){setTimeout((function(){F.setStatus("")}),1),e()}),1)):e())}}function u(){}function p(e){return(e||u).__cache__}function l(e,t){var r=p(t),n=r[e];return n||((n=Object.create((t||u).prototype)).ptr=e,r[e]=n)}function f(e){if("string"==typeof e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);127>=n?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3}if(r=0,0<(n=(t=Array(t+1)).length)){n=r+n-1;for(var s=0;s<e.length;++s){var o=e.charCodeAt(s);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++s)),127>=o){if(r>=n)break;t[r++]=o}else{if(2047>=o){if(r+1>=n)break;t[r++]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;t[r++]=224|o>>12}else{if(r+3>=n)break;t[r++]=240|o>>18,t[r++]=128|o>>12&63}t[r++]=128|o>>6&63}t[r++]=128|63&o}}t[r]=0}return e=Yr.alloc(t,J),Yr.copy(t,J,e),e}return e}function _(e){if("object"==typeof e){var t=Yr.alloc(e,J);return Yr.copy(e,J,t),t}return e}function h(){throw"cannot construct a VoidPtr, no constructor in IDL"}function d(){this.ptr=_e(),p(d)[this.ptr]=this}function y(){this.ptr=ye(),p(y)[this.ptr]=this}function m(){this.ptr=be(),p(m)[this.ptr]=this}function g(){this.ptr=Ae(),p(g)[this.ptr]=this}function b(){this.ptr=Ce(),p(b)[this.ptr]=this}function T(){this.ptr=Le(),p(T)[this.ptr]=this}function A(){this.ptr=ke(),p(A)[this.ptr]=this}function E(){this.ptr=$e(),p(E)[this.ptr]=this}function x(){this.ptr=Ke(),p(x)[this.ptr]=this}function I(){throw"cannot construct a Status, no constructor in IDL"}function R(){this.ptr=nt(),p(R)[this.ptr]=this}function S(){this.ptr=at(),p(S)[this.ptr]=this}function M(){this.ptr=lt(),p(M)[this.ptr]=this}function N(){this.ptr=dt(),p(N)[this.ptr]=this}function w(){this.ptr=bt(),p(w)[this.ptr]=this}function v(){this.ptr=xt(),p(v)[this.ptr]=this}function O(){this.ptr=Mt(),p(O)[this.ptr]=this}function C(){this.ptr=Ot(),p(C)[this.ptr]=this}function D(){this.ptr=Bt(),p(D)[this.ptr]=this}var j,P,F=void 0!==(e=void 0===e?{}:e)?e:{};F.ready=new Promise((function(e,t){j=e,P=t}));var U=!1,L=!1;F.onRuntimeInitialized=function(){U=!0,L&&"function"==typeof F.onModuleLoaded&&F.onModuleLoaded(F)},F.onModuleParsed=function(){L=!0,U&&"function"==typeof F.onModuleLoaded&&F.onModuleLoaded(F)},F.isVersionSupported=function(e){return"string"==typeof e&&!(2>(e=e.split(".")).length||3<e.length)&&(1==e[0]&&0<=e[1]&&5>=e[1]||!(0!=e[0]||10<e[1]))};var G=Object.assign({},F),B="object"==typeof window,V="function"==typeof importScripts,k="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,z="";if(k){var H=require("fs"),q=require("path");z=V?q.dirname(z)+"/":__dirname+"/";var $=function(e,t){return e=e.startsWith("file://")?new URL(e):q.normalize(e),H.readFileSync(e,t?void 0:"utf8")},W=function(e){return(e=$(e,!0)).buffer||(e=new Uint8Array(e)),e},X=function(e,t,r){e=e.startsWith("file://")?new URL(e):q.normalize(e),H.readFile(e,(function(e,n){e?r(e):t(n.buffer)}))};1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),F.inspect=function(){return"[Emscripten Module object]"}}else(B||V)&&(V?z=self.location.href:"undefined"!=typeof document&&document.currentScript&&(z=document.currentScript.src),r&&(z=r),z=0!==z.indexOf("blob:")?z.substr(0,z.replace(/[?#].*/,"").lastIndexOf("/")+1):"",$=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},V&&(W=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),X=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});F.print||console.log.bind(console);var Y,Q=F.printErr||console.warn.bind(console);Object.assign(F,G),G=null,F.wasmBinary&&(Y=F.wasmBinary),"object"!=typeof WebAssembly&&s("no native wasm support detected");var K,J,Z,ee,te,re=!1,ne="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,se=[],oe=[],ie=[],ae=!1,ce=0,ue=null,pe="draco_decoder_gltf.wasm";pe.startsWith("data:application/octet-stream;base64,")||(pe=function(e){return F.locateFile?F.locateFile(e,z):z+e}(pe));var le={b:function(e,t,r){throw new a(e).init(t,r),e},a:function(){s("")},d:function(e,t,r){Z.copyWithin(e,t,t+r)},c:function(e){var t=Z.length;if(2147483648<(e>>>=0))return!1;for(var r=1;4>=r;r*=2){var s=t*(1+.2/r);s=Math.min(s,e+100663296);var o=Math;s=Math.max(e,s),o=o.min.call(o,2147483648,s+(65536-s%65536)%65536);e:{s=K.buffer;try{K.grow(o-s.byteLength+65535>>>16),n();var i=1;break e}catch(e){}i=void 0}if(i)return!0}return!1}};!function(){function e(e,t){F.asm=e.exports,K=F.asm.e,n(),oe.unshift(F.asm.f),ce--,F.monitorRunDependencies&&F.monitorRunDependencies(ce),0==ce&&ue&&(e=ue,ue=null,e())}function t(t){e(t.instance)}function r(e){return function(){if(!Y&&(B||V)){if("function"==typeof fetch&&!pe.startsWith("file://"))return fetch(pe,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+pe+"'";return e.arrayBuffer()})).catch((function(){return o(pe)}));if(X)return new Promise((function(e,t){X(pe,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return o(pe)}))}().then((function(e){return WebAssembly.instantiate(e,i)})).then((function(e){return e})).then(e,(function(e){Q("failed to asynchronously prepare wasm: "+e),s(e)}))}var i={a:le};if(ce++,F.monitorRunDependencies&&F.monitorRunDependencies(ce),F.instantiateWasm)try{return F.instantiateWasm(i,e)}catch(e){Q("Module.instantiateWasm callback failed with error: "+e),P(e)}(Y||"function"!=typeof WebAssembly.instantiateStreaming||pe.startsWith("data:application/octet-stream;base64,")||pe.startsWith("file://")||k||"function"!=typeof fetch?r(t):fetch(pe,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,i).then(t,(function(e){return Q("wasm streaming compile failed: "+e),Q("falling back to ArrayBuffer instantiation"),r(t)}))}))).catch(P)}();var fe=F._emscripten_bind_VoidPtr___destroy___0=function(){return(fe=F._emscripten_bind_VoidPtr___destroy___0=F.asm.h).apply(null,arguments)},_e=F._emscripten_bind_DecoderBuffer_DecoderBuffer_0=function(){return(_e=F._emscripten_bind_DecoderBuffer_DecoderBuffer_0=F.asm.i).apply(null,arguments)},he=F._emscripten_bind_DecoderBuffer_Init_2=function(){return(he=F._emscripten_bind_DecoderBuffer_Init_2=F.asm.j).apply(null,arguments)},de=F._emscripten_bind_DecoderBuffer___destroy___0=function(){return(de=F._emscripten_bind_DecoderBuffer___destroy___0=F.asm.k).apply(null,arguments)},ye=F._emscripten_bind_AttributeTransformData_AttributeTransformData_0=function(){return(ye=F._emscripten_bind_AttributeTransformData_AttributeTransformData_0=F.asm.l).apply(null,arguments)},me=F._emscripten_bind_AttributeTransformData_transform_type_0=function(){return(me=F._emscripten_bind_AttributeTransformData_transform_type_0=F.asm.m).apply(null,arguments)},ge=F._emscripten_bind_AttributeTransformData___destroy___0=function(){return(ge=F._emscripten_bind_AttributeTransformData___destroy___0=F.asm.n).apply(null,arguments)},be=F._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return(be=F._emscripten_bind_GeometryAttribute_GeometryAttribute_0=F.asm.o).apply(null,arguments)},Te=F._emscripten_bind_GeometryAttribute___destroy___0=function(){return(Te=F._emscripten_bind_GeometryAttribute___destroy___0=F.asm.p).apply(null,arguments)},Ae=F._emscripten_bind_PointAttribute_PointAttribute_0=function(){return(Ae=F._emscripten_bind_PointAttribute_PointAttribute_0=F.asm.q).apply(null,arguments)},Ee=F._emscripten_bind_PointAttribute_size_0=function(){return(Ee=F._emscripten_bind_PointAttribute_size_0=F.asm.r).apply(null,arguments)},xe=F._emscripten_bind_PointAttribute_GetAttributeTransformData_0=function(){return(xe=F._emscripten_bind_PointAttribute_GetAttributeTransformData_0=F.asm.s).apply(null,arguments)},Ie=F._emscripten_bind_PointAttribute_attribute_type_0=function(){return(Ie=F._emscripten_bind_PointAttribute_attribute_type_0=F.asm.t).apply(null,arguments)},Re=F._emscripten_bind_PointAttribute_data_type_0=function(){return(Re=F._emscripten_bind_PointAttribute_data_type_0=F.asm.u).apply(null,arguments)},Se=F._emscripten_bind_PointAttribute_num_components_0=function(){return(Se=F._emscripten_bind_PointAttribute_num_components_0=F.asm.v).apply(null,arguments)},Me=F._emscripten_bind_PointAttribute_normalized_0=function(){return(Me=F._emscripten_bind_PointAttribute_normalized_0=F.asm.w).apply(null,arguments)},Ne=F._emscripten_bind_PointAttribute_byte_stride_0=function(){return(Ne=F._emscripten_bind_PointAttribute_byte_stride_0=F.asm.x).apply(null,arguments)},we=F._emscripten_bind_PointAttribute_byte_offset_0=function(){return(we=F._emscripten_bind_PointAttribute_byte_offset_0=F.asm.y).apply(null,arguments)},ve=F._emscripten_bind_PointAttribute_unique_id_0=function(){return(ve=F._emscripten_bind_PointAttribute_unique_id_0=F.asm.z).apply(null,arguments)},Oe=F._emscripten_bind_PointAttribute___destroy___0=function(){return(Oe=F._emscripten_bind_PointAttribute___destroy___0=F.asm.A).apply(null,arguments)},Ce=F._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=function(){return(Ce=F._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=F.asm.B).apply(null,arguments)},De=F._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=function(){return(De=F._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=F.asm.C).apply(null,arguments)},je=F._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=function(){return(je=F._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=F.asm.D).apply(null,arguments)},Pe=F._emscripten_bind_AttributeQuantizationTransform_min_value_1=function(){return(Pe=F._emscripten_bind_AttributeQuantizationTransform_min_value_1=F.asm.E).apply(null,arguments)},Fe=F._emscripten_bind_AttributeQuantizationTransform_range_0=function(){return(Fe=F._emscripten_bind_AttributeQuantizationTransform_range_0=F.asm.F).apply(null,arguments)},Ue=F._emscripten_bind_AttributeQuantizationTransform___destroy___0=function(){return(Ue=F._emscripten_bind_AttributeQuantizationTransform___destroy___0=F.asm.G).apply(null,arguments)},Le=F._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=function(){return(Le=F._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=F.asm.H).apply(null,arguments)},Ge=F._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=function(){return(Ge=F._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=F.asm.I).apply(null,arguments)},Be=F._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=function(){return(Be=F._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=F.asm.J).apply(null,arguments)},Ve=F._emscripten_bind_AttributeOctahedronTransform___destroy___0=function(){return(Ve=F._emscripten_bind_AttributeOctahedronTransform___destroy___0=F.asm.K).apply(null,arguments)},ke=F._emscripten_bind_PointCloud_PointCloud_0=function(){return(ke=F._emscripten_bind_PointCloud_PointCloud_0=F.asm.L).apply(null,arguments)},ze=F._emscripten_bind_PointCloud_num_attributes_0=function(){return(ze=F._emscripten_bind_PointCloud_num_attributes_0=F.asm.M).apply(null,arguments)},He=F._emscripten_bind_PointCloud_num_points_0=function(){return(He=F._emscripten_bind_PointCloud_num_points_0=F.asm.N).apply(null,arguments)},qe=F._emscripten_bind_PointCloud___destroy___0=function(){return(qe=F._emscripten_bind_PointCloud___destroy___0=F.asm.O).apply(null,arguments)},$e=F._emscripten_bind_Mesh_Mesh_0=function(){return($e=F._emscripten_bind_Mesh_Mesh_0=F.asm.P).apply(null,arguments)},We=F._emscripten_bind_Mesh_num_faces_0=function(){return(We=F._emscripten_bind_Mesh_num_faces_0=F.asm.Q).apply(null,arguments)},Xe=F._emscripten_bind_Mesh_num_attributes_0=function(){return(Xe=F._emscripten_bind_Mesh_num_attributes_0=F.asm.R).apply(null,arguments)},Ye=F._emscripten_bind_Mesh_num_points_0=function(){return(Ye=F._emscripten_bind_Mesh_num_points_0=F.asm.S).apply(null,arguments)},Qe=F._emscripten_bind_Mesh___destroy___0=function(){return(Qe=F._emscripten_bind_Mesh___destroy___0=F.asm.T).apply(null,arguments)},Ke=F._emscripten_bind_Metadata_Metadata_0=function(){return(Ke=F._emscripten_bind_Metadata_Metadata_0=F.asm.U).apply(null,arguments)},Je=F._emscripten_bind_Metadata___destroy___0=function(){return(Je=F._emscripten_bind_Metadata___destroy___0=F.asm.V).apply(null,arguments)},Ze=F._emscripten_bind_Status_code_0=function(){return(Ze=F._emscripten_bind_Status_code_0=F.asm.W).apply(null,arguments)},et=F._emscripten_bind_Status_ok_0=function(){return(et=F._emscripten_bind_Status_ok_0=F.asm.X).apply(null,arguments)},tt=F._emscripten_bind_Status_error_msg_0=function(){return(tt=F._emscripten_bind_Status_error_msg_0=F.asm.Y).apply(null,arguments)},rt=F._emscripten_bind_Status___destroy___0=function(){return(rt=F._emscripten_bind_Status___destroy___0=F.asm.Z).apply(null,arguments)},nt=F._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=function(){return(nt=F._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=F.asm._).apply(null,arguments)},st=F._emscripten_bind_DracoFloat32Array_GetValue_1=function(){return(st=F._emscripten_bind_DracoFloat32Array_GetValue_1=F.asm.$).apply(null,arguments)},ot=F._emscripten_bind_DracoFloat32Array_size_0=function(){return(ot=F._emscripten_bind_DracoFloat32Array_size_0=F.asm.aa).apply(null,arguments)},it=F._emscripten_bind_DracoFloat32Array___destroy___0=function(){return(it=F._emscripten_bind_DracoFloat32Array___destroy___0=F.asm.ba).apply(null,arguments)},at=F._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return(at=F._emscripten_bind_DracoInt8Array_DracoInt8Array_0=F.asm.ca).apply(null,arguments)},ct=F._emscripten_bind_DracoInt8Array_GetValue_1=function(){return(ct=F._emscripten_bind_DracoInt8Array_GetValue_1=F.asm.da).apply(null,arguments)},ut=F._emscripten_bind_DracoInt8Array_size_0=function(){return(ut=F._emscripten_bind_DracoInt8Array_size_0=F.asm.ea).apply(null,arguments)},pt=F._emscripten_bind_DracoInt8Array___destroy___0=function(){return(pt=F._emscripten_bind_DracoInt8Array___destroy___0=F.asm.fa).apply(null,arguments)},lt=F._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=function(){return(lt=F._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=F.asm.ga).apply(null,arguments)},ft=F._emscripten_bind_DracoUInt8Array_GetValue_1=function(){return(ft=F._emscripten_bind_DracoUInt8Array_GetValue_1=F.asm.ha).apply(null,arguments)},_t=F._emscripten_bind_DracoUInt8Array_size_0=function(){return(_t=F._emscripten_bind_DracoUInt8Array_size_0=F.asm.ia).apply(null,arguments)},ht=F._emscripten_bind_DracoUInt8Array___destroy___0=function(){return(ht=F._emscripten_bind_DracoUInt8Array___destroy___0=F.asm.ja).apply(null,arguments)},dt=F._emscripten_bind_DracoInt16Array_DracoInt16Array_0=function(){return(dt=F._emscripten_bind_DracoInt16Array_DracoInt16Array_0=F.asm.ka).apply(null,arguments)},yt=F._emscripten_bind_DracoInt16Array_GetValue_1=function(){return(yt=F._emscripten_bind_DracoInt16Array_GetValue_1=F.asm.la).apply(null,arguments)},mt=F._emscripten_bind_DracoInt16Array_size_0=function(){return(mt=F._emscripten_bind_DracoInt16Array_size_0=F.asm.ma).apply(null,arguments)},gt=F._emscripten_bind_DracoInt16Array___destroy___0=function(){return(gt=F._emscripten_bind_DracoInt16Array___destroy___0=F.asm.na).apply(null,arguments)},bt=F._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=function(){return(bt=F._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=F.asm.oa).apply(null,arguments)},Tt=F._emscripten_bind_DracoUInt16Array_GetValue_1=function(){return(Tt=F._emscripten_bind_DracoUInt16Array_GetValue_1=F.asm.pa).apply(null,arguments)},At=F._emscripten_bind_DracoUInt16Array_size_0=function(){return(At=F._emscripten_bind_DracoUInt16Array_size_0=F.asm.qa).apply(null,arguments)},Et=F._emscripten_bind_DracoUInt16Array___destroy___0=function(){return(Et=F._emscripten_bind_DracoUInt16Array___destroy___0=F.asm.ra).apply(null,arguments)},xt=F._emscripten_bind_DracoInt32Array_DracoInt32Array_0=function(){return(xt=F._emscripten_bind_DracoInt32Array_DracoInt32Array_0=F.asm.sa).apply(null,arguments)},It=F._emscripten_bind_DracoInt32Array_GetValue_1=function(){return(It=F._emscripten_bind_DracoInt32Array_GetValue_1=F.asm.ta).apply(null,arguments)},Rt=F._emscripten_bind_DracoInt32Array_size_0=function(){return(Rt=F._emscripten_bind_DracoInt32Array_size_0=F.asm.ua).apply(null,arguments)},St=F._emscripten_bind_DracoInt32Array___destroy___0=function(){return(St=F._emscripten_bind_DracoInt32Array___destroy___0=F.asm.va).apply(null,arguments)},Mt=F._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=function(){return(Mt=F._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=F.asm.wa).apply(null,arguments)},Nt=F._emscripten_bind_DracoUInt32Array_GetValue_1=function(){return(Nt=F._emscripten_bind_DracoUInt32Array_GetValue_1=F.asm.xa).apply(null,arguments)},wt=F._emscripten_bind_DracoUInt32Array_size_0=function(){return(wt=F._emscripten_bind_DracoUInt32Array_size_0=F.asm.ya).apply(null,arguments)},vt=F._emscripten_bind_DracoUInt32Array___destroy___0=function(){return(vt=F._emscripten_bind_DracoUInt32Array___destroy___0=F.asm.za).apply(null,arguments)},Ot=F._emscripten_bind_MetadataQuerier_MetadataQuerier_0=function(){return(Ot=F._emscripten_bind_MetadataQuerier_MetadataQuerier_0=F.asm.Aa).apply(null,arguments)},Ct=F._emscripten_bind_MetadataQuerier_HasEntry_2=function(){return(Ct=F._emscripten_bind_MetadataQuerier_HasEntry_2=F.asm.Ba).apply(null,arguments)},Dt=F._emscripten_bind_MetadataQuerier_GetIntEntry_2=function(){return(Dt=F._emscripten_bind_MetadataQuerier_GetIntEntry_2=F.asm.Ca).apply(null,arguments)},jt=F._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=function(){return(jt=F._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=F.asm.Da).apply(null,arguments)},Pt=F._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=function(){return(Pt=F._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=F.asm.Ea).apply(null,arguments)},Ft=F._emscripten_bind_MetadataQuerier_GetStringEntry_2=function(){return(Ft=F._emscripten_bind_MetadataQuerier_GetStringEntry_2=F.asm.Fa).apply(null,arguments)},Ut=F._emscripten_bind_MetadataQuerier_NumEntries_1=function(){return(Ut=F._emscripten_bind_MetadataQuerier_NumEntries_1=F.asm.Ga).apply(null,arguments)},Lt=F._emscripten_bind_MetadataQuerier_GetEntryName_2=function(){return(Lt=F._emscripten_bind_MetadataQuerier_GetEntryName_2=F.asm.Ha).apply(null,arguments)},Gt=F._emscripten_bind_MetadataQuerier___destroy___0=function(){return(Gt=F._emscripten_bind_MetadataQuerier___destroy___0=F.asm.Ia).apply(null,arguments)},Bt=F._emscripten_bind_Decoder_Decoder_0=function(){return(Bt=F._emscripten_bind_Decoder_Decoder_0=F.asm.Ja).apply(null,arguments)},Vt=F._emscripten_bind_Decoder_DecodeArrayToPointCloud_3=function(){return(Vt=F._emscripten_bind_Decoder_DecodeArrayToPointCloud_3=F.asm.Ka).apply(null,arguments)},kt=F._emscripten_bind_Decoder_DecodeArrayToMesh_3=function(){return(kt=F._emscripten_bind_Decoder_DecodeArrayToMesh_3=F.asm.La).apply(null,arguments)},zt=F._emscripten_bind_Decoder_GetAttributeId_2=function(){return(zt=F._emscripten_bind_Decoder_GetAttributeId_2=F.asm.Ma).apply(null,arguments)},Ht=F._emscripten_bind_Decoder_GetAttributeIdByName_2=function(){return(Ht=F._emscripten_bind_Decoder_GetAttributeIdByName_2=F.asm.Na).apply(null,arguments)},qt=F._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=function(){return(qt=F._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=F.asm.Oa).apply(null,arguments)},$t=F._emscripten_bind_Decoder_GetAttribute_2=function(){return($t=F._emscripten_bind_Decoder_GetAttribute_2=F.asm.Pa).apply(null,arguments)},Wt=F._emscripten_bind_Decoder_GetAttributeByUniqueId_2=function(){return(Wt=F._emscripten_bind_Decoder_GetAttributeByUniqueId_2=F.asm.Qa).apply(null,arguments)},Xt=F._emscripten_bind_Decoder_GetMetadata_1=function(){return(Xt=F._emscripten_bind_Decoder_GetMetadata_1=F.asm.Ra).apply(null,arguments)},Yt=F._emscripten_bind_Decoder_GetAttributeMetadata_2=function(){return(Yt=F._emscripten_bind_Decoder_GetAttributeMetadata_2=F.asm.Sa).apply(null,arguments)},Qt=F._emscripten_bind_Decoder_GetFaceFromMesh_3=function(){return(Qt=F._emscripten_bind_Decoder_GetFaceFromMesh_3=F.asm.Ta).apply(null,arguments)},Kt=F._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=function(){return(Kt=F._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=F.asm.Ua).apply(null,arguments)},Jt=F._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=function(){return(Jt=F._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=F.asm.Va).apply(null,arguments)},Zt=F._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=function(){return(Zt=F._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=F.asm.Wa).apply(null,arguments)},er=F._emscripten_bind_Decoder_GetAttributeFloat_3=function(){return(er=F._emscripten_bind_Decoder_GetAttributeFloat_3=F.asm.Xa).apply(null,arguments)},tr=F._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=function(){return(tr=F._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=F.asm.Ya).apply(null,arguments)},rr=F._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=function(){return(rr=F._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=F.asm.Za).apply(null,arguments)},nr=F._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=function(){return(nr=F._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=F.asm._a).apply(null,arguments)},sr=F._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=function(){return(sr=F._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=F.asm.$a).apply(null,arguments)},or=F._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=function(){return(or=F._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=F.asm.ab).apply(null,arguments)},ir=F._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=function(){return(ir=F._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=F.asm.bb).apply(null,arguments)},ar=F._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=function(){return(ar=F._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=F.asm.cb).apply(null,arguments)},cr=F._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=function(){return(cr=F._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=F.asm.db).apply(null,arguments)},ur=F._emscripten_bind_Decoder_GetAttributeDataArrayForAllPoints_5=function(){return(ur=F._emscripten_bind_Decoder_GetAttributeDataArrayForAllPoints_5=F.asm.eb).apply(null,arguments)},pr=F._emscripten_bind_Decoder_SkipAttributeTransform_1=function(){return(pr=F._emscripten_bind_Decoder_SkipAttributeTransform_1=F.asm.fb).apply(null,arguments)},lr=F._emscripten_bind_Decoder_GetEncodedGeometryType_Deprecated_1=function(){return(lr=F._emscripten_bind_Decoder_GetEncodedGeometryType_Deprecated_1=F.asm.gb).apply(null,arguments)},fr=F._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=function(){return(fr=F._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=F.asm.hb).apply(null,arguments)},_r=F._emscripten_bind_Decoder_DecodeBufferToMesh_2=function(){return(_r=F._emscripten_bind_Decoder_DecodeBufferToMesh_2=F.asm.ib).apply(null,arguments)},hr=F._emscripten_bind_Decoder___destroy___0=function(){return(hr=F._emscripten_bind_Decoder___destroy___0=F.asm.jb).apply(null,arguments)},dr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=function(){return(dr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=F.asm.kb).apply(null,arguments)},yr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=function(){return(yr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=F.asm.lb).apply(null,arguments)},mr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=function(){return(mr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=F.asm.mb).apply(null,arguments)},gr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=function(){return(gr=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=F.asm.nb).apply(null,arguments)},br=F._emscripten_enum_draco_GeometryAttribute_Type_INVALID=function(){return(br=F._emscripten_enum_draco_GeometryAttribute_Type_INVALID=F.asm.ob).apply(null,arguments)},Tr=F._emscripten_enum_draco_GeometryAttribute_Type_POSITION=function(){return(Tr=F._emscripten_enum_draco_GeometryAttribute_Type_POSITION=F.asm.pb).apply(null,arguments)},Ar=F._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return(Ar=F._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=F.asm.qb).apply(null,arguments)},Er=F._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return(Er=F._emscripten_enum_draco_GeometryAttribute_Type_COLOR=F.asm.rb).apply(null,arguments)},xr=F._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return(xr=F._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=F.asm.sb).apply(null,arguments)},Ir=F._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return(Ir=F._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=F.asm.tb).apply(null,arguments)},Rr=F._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return(Rr=F._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=F.asm.ub).apply(null,arguments)},Sr=F._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return(Sr=F._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=F.asm.vb).apply(null,arguments)},Mr=F._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return(Mr=F._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=F.asm.wb).apply(null,arguments)},Nr=F._emscripten_enum_draco_DataType_DT_INVALID=function(){return(Nr=F._emscripten_enum_draco_DataType_DT_INVALID=F.asm.xb).apply(null,arguments)},wr=F._emscripten_enum_draco_DataType_DT_INT8=function(){return(wr=F._emscripten_enum_draco_DataType_DT_INT8=F.asm.yb).apply(null,arguments)},vr=F._emscripten_enum_draco_DataType_DT_UINT8=function(){return(vr=F._emscripten_enum_draco_DataType_DT_UINT8=F.asm.zb).apply(null,arguments)},Or=F._emscripten_enum_draco_DataType_DT_INT16=function(){return(Or=F._emscripten_enum_draco_DataType_DT_INT16=F.asm.Ab).apply(null,arguments)},Cr=F._emscripten_enum_draco_DataType_DT_UINT16=function(){return(Cr=F._emscripten_enum_draco_DataType_DT_UINT16=F.asm.Bb).apply(null,arguments)},Dr=F._emscripten_enum_draco_DataType_DT_INT32=function(){return(Dr=F._emscripten_enum_draco_DataType_DT_INT32=F.asm.Cb).apply(null,arguments)},jr=F._emscripten_enum_draco_DataType_DT_UINT32=function(){return(jr=F._emscripten_enum_draco_DataType_DT_UINT32=F.asm.Db).apply(null,arguments)},Pr=F._emscripten_enum_draco_DataType_DT_INT64=function(){return(Pr=F._emscripten_enum_draco_DataType_DT_INT64=F.asm.Eb).apply(null,arguments)},Fr=F._emscripten_enum_draco_DataType_DT_UINT64=function(){return(Fr=F._emscripten_enum_draco_DataType_DT_UINT64=F.asm.Fb).apply(null,arguments)},Ur=F._emscripten_enum_draco_DataType_DT_FLOAT32=function(){return(Ur=F._emscripten_enum_draco_DataType_DT_FLOAT32=F.asm.Gb).apply(null,arguments)},Lr=F._emscripten_enum_draco_DataType_DT_FLOAT64=function(){return(Lr=F._emscripten_enum_draco_DataType_DT_FLOAT64=F.asm.Hb).apply(null,arguments)},Gr=F._emscripten_enum_draco_DataType_DT_BOOL=function(){return(Gr=F._emscripten_enum_draco_DataType_DT_BOOL=F.asm.Ib).apply(null,arguments)},Br=F._emscripten_enum_draco_DataType_DT_TYPES_COUNT=function(){return(Br=F._emscripten_enum_draco_DataType_DT_TYPES_COUNT=F.asm.Jb).apply(null,arguments)},Vr=F._emscripten_enum_draco_StatusCode_OK=function(){return(Vr=F._emscripten_enum_draco_StatusCode_OK=F.asm.Kb).apply(null,arguments)},kr=F._emscripten_enum_draco_StatusCode_DRACO_ERROR=function(){return(kr=F._emscripten_enum_draco_StatusCode_DRACO_ERROR=F.asm.Lb).apply(null,arguments)},zr=F._emscripten_enum_draco_StatusCode_IO_ERROR=function(){return(zr=F._emscripten_enum_draco_StatusCode_IO_ERROR=F.asm.Mb).apply(null,arguments)},Hr=F._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=function(){return(Hr=F._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=F.asm.Nb).apply(null,arguments)},qr=F._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=function(){return(qr=F._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=F.asm.Ob).apply(null,arguments)},$r=F._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=function(){return($r=F._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=F.asm.Pb).apply(null,arguments)};F._malloc=function(){return(F._malloc=F.asm.Qb).apply(null,arguments)},F._free=function(){return(F._free=F.asm.Rb).apply(null,arguments)};var Wr,Xr=function(){return(Xr=F.asm.Sb).apply(null,arguments)};if(F.___start_em_js=11660,F.___stop_em_js=11758,ue=function e(){Wr||c(),Wr||(ue=e)},F.preInit)for("function"==typeof F.preInit&&(F.preInit=[F.preInit]);0<F.preInit.length;)F.preInit.pop()();c(),u.prototype=Object.create(u.prototype),u.prototype.constructor=u,u.prototype.__class__=u,u.__cache__={},F.WrapperObject=u,F.getCache=p,F.wrapPointer=l,F.castObject=function(e,t){return l(e.ptr,t)},F.NULL=l(0),F.destroy=function(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete p(e.__class__)[e.ptr]},F.compare=function(e,t){return e.ptr===t.ptr},F.getPointer=function(e){return e.ptr},F.getClass=function(e){return e.__class__};var Yr={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(Yr.needed){for(var e=0;e<Yr.temps.length;e++)F._free(Yr.temps[e]);Yr.temps.length=0,F._free(Yr.buffer),Yr.buffer=0,Yr.size+=Yr.needed,Yr.needed=0}Yr.buffer||(Yr.size+=128,Yr.buffer=F._malloc(Yr.size),Yr.buffer||s(void 0)),Yr.pos=0},alloc:function(e,t){return Yr.buffer||s(void 0),e=7+(e=e.length*t.BYTES_PER_ELEMENT)&-8,Yr.pos+e>=Yr.size?(0<e||s(void 0),Yr.needed+=e,t=F._malloc(e),Yr.temps.push(t)):(t=Yr.buffer+Yr.pos,Yr.pos+=e),t},copy:function(e,t,r){switch(r>>>=0,t.BYTES_PER_ELEMENT){case 2:r>>>=1;break;case 4:r>>>=2;break;case 8:r>>>=3}for(var n=0;n<e.length;n++)t[r+n]=e[n]}};return h.prototype=Object.create(u.prototype),h.prototype.constructor=h,h.prototype.__class__=h,h.__cache__={},F.VoidPtr=h,h.prototype.__destroy__=h.prototype.__destroy__=function(){fe(this.ptr)},d.prototype=Object.create(u.prototype),d.prototype.constructor=d,d.prototype.__class__=d,d.__cache__={},F.DecoderBuffer=d,d.prototype.Init=d.prototype.Init=function(e,t){var r=this.ptr;Yr.prepare(),"object"==typeof e&&(e=_(e)),t&&"object"==typeof t&&(t=t.ptr),he(r,e,t)},d.prototype.__destroy__=d.prototype.__destroy__=function(){de(this.ptr)},y.prototype=Object.create(u.prototype),y.prototype.constructor=y,y.prototype.__class__=y,y.__cache__={},F.AttributeTransformData=y,y.prototype.transform_type=y.prototype.transform_type=function(){return me(this.ptr)},y.prototype.__destroy__=y.prototype.__destroy__=function(){ge(this.ptr)},m.prototype=Object.create(u.prototype),m.prototype.constructor=m,m.prototype.__class__=m,m.__cache__={},F.GeometryAttribute=m,m.prototype.__destroy__=m.prototype.__destroy__=function(){Te(this.ptr)},g.prototype=Object.create(u.prototype),g.prototype.constructor=g,g.prototype.__class__=g,g.__cache__={},F.PointAttribute=g,g.prototype.size=g.prototype.size=function(){return Ee(this.ptr)},g.prototype.GetAttributeTransformData=g.prototype.GetAttributeTransformData=function(){return l(xe(this.ptr),y)},g.prototype.attribute_type=g.prototype.attribute_type=function(){return Ie(this.ptr)},g.prototype.data_type=g.prototype.data_type=function(){return Re(this.ptr)},g.prototype.num_components=g.prototype.num_components=function(){return Se(this.ptr)},g.prototype.normalized=g.prototype.normalized=function(){return!!Me(this.ptr)},g.prototype.byte_stride=g.prototype.byte_stride=function(){return Ne(this.ptr)},g.prototype.byte_offset=g.prototype.byte_offset=function(){return we(this.ptr)},g.prototype.unique_id=g.prototype.unique_id=function(){return ve(this.ptr)},g.prototype.__destroy__=g.prototype.__destroy__=function(){Oe(this.ptr)},b.prototype=Object.create(u.prototype),b.prototype.constructor=b,b.prototype.__class__=b,b.__cache__={},F.AttributeQuantizationTransform=b,b.prototype.InitFromAttribute=b.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!De(t,e)},b.prototype.quantization_bits=b.prototype.quantization_bits=function(){return je(this.ptr)},b.prototype.min_value=b.prototype.min_value=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Pe(t,e)},b.prototype.range=b.prototype.range=function(){return Fe(this.ptr)},b.prototype.__destroy__=b.prototype.__destroy__=function(){Ue(this.ptr)},T.prototype=Object.create(u.prototype),T.prototype.constructor=T,T.prototype.__class__=T,T.__cache__={},F.AttributeOctahedronTransform=T,T.prototype.InitFromAttribute=T.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!Ge(t,e)},T.prototype.quantization_bits=T.prototype.quantization_bits=function(){return Be(this.ptr)},T.prototype.__destroy__=T.prototype.__destroy__=function(){Ve(this.ptr)},A.prototype=Object.create(u.prototype),A.prototype.constructor=A,A.prototype.__class__=A,A.__cache__={},F.PointCloud=A,A.prototype.num_attributes=A.prototype.num_attributes=function(){return ze(this.ptr)},A.prototype.num_points=A.prototype.num_points=function(){return He(this.ptr)},A.prototype.__destroy__=A.prototype.__destroy__=function(){qe(this.ptr)},E.prototype=Object.create(u.prototype),E.prototype.constructor=E,E.prototype.__class__=E,E.__cache__={},F.Mesh=E,E.prototype.num_faces=E.prototype.num_faces=function(){return We(this.ptr)},E.prototype.num_attributes=E.prototype.num_attributes=function(){return Xe(this.ptr)},E.prototype.num_points=E.prototype.num_points=function(){return Ye(this.ptr)},E.prototype.__destroy__=E.prototype.__destroy__=function(){Qe(this.ptr)},x.prototype=Object.create(u.prototype),x.prototype.constructor=x,x.prototype.__class__=x,x.__cache__={},F.Metadata=x,x.prototype.__destroy__=x.prototype.__destroy__=function(){Je(this.ptr)},I.prototype=Object.create(u.prototype),I.prototype.constructor=I,I.prototype.__class__=I,I.__cache__={},F.Status=I,I.prototype.code=I.prototype.code=function(){return Ze(this.ptr)},I.prototype.ok=I.prototype.ok=function(){return!!et(this.ptr)},I.prototype.error_msg=I.prototype.error_msg=function(){return t(tt(this.ptr))},I.prototype.__destroy__=I.prototype.__destroy__=function(){rt(this.ptr)},R.prototype=Object.create(u.prototype),R.prototype.constructor=R,R.prototype.__class__=R,R.__cache__={},F.DracoFloat32Array=R,R.prototype.GetValue=R.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),st(t,e)},R.prototype.size=R.prototype.size=function(){return ot(this.ptr)},R.prototype.__destroy__=R.prototype.__destroy__=function(){it(this.ptr)},S.prototype=Object.create(u.prototype),S.prototype.constructor=S,S.prototype.__class__=S,S.__cache__={},F.DracoInt8Array=S,S.prototype.GetValue=S.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),ct(t,e)},S.prototype.size=S.prototype.size=function(){return ut(this.ptr)},S.prototype.__destroy__=S.prototype.__destroy__=function(){pt(this.ptr)},M.prototype=Object.create(u.prototype),M.prototype.constructor=M,M.prototype.__class__=M,M.__cache__={},F.DracoUInt8Array=M,M.prototype.GetValue=M.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),ft(t,e)},M.prototype.size=M.prototype.size=function(){return _t(this.ptr)},M.prototype.__destroy__=M.prototype.__destroy__=function(){ht(this.ptr)},N.prototype=Object.create(u.prototype),N.prototype.constructor=N,N.prototype.__class__=N,N.__cache__={},F.DracoInt16Array=N,N.prototype.GetValue=N.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),yt(t,e)},N.prototype.size=N.prototype.size=function(){return mt(this.ptr)},N.prototype.__destroy__=N.prototype.__destroy__=function(){gt(this.ptr)},w.prototype=Object.create(u.prototype),w.prototype.constructor=w,w.prototype.__class__=w,w.__cache__={},F.DracoUInt16Array=w,w.prototype.GetValue=w.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Tt(t,e)},w.prototype.size=w.prototype.size=function(){return At(this.ptr)},w.prototype.__destroy__=w.prototype.__destroy__=function(){Et(this.ptr)},v.prototype=Object.create(u.prototype),v.prototype.constructor=v,v.prototype.__class__=v,v.__cache__={},F.DracoInt32Array=v,v.prototype.GetValue=v.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),It(t,e)},v.prototype.size=v.prototype.size=function(){return Rt(this.ptr)},v.prototype.__destroy__=v.prototype.__destroy__=function(){St(this.ptr)},O.prototype=Object.create(u.prototype),O.prototype.constructor=O,O.prototype.__class__=O,O.__cache__={},F.DracoUInt32Array=O,O.prototype.GetValue=O.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Nt(t,e)},O.prototype.size=O.prototype.size=function(){return wt(this.ptr)},O.prototype.__destroy__=O.prototype.__destroy__=function(){vt(this.ptr)},C.prototype=Object.create(u.prototype),C.prototype.constructor=C,C.prototype.__class__=C,C.__cache__={},F.MetadataQuerier=C,C.prototype.HasEntry=C.prototype.HasEntry=function(e,t){var r=this.ptr;return Yr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:f(t),!!Ct(r,e,t)},C.prototype.GetIntEntry=C.prototype.GetIntEntry=function(e,t){var r=this.ptr;return Yr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:f(t),Dt(r,e,t)},C.prototype.GetIntEntryArray=C.prototype.GetIntEntryArray=function(e,t,r){var n=this.ptr;Yr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:f(t),r&&"object"==typeof r&&(r=r.ptr),jt(n,e,t,r)},C.prototype.GetDoubleEntry=C.prototype.GetDoubleEntry=function(e,t){var r=this.ptr;return Yr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:f(t),Pt(r,e,t)},C.prototype.GetStringEntry=C.prototype.GetStringEntry=function(e,r){var n=this.ptr;return Yr.prepare(),e&&"object"==typeof e&&(e=e.ptr),r=r&&"object"==typeof r?r.ptr:f(r),t(Ft(n,e,r))},C.prototype.NumEntries=C.prototype.NumEntries=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Ut(t,e)},C.prototype.GetEntryName=C.prototype.GetEntryName=function(e,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),t(Lt(n,e,r))},C.prototype.__destroy__=C.prototype.__destroy__=function(){Gt(this.ptr)},D.prototype=Object.create(u.prototype),D.prototype.constructor=D,D.prototype.__class__=D,D.__cache__={},F.Decoder=D,D.prototype.DecodeArrayToPointCloud=D.prototype.DecodeArrayToPointCloud=function(e,t,r){var n=this.ptr;return Yr.prepare(),"object"==typeof e&&(e=_(e)),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),l(Vt(n,e,t,r),I)},D.prototype.DecodeArrayToMesh=D.prototype.DecodeArrayToMesh=function(e,t,r){var n=this.ptr;return Yr.prepare(),"object"==typeof e&&(e=_(e)),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),l(kt(n,e,t,r),I)},D.prototype.GetAttributeId=D.prototype.GetAttributeId=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),zt(r,e,t)},D.prototype.GetAttributeIdByName=D.prototype.GetAttributeIdByName=function(e,t){var r=this.ptr;return Yr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:f(t),Ht(r,e,t)},D.prototype.GetAttributeIdByMetadataEntry=D.prototype.GetAttributeIdByMetadataEntry=function(e,t,r){var n=this.ptr;return Yr.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:f(t),r=r&&"object"==typeof r?r.ptr:f(r),qt(n,e,t,r)},D.prototype.GetAttribute=D.prototype.GetAttribute=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),l($t(r,e,t),g)},D.prototype.GetAttributeByUniqueId=D.prototype.GetAttributeByUniqueId=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),l(Wt(r,e,t),g)},D.prototype.GetMetadata=D.prototype.GetMetadata=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),l(Xt(t,e),x)},D.prototype.GetAttributeMetadata=D.prototype.GetAttributeMetadata=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),l(Yt(r,e,t),x)},D.prototype.GetFaceFromMesh=D.prototype.GetFaceFromMesh=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Qt(n,e,t,r)},D.prototype.GetTriangleStripsFromMesh=D.prototype.GetTriangleStripsFromMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Kt(r,e,t)},D.prototype.GetTrianglesUInt16Array=D.prototype.GetTrianglesUInt16Array=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Jt(n,e,t,r)},D.prototype.GetTrianglesUInt32Array=D.prototype.GetTrianglesUInt32Array=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Zt(n,e,t,r)},D.prototype.GetAttributeFloat=D.prototype.GetAttributeFloat=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!er(n,e,t,r)},D.prototype.GetAttributeFloatForAllPoints=D.prototype.GetAttributeFloatForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!tr(n,e,t,r)},D.prototype.GetAttributeIntForAllPoints=D.prototype.GetAttributeIntForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!rr(n,e,t,r)},D.prototype.GetAttributeInt8ForAllPoints=D.prototype.GetAttributeInt8ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!nr(n,e,t,r)},D.prototype.GetAttributeUInt8ForAllPoints=D.prototype.GetAttributeUInt8ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!sr(n,e,t,r)},D.prototype.GetAttributeInt16ForAllPoints=D.prototype.GetAttributeInt16ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!or(n,e,t,r)},D.prototype.GetAttributeUInt16ForAllPoints=D.prototype.GetAttributeUInt16ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ir(n,e,t,r)},D.prototype.GetAttributeInt32ForAllPoints=D.prototype.GetAttributeInt32ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ar(n,e,t,r)},D.prototype.GetAttributeUInt32ForAllPoints=D.prototype.GetAttributeUInt32ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!cr(n,e,t,r)},D.prototype.GetAttributeDataArrayForAllPoints=D.prototype.GetAttributeDataArrayForAllPoints=function(e,t,r,n,s){var o=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),s&&"object"==typeof s&&(s=s.ptr),!!ur(o,e,t,r,n,s)},D.prototype.SkipAttributeTransform=D.prototype.SkipAttributeTransform=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),pr(t,e)},D.prototype.GetEncodedGeometryType_Deprecated=D.prototype.GetEncodedGeometryType_Deprecated=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),lr(t,e)},D.prototype.DecodeBufferToPointCloud=D.prototype.DecodeBufferToPointCloud=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),l(fr(r,e,t),I)},D.prototype.DecodeBufferToMesh=D.prototype.DecodeBufferToMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),l(_r(r,e,t),I)},D.prototype.__destroy__=D.prototype.__destroy__=function(){hr(this.ptr)},function(){function e(){F.ATTRIBUTE_INVALID_TRANSFORM=dr(),F.ATTRIBUTE_NO_TRANSFORM=yr(),F.ATTRIBUTE_QUANTIZATION_TRANSFORM=mr(),F.ATTRIBUTE_OCTAHEDRON_TRANSFORM=gr(),F.INVALID=br(),F.POSITION=Tr(),F.NORMAL=Ar(),F.COLOR=Er(),F.TEX_COORD=xr(),F.GENERIC=Ir(),F.INVALID_GEOMETRY_TYPE=Rr(),F.POINT_CLOUD=Sr(),F.TRIANGULAR_MESH=Mr(),F.DT_INVALID=Nr(),F.DT_INT8=wr(),F.DT_UINT8=vr(),F.DT_INT16=Or(),F.DT_UINT16=Cr(),F.DT_INT32=Dr(),F.DT_UINT32=jr(),F.DT_INT64=Pr(),F.DT_UINT64=Fr(),F.DT_FLOAT32=Ur(),F.DT_FLOAT64=Lr(),F.DT_BOOL=Gr(),F.DT_TYPES_COUNT=Br(),F.OK=Vr(),F.DRACO_ERROR=kr(),F.IO_ERROR=zr(),F.INVALID_PARAMETER=Hr(),F.UNSUPPORTED_VERSION=qr(),F.UNKNOWN_VERSION=$r()}ae?e():oe.unshift(e)}(),"function"==typeof F.onModuleParsed&&F.onModuleParsed(),F.Decoder.prototype.GetEncodedGeometryType=function(e){if(e.__class__&&e.__class__===F.DecoderBuffer)return F.Decoder.prototype.GetEncodedGeometryType_Deprecated(e);if(8>e.byteLength)return F.INVALID_GEOMETRY_TYPE;switch(e[7]){case 0:return F.POINT_CLOUD;case 1:return F.TRIANGULAR_MESH;default:return F.INVALID_GEOMETRY_TYPE}},e.ready});e.exports=n}(ma)),ma.exports}var Ta=function(){if(ya)return da;ya=1;var e=_a(),t=ba();return da={createEncoderModule:e,createDecoderModule:t}}();let Aa=null;async function Ea(e,t,r){let n=await new Promise((e=>{if(Aa)return e(Aa);const t=document.createElement("script");t.src="./basis/encoder/basis_encoder.js",t.onload=()=>{BASIS({onRuntimeInitialized:()=>{}}).then((t=>{Aa=t,e(Aa),t.initializeBasis?(t.initializeBasis(),console.log("module.initializeBasis() called successfully.")):console.error("module.initializeBasis() is not available on the Module object.")}))},t.onerror=()=>{console.error("Failed to load the Basis module.")},document.head.appendChild(t)})),{BasisEncoder:s}=n,o=new s;const i=n.basis_tex_format.cUASTC4x4.value;o.setFormatMode(i),o.setUASTC(!0),o.setCreateKTX2File(!0),o.setKTX2UASTCSupercompression(!0);let a=n.ldr_image_type.cPNGImage.value;"image/jpeg"!==t&&"image/jpg"!==t&&"jfif"!==t||(a=n.ldr_image_type.cJPGImage.value),o.setSliceSourceImage(0,e,0,0,a),o.setPackUASTCFlags(0),o.setKTX2SRGBTransferFunc(r),o.setPerceptual(r),o.setMipGen(!0),o.setMipSRGB(r);const c=new Uint8Array(536870912);try{const e=o.encode(c);return 0===e?null:c.slice(0,e)}catch(e){return null}finally{o.delete()}}const xa={maxSize:2048,hasJoin:!0,hasPalette:!0,hasFlatten:!0,hasKtx2:!0};async function Ia(e,t=xa){const r=(new Ve).registerExtensions(Un).registerDependencies({"draco3d.decoder":await Ta.createDecoderModule(),"draco3d.encoder":await Ta.createEncoderModule()});let{maxSize:n=2048,hasJoin:s,hasPalette:o,hasFlatten:i,hasKtx2:a}=t;const c=new Uint8Array(e),u=await r.readBinary(c);if(u.getRoot().listMaterials().some((e=>!!e.getExtension("KHR_materials_pbrSpecularGlossiness")))){await u.transform(Ns(wi,(async e=>{const t=e.getLogger();if(!e.getRoot().listExtensionsUsed().map((e=>e.extensionName)).includes("KHR_materials_pbrSpecularGlossiness"))return void t.warn(`${wi}: KHR_materials_pbrSpecularGlossiness not found on document.`);const r=e.createExtension(jr),n=e.createExtension(an),s=e.createExtension($r),o=new Set;for(const t of e.getRoot().listMaterials()){const s=t.getExtension("KHR_materials_pbrSpecularGlossiness");if(!s)continue;const i=n.createSpecular().setSpecularFactor(1).setSpecularColorFactor(s.getSpecularFactor());o.add(s.getSpecularGlossinessTexture()),o.add(t.getBaseColorTexture()),o.add(t.getMetallicRoughnessTexture()),t.setBaseColorFactor(s.getDiffuseFactor()).setMetallicFactor(0).setRoughnessFactor(1).setExtension("KHR_materials_ior",r.createIOR().setIOR(1e3)).setExtension("KHR_materials_specular",i);const a=s.getDiffuseTexture();a&&(t.setBaseColorTexture(a),t.getBaseColorTextureInfo().copy(s.getDiffuseTextureInfo()));const c=s.getSpecularGlossinessTexture();if(c){const r=s.getSpecularGlossinessTextureInfo(),n=e.createTexture();await vs(c,n,((e,t,r)=>{e.set(t,r,3,255)})),i.setSpecularTexture(n),i.setSpecularColorTexture(n),i.getSpecularTextureInfo().copy(r),i.getSpecularColorTextureInfo().copy(r);const o=s.getGlossinessFactor(),a=e.createTexture();await vs(c,a,((e,t,r)=>{const n=255-Math.round(e.get(t,r,3)*o);e.set(t,r,0,0),e.set(t,r,1,n),e.set(t,r,2,0),e.set(t,r,3,255)})),t.setMetallicRoughnessTexture(a),t.getMetallicRoughnessTextureInfo().copy(r)}else i.setSpecularColorFactor(s.getSpecularFactor()),t.setRoughnessFactor(1-s.getGlossinessFactor());t.setExtension("KHR_materials_pbrSpecularGlossiness",null)}s.dispose();for(const e of o)e&&1===e.listParents().length&&e.dispose();t.debug(`${wi}: Complete.`)}))),u.getRoot().listMaterials().forEach((e=>{const t=e.getExtension("KHR_materials_ior");t?.setIOR(1.5)}));const e=["KHR_materials_ior","KHR_materials_specular"];for(const t of u.getRoot().listExtensionsUsed())e.includes(t.extensionName)&&t.dispose();u.transform(go())}let p=[];p.push(io()),o&&p.push(function(e=Oi){const t=ws(Oi,e),r=Math.max(t.blockSize,1),n=Math.max(t.min,1);return Ns(vi,(async e=>{const s=e.getLogger(),o=e.getRoot();t.keepAttributes||await e.transform(go({propertyTypes:[f.ACCESSOR],keepAttributes:!1,keepIndices:!0,keepLeaves:!0}));const i=new Set,a=new Set;for(const e of o.listMeshes())for(const t of e.listPrimitives()){const e=t.getMaterial();e&&!t.getAttribute("TEXCOORD_0")&&(i.add(t),a.add(e))}const c=new Set,u=new Map,p={baseColor:new Set,emissive:new Set,metallicRoughness:new Set};for(const e of a){const t=Di(e.getBaseColorFactor().slice()),r=Di([...e.getEmissiveFactor(),1]),n=Ci(e.getRoughnessFactor()),s=Ci(e.getMetallicFactor()),o=`baseColor:${t},emissive:${r},metallicRoughness:${s}${n}`;p.baseColor.add(t),p.emissive.add(r),p.metallicRoughness.add(s+"+"+n),c.add(o),u.set(e,o)}const l=c.size;if(l<n)return void s.debug(`${vi}: Found <${n} unique material properties. Exiting.`);const _=ji(l*r),h=ji(r),d=_-l*r,y={baseColor:null,emissive:null,metallicRoughness:null},m=new Set(["name","extras"]),g=(...e)=>e.forEach((e=>m.add(e)));let b=null,T=null,A=null;if(p.baseColor.size>=n){const t="PaletteBaseColor";b=e.createTexture(t).setURI(`${t}.png`),y.baseColor=ns(new Uint8Array(_*h*4),[_,h,4]),g("baseColorFactor","baseColorTexture","baseColorTextureInfo")}if(p.emissive.size>=n){const t="PaletteEmissive";T=e.createTexture(t).setURI(`${t}.png`),y.emissive=ns(new Uint8Array(_*h*4),[_,h,4]),g("emissiveFactor","emissiveTexture","emissiveTextureInfo")}if(p.metallicRoughness.size>=n){const t="PaletteMetallicRoughness";A=e.createTexture(t).setURI(`${t}.png`),y.metallicRoughness=ns(new Uint8Array(_*h*4),[_,h,4]),g("metallicFactor","roughnessFactor","metallicRoughnessTexture","metallicRoughnessTextureInfo")}if(!(b||T||A))return void s.debug(`${vi}: No material property has >=${n} unique values. Exiting.`);const E=new Set,x=new Map,I=[];let R=0;for(const e of a){const t=u.get(e);if(E.has(t))continue;const n=R++;if(y.baseColor){const t=y.baseColor,s=[...e.getBaseColorFactor()];N.convertLinearToSRGB(s,s),Pi(t,n,s,r)}if(y.emissive){const t=y.emissive,s=[...e.getEmissiveFactor(),1];N.convertLinearToSRGB(s,s),Pi(t,n,s,r)}if(y.metallicRoughness){const t=y.metallicRoughness,s=e.getMetallicFactor();Pi(t,n,[0,e.getRoughnessFactor(),s,1],r)}E.add(t),x.set(t,n)}const S="image/png";if(b){const e=await _s(y.baseColor,S);b.setImage(e).setMimeType(S)}if(T){const e=await _s(y.emissive,S);T.setImage(e).setMimeType(S)}if(A){const e=await _s(y.metallicRoughness,S);A.setImage(e).setMimeType(S)}let M=1;for(const t of i){const r=t.getMaterial(),n=u.get(r),s=(x.get(n)+.5)/l*(_-d)/_,o=t.getAttribute("POSITION"),i=o.getBuffer(),a=new Float32Array(2*o.getCount()).fill(s),c=e.createAccessor().setType("VEC2").setArray(a).setBuffer(i);let p;for(const e of I)e.equals(r,m)&&(p=e);if(!p){const e=(M++).toString().padStart(3,"0");p=r.clone().setName(`PaletteMaterial${e}`),b&&p.setBaseColorFactor([1,1,1,1]).setBaseColorTexture(b).getBaseColorTextureInfo().setMinFilter(ae.MinFilter.NEAREST).setMagFilter(ae.MagFilter.NEAREST),T&&p.setEmissiveFactor([1,1,1]).setEmissiveTexture(T).getEmissiveTextureInfo().setMinFilter(ae.MinFilter.NEAREST).setMagFilter(ae.MagFilter.NEAREST),A&&p.setMetallicFactor(1).setRoughnessFactor(1).setMetallicRoughnessTexture(A).getMetallicRoughnessTextureInfo().setMinFilter(ae.MinFilter.NEAREST).setMagFilter(ae.MagFilter.NEAREST),I.push(p)}t.setMaterial(p).setAttribute("TEXCOORD_0",c)}t.cleanup&&await e.transform(go({propertyTypes:[f.MATERIAL]})),s.debug(`${vi}: Complete.`)}))}({min:5})),s&&p.push(function(e=Ai){const t=ws(Ai,e);return Ns(hi,(async e=>{const r=e.getRoot(),n=e.getLogger();for(const n of r.listScenes())Ei(e,n,t),n.traverse((r=>Ei(e,r,t)));t.cleanup&&await e.transform(go({propertyTypes:[yi,mi,gi,bi],keepAttributes:!0,keepIndices:!0,keepLeaves:!1})),n.debug(`${hi}: Complete.`)}))}()),i&&p.push(function(e=si){const t=ws(si,e);return Ns(ni,(async e=>{const r=e.getRoot(),n=e.getLogger(),s=new Set;for(const e of r.listSkins())for(const t of e.listJoints())s.add(t);const o=new Set;for(const e of r.listAnimations())for(const t of e.listChannels()){const e=t.getTargetNode();e&&"weights"!==t.getTargetPath()&&o.add(e)}const i=new Set,a=new Set;for(const e of r.listScenes())e.traverse((e=>{const t=e.getParentNode();t&&((s.has(t)||i.has(t))&&i.add(e),(o.has(t)||a.has(t))&&a.add(e))}));for(const e of r.listScenes())e.traverse((e=>{o.has(e)||i.has(e)||a.has(e)||Ys(e)}));o.size&&n.debug(`${ni}: Flattening node hierarchies with TRS animation not yet supported.`),t.cleanup&&await e.transform(go({propertyTypes:[f.NODE],keepLeaves:!1})),n.debug(`${ni}: Complete.`)}))}()),p.push(Lo()),p.push(function(e=$i){const t=ws($i,e);return Ns(Hi,(async e=>{const r=new Set,n=e.getRoot().listAccessors().length,s=e.getLogger(),o=t.ready,i=t.resample;await o;for(const n of e.getRoot().listAnimations()){const e=new Map;for(const t of n.listChannels())e.set(t.getSampler(),t.getTargetPath());for(const s of n.listSamplers()){const n=s.getInterpolation();if("STEP"===n||"LINEAR"===n){const o=s.getInput(),a=s.getOutput();r.add(o),r.add(a);const c=Wi(o.getArray(),o.getComponentType(),o.getNormalized()),u=Wi(a.getArray(),a.getComponentType(),a.getNormalized()),p=u.length/c.length,l=c.length;let f;if(f="STEP"===n?i(c,u,"step",t.tolerance):"rotation"===e.get(s)?i(c,u,"slerp",t.tolerance):i(c,u,"lerp",t.tolerance),f<l){const e=o.getArray(),t=a.getArray(),r=Xi(new Float32Array(c.buffer,c.byteOffset,f),o.getComponentType(),o.getNormalized()),n=Xi(new Float32Array(u.buffer,u.byteOffset,f*p),a.getComponentType(),a.getNormalized());o.setArray(qi),a.setArray(qi),s.setInput(o.clone().setArray(r)),s.setOutput(a.clone().setArray(n)),o.setArray(e),a.setArray(t)}}}}for(const e of Array.from(r.values()))e.listParents().some((e=>!(e instanceof Ae)))||e.dispose();e.getRoot().listAccessors().length>n&&t.cleanup&&await e.transform(io({propertyTypes:[f.ACCESSOR]})),s.debug(`${Hi}: Complete.`)}))}()),p.push(go()),p.push(function(e=na){const t=ws(na,e).ratio;if(t<0||t>1)throw new Error(`${ra}: Ratio must be between 0 and 1.`);return Ns(ra,(e=>{const r=e.getRoot(),n=e.getLogger();let s=0;for(const e of r.listAccessors()){const r=e.getCount(),n=Array(e.getElementSize()).fill(0),o=Array(e.getElementSize()).fill(0);let i=0;for(let s=0;s<r&&(e.getElement(s,o),L.eq(o,n,0)||i++,!(i/r>=t));s++);const a=i/r<t;a!==e.getSparse()&&(e.setSparse(a),s++)}n.debug(`${ra}: Updated ${s} accessors.`),n.debug(`${ra}: Complete.`)}))}({ratio:.2})),p.push(function(e=ri){const t=ws(ri,e);return Ns("draco",(async e=>{await e.transform(Lo()),e.createExtension(rr).setRequired(!0).setEncoderOptions({method:"edgebreaker"===t.method?rr.EncoderMethod.EDGEBREAKER:rr.EncoderMethod.SEQUENTIAL,encodeSpeed:t.encodeSpeed,decodeSpeed:t.decodeSpeed,quantizationBits:{POSITION:t.quantizePosition,NORMAL:t.quantizeNormal,COLOR:t.quantizeColor,TEX_COORD:t.quantizeTexcoord,GENERIC:t.quantizeGeneric},quantizationVolume:t.quantizationVolume})}))}({method:"edgebreaker",quantizePosition:24,quantizeNormal:10,quantizeColor:8,quantizeTexcoord:12,quantizeGeneric:8,quantizationVolume:"mesh"})),await u.transform(...p);let l=!1,_=u.getRoot().listTextures();console.time("transformTexture");for(var h=0;h<_.length;h++){let e=_[h],t=e.getSize();console.time("one texture transformTexture"),t&&n&&(t[0]>n||t[1]>n)&&await aa(e,{resize:[n,n]});let r=e.getMimeType();if(a&&"image/ktx2"!==r){let t=e.getImage(),n=e.getSize();if(n)if(n[0]*n[1]<6e6){let n=await Ea(t,r,!0);n&&(l=!0,e.setImage(n).setMimeType("image/ktx2").setURI(`${e.getName()}.ktx2`))}else console.warn("texture size limited 6 megapixels")}console.timeEnd("one texture transformTexture"),console.info("----textures compress progress:",`${h+1}/${_.length}`)}console.timeEnd("transformTexture"),l&&u.createExtension(Nn).setRequired(!0);return await r.writeBinary(u)}export{Ia as gltfOptimization,Ea as toKTX2UASTC};
